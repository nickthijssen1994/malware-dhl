.class final Lcom/jd/hybrid/downloader/f$a;
.super Ljava/lang/Object;

# interfaces
.implements Ljava/lang/Comparable;
.implements Ljava/lang/Runnable;


# annotations
.annotation system Ldalvik/annotation/EnclosingClass;
    value = Lcom/jd/hybrid/downloader/f;
.end annotation

.annotation system Ldalvik/annotation/InnerClass;
    accessFlags = 0x0
    name = "a"
.end annotation

.annotation system Ldalvik/annotation/Signature;
    value = {
        "Ljava/lang/Object;",
        "Ljava/lang/Comparable<",
        "Lcom/jd/hybrid/downloader/f$a;",
        ">;",
        "Ljava/lang/Runnable;"
    }
.end annotation


# instance fields
.field final synthetic a:Lcom/jd/hybrid/downloader/f;

.field private final b:Lcom/jd/framework/network/request/JDFileRequest;

.field private final c:I


# direct methods
.method public constructor <init>(Lcom/jd/hybrid/downloader/f;Lcom/jd/framework/network/request/JDFileRequest;I)V
    .registers 4

    iput-object p1, p0, Lcom/jd/hybrid/downloader/f$a;->a:Lcom/jd/hybrid/downloader/f;

    invoke-direct {p0}, Ljava/lang/Object;-><init>()V

    iput-object p2, p0, Lcom/jd/hybrid/downloader/f$a;->b:Lcom/jd/framework/network/request/JDFileRequest;

    iput p3, p0, Lcom/jd/hybrid/downloader/f$a;->c:I

    return-void
.end method


# virtual methods
.method public final bridge synthetic compareTo(Ljava/lang/Object;)I
    .registers 3

    check-cast p1, Lcom/jd/hybrid/downloader/f$a;

    iget p1, p1, Lcom/jd/hybrid/downloader/f$a;->c:I

    iget v0, p0, Lcom/jd/hybrid/downloader/f$a;->c:I

    sub-int/2addr p1, v0

    return p1
.end method

.method public final run()V
    .registers 15

    iget-object v0, p0, Lcom/jd/hybrid/downloader/f$a;->a:Lcom/jd/hybrid/downloader/f;

    invoke-static {v0}, Lcom/jd/hybrid/downloader/f;->c(Lcom/jd/hybrid/downloader/f;)Ljava/util/concurrent/ConcurrentLinkedQueue;

    move-result-object v0

    invoke-virtual {p0}, Ljava/lang/Object;->hashCode()I

    move-result v1

    invoke-static {v1}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;

    move-result-object v1

    invoke-virtual {v0, v1}, Ljava/util/concurrent/ConcurrentLinkedQueue;->remove(Ljava/lang/Object;)Z

    iget-object v0, p0, Lcom/jd/hybrid/downloader/f$a;->a:Lcom/jd/hybrid/downloader/f;

    invoke-static {v0}, Lcom/jd/hybrid/downloader/f;->b(Lcom/jd/hybrid/downloader/f;)Ljava/lang/Object;

    move-result-object v0

    monitor-enter v0

    :goto_18
    :try_start_18
    iget-object v1, p0, Lcom/jd/hybrid/downloader/f$a;->a:Lcom/jd/hybrid/downloader/f;

    invoke-static {v1}, Lcom/jd/hybrid/downloader/f;->a(Lcom/jd/hybrid/downloader/f;)Z

    move-result v1
    :try_end_1e
    .catchall {:try_start_18 .. :try_end_1e} :catchall_201

    if-nez v1, :cond_31

    :try_start_20
    iget-object v1, p0, Lcom/jd/hybrid/downloader/f$a;->a:Lcom/jd/hybrid/downloader/f;

    invoke-static {v1}, Lcom/jd/hybrid/downloader/f;->b(Lcom/jd/hybrid/downloader/f;)Ljava/lang/Object;

    move-result-object v1

    invoke-virtual {v1}, Ljava/lang/Object;->wait()V
    :try_end_29
    .catch Ljava/lang/InterruptedException; {:try_start_20 .. :try_end_29} :catch_2a
    .catchall {:try_start_20 .. :try_end_29} :catchall_201

    goto :goto_18

    :catch_2a
    move-exception v1

    :try_start_2b
    const-string v2, "HybridSerialFileDownloader"

    invoke-static {v2, v1}, Lcom/jd/libs/hybrid/base/b/c;->a(Ljava/lang/String;Ljava/lang/Throwable;)V

    goto :goto_18

    :cond_31
    monitor-exit v0
    :try_end_32
    .catchall {:try_start_2b .. :try_end_32} :catchall_201

    sget-boolean v0, Lcom/android/volley/VolleyLog;->DEBUG:Z

    if-eqz v0, :cond_4f

    const-string v0, "JDFileDownloader"

    new-instance v1, Ljava/lang/StringBuilder;

    const-string v2, "execute file request -> "

    invoke-direct {v1, v2}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V

    iget-object v2, p0, Lcom/jd/hybrid/downloader/f$a;->b:Lcom/jd/framework/network/request/JDFileRequest;

    invoke-virtual {v2}, Lcom/jd/framework/network/request/JDFileRequest;->getUrl()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v0, v1}, Lcom/jd/libs/hybrid/base/b/c;->c(Ljava/lang/String;Ljava/lang/String;)V

    :cond_4f
    iget-object v0, p0, Lcom/jd/hybrid/downloader/f$a;->a:Lcom/jd/hybrid/downloader/f;

    invoke-static {v0}, Lcom/jd/hybrid/downloader/f;->d(Lcom/jd/hybrid/downloader/f;)Landroid/content/Context;

    move-result-object v0

    iget-object v9, p0, Lcom/jd/hybrid/downloader/f$a;->b:Lcom/jd/framework/network/request/JDFileRequest;

    iget-object v1, p0, Lcom/jd/hybrid/downloader/f$a;->a:Lcom/jd/hybrid/downloader/f;

    invoke-static {v1}, Lcom/jd/hybrid/downloader/f;->e(Lcom/jd/hybrid/downloader/f;)Lcom/android/volley/toolbox/HttpStackFactory;

    move-result-object v1

    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->getUseOkhttpFlag()Z

    move-result v2

    if-eqz v2, :cond_69

    new-instance v2, Lcom/jd/hybrid/downloader/e$b;

    invoke-direct {v2, v1}, Lcom/jd/hybrid/downloader/e$b;-><init>(Lcom/android/volley/toolbox/HttpStackFactory;)V

    goto :goto_6e

    :cond_69
    new-instance v2, Lcom/jd/hybrid/downloader/e$c;

    invoke-direct {v2, v1}, Lcom/jd/hybrid/downloader/e$c;-><init>(Lcom/android/volley/toolbox/HttpStackFactory;)V

    :goto_6e
    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->isTopPriority()Z

    move-result v1

    if-eqz v1, :cond_76

    const/4 v1, -0x8

    goto :goto_78

    :cond_76
    const/16 v1, 0x13

    :goto_78
    invoke-static {v1}, Landroid/os/Process;->setThreadPriority(I)V

    sget-boolean v1, Lcom/android/volley/VolleyLog;->DEBUG:Z

    if-eqz v1, :cond_a2

    const-string v1, "DownloadImpl"

    new-instance v3, Ljava/lang/StringBuilder;

    const-string v4, "Start Downloading----> , isExclusiveTask : "

    invoke-direct {v3, v4}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V

    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->isExclusiveTask()Z

    move-result v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    const-string v4, "RequestUrl:"

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->getUrl()Ljava/lang/String;

    move-result-object v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-static {v1, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    :cond_a2
    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->isBreakpointTransmission()Z

    move-result v1

    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->getResponseListener()Lcom/jd/framework/network/file/JDFileResponseListener;

    move-result-object v10

    invoke-interface {v10}, Lcom/jd/framework/network/file/JDFileResponseListener;->onStart()V

    const/4 v11, 0x0

    :try_start_ae
    invoke-virtual {v2, v9}, Lcom/jd/hybrid/downloader/e;->a(Lcom/jd/framework/network/request/JDFileRequest;)Lcom/jd/hybrid/downloader/d$a;

    move-result-object v2

    check-cast v2, Lcom/jd/hybrid/downloader/e$a;
    :try_end_b4
    .catch Ljava/lang/Throwable; {:try_start_ae .. :try_end_b4} :catch_1ae

    :try_start_b4
    iget-object v12, v2, Lcom/jd/hybrid/downloader/e$a;->d:Ljava/io/InputStream;

    iget-wide v3, v2, Lcom/jd/hybrid/downloader/e$a;->e:J

    iget-object v13, v2, Lcom/jd/hybrid/downloader/e$a;->f:Ljava/util/Map;
    :try_end_ba
    .catch Ljava/lang/Throwable; {:try_start_b4 .. :try_end_ba} :catch_199

    :try_start_ba
    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->getSavePath()Lcom/jd/framework/network/file/JDFileGuider;

    move-result-object v2

    invoke-virtual {v2, v3, v4}, Lcom/jd/framework/network/file/JDFileGuider;->setAvailableSize(J)V

    invoke-virtual {v2}, Lcom/jd/framework/network/file/JDFileGuider;->isImmutable()Z

    move-result v3

    invoke-virtual {v2}, Lcom/jd/framework/network/file/JDFileGuider;->getSpace()I

    move-result v4

    invoke-static {v9, v0, v2, v3, v4}, Lcom/jd/framework/network/filedown/JDFileService;->resetSaveFileParam(Lcom/jd/framework/network/request/JDFileRequest;Landroid/content/Context;Lcom/jd/framework/network/file/JDFileGuider;ZI)V

    invoke-static {v2, v0}, Lcom/jd/framework/network/filedown/JDFileService;->getFileSavePath(Lcom/jd/framework/network/file/JDFileGuider;Landroid/content/Context;)Ljava/io/File;

    move-result-object v0

    if-nez v0, :cond_fa

    sget-boolean v0, Lcom/android/volley/VolleyLog;->DEBUG:Z

    if-eqz v0, :cond_f2

    const-string v0, "DownloadImpl"

    new-instance v1, Ljava/lang/StringBuilder;

    const-string v2, "requestID : "

    invoke-direct {v1, v2}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V

    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->getSequence()I

    move-result v2

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    const-string v2, ",\u4e0b\u8f7d\u5931\u8d25\uff0c\u5b58\u50a8\u7a7a\u95f4\u4e0d\u8db3\uff01"

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    :cond_f2
    new-instance v0, Ljava/io/IOException;

    const-string v1, "Not enough storage space\uff01"

    invoke-direct {v0, v1}, Ljava/io/IOException;-><init>(Ljava/lang/String;)V

    throw v0

    :cond_fa
    if-eqz v1, :cond_10d

    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->getStartPosBreakpointTransmission()I

    move-result v1

    int-to-long v3, v1

    invoke-virtual {v2}, Lcom/jd/framework/network/file/JDFileGuider;->getAvailableSize()J

    move-result-wide v6

    move-object v1, v12

    move-object v2, v0

    move-object v5, v10

    move-object v8, v9

    invoke-static/range {v1 .. v8}, Lcom/jd/hybrid/downloader/d;->a(Ljava/io/InputStream;Ljava/io/File;JLcom/jd/framework/network/file/JDFileResponseListener;JLcom/jd/framework/network/file/JDStopController;)V

    goto :goto_13b

    :cond_10d
    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->getSavePath()Lcom/jd/framework/network/file/JDFileGuider;

    move-result-object v1

    invoke-static {v1, v0}, Lcom/jd/framework/network/filedown/JDFileService;->openFileOutput(Lcom/jd/framework/network/file/JDFileGuider;Ljava/io/File;)Ljava/io/BufferedOutputStream;

    move-result-object v7
    :try_end_115
    .catchall {:try_start_ba .. :try_end_115} :catchall_194

    :try_start_115
    invoke-virtual {v2}, Lcom/jd/framework/network/file/JDFileGuider;->getAvailableSize()J

    move-result-wide v4

    move-object v1, v12

    move-object v2, v7

    move-object v3, v10

    move-object v6, v9

    invoke-static/range {v1 .. v6}, Lcom/jd/hybrid/downloader/d;->a(Ljava/io/InputStream;Ljava/io/BufferedOutputStream;Lcom/jd/framework/network/file/JDFileResponseListener;JLcom/jd/framework/network/file/JDStopController;)V
    :try_end_120
    .catchall {:try_start_115 .. :try_end_120} :catchall_180

    if-eqz v7, :cond_12d

    :try_start_122
    invoke-virtual {v7}, Ljava/io/BufferedOutputStream;->flush()V
    :try_end_125
    .catchall {:try_start_122 .. :try_end_125} :catchall_126

    goto :goto_12d

    :catchall_126
    move-exception v0

    if-eqz v7, :cond_12c

    :try_start_129
    invoke-virtual {v7}, Ljava/io/BufferedOutputStream;->close()V

    :cond_12c
    throw v0

    :cond_12d
    :goto_12d
    if-eqz v7, :cond_132

    invoke-virtual {v7}, Ljava/io/BufferedOutputStream;->close()V

    :cond_132
    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->isStop()Z

    move-result v1

    if-eqz v1, :cond_13b

    invoke-virtual {v0}, Ljava/io/File;->delete()Z

    :cond_13b
    :goto_13b
    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->isStop()Z

    move-result v1

    if-nez v1, :cond_15e

    invoke-virtual {v0}, Ljava/io/File;->exists()Z

    move-result v1

    if-eqz v1, :cond_156

    new-instance v1, Lcom/jd/framework/network/JDResponse;

    invoke-direct {v1}, Lcom/jd/framework/network/JDResponse;-><init>()V

    invoke-virtual {v1, v0}, Lcom/jd/framework/network/JDResponse;->setData(Ljava/lang/Object;)V

    invoke-virtual {v1, v13}, Lcom/jd/framework/network/JDResponse;->setHeaders(Ljava/util/Map;)V

    invoke-interface {v10, v1}, Lcom/jd/framework/network/file/JDFileResponseListener;->onEnd(Lcom/jd/framework/network/JDResponse;)V

    goto :goto_161

    :cond_156
    new-instance v0, Ljava/lang/IllegalStateException;

    const-string v1, "download finished but file not exist"

    invoke-direct {v0, v1}, Ljava/lang/IllegalStateException;-><init>(Ljava/lang/String;)V

    throw v0

    :cond_15e
    invoke-interface {v10}, Lcom/jd/framework/network/file/JDFileResponseListener;->onPause()V

    :goto_161
    sget-boolean v0, Lcom/android/volley/VolleyLog;->DEBUG:Z

    if-eqz v0, :cond_17c

    const-string v0, "DownloadImpl"

    new-instance v1, Ljava/lang/StringBuilder;

    const-string v2, "download success:"

    invoke-direct {v1, v2}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V

    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->getUrl()Ljava/lang/String;

    move-result-object v2

    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
    :try_end_17c
    .catchall {:try_start_129 .. :try_end_17c} :catchall_194

    :cond_17c
    :try_start_17c
    invoke-virtual {v12}, Ljava/io/InputStream;->close()V
    :try_end_17f
    .catch Ljava/lang/Throwable; {:try_start_17c .. :try_end_17f} :catch_199

    return-void

    :catchall_180
    move-exception v0

    if-eqz v7, :cond_18e

    :try_start_183
    invoke-virtual {v7}, Ljava/io/BufferedOutputStream;->flush()V
    :try_end_186
    .catchall {:try_start_183 .. :try_end_186} :catchall_187

    goto :goto_18e

    :catchall_187
    move-exception v0

    if-eqz v7, :cond_18d

    :try_start_18a
    invoke-virtual {v7}, Ljava/io/BufferedOutputStream;->close()V

    :cond_18d
    throw v0

    :cond_18e
    :goto_18e
    if-eqz v7, :cond_193

    invoke-virtual {v7}, Ljava/io/BufferedOutputStream;->close()V

    :cond_193
    throw v0
    :try_end_194
    .catchall {:try_start_18a .. :try_end_194} :catchall_194

    :catchall_194
    move-exception v0

    :try_start_195
    invoke-virtual {v12}, Ljava/io/InputStream;->close()V

    throw v0
    :try_end_199
    .catch Ljava/lang/Throwable; {:try_start_195 .. :try_end_199} :catch_199

    :catch_199
    move-exception v0

    sget-boolean v1, Lcom/android/volley/VolleyLog;->DEBUG:Z

    if-eqz v1, :cond_1a1

    invoke-virtual {v0}, Ljava/lang/Throwable;->printStackTrace()V

    :cond_1a1
    new-instance v1, Lcom/jd/framework/network/error/JDFileDownloadError;

    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->getUrl()Ljava/lang/String;

    move-result-object v2

    invoke-direct {v1, v2, v0, v11}, Lcom/jd/framework/network/error/JDFileDownloadError;-><init>(Ljava/lang/String;Ljava/lang/Throwable;Z)V

    invoke-interface {v10, v1}, Lcom/jd/framework/network/file/JDFileResponseListener;->onError(Lcom/jd/framework/network/error/JDError;)V

    return-void

    :catch_1ae
    move-exception v0

    sget-boolean v1, Lcom/android/volley/VolleyLog;->DEBUG:Z

    if-eqz v1, :cond_1b6

    invoke-virtual {v0}, Ljava/lang/Throwable;->printStackTrace()V

    :cond_1b6
    sget-boolean v1, Lcom/android/volley/VolleyLog;->DEBUG:Z

    if-eqz v1, :cond_1e8

    const-string v1, "DownloadImpl"

    new-instance v2, Ljava/lang/StringBuilder;

    const-string v3, "errorInfo:"

    invoke-direct {v2, v3}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V

    invoke-virtual {v0}, Ljava/lang/Throwable;->toString()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I

    const-string v1, "DownloadImpl"

    new-instance v2, Ljava/lang/StringBuilder;

    const-string v3, "FileRequest URL : "

    invoke-direct {v2, v3}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V

    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->getUrl()Ljava/lang/String;

    move-result-object v3

    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v2

    invoke-static {v1, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I

    :cond_1e8
    instance-of v1, v0, Lcom/jd/framework/network/error/JDError;

    if-eqz v1, :cond_1f4

    new-instance v1, Lcom/jd/framework/network/error/JDFileDownloadError;

    check-cast v0, Lcom/jd/framework/network/error/JDError;

    invoke-direct {v1, v0, v11}, Lcom/jd/framework/network/error/JDFileDownloadError;-><init>(Lcom/jd/framework/network/error/JDError;Z)V

    goto :goto_1fd

    :cond_1f4
    new-instance v1, Lcom/jd/framework/network/error/JDFileDownloadError;

    invoke-virtual {v9}, Lcom/jd/framework/network/request/JDFileRequest;->getUrl()Ljava/lang/String;

    move-result-object v2

    invoke-direct {v1, v2, v0, v11}, Lcom/jd/framework/network/error/JDFileDownloadError;-><init>(Ljava/lang/String;Ljava/lang/Throwable;Z)V

    :goto_1fd
    invoke-interface {v10, v1}, Lcom/jd/framework/network/file/JDFileResponseListener;->onError(Lcom/jd/framework/network/error/JDError;)V

    return-void

    :catchall_201
    move-exception v1

    :try_start_202
    monitor-exit v0
    :try_end_203
    .catchall {:try_start_202 .. :try_end_203} :catchall_201

    throw v1

    return-void
.end method
