package cn.bingoogolapple.qrcode.core;

import android.graphics.Bitmap;
import android.hardware.Camera;
import android.os.AsyncTask;
import android.text.TextUtils;
import java.lang.ref.WeakReference;

/* JADX INFO: Access modifiers changed from: package-private */
/* compiled from: TbsSdkJava */
/* loaded from: classes.dex */
public class c extends AsyncTask<Void, Void, d> {
    private static long g;
    private Camera a;
    private byte[] b;
    private boolean c;
    private String d;
    private Bitmap e;
    private WeakReference<QRCodeView> f;

    /* JADX INFO: Access modifiers changed from: package-private */
    public c(Camera camera, byte[] bArr, QRCodeView qRCodeView, boolean z) {
        this.a = camera;
        this.b = bArr;
        this.f = new WeakReference<>(qRCodeView);
        this.c = z;
    }

    /* JADX INFO: Access modifiers changed from: package-private */
    public c(String str, QRCodeView qRCodeView) {
        this.d = str;
        this.f = new WeakReference<>(qRCodeView);
    }

    /* JADX INFO: Access modifiers changed from: package-private */
    public c(Bitmap bitmap, QRCodeView qRCodeView) {
        this.e = bitmap;
        this.f = new WeakReference<>(qRCodeView);
    }

    /* JADX INFO: Access modifiers changed from: package-private */
    public c a() {
        executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, new Void[0]);
        return this;
    }

    /* JADX INFO: Access modifiers changed from: package-private */
    public void b() {
        if (getStatus() != AsyncTask.Status.FINISHED) {
            cancel(true);
        }
    }

    @Override // android.os.AsyncTask
    protected void onCancelled() {
        super.onCancelled();
        this.f.clear();
        this.e = null;
        this.b = null;
    }

    private d a(QRCodeView qRCodeView) {
        int i;
        int i2;
        Exception e;
        byte[] bArr = this.b;
        if (bArr == null) {
            return null;
        }
        try {
            Camera.Size previewSize = this.a.getParameters().getPreviewSize();
            i = previewSize.width;
            try {
                i2 = previewSize.height;
                try {
                    if (this.c) {
                        bArr = new byte[this.b.length];
                        for (int i3 = 0; i3 < i2; i3++) {
                            for (int i4 = 0; i4 < i; i4++) {
                                bArr[(((i4 * i2) + i2) - i3) - 1] = this.b[(i3 * i) + i4];
                            }
                        }
                    } else {
                        i = i2;
                        i2 = i;
                    }
                } catch (Exception e2) {
                    e = e2;
                }
            } catch (Exception e3) {
                e = e3;
                i2 = 0;
            }
        } catch (Exception e4) {
            e = e4;
            i2 = 0;
            i = 0;
        }
        try {
            return qRCodeView.processData(bArr, i2, i, false);
        } catch (Exception e5) {
            e = e5;
            i = i2;
            i2 = i;
            e.printStackTrace();
            if (i == 0 || i2 == 0) {
                return null;
            }
            try {
                a.a("识别失败重试");
                return qRCodeView.processData(bArr, i, i2, true);
            } catch (Exception e6) {
                e6.printStackTrace();
                return null;
            }
        }
    }

    /* JADX INFO: Access modifiers changed from: protected */
    /* renamed from: a */
    public d doInBackground(Void... voidArr) {
        QRCodeView qRCodeView = this.f.get();
        if (qRCodeView == null) {
            return null;
        }
        String str = this.d;
        if (str != null) {
            return qRCodeView.processBitmapData(a.c(str));
        }
        Bitmap bitmap = this.e;
        if (bitmap != null) {
            d processBitmapData = qRCodeView.processBitmapData(bitmap);
            this.e = null;
            return processBitmapData;
        }
        if (a.a()) {
            a.a("两次任务执行的时间间隔：" + (System.currentTimeMillis() - g));
            g = System.currentTimeMillis();
        }
        long currentTimeMillis = System.currentTimeMillis();
        d a = a(qRCodeView);
        if (a.a()) {
            long currentTimeMillis2 = System.currentTimeMillis() - currentTimeMillis;
            if (a == null || TextUtils.isEmpty(a.a)) {
                a.b("识别失败时间为：" + currentTimeMillis2);
            } else {
                a.a("识别成功时间为：" + currentTimeMillis2);
            }
        }
        return a;
    }

    /* JADX INFO: Access modifiers changed from: protected */
    /* renamed from: a */
    public void onPostExecute(d dVar) {
        QRCodeView qRCodeView = this.f.get();
        if (qRCodeView != null) {
            if (this.d == null && this.e == null) {
                qRCodeView.onPostParseData(dVar);
                return;
            }
            this.e = null;
            qRCodeView.onPostParseBitmapOrPicture(dVar);
        }
    }
}
