package cn.com.union.fido.ui;

import android.app.Activity;
import android.os.Bundle;
import cn.com.union.fido.bean.authenticator.command.BaseResponse;
import cn.com.union.fido.bean.uafclient.Operation;
import cn.com.union.fido.ui.finger.FingerSensorService;
import com.jdcn.fido.sdk.IFidoCallback;
import com.jdcn.fido.utils.TrackerUtil;
import java.lang.ref.WeakReference;

/* loaded from: classes.dex */
public class FidoPresenter implements IActivityPresenter, IAuthPresenter {
    private IFidoModel fidoModel;
    private WeakReference<IFidoView> fidoView;
    private IAuthSensorService sensorService;
    private volatile boolean isAuthViewDisplay = false;
    private volatile boolean isAuthActivityFinish = false;
    private volatile boolean isAuthSensorFinish = false;
    private volatile boolean isAuthFinish = false;

    public FidoPresenter(int i, String str, byte[] bArr) {
        this.fidoModel = new FidoModel(i, str, bArr);
    }

    private void handlerResult(int i, BaseResponse baseResponse) {
        int i2;
        switch (i) {
            case 16:
                i2 = 0;
                break;
            case 17:
                i2 = 2;
                break;
            case 18:
                i2 = 5;
                break;
            case 19:
                i2 = 8;
                break;
            case 20:
            case 22:
            case 23:
            default:
                i2 = 1;
                break;
            case 21:
                i2 = 16;
                break;
            case 24:
                i2 = 19;
                break;
            case 25:
                i2 = 20;
                break;
            case 26:
                i2 = 21;
                break;
            case 27:
                i2 = 22;
                break;
            case 28:
                i2 = 23;
                break;
            case 29:
                i2 = 24;
                break;
            case 30:
                i2 = 25;
                break;
        }
        if (!this.isAuthFinish) {
            this.isAuthFinish = true;
            this.fidoModel.setResponseCoded(i2);
            this.fidoModel.setBaseResponse(baseResponse);
            notifyAuthService();
        }
        if (!this.isAuthActivityFinish) {
            this.isAuthActivityFinish = true;
            IFidoView iFidoView = this.fidoView.get();
            if (iFidoView != null) {
                if (i2 == 0) {
                    iFidoView.onAuthenticationSucceeded(getOpType());
                } else {
                    iFidoView.onAuthenticationError(getOpType());
                }
            }
        }
        if (!this.isAuthSensorFinish) {
            this.isAuthSensorFinish = true;
            this.sensorService.endAuthenticator();
        }
    }

    private void notifyAuthService() {
        try {
            synchronized (this) {
                notifyAll();
            }
        } catch (Throwable unused) {
        }
    }

    @Override // cn.com.union.fido.ui.IAuthPresenter
    public void authViewDisplay() {
        if (!this.isAuthViewDisplay) {
            this.isAuthViewDisplay = true;
            if (!this.isAuthFinish) {
                IFidoCallback callback = FIDOUISDK.getCallback();
                if (callback != null) {
                    callback.response(500, (Bundle) null);
                    IFidoView iFidoView = this.fidoView.get();
                    if (iFidoView != null) {
                        iFidoView.authViewDisplay(getOpType());
                    }
                    if (getOpType().equals(Operation.Reg.name())) {
                        TrackerUtil.append("SCENE_REG_UI_DISPLAY");
                    }
                    if (getOpType().equals(Operation.Auth.name())) {
                        TrackerUtil.append("SCENE_TRANS_UI_DISPLAY");
                        return;
                    }
                    return;
                }
                this.isAuthFinish = true;
                IFidoView iFidoView2 = this.fidoView.get();
                if (iFidoView2 != null) {
                    iFidoView2.onAuthenticationError(getOpType());
                }
            }
        }
    }

    @Override // cn.com.union.fido.ui.IAuthPresenter
    public byte[] getFidoCmd() {
        return this.fidoModel.getFidoCmd();
    }

    public IFidoModel getFidoModel() {
        return this.fidoModel;
    }

    @Override // cn.com.union.fido.ui.IAuthPresenter
    public String getOpType() {
        return this.fidoModel.getOpType();
    }

    @Override // cn.com.union.fido.ui.IActivityPresenter
    public void handlerActivityResult(int i) {
        if (!this.isAuthActivityFinish) {
            this.isAuthActivityFinish = true;
            handlerResult(i, null);
        }
    }

    @Override // cn.com.union.fido.ui.IAuthPresenter
    public void handlerAuthResult(int i, BaseResponse baseResponse) {
        if (!this.isAuthSensorFinish) {
            this.isAuthSensorFinish = true;
            handlerResult(i, baseResponse);
        }
    }

    @Override // cn.com.union.fido.ui.IAuthPresenter
    public void onAuthenticationFailed() {
        IFidoView iFidoView = this.fidoView.get();
        if (iFidoView != null) {
            iFidoView.onAuthenticationFailed(getOpType());
        }
    }

    @Override // cn.com.union.fido.ui.IAuthPresenter
    public void onAuthenticationHelp(CharSequence charSequence) {
        IFidoView iFidoView = this.fidoView.get();
        if (iFidoView != null) {
            iFidoView.onAuthenticationHelp(getOpType(), charSequence);
        }
    }

    @Override // cn.com.union.fido.ui.IActivityPresenter
    public void setFidoView(IFidoView iFidoView) {
        this.fidoView = new WeakReference<>(iFidoView);
    }

    @Override // cn.com.union.fido.ui.IActivityPresenter
    public void startAuthenticator(Activity activity) {
        if (this.fidoModel.getAuthenticatorIndex() == 0) {
            if (this.sensorService == null) {
                this.sensorService = new FingerSensorService();
            }
            this.sensorService.startAuthenticator(activity, this);
        }
    }
}
