package com.huawei.hms.update.manager;

import android.content.Context;
import android.content.Intent;
import android.text.TextUtils;
import com.huawei.hms.common.PackageConstants;
import com.huawei.hms.support.log.HMSLog;
import com.huawei.updatesdk.UpdateSdkAPI;
import com.huawei.updatesdk.service.appmgr.bean.ApkUpgradeInfo;
import com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack;
import com.huawei.updatesdk.service.otaupdate.UpdateKey;
import java.io.Serializable;

/* compiled from: TbsSdkJava */
/* loaded from: classes.dex */
public class PackageNameManager {
    public static final Object b = new Object();
    public static PackageNameManager c;
    public Context a;

    /* compiled from: TbsSdkJava */
    /* loaded from: classes.dex */
    public interface QueryPublishCallback {
        void onQueryResult();
    }

    /* compiled from: TbsSdkJava */
    /* loaded from: classes.dex */
    public class a implements CheckUpdateCallBack {
        public final /* synthetic */ QueryPublishCallback a;

        public a(PackageNameManager packageNameManager, QueryPublishCallback queryPublishCallback) {
            this.a = queryPublishCallback;
        }

        @Override // com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack
        public void onMarketInstallInfo(Intent intent) {
            if (HMSPublishStateHolder.getPublishState() != 1) {
                HMSPublishStateHolder.setPublishState(2);
            }
            this.a.onQueryResult();
        }

        @Override // com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack
        public void onMarketStoreError(int i) {
            HMSLog.e("PackageNameManager", "onMarketStoreError responseCode: " + i);
            if (HMSPublishStateHolder.getPublishState() != 1) {
                HMSPublishStateHolder.setPublishState(2);
            }
            this.a.onQueryResult();
        }

        @Override // com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack
        public void onUpdateInfo(Intent intent) {
            if (intent != null) {
                try {
                    int intExtra = intent.getIntExtra("status", -99);
                    HMSLog.i("PackageNameManager", "CheckUpdateCallBack status is " + intExtra);
                    String stringExtra = intent.getStringExtra(UpdateKey.FAIL_REASON);
                    if (!TextUtils.isEmpty(stringExtra)) {
                        HMSLog.e("PackageNameManager", "checkTargetAppUpdate reason is " + stringExtra);
                    }
                    if (intExtra == 7) {
                        Serializable serializableExtra = intent.getSerializableExtra(UpdateKey.INFO);
                        if ((serializableExtra instanceof ApkUpgradeInfo) && ((ApkUpgradeInfo) serializableExtra).getPackage_().equalsIgnoreCase(PackageConstants.SERVICES_PACKAGE_ALL_SCENE)) {
                            HMSLog.i("PackageNameManager", "com.huawei.hms has already be published");
                            HMSPublishStateHolder.setPublishState(1);
                        }
                    }
                } catch (Exception e) {
                    HMSLog.e("PackageNameManager", "intent has some error" + e.getMessage());
                }
            }
            if (HMSPublishStateHolder.getPublishState() != 1) {
                HMSPublishStateHolder.setPublishState(2);
            }
            this.a.onQueryResult();
        }

        @Override // com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack
        public void onUpdateStoreError(int i) {
            HMSLog.e("PackageNameManager", "onUpdateStoreError responseCode: " + i);
            if (HMSPublishStateHolder.getPublishState() != 1) {
                HMSPublishStateHolder.setPublishState(2);
            }
            this.a.onQueryResult();
        }
    }

    public PackageNameManager(Context context) {
        this.a = context;
    }

    public static PackageNameManager getInstance(Context context) {
        synchronized (b) {
            if (c == null) {
                c = new PackageNameManager(context);
            }
        }
        return c;
    }

    public void queryPackageName(QueryPublishCallback queryPublishCallback) {
        UpdateSdkAPI.checkTargetAppUpdate(this.a, PackageConstants.SERVICES_PACKAGE_ALL_SCENE, new a(this, queryPublishCallback));
    }
}
