package com.jingdong.aura.core.a;

import android.content.Context;
import com.huawei.hms.support.api.push.pushselfshow.click.SelfShowType;
import com.jingdong.aura.core.a.a;
import com.jingdong.aura.core.util.d;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

/* compiled from: TbsSdkJava */
/* loaded from: classes.dex */
public class b {
    public static void a(Context context, boolean z) {
        List<a.C0042a> list;
        List<a.C0042a> list2 = null;
        try {
            list = a(context.getAssets().open("aura.json"));
        } catch (Exception e) {
            e.printStackTrace();
            list = null;
        }
        a.a().a(list);
        if (z) {
            a.a().b(list);
            return;
        }
        try {
            File file = new File(d.a().getAbsolutePath() + "/aura/updateAura.json");
            if (file.exists()) {
                list2 = a(new FileInputStream(file));
            }
        } catch (Exception e2) {
            e2.printStackTrace();
        }
        ArrayList arrayList = new ArrayList();
        if (list2 == null || list2.size() <= 0) {
            if (list != null && list.size() > 0) {
                arrayList.addAll(list);
            }
        } else if (list == null || list.size() <= 0) {
            arrayList.addAll(list2);
        } else {
            arrayList.addAll(a(list, list2));
        }
        if (arrayList.size() > 0) {
            a.a().b(arrayList);
        }
    }

    static List<a.C0042a> a(List<a.C0042a> list, List<a.C0042a> list2) {
        ArrayList<a.C0042a> arrayList = new ArrayList();
        ArrayList arrayList2 = new ArrayList();
        Iterator<a.C0042a> it = list.iterator();
        while (true) {
            boolean z = false;
            if (!it.hasNext()) {
                break;
            }
            a.C0042a next = it.next();
            for (a.C0042a aVar : list2) {
                if (next.e.equals(aVar.e)) {
                    if (next.i >= aVar.i) {
                        arrayList.add(next);
                    } else {
                        arrayList.add(aVar);
                    }
                    z = true;
                }
            }
            if (!z) {
                arrayList.add(next);
            }
        }
        arrayList2.addAll(arrayList);
        for (a.C0042a aVar2 : list2) {
            boolean z2 = false;
            for (a.C0042a aVar3 : arrayList) {
                if (aVar2.e.equals(aVar3.e)) {
                    z2 = true;
                }
            }
            if (!z2) {
                arrayList2.add(aVar2);
            }
        }
        return arrayList2;
    }

    public static List<a.C0042a> a(InputStream inputStream) {
        byte[] bArr;
        if (inputStream != null) {
            try {
                bArr = new byte[inputStream.available()];
                inputStream.read(bArr);
            } finally {
                if (inputStream != null) {
                    try {
                        inputStream.close();
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                }
            }
        } else {
            bArr = null;
        }
        return a(bArr);
    }

    private static List<a.C0042a> a(byte[] bArr) {
        ArrayList arrayList = new ArrayList();
        JSONArray jSONArray = new JSONArray(new String(bArr));
        for (int i = 0; i < jSONArray.length(); i++) {
            JSONObject optJSONObject = jSONArray.optJSONObject(i);
            a.C0042a aVar = new a.C0042a();
            aVar.e = optJSONObject.optString("pkgName");
            aVar.h = optJSONObject.optString("verName");
            aVar.i = optJSONObject.optLong("verCode");
            aVar.f = optJSONObject.optBoolean("hasSO");
            aVar.j = optJSONObject.optString(SelfShowType.PUSH_CMD_APP, null);
            aVar.k = optJSONObject.optString("md5", null);
            aVar.l = optJSONObject.optString("md5_asec", null);
            aVar.g = optJSONObject.optLong("size");
            aVar.m = optJSONObject.optInt("bundleType");
            aVar.n = optJSONObject.optString("downloadUrl");
            aVar.a = new ArrayList();
            a(aVar.a, optJSONObject, "activity");
            a(aVar.a, optJSONObject, "receiver");
            a(aVar.a, optJSONObject, "service");
            a(aVar.a, optJSONObject, "provider");
            aVar.r = new ArrayList();
            a(aVar.r, optJSONObject, "receiver");
            aVar.o = new ArrayList();
            a(aVar.o, optJSONObject, "activity");
            aVar.p = new ArrayList();
            a(aVar.p, optJSONObject, "service");
            aVar.q = new ArrayList();
            a(aVar.q, optJSONObject, "provider");
            aVar.b = new ArrayList();
            a(aVar.b, optJSONObject, "manualComponents");
            aVar.c = new ArrayList();
            a(aVar.c, optJSONObject, "dependency");
            aVar.d = new ArrayList();
            a(aVar.d, optJSONObject, "auraDependentSo");
            arrayList.add(aVar);
        }
        return arrayList;
    }

    private static void a(List<String> list, JSONObject jSONObject, String str) {
        JSONArray optJSONArray = jSONObject.optJSONArray(str);
        if (optJSONArray != null) {
            for (int i = 0; i < optJSONArray.length(); i++) {
                try {
                    list.add(optJSONArray.getString(i));
                } catch (JSONException e) {
                    e.printStackTrace();
                }
            }
        }
    }
}
