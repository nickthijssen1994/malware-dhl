package com.jingdong.aura.wrapper;

import android.os.Handler;
import android.os.HandlerThread;
import android.os.Looper;
import android.os.Message;
import android.os.Process;
import android.text.TextUtils;
import android.widget.Toast;
import com.jingdong.aura.R$string;
import com.jingdong.aura.core.b.e;
import com.jingdong.aura.core.nativelib.AuraNative;
import com.jingdong.aura.core.runing.k;
import com.jingdong.aura.core.util.h;
import java.io.File;
import org.osgi.framework.BundleEvent;

/* compiled from: TbsSdkJava */
/* loaded from: classes.dex */
public class b implements org.osgi.framework.b {
    public static String a = "";
    a b = new a();
    private Handler c;
    private HandlerThread d;

    /* compiled from: TbsSdkJava */
    /* renamed from: com.jingdong.aura.wrapper.b$b  reason: collision with other inner class name */
    /* loaded from: classes.dex */
    private final class HandlerC0047b extends Handler {
        public HandlerC0047b(Looper looper) {
            super(looper);
        }

        @Override // android.os.Handler
        public void handleMessage(Message message) {
            File b;
            if (message != null) {
                String str = (String) message.obj;
                if (!TextUtils.isEmpty(str) && (b = com.jingdong.aura.core.b.a.a().b(str)) != null) {
                    if (com.jingdong.aura.core.b.a.a().c() != null) {
                        if (!com.jingdong.aura.core.b.a.a().c().a(b.getAbsolutePath())) {
                            b.this.a(str);
                        }
                    } else if (!b.this.a(b) && !AuraNative.a(b.getAbsolutePath())) {
                        b.this.a(str);
                    }
                }
            }
        }
    }

    /* JADX INFO: Access modifiers changed from: private */
    public boolean a(File file) {
        return h.c(a.a(file.getAbsolutePath()), a);
    }

    /* JADX INFO: Access modifiers changed from: private */
    public void a(final String str) {
        new Handler(Looper.getMainLooper()).post(new Runnable() { // from class: com.jingdong.aura.wrapper.b.1
            @Override // java.lang.Runnable
            public void run() {
                Toast.makeText(k.a, R$string.aura_bundlebroken, 0).show();
                e.a(str, "组件损坏,请重新安装", "ApkUtils.initHostKey_1", null);
                b.this.b.sendEmptyMessageDelayed(0, 5000);
            }
        });
    }

    /* compiled from: TbsSdkJava */
    /* loaded from: classes.dex */
    public static class a extends Handler {
        @Override // android.os.Handler
        public void handleMessage(Message message) {
            Process.killProcess(Process.myPid());
        }
    }

    public b() {
        this.d = null;
        this.d = new HandlerThread("Check bundle security");
        this.d.start();
        this.c = new HandlerC0047b(this.d.getLooper());
    }

    public void bundleChanged(BundleEvent bundleEvent) {
        int type = bundleEvent.getType();
        if (type == 1 || type == 8) {
            Message obtain = Message.obtain();
            obtain.obj = bundleEvent.getBundle().n();
            this.c.sendMessage(obtain);
        }
    }
}
