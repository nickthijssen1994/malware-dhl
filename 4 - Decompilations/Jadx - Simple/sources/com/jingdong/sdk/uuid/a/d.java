package com.jingdong.sdk.uuid.a;

import android.content.Context;
import android.os.Build;
import android.os.Environment;
import android.text.TextUtils;
import com.jingdong.sdk.uuid.Request;
import com.jingdong.sdk.uuid.b;
import com.jingdong.sdk.uuid.e;
import com.jingdong.sdk.uuid.f;
import com.jingdong.sdk.uuid.h;
import java.io.File;
import java.io.FileOutputStream;
import java.io.RandomAccessFile;
import java.util.UUID;

/* loaded from: classes.dex */
public class d implements b {
    private static String a() {
        return UUID.randomUUID().toString().replaceAll("-", "");
    }

    public static String a(Context context) {
        if (!h.a(context)) {
            return "";
        }
        try {
            File b = b(context);
            if (!b.exists()) {
                b(b);
            }
            return a(b);
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    private static String a(File file) {
        RandomAccessFile randomAccessFile = new RandomAccessFile(file, "r");
        byte[] bArr = new byte[(int) randomAccessFile.length()];
        randomAccessFile.readFully(bArr);
        randomAccessFile.close();
        return new String(bArr);
    }

    private static File b(Context context) {
        File file = Environment.getExternalStorageState().equals("mounted") ? new File(Environment.getExternalStorageDirectory(), "Android/device") : new File(context.getFilesDir(), "Android/device");
        if (!file.exists()) {
            file.mkdirs();
        }
        return new File(file, ".DEVICE");
    }

    private static void b(File file) {
        FileOutputStream fileOutputStream = new FileOutputStream(file);
        fileOutputStream.write(a().getBytes());
        fileOutputStream.close();
    }

    @Override // com.jingdong.sdk.uuid.b
    public f a(b.a aVar) {
        com.jingdong.sdk.uuid.d.a("Enter RandomUUIDInterceptor intercept()");
        Request a = aVar.a();
        e.a(a);
        String a2 = e.a().a("randomUUID");
        if (TextUtils.isEmpty(a2)) {
            if (Build.VERSION.SDK_INT <= 29 && a.isFileCacheEnabled()) {
                a2 = a(a.getContext());
            }
            if (TextUtils.isEmpty(a2)) {
                a2 = a();
            }
            e.a().a("randomUUID", a2);
        }
        return new f(a, false).a(a2).a(false);
    }
}
