package com.jd.lib.un.basewidget.widget.banner.indicator;

import android.content.Context;
import android.content.res.Resources;
import android.graphics.RectF;
import android.util.AttributeSet;
import android.view.MotionEvent;
import android.view.View;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.viewpager.widget.PagerAdapter;
import androidx.viewpager.widget.ViewPager;
import com.jd.lib.un.basewidget.widget.banner.BannerAdapter;
import com.jd.lib.un.basewidget.widget.banner.BannerView;
import java.util.ArrayList;
import java.util.List;

/* compiled from: TbsSdkJava */
/* loaded from: classes.dex */
public abstract class BaseIndicator extends View implements ViewPager.OnAdapterChangeListener, ViewPager.OnPageChangeListener {
    private PagerAdapter mAdapter;
    private BannerAdapter mBannerAdapter;
    private BannerView mBannerView;
    private ViewPager mViewPager;
    private boolean isNormal = true;
    private boolean isInitDone = false;
    protected boolean isSupportLoop = true;
    protected List<IndicatorPoint> indicatorPoints = new ArrayList();

    protected abstract void initSelected(int i);

    public void onPageScrollStateChanged(int i) {
    }

    public void onPageSelected(int i) {
    }

    public BaseIndicator(Context context) {
        super(context);
    }

    public BaseIndicator(Context context, @Nullable AttributeSet attributeSet) {
        super(context, attributeSet);
    }

    public BaseIndicator(Context context, @Nullable AttributeSet attributeSet, int i) {
        super(context, attributeSet, i);
    }

    @Override // android.view.View
    public boolean onTouchEvent(MotionEvent motionEvent) {
        if (motionEvent.getActionMasked() != 0 || !tryToDispatch(motionEvent)) {
            return super.onTouchEvent(motionEvent);
        }
        return true;
    }

    private boolean tryToDispatch(MotionEvent motionEvent) {
        float x = motionEvent.getX();
        float y = motionEvent.getY();
        for (IndicatorPoint indicatorPoint : this.indicatorPoints) {
            RectF rectF = indicatorPoint.rect;
            if (rectF != null && rectF.contains(x, y)) {
                onTouchSelected(indicatorPoint.index);
                return true;
            }
        }
        return false;
    }

    public void setViewPager(ViewPager viewPager) {
        this.mViewPager = viewPager;
        this.mAdapter = viewPager.getAdapter();
        this.mViewPager.removeOnPageChangeListener(this);
        this.mViewPager.addOnPageChangeListener(this);
        this.mViewPager.removeOnAdapterChangeListener(this);
        this.mViewPager.addOnAdapterChangeListener(this);
        this.isNormal = true;
        this.isInitDone = true;
        ViewPager viewPager2 = this.mViewPager;
        initSelected(viewPager2 != null ? viewPager2.getCurrentItem() : 0);
    }

    public void setBannerView(BannerView bannerView) {
        this.mBannerView = bannerView;
        this.mBannerAdapter = bannerView.getAdapter();
        this.mBannerView.removeOnPageChangeListener(this);
        this.mBannerView.addOnPageChangeListener(this);
        this.mBannerView.removeOnAdapterChangeListener(this);
        this.mBannerView.addOnAdapterChangeListener(this);
        int i = 0;
        this.isNormal = false;
        this.isInitDone = true;
        BannerView bannerView2 = this.mBannerView;
        if (bannerView2 != null) {
            i = bannerView2.getCurrentItem();
        }
        initSelected(i);
    }

    protected int getCount() {
        if (this.isNormal) {
            PagerAdapter pagerAdapter = this.mAdapter;
            if (pagerAdapter != null) {
                return pagerAdapter.getCount();
            }
            return 0;
        }
        BannerAdapter bannerAdapter = this.mBannerAdapter;
        if (bannerAdapter != null) {
            return bannerAdapter.getItemCount();
        }
        return 0;
    }

    protected void addIndicatorPoint(IndicatorPoint indicatorPoint) {
        this.indicatorPoints.add(indicatorPoint);
    }

    protected void removeIndicatorPoint(IndicatorPoint indicatorPoint) {
        this.indicatorPoints.remove(indicatorPoint);
    }

    protected void clearIndicatorPoint() {
        this.indicatorPoints.clear();
    }

    public void setIsSupportLoop(boolean z) {
        this.isSupportLoop = z;
    }

    private void onTouchSelected(int i) {
        ViewPager viewPager = this.mViewPager;
        if (viewPager != null) {
            viewPager.setCurrentItem(i, true);
            return;
        }
        BannerView bannerView = this.mBannerView;
        if (bannerView != null) {
            bannerView.setCurrentItem(i, true);
        }
    }

    protected int dp2px(int i) {
        return (int) ((Resources.getSystem().getDisplayMetrics().density * ((float) i)) + 0.5f);
    }

    public void onAdapterChanged(@NonNull ViewPager viewPager, @Nullable PagerAdapter pagerAdapter, @Nullable PagerAdapter pagerAdapter2) {
        if (pagerAdapter2 instanceof BannerAdapter) {
            this.mBannerAdapter = (BannerAdapter) pagerAdapter2;
            if (this.mBannerAdapter.getItemCount() > 0) {
                this.mBannerView.setCurrentItem(0);
                initSelected(0);
                return;
            }
            return;
        }
        this.mAdapter = pagerAdapter2;
        if (this.mAdapter.getCount() > 0) {
            this.mViewPager.setCurrentItem(0);
            initSelected(0);
        }
    }

    /* compiled from: TbsSdkJava */
    /* loaded from: classes.dex */
    public class IndicatorPoint {
        public int bottom;
        public int index;
        public int left;
        public RectF rect;
        public int right;
        public int top;

        public IndicatorPoint(int i, int i2, int i3, int i4, int i5) {
            this.index = i;
            this.left = i2;
            this.top = i3;
            this.right = i4;
            this.bottom = i5;
            this.rect = new RectF((float) i2, (float) i3, (float) i4, (float) i5);
        }

        public IndicatorPoint() {
        }
    }
}
