package com.jd.lib.unification.album.filter;

import android.content.Context;
import android.graphics.Bitmap;
import android.os.Handler;
import android.os.Message;
import android.util.AttributeSet;
import android.view.LayoutInflater;
import android.view.View;
import android.widget.LinearLayout;
import android.widget.SeekBar;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import com.jd.lib.unification.album.filter.FilterTools;
import com.jd.lib.unification.album.filter.filter.CommonFilter;
import com.jd.lib.unification.album.filter.video.ExtractDecodeEditEncodeMux;
import com.jd.lib.unification.album.filter.video.VideoUtil;
import com.jd.lib.unification.video.view.util.VideoInfoUtil;
import com.jd.unalbumwidget.R;
import com.jingdong.common.DpiUtil;
import java.util.List;

/* compiled from: TbsSdkJava */
/* loaded from: classes.dex */
public class FilterView extends LinearLayout {
    private FilterAdapter adapter;
    private ExtractDecodeEditEncodeMux extractDecodeEdit;
    private FilterChangerListener filterChangerListener;
    private Context mContext;
    private FilterTools.FilterAdjuster mFilterAdjuster;
    private MainHandler mUIHandler;
    private FilterProgressChangerListener progressChangerListener;
    private RecyclerView recyclerView;
    private SeekBar seekBar;
    private LinearLayout seekBarLayot;
    private FilterInfo selectImageFilter;

    /* compiled from: TbsSdkJava */
    /* loaded from: classes.dex */
    public interface FilterChangerListener {
        void onFilterChanged(FilterTools.FilterType filterType, CommonFilter commonFilter);
    }

    /* compiled from: TbsSdkJava */
    /* loaded from: classes.dex */
    public interface FilterProgressChangerListener {
        void onFilterProgressChanged();
    }

    public FilterView(Context context) {
        this(context, null);
    }

    public FilterView(Context context, AttributeSet attributeSet) {
        this(context, attributeSet, 0);
    }

    public FilterView(Context context, AttributeSet attributeSet, int i) {
        super(context, attributeSet, i);
        this.mContext = context;
        this.mUIHandler = new MainHandler();
        LayoutInflater.from(context).inflate(R.layout.common_filter_view, this);
        this.recyclerView = findViewById(R.id.recycleView);
        this.recyclerView.setLayoutManager(new LinearLayoutManager(context, 0, false));
        this.seekBarLayot = (LinearLayout) findViewById(R.id.seekBarLayot);
        this.seekBar = (SeekBar) findViewById(R.id.seekBar);
        this.seekBar.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() { // from class: com.jd.lib.unification.album.filter.FilterView.1
            @Override // android.widget.SeekBar.OnSeekBarChangeListener
            public void onStartTrackingTouch(SeekBar seekBar) {
            }

            @Override // android.widget.SeekBar.OnSeekBarChangeListener
            public void onStopTrackingTouch(SeekBar seekBar) {
            }

            @Override // android.widget.SeekBar.OnSeekBarChangeListener
            public void onProgressChanged(SeekBar seekBar, int i2, boolean z) {
                if (FilterView.this.mFilterAdjuster != null) {
                    FilterView.this.mFilterAdjuster.adjust(i2);
                    if (FilterView.this.progressChangerListener != null) {
                        FilterView.this.progressChangerListener.onFilterProgressChanged();
                    }
                }
            }
        });
    }

    public void initData(Bitmap bitmap, List<FilterTools.FilterType> list) {
        List<FilterInfo> list2;
        Bitmap scaleBitmap = VideoInfoUtil.scaleBitmap(bitmap, DpiUtil.dip2px(this.mContext, 70.0f), DpiUtil.dip2px(this.mContext, 70.0f));
        if (list == null || list.size() == 0) {
            list2 = FilterTools.initFilter(this.mContext, scaleBitmap);
        } else {
            list2 = FilterTools.initFilter(this.mContext, scaleBitmap, list);
        }
        if (list2.size() > 0) {
            this.selectImageFilter = list2.get(0);
        }
        FilterTools.getFilterBitmap(this.mContext, list2, scaleBitmap, this.mUIHandler);
        this.adapter = new FilterAdapter(this.mContext, list2);
        this.recyclerView.setAdapter(this.adapter);
        this.adapter.setOnClickListener(new View.OnClickListener() { // from class: com.jd.lib.unification.album.filter.FilterView.2
            @Override // android.view.View.OnClickListener
            public void onClick(View view) {
                if (FilterView.this.selectImageFilter != null) {
                    FilterView.this.selectImageFilter.isSelect = false;
                }
                FilterView.this.selectImageFilter = (FilterInfo) view.getTag();
                FilterView.this.selectImageFilter.isSelect = true;
                FilterView.this.adapter.notifyDataSetChanged();
                CommonFilter createFilterForType = FilterTools.createFilterForType(FilterView.this.selectImageFilter.type);
                if (createFilterForType != null && FilterView.this.filterChangerListener != null) {
                    FilterView.this.mFilterAdjuster = new FilterTools.FilterAdjuster(createFilterForType);
                    if (FilterView.this.mFilterAdjuster.canAdjust()) {
                        FilterView.this.seekBarLayot.setVisibility(0);
                        FilterView.this.seekBar.setProgress(FilterView.this.seekBar.getMax());
                    } else {
                        FilterView.this.seekBarLayot.setVisibility(8);
                    }
                    FilterView.this.filterChangerListener.onFilterChanged(FilterView.this.selectImageFilter.type, createFilterForType);
                }
            }
        });
    }

    /* JADX INFO: Access modifiers changed from: private */
    /* compiled from: TbsSdkJava */
    /* loaded from: classes.dex */
    public class MainHandler extends Handler {
        private MainHandler() {
        }

        @Override // android.os.Handler
        public void handleMessage(Message message) {
            if (message.what == 200 && FilterView.this.adapter != null) {
                FilterView.this.adapter.notifyItemChanged(message.arg1);
            }
        }
    }

    public boolean isNeedFilter(FilterTools.FilterType filterType) {
        return filterType != FilterTools.FilterType.NO_FILTER;
    }

    public void addFilter(String str, int i, int i2, int i3, FilterTools.FilterType filterType, boolean z, final ExtractDecodeEditEncodeMux.ResultListener resultListener) {
        if (filterType != FilterTools.FilterType.NO_FILTER || resultListener == null) {
            String createOutVideoPath = VideoUtil.createOutVideoPath(str);
            String createFilterVideoName = VideoUtil.createFilterVideoName(str, filterType, z);
            this.extractDecodeEdit = new ExtractDecodeEditEncodeMux(this.mContext);
            this.extractDecodeEdit.setSource(str);
            ExtractDecodeEditEncodeMux extractDecodeEditEncodeMux = this.extractDecodeEdit;
            extractDecodeEditEncodeMux.setOutputFile(createOutVideoPath + createFilterVideoName);
            this.extractDecodeEdit.setVideoOrientation(i3);
            this.extractDecodeEdit.setFilterType(filterType);
            this.extractDecodeEdit.setFilterProgress(getSeekBarProgress());
            this.extractDecodeEdit.testExtractDecodeEditEncodeMuxAudioVideo(new ExtractDecodeEditEncodeMux.ResultListener() { // from class: com.jd.lib.unification.album.filter.FilterView.3
                @Override // com.jd.lib.unification.album.filter.video.ExtractDecodeEditEncodeMux.ResultListener
                public void onResult(boolean z2, String str2, String str3) {
                    ExtractDecodeEditEncodeMux.ResultListener resultListener2 = resultListener;
                    if (resultListener2 != null) {
                        resultListener2.onResult(z2, str2, str3);
                        FilterView.this.extractDecodeEdit.setHandlerThread(null);
                    }
                }
            }, i, i2);
            return;
        }
        resultListener.onResult(true, str, "");
    }

    public void setFilterChangerListener(FilterChangerListener filterChangerListener) {
        this.filterChangerListener = filterChangerListener;
    }

    public void setProgressChangerListener(FilterProgressChangerListener filterProgressChangerListener) {
        this.progressChangerListener = filterProgressChangerListener;
    }

    public int getSeekBarProgress() {
        return this.seekBar.getProgress();
    }

    public void destory() {
        this.mUIHandler.removeCallbacksAndMessages(null);
        if (this.adapter != null) {
            this.adapter = null;
        }
        ExtractDecodeEditEncodeMux extractDecodeEditEncodeMux = this.extractDecodeEdit;
    }
}
