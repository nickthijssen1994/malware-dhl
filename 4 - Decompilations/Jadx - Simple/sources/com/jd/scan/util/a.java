package com.jd.scan.util;

import android.app.Activity;
import android.content.Context;
import android.content.SharedPreferences;
import android.media.AudioManager;
import android.media.MediaPlayer;
import android.os.Vibrator;
import android.preference.PreferenceManager;
import java.io.Closeable;

/* loaded from: classes.dex */
public class a implements MediaPlayer.OnErrorListener, Closeable {
    private static final String a = "a";
    private final Activity b;
    private MediaPlayer c = null;
    private boolean d;
    private boolean e;

    public a(Activity activity) {
        this.b = activity;
        a();
    }

    /* JADX WARN: Removed duplicated region for block: B:15:0x0045  */
    /* Code decompiled incorrectly, please refer to instructions dump */
    private android.media.MediaPlayer a(android.content.Context r10) {
        /*
            r9 = this;
            android.media.MediaPlayer r6 = new android.media.MediaPlayer
            r6.<init>()
            r7 = 0
            android.content.res.Resources r10 = r10.getResources()     // Catch: IOException -> 0x004f
            int r0 = com.jd.scan.R.raw.beep     // Catch: IOException -> 0x004f
            android.content.res.AssetFileDescriptor r10 = r10.openRawResourceFd(r0)     // Catch: IOException -> 0x004f
            java.io.FileDescriptor r1 = r10.getFileDescriptor()     // Catch: Throwable -> 0x003d, all -> 0x003a
            long r2 = r10.getStartOffset()     // Catch: Throwable -> 0x003d, all -> 0x003a
            long r4 = r10.getLength()     // Catch: Throwable -> 0x003d, all -> 0x003a
            r0 = r6
            r0.setDataSource(r1, r2, r4)     // Catch: Throwable -> 0x003d, all -> 0x003a
            r6.setOnErrorListener(r9)     // Catch: Throwable -> 0x003d, all -> 0x003a
            r0 = 3
            r6.setAudioStreamType(r0)     // Catch: Throwable -> 0x003d, all -> 0x003a
            r0 = 0
            r6.setLooping(r0)     // Catch: Throwable -> 0x003d, all -> 0x003a
            r0 = 1036831949(0x3dcccccd, float:0.1)
            r6.setVolume(r0, r0)     // Catch: Throwable -> 0x003d, all -> 0x003a
            r6.prepare()     // Catch: Throwable -> 0x003d, all -> 0x003a
            if (r10 == 0) goto L_0x0039
            r10.close()     // Catch: IOException -> 0x004f
        L_0x0039:
            return r6
        L_0x003a:
            r0 = move-exception
            r1 = r7
            goto L_0x0043
        L_0x003d:
            r0 = move-exception
            throw r0     // Catch: all -> 0x003f
        L_0x003f:
            r1 = move-exception
            r8 = r1
            r1 = r0
            r0 = r8
        L_0x0043:
            if (r10 == 0) goto L_0x004e
            if (r1 == 0) goto L_0x004b
            r10.close()     // Catch: Throwable -> 0x004e, IOException -> 0x004f
            goto L_0x004e
        L_0x004b:
            r10.close()     // Catch: IOException -> 0x004f
        L_0x004e:
            throw r0     // Catch: IOException -> 0x004f
        L_0x004f:
            r10 = move-exception
            java.lang.String r0 = com.jd.scan.util.a.a
            android.util.Log.w(r0, r10)
            r6.release()
            return r7
        */
        throw new UnsupportedOperationException("Method not decompiled: com.jd.scan.util.a.a(android.content.Context):android.media.MediaPlayer");
    }

    private static boolean a(SharedPreferences sharedPreferences, Context context) {
        boolean z = sharedPreferences.getBoolean("preferences_play_beep", true);
        if (!z || ((AudioManager) context.getSystemService("audio")).getRingerMode() == 2) {
            return z;
        }
        return false;
    }

    public synchronized void a() {
        SharedPreferences defaultSharedPreferences = PreferenceManager.getDefaultSharedPreferences(this.b);
        this.d = a(defaultSharedPreferences, this.b);
        this.e = defaultSharedPreferences.getBoolean("preferences_vibrate", true);
        if (this.d && this.c == null) {
            this.b.setVolumeControlStream(3);
            this.c = a(this.b);
        }
    }

    public synchronized void b() {
        if (this.d && this.c != null) {
            this.c.start();
        }
        if (this.e) {
            ((Vibrator) this.b.getSystemService("vibrator")).vibrate(200);
        }
    }

    @Override // java.io.Closeable, java.lang.AutoCloseable
    public synchronized void close() {
        if (this.c != null) {
            this.c.release();
            this.c = null;
        }
    }

    @Override // android.media.MediaPlayer.OnErrorListener
    public synchronized boolean onError(MediaPlayer mediaPlayer, int i, int i2) {
        if (i == 100) {
            this.b.finish();
        } else {
            close();
            a();
        }
        return true;
    }
}
