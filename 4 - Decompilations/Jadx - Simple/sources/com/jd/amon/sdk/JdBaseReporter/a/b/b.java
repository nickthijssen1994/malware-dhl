package com.jd.amon.sdk.JdBaseReporter.a.b;

import com.jd.amon.sdk.JdBaseReporter.a;
import com.jd.amon.sdk.JdBaseReporter.a.b.f;
import com.jd.amon.sdk.JdBaseReporter.b.b$a;
import com.jd.amon.sdk.JdBaseReporter.e.d;
import com.jd.amon.sdk.JdBaseReporter.f.e;
import java.util.ArrayList;
import org.json.JSONArray;
import org.json.JSONObject;

/* loaded from: classes.dex */
public class b {
    private com.jd.amon.sdk.JdBaseReporter.b.b a = com.jd.amon.sdk.JdBaseReporter.b.b.a(a.a().f());

    private static boolean b(ArrayList<d>[] arrayListArr) {
        int length = arrayListArr.length;
        boolean z = true;
        for (int i = 0; i < length; i++) {
            ArrayList<d> arrayList = arrayListArr[i];
            z = z && (arrayList == null || arrayList.size() <= 0);
        }
        return z;
    }

    public com.jd.amon.sdk.JdBaseReporter.b.a a(int i) {
        com.jd.amon.sdk.JdBaseReporter.b.b bVar;
        b$a b_a;
        switch (i) {
            case 0:
                bVar = this.a;
                b_a = b$a.CORE;
                break;
            case 1:
                bVar = this.a;
                b_a = b$a.MEDIUM;
                break;
            case 2:
                bVar = this.a;
                b_a = b$a.NORMAL;
                break;
            default:
                return null;
        }
        return bVar.a(b_a);
    }

    public JSONArray a(ArrayList<d>[] arrayListArr, f.a aVar) {
        JSONArray jSONArray = new JSONArray();
        if (b(arrayListArr)) {
            return jSONArray;
        }
        for (int i = 0; i < arrayListArr.length; i++) {
            ArrayList<d> arrayList = arrayListArr[i];
            if (arrayList != null && arrayList.size() > 0) {
                long j = -1;
                long j2 = -1;
                for (int i2 = 0; i2 < arrayList.size(); i2++) {
                    try {
                        d dVar = arrayList.get(i2);
                        if (i2 == 0) {
                            j = Long.parseLong(dVar.b());
                        }
                        if (i2 == arrayList.size() - 1) {
                            j2 = Long.parseLong(dVar.b());
                        }
                        jSONArray.put(new JSONObject(dVar.a()));
                    } catch (Throwable th) {
                        th.printStackTrace();
                        a.a().c().a("ReportDataResolver", "数据格式可能已毁坏，丢弃数据", th);
                        com.jd.amon.sdk.JdBaseReporter.b.a a = a(i);
                        if (a != null) {
                            a.a(j, j2);
                        }
                        aVar.d();
                        return jSONArray;
                    }
                }
            }
        }
        return jSONArray;
    }

    public void a(ArrayList<d>[] arrayListArr) {
        for (int i = 0; i < arrayListArr.length; i++) {
            ArrayList<d> arrayList = arrayListArr[i];
            if (arrayList != null && arrayList.size() > 0) {
                long j = -1;
                long j2 = -1;
                for (int i2 = 0; i2 < arrayList.size(); i2++) {
                    try {
                        d dVar = arrayList.get(i2);
                        if (i2 == 0) {
                            j2 = Long.parseLong(dVar.b());
                        }
                        if (i2 == arrayList.size() - 1) {
                            j = Long.parseLong(dVar.b());
                        }
                    } catch (Throwable th) {
                        th.printStackTrace();
                    }
                }
                com.jd.amon.sdk.JdBaseReporter.b.a a = a(i);
                if (a != null) {
                    a.a(j2, j);
                    if (e.a) {
                        e.a("ReportDataResolver", "上传成功后删除" + a.b() + "的firstId :" + j2 + "lastId :" + j);
                    }
                }
            }
        }
    }

    public ArrayList<d>[] a(long j) {
        double d = (double) j;
        Double.isNaN(d);
        long round = Math.round((d * 5.0d) / 10.0d);
        Double.isNaN(d);
        long round2 = Math.round((d * 3.0d) / 10.0d);
        long j2 = (j - round) - round2;
        com.jd.amon.sdk.JdBaseReporter.b.a a = this.a.a(b$a.CORE);
        com.jd.amon.sdk.JdBaseReporter.b.a a2 = this.a.a(b$a.MEDIUM);
        com.jd.amon.sdk.JdBaseReporter.b.a a3 = this.a.a(b$a.NORMAL);
        long d2 = a.d();
        long d3 = a2.d();
        long d4 = a3.d();
        round2 = 0;
        if (d2 <= round || d3 <= round2 || d4 <= j2) {
            if (d2 <= round && d3 <= round2 && d4 <= j2) {
                round = d2;
            } else if (d2 <= round || d3 > round2 || d4 > j2) {
                if (d2 > round || d3 <= round2 || d4 > j2) {
                    if (d2 <= round && d3 <= round2 && d4 > j2) {
                        j2 = Math.min(j - (d2 + d3), d4);
                        round = d2;
                    } else if (d2 > round && d3 > round2 && d4 <= j2) {
                        double d5 = (double) (j2 - d4);
                        Double.isNaN(d5);
                        round = Math.min(round + Math.round((d5 * 5.0d) / 8.0d), d2);
                        round2 = Math.min((j - d4) - round, d3);
                    } else if (d2 <= round && d3 > round2 && d4 > j2) {
                        double d6 = (double) (round - d2);
                        Double.isNaN(d6);
                        round2 = Math.min(round2 + Math.round((d6 * 3.0d) / 5.0d), d3);
                        j2 = Math.min((j - d2) - round2, d4);
                        round = d2;
                    } else if (d2 <= round || d3 > round2 || d4 <= j2) {
                        round = 0;
                        j2 = 0;
                    } else {
                        double d7 = (double) (round2 - d3);
                        Double.isNaN(d7);
                        round = Math.min(round + Math.round((d7 * 5.0d) / 7.0d), d2);
                        j2 = Math.min((j - d3) - round, d4);
                    }
                    round2 = d3;
                } else {
                    round2 = Math.min(j - (d2 + d4), d3);
                    round = d2;
                }
                j2 = d4;
            } else {
                round = Math.min(j - (d3 + d4), d2);
            }
            round2 = d3;
            j2 = d4;
        }
        if (e.a) {
            e.a("ReportDataResolver", "当前数据库中的数据量 core:" + d2 + " medium:" + d3 + " normal:" + d4);
            e.a("ReportDataResolver", "当前上报的数据量 core:" + round + " medium:" + round2 + " normal:" + j2);
        }
        return new ArrayList[]{a.a(Long.valueOf(round)), a2.a(Long.valueOf(round2)), a3.a(Long.valueOf(j2))};
    }
}
