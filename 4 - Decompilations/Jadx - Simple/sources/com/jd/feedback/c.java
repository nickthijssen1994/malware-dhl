package com.jd.feedback;

import android.net.Uri;
import android.os.Process;
import android.util.Log;
import android.util.LruCache;
import com.jd.feedback.b.b;
import com.jd.feedback.network.a;
import com.jd.feedback.network.result.FeedbackRequestResult;
import com.jingdong.common.utils.Configuration;
import io.reactivex.Observable;
import io.reactivex.ObservableSource;
import io.reactivex.functions.Function;
import io.reactivex.schedulers.Schedulers;
import java.util.List;

/* compiled from: TbsSdkJava */
/* loaded from: classes.dex */
public final class c {
    private static LruCache<String, String> a = new LruCache<>(5);

    public static Observable<String> a(List<Uri> list) {
        return a(false, list, (String) null);
    }

    public static Observable<String> a(List<Uri> list, String str) {
        return a(true, list, str);
    }

    private static Observable<String> a(final boolean z, List<Uri> list, final String str) {
        return Observable.fromIterable(list).flatMap(new Function<Uri, ObservableSource<String>>() { // from class: com.jd.feedback.c.1
            public final /* synthetic */ Object apply(Object obj) {
                return c.a(z, (Uri) obj, str).subscribeOn(Schedulers.computation());
            }
        });
    }

    static /* synthetic */ Observable a(final boolean z, Uri uri, final String str) {
        return Observable.just(uri).subscribeOn(Schedulers.computation()).map(new Function<Uri, String>() { // from class: com.jd.feedback.c.4
            public final /* synthetic */ Object apply(Object obj) {
                return a((Uri) obj);
            }

            private static String a(Uri uri2) {
                Log.i("ImageProccessor", "图片压缩编码 at thread " + Process.myTid());
                try {
                    return b.a(b.a(uri2));
                } catch (Exception e) {
                    Log.w("ImageProccessor", "读取图片失败: " + e.getMessage());
                    throw e;
                }
            }
        }).flatMap(new Function<String, ObservableSource<FeedbackRequestResult>>() { // from class: com.jd.feedback.c.3
            public final /* synthetic */ Object apply(Object obj) {
                String str2 = (String) obj;
                if (z) {
                    String str3 = str;
                    a.a("clientVersion", "build", Configuration.PARTNER, "appKey", "secretKey", "userId");
                    return a.a(true, str2, str3);
                }
                a.a("clientVersion", "build", Configuration.PARTNER, "appKey", "secretKey");
                return a.a(false, str2, (String) null);
            }
        }).map(new Function<FeedbackRequestResult, String>() { // from class: com.jd.feedback.c.2
            public final /* synthetic */ Object apply(Object obj) {
                FeedbackRequestResult feedbackRequestResult = (FeedbackRequestResult) obj;
                if (feedbackRequestResult.getState().equals("200")) {
                    Log.i("TAG", "image upload success :" + feedbackRequestResult.getMessage());
                } else {
                    Log.w("TAG", "image upload fail :" + feedbackRequestResult.getMessage());
                }
                return feedbackRequestResult.getImageUrl();
            }
        });
    }
}
