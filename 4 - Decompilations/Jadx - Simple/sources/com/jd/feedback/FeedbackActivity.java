package com.jd.feedback;

import android.app.Dialog;
import android.content.Context;
import android.content.Intent;
import android.graphics.Color;
import android.net.Uri;
import android.os.Build;
import android.os.Bundle;
import android.text.Editable;
import android.text.TextUtils;
import android.text.TextWatcher;
import android.util.Log;
import android.view.MotionEvent;
import android.view.View;
import android.view.inputmethod.InputMethodManager;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.ScrollView;
import android.widget.TextView;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.appcompat.widget.AppCompatImageView;
import androidx.constraintlayout.widget.ConstraintLayout;
import androidx.core.app.ActivityCompat;
import androidx.core.content.ContextCompat;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import com.facebook.react.views.textinput.ReactEditTextInputConnectionWrapper;
import com.google.android.flexbox.FlexboxLayoutManager;
import com.google.gson.Gson;
import com.jakewharton.rxbinding2.b.f;
import com.jd.feedback.FeedbackSDK;
import com.jd.feedback.album.a.c.a;
import com.jd.feedback.album.a.e;
import com.jd.feedback.album.d;
import com.jd.feedback.b.g;
import com.jd.feedback.network.result.FeedbackRequestResult;
import com.jd.feedback.network.result.StatisticsRequestResult;
import com.jd.feedback.ui.a;
import com.jd.feedback.ui.a.a;
import com.jd.feedback.ui.b;
import com.jd.feedback.ui.c;
import com.uber.autodispose.l;
import io.reactivex.Notification;
import io.reactivex.Observable;
import io.reactivex.ObservableSource;
import io.reactivex.Observer;
import io.reactivex.android.schedulers.AndroidSchedulers;
import io.reactivex.disposables.Disposable;
import io.reactivex.functions.BiPredicate;
import io.reactivex.functions.Consumer;
import io.reactivex.functions.Function;
import io.reactivex.functions.Function3;
import io.reactivex.functions.Predicate;
import io.reactivex.schedulers.Schedulers;
import io.reactivex.subjects.ReplaySubject;
import java.io.File;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import java.util.concurrent.TimeUnit;
import java.util.regex.Pattern;

/* compiled from: TbsSdkJava */
/* loaded from: classes.dex */
public class FeedbackActivity extends AppCompatActivity {
    private Observable<Object> A;
    private String E;
    private List<a> F;
    private int G;
    ReplaySubject<Integer> a;
    Observable<Integer> b;
    Observable<Integer> c;
    private ConstraintLayout d;
    private View e;
    private ScrollView f;
    private TextView g;
    private EditText h;
    private TextView i;
    private RecyclerView j;
    private EditText k;
    private Button l;
    private AppCompatImageView m;
    private TextView n;
    private TextView o;
    private View p;
    private ImageView q;
    private TextView r;
    private Dialog s;
    private Dialog t;
    private Dialog u;
    private Dialog v;
    private com.jd.feedback.ui.a.a<a> w;
    private RecyclerView x;
    private c y;
    private List<String> z = new ArrayList();
    private final String B = "PHONE";
    private final String C = "COO_IMAGES";
    private final String D = "SELECTED_TYPE_INDEX";
    private boolean H = false;
    private boolean I = false;
    private String J = null;
    private List<a> K = new ArrayList();
    private ArrayList<d> L = new ArrayList<>();
    private View.OnTouchListener M = new View.OnTouchListener() { // from class: com.jd.feedback.FeedbackActivity.19
        @Override // android.view.View.OnTouchListener
        public final boolean onTouch(View view, MotionEvent motionEvent) {
            if (view.getId() == R.id.feedback_scrollview) {
                if (view.getId() != R.id.feedback_edit_content) {
                    FeedbackActivity.a(FeedbackActivity.this, view);
                }
            } else if (view.getId() == R.id.feedback_edit_content) {
                if (motionEvent.getAction() == 1) {
                    FeedbackActivity.this.f.requestDisallowInterceptTouchEvent(false);
                } else {
                    FeedbackActivity.this.f.requestDisallowInterceptTouchEvent(true);
                }
            }
            return false;
        }
    };
    private final int N = 101;
    private final int O = 102;

    /* JADX WARN: Multi-variable type inference failed */
    public void onCreate(Bundle bundle) {
        String str;
        ArrayList<Uri> arrayList;
        List<a> list;
        FeedbackActivity.super.onCreate(bundle);
        Intent intent = getIntent();
        if (intent.getStringExtra(FeedbackReplyActivity.a) != null) {
            this.J = intent.getStringExtra(FeedbackReplyActivity.a);
            this.I = true;
        }
        if (bundle != null) {
            this.H = true;
            this.E = bundle.getString("PHONE");
            this.F = bundle.getParcelableArrayList("COO_IMAGES");
            this.G = bundle.getInt("SELECTED_TYPE_INDEX");
        }
        this.K.clear();
        this.L.clear();
        if (!this.H || (list = this.F) == null) {
            Intent intent2 = getIntent();
            if (intent2 != null) {
                ArrayList parcelableArrayListExtra = intent2.getParcelableArrayListExtra(FeedbackSDK.INTENT_KEY_IMAGES2ADD);
                Log.d("FeedbackActivity", "imagesToAdd: ".concat(String.valueOf(parcelableArrayListExtra)));
                if (parcelableArrayListExtra != null) {
                    try {
                        Log.d("FeedbackActivity", "convert image paths to uris");
                        arrayList = g.a((List) parcelableArrayListExtra, true);
                    } catch (Exception e) {
                        Log.w("FeedbackActivity", "get image uri by path failed");
                        e.printStackTrace();
                        arrayList = new ArrayList<>();
                    }
                } else {
                    arrayList = new ArrayList<>();
                }
                Log.d("FeedbackActivity", "imageUrisToAdd: ".concat(String.valueOf(arrayList)));
                List<a> a = a(arrayList);
                if (a.size() > 3) {
                    this.K.add(a.get(0));
                    this.K.add(a.get(1));
                    this.K.add(a.get(2));
                } else {
                    this.K.addAll(a);
                }
            }
        } else {
            this.K.addAll(list);
        }
        for (a aVar : this.K) {
            d dVar = new d();
            dVar.b = aVar.b;
            this.L.add(dVar);
        }
        setContentView(R.layout.activity_feed_back);
        this.n = (TextView) findViewById(R.id.text_title);
        this.m = findViewById(R.id.btn_back);
        this.m.setOnClickListener(new View.OnClickListener() { // from class: com.jd.feedback.FeedbackActivity.1
            @Override // android.view.View.OnClickListener
            public final void onClick(View view) {
                FeedbackActivity.this.finish();
            }
        });
        this.e = findViewById(R.id.feedback_titlebar_area);
        this.q = (ImageView) findViewById(R.id.feedback_history);
        this.q.setOnClickListener(new View.OnClickListener() { // from class: com.jd.feedback.FeedbackActivity.12
            /* JADX WARN: Type inference failed for: r3v1, types: [android.content.Context, com.jd.feedback.FeedbackActivity] */
            /* JADX WARN: Unknown variable types count: 1 */
            @Override // android.view.View.OnClickListener
            /* Code decompiled incorrectly, please refer to instructions dump */
            public final void onClick(android.view.View r3) {
                /*
                    r2 = this;
                    com.jd.feedback.FeedbackActivity r3 = com.jd.feedback.FeedbackActivity.this
                    android.content.Intent r0 = new android.content.Intent
                    java.lang.Class<com.jd.feedback.FeedbackHistoryActivity> r1 = com.jd.feedback.FeedbackHistoryActivity.class
                    r0.<init>(r3, r1)
                    r3.startActivity(r0)
                    return
                */
                throw new UnsupportedOperationException("Method not decompiled: com.jd.feedback.FeedbackActivity.AnonymousClass12.onClick(android.view.View):void");
            }
        });
        this.r = (TextView) findViewById(R.id.red_point);
        this.r.setVisibility(8);
        this.f = (ScrollView) findViewById(R.id.feedback_scrollview);
        this.g = (TextView) findViewById(R.id.feedback_question_sentence);
        this.x = findViewById(R.id.feedback_titles_view);
        this.x.setLayoutManager(new FlexboxLayoutManager(this, 0, 1));
        this.y = new c(this.z, new c.a() { // from class: com.jd.feedback.FeedbackActivity.22
        });
        this.x.setAdapter(this.y);
        this.h = (EditText) findViewById(R.id.feedback_edit_content);
        this.b = com.jakewharton.rxbinding2.b.c.b(this.h).map(new Function<com.jakewharton.rxbinding2.b.d, Integer>() { // from class: com.jd.feedback.FeedbackActivity.23
            public final /* synthetic */ Object apply(Object obj) {
                return Integer.valueOf(((com.jakewharton.rxbinding2.b.d) obj).b().toString().length());
            }
        });
        this.i = (TextView) findViewById(R.id.feedback_control_text);
        this.a = ReplaySubject.create();
        this.j = findViewById(R.id.feedback_dragView);
        this.w = new com.jd.feedback.ui.a.a<>(this.K);
        this.a.onNext(Integer.valueOf(this.w.b()));
        this.j.setLayoutManager(new LinearLayoutManager(this, 0, false));
        this.j.setAdapter(this.w);
        this.w.b = new a.c() { // from class: com.jd.feedback.FeedbackActivity.24
            @Override // com.jd.feedback.ui.a.a.c
            public final void a() {
                if (FeedbackActivity.a(FeedbackActivity.this, 101, new String[]{"android.permission.READ_EXTERNAL_STORAGE", "android.permission.CAMERA"})) {
                    FeedbackActivity.this.c();
                }
            }

            @Override // com.jd.feedback.ui.a.a.c
            public final void a(ImageView imageView, Object obj) {
                if (FeedbackActivity.a(FeedbackActivity.this, 102, new String[]{"android.permission.READ_EXTERNAL_STORAGE"})) {
                    FeedbackSDK.getImageLoader().load(imageView, ((com.jd.feedback.ui.a) obj).a, null, null, FeedbackSDK.ImageLoader.OPTION_CENTER_CROP);
                }
            }

            @Override // com.jd.feedback.ui.a.a.c
            public final void a(List list2, int i) {
                FeedbackActivity.this.a.onNext(Integer.valueOf(list2.size() - 1));
                FeedbackActivity.this.L.remove(i);
            }
        };
        this.l = (Button) findViewById(R.id.feedback_submit_button);
        this.k = (EditText) findViewById(R.id.feedback_personal_phone);
        this.c = com.jakewharton.rxbinding2.b.c.b(this.k).map(new Function<com.jakewharton.rxbinding2.b.d, Integer>() { // from class: com.jd.feedback.FeedbackActivity.25
            public final /* synthetic */ Object apply(Object obj) {
                return Integer.valueOf(((com.jakewharton.rxbinding2.b.d) obj).b().toString().length());
            }
        });
        if (this.H && (str = this.E) != null) {
            this.k.setText(str);
        } else if (!TextUtils.isEmpty(FeedbackSDK.getUserPhoneNumber())) {
            this.k.setText(FeedbackSDK.getUserPhoneNumber());
        }
        this.k.addTextChangedListener(new TextWatcher() { // from class: com.jd.feedback.FeedbackActivity.26
            @Override // android.text.TextWatcher
            public final void beforeTextChanged(CharSequence charSequence, int i, int i2, int i3) {
            }

            @Override // android.text.TextWatcher
            public final void onTextChanged(CharSequence charSequence, int i, int i2, int i3) {
                try {
                    String obj = FeedbackActivity.this.k.getText().toString();
                    String a2 = FeedbackActivity.a(obj);
                    if (!TextUtils.isEmpty(a2) && !obj.equals(a2)) {
                        FeedbackActivity.this.k.setText(a2);
                        FeedbackActivity.this.k.setSelection(a2.length());
                    }
                } catch (Exception e2) {
                    e2.printStackTrace();
                }
            }

            @Override // android.text.TextWatcher
            public final void afterTextChanged(Editable editable) {
                if (editable.toString().trim().length() == 0) {
                    FeedbackActivity.this.k.setHint(a.i());
                }
            }
        });
        this.o = (TextView) findViewById(R.id.phoneTextleft);
        this.p = findViewById(R.id.phone_area);
        this.d = findViewById(R.id.feedback_root);
        this.t = new Dialog(this, R.style.bgTransparent);
        this.t.setContentView(R.layout.dialog_fail);
        this.t.setCanceledOnTouchOutside(false);
        this.t.findViewById(R.id.btn_negative).setOnClickListener(new View.OnClickListener() { // from class: com.jd.feedback.FeedbackActivity.27
            @Override // android.view.View.OnClickListener
            public final void onClick(View view) {
                FeedbackActivity.this.t.dismiss();
            }
        });
        this.A = com.jakewharton.rxbinding2.a.a.a(this.t.findViewById(R.id.btn_positive)).doOnNext(new Consumer<Object>() { // from class: com.jd.feedback.FeedbackActivity.28
            public final void accept(Object obj) {
                FeedbackActivity.this.t.dismiss();
            }
        });
        this.v = new Dialog(this, R.style.bgTransparent);
        this.v.setContentView(R.layout.dialog_pulling);
        this.v.setCanceledOnTouchOutside(false);
        this.u = new Dialog(this, R.style.bgTransparent);
        this.u.setContentView(R.layout.dialog_success);
        this.s = new Dialog(this, R.style.bgTransparent);
        this.s.setContentView(R.layout.dialog_uploading);
        this.s.setCanceledOnTouchOutside(false);
        getWindow().setSoftInputMode(18);
        a();
        this.v.show();
        FeedbackSDK.api_pullconfig(this, new FeedbackSDK.PullConfigListener() { // from class: com.jd.feedback.FeedbackActivity.2
            @Override // com.jd.feedback.FeedbackSDK.FeedbackRequestListener
            public final void onSuccess(String str2) {
                if (FeedbackActivity.this.v != null) {
                    FeedbackActivity.this.v.dismiss();
                }
                FeedbackActivity.this.a();
                FeedbackActivity.this.b();
            }

            @Override // com.jd.feedback.FeedbackSDK.FeedbackRequestListener
            public final void onFailure(Throwable th) {
                if (FeedbackActivity.this.v != null) {
                    FeedbackActivity.this.v.dismiss();
                }
                FeedbackActivity.this.b();
            }
        });
        ((l) com.jakewharton.rxbinding2.b.c.a(this.h).doOnNext(new Consumer<f>() { // from class: com.jd.feedback.FeedbackActivity.3
            public final /* synthetic */ void accept(Object obj) {
                try {
                    String charSequence = ((f) obj).b().toString();
                    String a2 = FeedbackActivity.a(charSequence);
                    if (!TextUtils.isEmpty(a2) && !charSequence.equals(a2)) {
                        FeedbackActivity.this.h.setText(a2);
                        FeedbackActivity.this.h.setSelection(a2.length());
                    }
                } catch (Exception e2) {
                    e2.printStackTrace();
                }
            }
        }).as(com.uber.autodispose.a.a(com.uber.autodispose.android.lifecycle.a.a(this)))).a();
        ((l) this.b.doOnNext(new Consumer<Integer>() { // from class: com.jd.feedback.FeedbackActivity.7
            public final /* synthetic */ void accept(Object obj) {
                TextView textView = FeedbackActivity.this.i;
                textView.setText(((Integer) obj) + "/500");
            }
        }).distinctUntilChanged(new BiPredicate<Integer, Integer>() { // from class: com.jd.feedback.FeedbackActivity.6
            public final /* synthetic */ boolean test(Object obj, Object obj2) {
                return ((Integer) obj).intValue() >= 480 && ((Integer) obj2).intValue() >= 480;
            }
        }).filter(new Predicate<Integer>() { // from class: com.jd.feedback.FeedbackActivity.5
            public final /* synthetic */ boolean test(Object obj) {
                return ((Integer) obj).intValue() >= 480;
            }
        }).as(com.uber.autodispose.a.a(com.uber.autodispose.android.lifecycle.a.a(this)))).a(new Observer<Integer>() { // from class: com.jd.feedback.FeedbackActivity.4
            public final void onComplete() {
            }

            public final void onSubscribe(Disposable disposable) {
            }

            public final void onError(Throwable th) {
                th.printStackTrace();
            }

            /* JADX WARN: Type inference failed for: r3v1, types: [android.content.Context, com.jd.feedback.FeedbackActivity] */
            /* JADX WARN: Unknown variable types count: 1 */
            /* Code decompiled incorrectly, please refer to instructions dump */
            public final /* synthetic */ void onNext(java.lang.Object r3) {
                /*
                    r2 = this;
                    com.jd.feedback.FeedbackActivity r3 = com.jd.feedback.FeedbackActivity.this
                    int r0 = com.jd.feedback.R.string.lib_setting_feedback_text_size_limitcontent
                    java.lang.String r0 = r3.getString(r0)
                    r1 = 0
                    android.widget.Toast r3 = android.widget.Toast.makeText(r3, r0, r1)
                    r3.show()
                    return
                */
                throw new UnsupportedOperationException("Method not decompiled: com.jd.feedback.FeedbackActivity.AnonymousClass4.onNext(java.lang.Object):void");
            }
        });
        ((l) Observable.combineLatest(this.a.startWith(0), this.b.startWith(0), this.c.startWith(0), new Function3<Integer, Integer, Integer, Boolean>() { // from class: com.jd.feedback.FeedbackActivity.9
            public final /* synthetic */ Object apply(Object obj, Object obj2, Object obj3) {
                Integer num = (Integer) obj;
                Integer num2 = (Integer) obj2;
                Log.d("FeedbackActivity", "combine imageSize=" + num + ", contentlength=" + num2 + ", phoneLength=" + ((Integer) obj3));
                if (FeedbackActivity.this.I && (num.intValue() > 0 || num2.intValue() > 0)) {
                    return Boolean.TRUE;
                }
                if (FeedbackActivity.this.I || ((num.intValue() <= 0 && num2.intValue() <= 0) || (a.o() && FeedbackActivity.this.k.getText().toString().trim().length() <= 0))) {
                    return Boolean.FALSE;
                }
                return Boolean.TRUE;
            }
        }).doOnNext(new Consumer<Boolean>() { // from class: com.jd.feedback.FeedbackActivity.8
            public final /* synthetic */ void accept(Object obj) {
                FeedbackActivity.this.a(((Boolean) obj).booleanValue());
            }
        }).as(com.uber.autodispose.a.a(com.uber.autodispose.android.lifecycle.a.a(this)))).a();
        ((l) Observable.merge(this.A, com.jakewharton.rxbinding2.a.a.a(this.l)).doAfterNext(new Consumer<Object>() { // from class: com.jd.feedback.FeedbackActivity.17
            public final void accept(Object obj) {
                FeedbackActivity.q(FeedbackActivity.this);
            }
        }).concatMap(new Function<Object, ObservableSource<FeedbackRequestResult>>() { // from class: com.jd.feedback.FeedbackActivity.16
            public final /* synthetic */ Object apply(Object obj) {
                Observable<String> observable;
                ArrayList arrayList2 = new ArrayList();
                StringBuilder sb = new StringBuilder("image paths: ");
                for (com.jd.feedback.ui.a aVar2 : FeedbackActivity.this.w.a()) {
                    arrayList2.add(aVar2.a);
                    sb.append(ReactEditTextInputConnectionWrapper.NEWLINE_RAW_VALUE);
                    sb.append(aVar2.b);
                }
                Log.d("FeedbackActivity", sb.toString());
                if (FeedbackActivity.this.I) {
                    observable = c.a(arrayList2, FeedbackActivity.this.J);
                } else {
                    observable = c.a(arrayList2);
                }
                return observable.observeOn(Schedulers.computation()).toList().doOnSuccess(new Consumer<List<String>>() { // from class: com.jd.feedback.FeedbackActivity.16.2
                    public final /* synthetic */ void accept(Object obj2) {
                        if (((List) obj2).size() < FeedbackActivity.this.w.a().size()) {
                            throw new Exception("部分图片上传失败");
                        }
                    }
                }).flatMapObservable(new Function<List<String>, ObservableSource<FeedbackRequestResult>>() { // from class: com.jd.feedback.FeedbackActivity.16.1
                    public final /* synthetic */ Object apply(Object obj2) {
                        List list2 = (List) obj2;
                        Log.i("FeedbackActivity", "-------------意见反馈开始");
                        String str2 = !FeedbackActivity.this.I ? (String) FeedbackActivity.this.z.get(FeedbackActivity.this.y.a) : null;
                        String obj3 = FeedbackActivity.this.h.getText().toString();
                        String obj4 = FeedbackActivity.this.k.getText().toString();
                        Log.d("FeedbackActivity", "\ntype: " + str2 + "\ntext: " + obj3 + "\nphone: " + obj4 + "\nurls: " + list2);
                        if (FeedbackActivity.this.I) {
                            return com.jd.feedback.network.a.a(obj3, list2, FeedbackActivity.this.J);
                        }
                        return com.jd.feedback.network.a.a(str2, obj3, obj4, list2);
                    }
                });
            }
        }).observeOn(AndroidSchedulers.mainThread()).doOnEach(new Consumer<Notification<FeedbackRequestResult>>() { // from class: com.jd.feedback.FeedbackActivity.15
            public final /* synthetic */ void accept(Object obj) {
                Log.i("FeedbackActivity", "-------------意见反馈结束");
                FeedbackActivity.l(FeedbackActivity.this);
            }
        }).doOnError(new Consumer<Throwable>() { // from class: com.jd.feedback.FeedbackActivity.14
            public final /* synthetic */ void accept(Object obj) {
                Throwable th = (Throwable) obj;
                Log.w("FeedbackActivity", "反馈失败 ：" + th.getMessage());
                th.printStackTrace();
                FeedbackActivity.this.t.show();
            }
        }).retry().doOnNext(new Consumer<FeedbackRequestResult>() { // from class: com.jd.feedback.FeedbackActivity.13
            public final /* synthetic */ void accept(Object obj) {
                FeedbackActivity.this.u.show();
            }
        }).delay(2, TimeUnit.SECONDS).doOnNext(new Consumer<FeedbackRequestResult>() { // from class: com.jd.feedback.FeedbackActivity.11
            public final /* synthetic */ void accept(Object obj) {
                Log.d("FeedbackActivity", "after delay at : " + Thread.currentThread().getName());
            }
        }).as(com.uber.autodispose.a.a(com.uber.autodispose.android.lifecycle.a.a(this)))).a(new Consumer<FeedbackRequestResult>() { // from class: com.jd.feedback.FeedbackActivity.10
            public final /* synthetic */ void accept(Object obj) {
                Log.d("FeedbackActivity", "after delay finish at : " + Thread.currentThread().getName());
                FeedbackActivity.this.finish();
            }
        });
        if (this.I) {
            this.g.setVisibility(8);
            this.x.setVisibility(8);
            this.o.setVisibility(8);
            this.k.setVisibility(8);
            this.p.setVisibility(8);
        }
    }

    protected void onSaveInstanceState(Bundle bundle) {
        FeedbackActivity.super.onSaveInstanceState(bundle);
        EditText editText = this.k;
        if (editText != null) {
            bundle.putString("PHONE", editText.getText().toString());
        }
        com.jd.feedback.ui.a.a<com.jd.feedback.ui.a> aVar = this.w;
        if (aVar != null) {
            bundle.putParcelableArrayList("COO_IMAGES", new ArrayList<>(aVar.a()));
        }
        c cVar = this.y;
        if (cVar != null) {
            bundle.putInt("SELECTED_TYPE_INDEX", cVar.a);
        }
    }

    /* JADX WARN: Multi-variable type inference failed */
    private List<com.jd.feedback.ui.a> a(List<Uri> list) {
        ArrayList arrayList = new ArrayList();
        if (list != null && list.size() > 0) {
            for (Uri uri : list) {
                String a = g.a((Context) this, uri);
                if (a != null) {
                    arrayList.add(new com.jd.feedback.ui.a(uri, a));
                }
            }
        }
        return arrayList;
    }

    public void a() {
        this.e.setBackgroundColor(Color.parseColor(a.d()));
        this.n.setTextColor(Color.parseColor(a.c()));
        if (this.I) {
            this.n.setText(getResources().getString(R.string.feedback_title_reply));
        } else {
            this.n.setText(a.b());
        }
        if (this.I || !a.p()) {
            this.q.setVisibility(8);
            this.r.setVisibility(8);
        } else {
            this.q.setVisibility(0);
        }
        this.g.setText(a.e());
        this.z.clear();
        this.z.addAll(a.f());
        this.y.a(this.z);
        if (this.H) {
            this.y.a(this.G);
        }
        this.y.notifyDataSetChanged();
        this.h.setHint(a.g());
        if (!a.n() || this.I) {
            this.p.setVisibility(8);
            this.o.setVisibility(8);
            this.k.setVisibility(8);
        } else {
            this.p.setVisibility(0);
            this.o.setVisibility(0);
            TextView textView = this.o;
            StringBuilder sb = new StringBuilder();
            sb.append(a.h());
            sb.append(a.o() ? "(必填)" : "");
            textView.setText(sb.toString());
            this.k.setVisibility(0);
            this.k.setHint(a.i());
        }
        this.l.setText(a.j());
        this.l.setTextColor(Color.parseColor(a.k()));
        this.d.setBackgroundColor(Color.parseColor(a.m()));
        if (this.I) {
            if (this.w.b() > 0 || this.h.getText().toString().trim().length() > 0) {
                a(true);
            } else {
                a(false);
            }
        } else if ((this.w.b() > 0 || this.h.getText().toString().trim().length() > 0) && (!a.o() || this.k.getText().toString().trim().length() > 0)) {
            a(true);
        } else {
            a(false);
        }
    }

    public void b() {
        if (!TextUtils.isEmpty(FeedbackSDK.getUserId())) {
            if (this.I || this.q.getVisibility() != 0) {
                this.r.setVisibility(8);
            } else {
                FeedbackSDK.api_getFeedbackStatistics(this, new FeedbackSDK.FeedbackRequestListener() { // from class: com.jd.feedback.FeedbackActivity.18
                    @Override // com.jd.feedback.FeedbackSDK.FeedbackRequestListener
                    public final void onSuccess(String str) {
                        StatisticsRequestResult statisticsRequestResult = (StatisticsRequestResult) new Gson().fromJson(str, StatisticsRequestResult.class);
                        if (statisticsRequestResult.getData().getUnreadReplyCount() > 0) {
                            FeedbackActivity.this.r.setVisibility(0);
                            FeedbackActivity.this.r.setText(String.valueOf(statisticsRequestResult.getData().getUnreadReplyCount()));
                            return;
                        }
                        FeedbackActivity.this.r.setVisibility(8);
                    }

                    @Override // com.jd.feedback.FeedbackSDK.FeedbackRequestListener
                    public final void onFailure(Throwable th) {
                        FeedbackActivity.this.r.setVisibility(8);
                    }
                });
            }
        }
    }

    protected void onStart() {
        FeedbackActivity.super.onStart();
        b();
    }

    public void a(boolean z) {
        this.l.setEnabled(z);
        this.l.setClickable(z);
        if (z) {
            this.l.setBackgroundColor(Color.parseColor(a.l()));
        } else {
            this.l.setBackgroundColor(getResources().getColor(R.color.frame_gray));
        }
    }

    protected void onDestroy() {
        FeedbackActivity.super.onDestroy();
        Dialog dialog = this.u;
        if (dialog != null) {
            dialog.dismiss();
        }
        Dialog dialog2 = this.t;
        if (dialog2 != null) {
            dialog2.dismiss();
        }
        Dialog dialog3 = this.v;
        if (dialog3 != null) {
            dialog3.dismiss();
        }
    }

    /* JADX WARN: Multi-variable type inference failed */
    public void onRequestPermissionsResult(int i, String[] strArr, int[] iArr) {
        switch (i) {
            case 101:
                StringBuffer stringBuffer = new StringBuffer();
                for (int i2 = 0; i2 < iArr.length; i2++) {
                    if (iArr[i2] != 0) {
                        if (stringBuffer.length() > 0) {
                            stringBuffer.append("、");
                        }
                        if (strArr[i2].endsWith("STORAGE")) {
                            stringBuffer.append("存储空间");
                        } else if (strArr[i2].endsWith("CAMERA")) {
                            stringBuffer.append("相机");
                        }
                    }
                }
                if (stringBuffer.length() > 0) {
                    stringBuffer.insert(0, "请在设置-->权限管理中开启本应用的");
                    stringBuffer.append("访问权限");
                    b.a(this, stringBuffer.toString()).show();
                    return;
                }
                c();
                return;
            case 102:
                if (iArr[0] != 0) {
                    Log.d("FeedbackActivity", "存储访问权限被拒绝，不加载图片.");
                    this.K.clear();
                    this.L.clear();
                    this.w.a = this.K;
                    b.a(this, "请在设置-->权限管理中开启本应用的存储空间访问权限").show();
                }
                this.w.notifyDataSetChanged();
                return;
            default:
                return;
        }
    }

    /* JADX WARN: Multi-variable type inference failed */
    public void c() {
        e a = com.jd.feedback.album.b.b(this).a();
        a.f = true;
        e eVar = a;
        eVar.g = 4;
        e eVar2 = eVar;
        eVar2.k = 3;
        eVar2.e = this.L;
        a.C0017a a2 = com.jd.feedback.album.a.c.a.a((Context) this);
        a2.f = "选择图片";
        eVar2.d = a2.a();
        e eVar3 = eVar2;
        eVar3.b = new com.jd.feedback.album.a<ArrayList<d>>() { // from class: com.jd.feedback.FeedbackActivity.21
            @Override // com.jd.feedback.album.a
            public final /* synthetic */ void a(@NonNull ArrayList<d> arrayList) {
                ArrayList<d> arrayList2 = arrayList;
                FeedbackActivity.this.L = arrayList2;
                ArrayList arrayList3 = new ArrayList();
                Iterator<d> it = arrayList2.iterator();
                while (it.hasNext()) {
                    d next = it.next();
                    if (new File(next.b).exists()) {
                        arrayList3.add(new com.jd.feedback.ui.a(Uri.parse("content://media/external/images/media/" + next.a), next.b));
                    }
                }
                com.jd.feedback.ui.a.a aVar = FeedbackActivity.this.w;
                aVar.a.clear();
                aVar.a.addAll(arrayList3);
                aVar.notifyDataSetChanged();
                FeedbackActivity.this.a.onNext(Integer.valueOf(FeedbackActivity.this.w.a().size()));
            }
        };
        e eVar4 = eVar3;
        eVar4.c = new com.jd.feedback.album.a<String>() { // from class: com.jd.feedback.FeedbackActivity.20
            @Override // com.jd.feedback.album.a
            public final /* bridge */ /* synthetic */ void a(@NonNull String str) {
            }
        };
        eVar4.a();
    }

    /* JADX WARN: Multi-variable type inference failed */
    static /* synthetic */ boolean a(FeedbackActivity feedbackActivity, int i, String[] strArr) {
        boolean z = false;
        if (Build.VERSION.SDK_INT >= 23) {
            ArrayList arrayList = new ArrayList();
            for (String str : strArr) {
                if (ContextCompat.checkSelfPermission(feedbackActivity, str) != 0) {
                    arrayList.add(str);
                }
            }
            Log.d("FeedbackActivity", "check deniedPermissions: " + arrayList.size());
            if (arrayList.size() > 0) {
                ActivityCompat.requestPermissions(feedbackActivity, (String[]) arrayList.toArray(new String[arrayList.size()]), i);
                Log.d("FeedbackActivity", "check permission: ".concat(String.valueOf(z)));
                return z;
            }
        }
        z = true;
        Log.d("FeedbackActivity", "check permission: ".concat(String.valueOf(z)));
        return z;
    }

    static /* synthetic */ String a(String str) {
        if (str == null) {
            return str;
        }
        return Pattern.compile("onload(.*?)=", 42).matcher(Pattern.compile("vbscript:", 2).matcher(Pattern.compile("javascript:", 2).matcher(Pattern.compile("e\u00adxpression\\((.*?)\\)", 42).matcher(Pattern.compile("eval\\((.*?)\\)", 42).matcher(Pattern.compile("<script(.*?)>", 42).matcher(Pattern.compile("</script>", 2).matcher(Pattern.compile("src[\r\n]*=[\r\n]*\\\"(.*?)\\\"", 42).matcher(Pattern.compile("src[\r\n]*=[\r\n]*\\'(.*?)\\'", 42).matcher(Pattern.compile("<script>(.*?)</script>", 2).matcher(str.replaceAll("", "")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("");
    }

    static /* synthetic */ void l(FeedbackActivity feedbackActivity) {
        Dialog dialog = feedbackActivity.s;
        if (dialog != null) {
            dialog.dismiss();
        }
    }

    static /* synthetic */ void q(FeedbackActivity feedbackActivity) {
        feedbackActivity.s.show();
    }

    static /* synthetic */ void a(FeedbackActivity feedbackActivity, View view) {
        InputMethodManager inputMethodManager = (InputMethodManager) feedbackActivity.getSystemService("input_method");
        if (inputMethodManager.isActive()) {
            inputMethodManager.hideSoftInputFromWindow(view.getWindowToken(), 0);
        }
    }
}
