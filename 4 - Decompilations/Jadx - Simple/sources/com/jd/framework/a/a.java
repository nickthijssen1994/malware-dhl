package com.jd.framework.a;

import com.jd.framework.network.JDResponseListener;
import com.jd.framework.network.request.JDRequest;
import com.jd.sentry.performance.network.instrumentation.okhttp3.ShooterOkhttp3Instrumentation;
import com.jingdong.sdk.oklog.OKLog;
import java.io.IOException;
import java.util.concurrent.TimeUnit;
import okhttp3.Call;
import okhttp3.Callback;
import okhttp3.OkHttpClient;
import okhttp3.Response;

/* compiled from: TbsSdkJava */
/* loaded from: classes.dex */
public class a {
    private OkHttpClient a = ShooterOkhttp3Instrumentation.builderInit(new OkHttpClient.Builder()).connectTimeout(10000, TimeUnit.MILLISECONDS).readTimeout(15000, TimeUnit.MILLISECONDS).retryOnConnectionFailure(false).build();
    private com.jd.framework.a.a.a b = new com.jd.framework.a.a.a();

    public void a(JDRequest jDRequest) {
        try {
            JDResponseListener responseListener = jDRequest.getResponseListener();
            if (responseListener != null) {
                responseListener.onStart();
            }
            a(jDRequest, false);
        } catch (Throwable unused) {
        }
    }

    public void a(final JDRequest jDRequest, final boolean z) {
        final JDResponseListener responseListener = jDRequest.getResponseListener();
        ShooterOkhttp3Instrumentation.newCall(this.a, this.b.a(jDRequest)).enqueue(new Callback() { // from class: com.jd.framework.a.a.1
            public void onFailure(Call call, IOException iOException) {
                if (call.isCanceled()) {
                    responseListener.onCancel();
                } else if (!z) {
                    if (OKLog.D) {
                        StringBuilder sb = new StringBuilder();
                        sb.append("exception : ");
                        sb.append(iOException != null ? iOException.getMessage() : "unknown");
                        OKLog.d("OkHttpNetworkFetcher", sb.toString());
                    }
                    a.this.a(jDRequest, true);
                } else {
                    responseListener.onError(a.this.b.a(jDRequest, iOException, null));
                }
            }

            public void onResponse(Call call, Response response) {
                try {
                    if (!response.isSuccessful() && response.code() != 302) {
                        throw new IOException("request is not success. response code : " + response.code());
                    }
                    responseListener.onEnd(a.this.b.a(jDRequest, response));
                } catch (Exception e) {
                    if (!z) {
                        a.this.a(jDRequest, true);
                        return;
                    }
                    responseListener.onError(a.this.b.a(jDRequest, e, response));
                }
            }
        });
    }
}
