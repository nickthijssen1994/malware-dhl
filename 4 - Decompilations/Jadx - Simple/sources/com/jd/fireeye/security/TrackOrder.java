package com.jd.fireeye.security;

import android.content.Context;
import android.content.SharedPreferences;
import android.text.TextUtils;
import android.util.Base64;
import com.alibaba.fastjson.asm.Opcodes;
import com.jd.fireeye.common.a;
import com.jd.fireeye.common.e;
import com.jd.fireeye.common.g;
import com.jd.fireeye.common.h;
import com.jd.fireeye.common.r;
import com.jd.fireeye.common.s;
import com.jd.lib.un.utils.UnTimeUtils;
import com.jd.push.common.constant.Constants;
import org.json.JSONException;
import org.json.JSONObject;

/* compiled from: TbsSdkJava */
/* loaded from: classes.dex */
public class TrackOrder {
    private static final String BETA_FIRST_ORDER_URL;
    private static final String FIRST_ORDER_URL;
    private static final String TAG;
    private static final String TRACK_KEY;
    private static final String TRACK_SIGNATURE;
    private static final String TRACK_SOURCE_NAME;
    private static SharedPreferences shareStore;

    private static String getFirstOrderURL() {
        return b.e() ? BETA_FIRST_ORDER_URL : FIRST_ORDER_URL;
    }

    public static void putTrackOrderParams(Context context, JSONObject jSONObject) {
        g.b(TAG, "come to putTrackOrderParams");
        initialShareStoreFile(context);
        if (shareStore != null) {
            if (jSONObject != null) {
                String str = "";
                String optString = jSONObject.optString("tracking");
                String optString2 = jSONObject.optString(Constants.JdPushMsg.JSON_KEY_PKG_NAME_full);
                try {
                    SharedPreferences.Editor edit = shareStore.edit();
                    if (!TextUtils.isEmpty(optString)) {
                        edit.putString(TRACK_KEY, optString);
                    }
                    if (!TextUtils.isEmpty(optString2)) {
                        String str2 = new String(Base64.encode(optString2.getBytes(), 2));
                        try {
                            edit.putString(TRACK_SOURCE_NAME, str2).putString(TRACK_SIGNATURE, a.a(context, optString2));
                            str = str2;
                        } catch (Throwable unused) {
                            str = str2;
                        }
                    }
                    edit.commit();
                } catch (Throwable unused2) {
                }
                if (g.a) {
                    g.b(TAG, "put trackid = " + optString + ",packName = " + optString2 + ",encryptSrc = " + str);
                    return;
                }
                return;
            }
            g.a(TAG, "TrackParams is Empty!!!");
        }
    }

    public static JSONObject getTrackOrderParams(Context context) {
        initialShareStoreFile(context);
        JSONObject jSONObject = new JSONObject();
        try {
            g.b(TAG, "come to getTrackOrderParams");
            String str = "";
            String str2 = "";
            if (shareStore != null) {
                str = shareStore.getString(TRACK_KEY, "");
                str2 = shareStore.getString(TRACK_SIGNATURE, "");
                if (g.a) {
                    g.b(TAG, "trackKey = " + str + ",signature = " + str2);
                }
            }
            if (str == null) {
                str = "";
            }
            jSONObject.put("fe_order_track", str);
            if (str2 == null) {
                str2 = "";
            }
            jSONObject.put("advertise_app", str2);
            String a = b.a();
            if (g.a) {
                g.b(TAG, "devicecode = " + a);
            }
            if (!s.b(a)) {
                a = r.b(context);
                if (g.a) {
                    g.b(TAG, "get uuid in sdk,devicecode = " + a);
                }
            }
            e.a encryptDeviceCode = getEncryptDeviceCode(a);
            if (encryptDeviceCode != null) {
                a = encryptDeviceCode.a + "-" + encryptDeviceCode.b;
                jSONObject.put("eufv", "1");
            }
            jSONObject.put(Constants.JdPushMsg.JSON_KEY_UUID, a);
            jSONObject.put("union_id", b.b());
            jSONObject.put("channel_id", b.c());
            jSONObject.put("appkey", "1b41a7042ce724d9ecaa5a15fe9fab7a");
        } catch (Throwable th) {
            th.printStackTrace();
        }
        if (g.a) {
            g.b(TAG, String.format("getTrackOrderParams json: \n%s", h.a(jSONObject.toString())));
        }
        return jSONObject;
    }

    public static void getFirstOrderTracking(Context context, String str, JSONObject jSONObject) {
        if (TextUtils.equals(str, "0")) {
            requestAndSaveTracking(jSONObject);
        } else if (TextUtils.equals(str, "1")) {
            putTrackOrderParams(context, jSONObject);
        }
    }

    private static void requestAndSaveTracking(JSONObject jSONObject) {
        if (jSONObject != null) {
            if (g.a) {
                g.b(TAG, String.format("requestAndSaveTracking param json: \n%s", h.a(jSONObject.toString())));
            }
            if (!TextUtils.isEmpty(jSONObject.optString("firstorderUnion"))) {
                e eVar = new e(getFirstOrderURL(), jSONObject);
                eVar.a((com.jd.fireeye.network.h) new f(jSONObject));
                eVar.a(UnTimeUtils.MIN);
                eVar.a("TrackOrder." + System.currentTimeMillis());
                eVar.d();
            }
        }
    }

    public static JSONObject buildFirstOrderRequest(JSONObject jSONObject) throws JSONException {
        JSONObject jSONObject2 = new JSONObject();
        if (jSONObject != null) {
            String optString = jSONObject.optString("firstorderUnion");
            String optString2 = jSONObject.optString("firstorderChannel");
            String optString3 = jSONObject.optString(Constants.JdPushMsg.JSON_KEY_PKG_NAME_full);
            String optString4 = jSONObject.optString("callerPackage");
            String a = a.a(b.a, optString3);
            String optString5 = jSONObject.optString("firstorderExtended1");
            if (optString5.length() > 127) {
                optString5 = optString5.substring(0, Opcodes.IAND);
            }
            String optString6 = jSONObject.optString("firstorderExtended2");
            if (optString6.length() > 127) {
                optString6 = optString6.substring(0, Opcodes.IAND);
            }
            String optString7 = jSONObject.optString("firstorderExtended3");
            if (optString7.length() > 511) {
                optString7 = optString7.substring(0, 510);
            }
            String optString8 = jSONObject.optString("firstorderExtended4");
            if (optString8.length() > 511) {
                optString8 = optString8.substring(0, 510);
            }
            jSONObject2.put("appkey", "1b41a7042ce724d9ecaa5a15fe9fab7a");
            jSONObject2.put("union", optString);
            jSONObject2.put("channel", optString2);
            jSONObject2.put("appSign", a);
            String a2 = b.a();
            e.a encryptDeviceCode = getEncryptDeviceCode(a2);
            if (encryptDeviceCode != null) {
                a2 = encryptDeviceCode.a + "-" + encryptDeviceCode.b;
                jSONObject2.put("eufv", "1");
            }
            jSONObject2.put("device", a2);
            jSONObject2.put("package", optString3);
            jSONObject2.put("callerPackage", optString4);
            jSONObject2.put("extendedData1", optString5);
            jSONObject2.put("extendedData2", optString6);
            jSONObject2.put("extendedData3", optString7);
            jSONObject2.put("extendedData4", optString8);
            StringBuilder sb = new StringBuilder();
            sb.append(s.c("1b41a7042ce724d9ecaa5a15fe9fab7a" + optString + optString2 + b.a() + optString3 + optString4 + a));
            StringBuilder sb2 = new StringBuilder();
            sb2.append(optString5);
            sb2.append(optString6);
            sb2.append(optString7);
            sb2.append(optString8);
            sb.append(s.c(sb2.toString()));
            jSONObject2.put("sign", s.c(sb.toString()));
        }
        return jSONObject2;
    }

    private static void initialShareStoreFile(Context context) {
        if (shareStore == null) {
            if (context == null) {
                g.a(TAG, "create file but context is null!!!");
            } else {
                shareStore = context.getSharedPreferences("jd_order_identify_encrypt_client", 0);
            }
        }
    }

    private static e.a getEncryptDeviceCode(String str) {
        try {
            if (TextUtils.isEmpty(str) || !str.contains("-")) {
                return null;
            }
            return e.a(str);
        } catch (Exception unused) {
            return null;
        }
    }
}
