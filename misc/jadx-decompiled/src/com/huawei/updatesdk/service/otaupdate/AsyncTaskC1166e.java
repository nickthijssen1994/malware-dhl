package com.huawei.updatesdk.service.otaupdate;

import android.app.Activity;
import android.content.ActivityNotFoundException;
import android.content.Context;
import android.content.Intent;
import android.content.pm.ApplicationInfo;
import android.content.pm.PackageInfo;
import android.os.AsyncTask;
import android.os.Bundle;
import android.text.TextUtils;
import android.util.Log;
import android.widget.Toast;
import com.huawei.updatesdk.p022a.p023a.p025b.p026a.p027a.C1069a;
import com.huawei.updatesdk.p022a.p023a.p028c.p029h.C1080b;
import com.huawei.updatesdk.p022a.p032b.p037d.AsyncTaskC1099b;
import com.huawei.updatesdk.p022a.p032b.p037d.p038c.C1103c;
import com.huawei.updatesdk.p022a.p032b.p037d.p038c.C1104d;
import com.huawei.updatesdk.p039b.p043b.C1113a;
import com.huawei.updatesdk.p039b.p046e.p047a.C1123b;
import com.huawei.updatesdk.p039b.p048f.C1126b;
import com.huawei.updatesdk.service.appmgr.bean.ApkUpgradeInfo;
import com.huawei.updatesdk.service.appmgr.bean.C1142a;
import com.huawei.updatesdk.service.appmgr.bean.C1144b;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;

/* compiled from: TbsSdkJava */
/* renamed from: com.huawei.updatesdk.service.otaupdate.e */
/* loaded from: classes.dex */
public class AsyncTaskC1166e extends AsyncTask<Void, Void, C1104d> {

    /* renamed from: a */
    private Context f1866a;

    /* renamed from: b */
    private CheckUpdateCallBack f1867b;

    /* renamed from: c */
    private UpdateParams f1868c;

    /* renamed from: d */
    private Toast f1869d;

    /* renamed from: e */
    private boolean f1870e = false;

    /* renamed from: f */
    private List<String> f1871f = new ArrayList();

    /* renamed from: g */
    private AsyncTaskC1099b f1872g;

    /* renamed from: h */
    private String f1873h;

    public AsyncTaskC1166e(Context context, UpdateParams updateParams, CheckUpdateCallBack checkUpdateCallBack) {
        this.f1868c = updateParams;
        this.f1866a = context;
        this.f1867b = checkUpdateCallBack;
        C1171h.m2502g().m2509b(updateParams.getServiceZone());
        if (TextUtils.isEmpty(C1171h.m2502g().m2508c())) {
            C1171h.m2502g().m2505d("com.huawei.appmarket");
        }
        this.f1873h = C1171h.m2502g().m2508c();
    }

    /* renamed from: a */
    private PackageInfo m2536a(Context context, String str) {
        PackageInfo a = C1126b.m2645a(str, context);
        if (a != null) {
            return a;
        }
        PackageInfo packageInfo = new PackageInfo();
        packageInfo.packageName = str;
        packageInfo.versionName = "1.0";
        packageInfo.versionCode = 1;
        ApplicationInfo applicationInfo = new ApplicationInfo();
        applicationInfo.targetSdkVersion = 19;
        packageInfo.applicationInfo = applicationInfo;
        return packageInfo;
    }

    /* renamed from: a */
    private C1104d m2535a(Context context, List<String> list) {
        ArrayList arrayList = new ArrayList();
        for (String str : list) {
            arrayList.add(m2536a(context, str));
        }
        C1142a aVar = !C1174i.m2497a(this.f1868c.getParamList()) ? new C1142a(this.f1868c.getParamList()) : C1142a.m2618a(arrayList);
        aVar.m2675a(C1171h.m2502g().m2504e() ? 34 : 0);
        aVar.m2615d(0);
        if (isCancelled()) {
            Log.w("UpdateSDKCheckTask", "UpdateSDK task is canceled and return empty upgradeInfo");
            return null;
        }
        this.f1872g = new AsyncTaskC1099b(aVar, null);
        return this.f1872g.m2736c();
    }

    /* renamed from: a */
    private void m2538a() {
        Toast toast = this.f1869d;
        if (toast != null) {
            toast.cancel();
        }
    }

    /* renamed from: a */
    private void m2537a(Context context, ApkUpgradeInfo apkUpgradeInfo) {
        if (context != null) {
            Intent intent = new Intent(context, AppUpdateActivity.class);
            Bundle bundle = new Bundle();
            bundle.putSerializable("app_update_parm", apkUpgradeInfo);
            bundle.putBoolean("app_must_btn", this.f1868c.isMustBtnOne());
            intent.putExtras(bundle);
            if (!(context instanceof Activity)) {
                intent.setFlags(268435456);
            }
            try {
                context.startActivity(intent);
            } catch (ActivityNotFoundException e) {
                C1069a.m2877b("UpdateSDKCheckTask", "go AppUpdateActivity error: " + e.toString());
            }
        }
    }

    /* renamed from: a */
    private void m2533a(List<ApkUpgradeInfo> list) {
        if (!C1174i.m2497a(list)) {
            for (ApkUpgradeInfo apkUpgradeInfo : list) {
                if (apkUpgradeInfo != null && !TextUtils.isEmpty(apkUpgradeInfo.getFullDownUrl_())) {
                    if (apkUpgradeInfo.getDiffSize_() > 0) {
                        apkUpgradeInfo.setDiffDownUrl_(apkUpgradeInfo.getDownurl_());
                    }
                    apkUpgradeInfo.setDownurl_(apkUpgradeInfo.getFullDownUrl_());
                }
            }
        }
    }

    /* renamed from: b */
    private void m2529b(C1104d dVar) {
        if (this.f1867b != null) {
            Intent intent = new Intent();
            intent.putExtra("status", 6);
            if (dVar.m2723a() != null) {
                intent.putExtra(UpdateKey.FAIL_CODE, dVar.m2723a().ordinal());
            }
            intent.putExtra(UpdateKey.FAIL_REASON, dVar.m2717c());
            intent.putExtra(UpdateKey.RESPONSE_CODE, dVar.m2719b());
            this.f1867b.onUpdateInfo(intent);
            this.f1867b.onUpdateStoreError(dVar.m2716d());
        }
    }

    /* renamed from: b */
    private boolean m2530b() {
        return !this.f1870e && TextUtils.isEmpty(this.f1868c.getTargetPkgName()) && C1174i.m2497a(this.f1868c.getPackageList()) && C1174i.m2497a(this.f1868c.getParamList());
    }

    /* JADX INFO: Access modifiers changed from: protected */
    /* renamed from: a */
    public C1104d doInBackground(Void... voidArr) {
        C1069a.m2879a("UpdateSDKCheckTask", "CheckOtaAndUpdataTask doInBackground");
        C1123b.m2658a(this);
        C1171h.m2502g().m2512a(this.f1866a, this.f1873h);
        C1103c.m2725c(C1080b.m2830c(this.f1866a, C1170g.m2514f(this.f1866a, C1171h.m2502g().m2504e() ? "upsdk_apptouch_store_url" : "upsdk_store_url")));
        String targetPkgName = this.f1868c.getTargetPkgName();
        if (TextUtils.isEmpty(targetPkgName)) {
            targetPkgName = this.f1866a.getPackageName();
        }
        if (!C1174i.m2497a(this.f1868c.getPackageList())) {
            this.f1871f.addAll(this.f1868c.getPackageList());
        } else if (!TextUtils.isEmpty(targetPkgName)) {
            this.f1871f.add(targetPkgName);
        }
        C1113a.m2683c().m2681d(C1171h.m2502g().m2513a());
        return m2535a(this.f1866a, this.f1871f);
    }

    /* JADX INFO: Access modifiers changed from: protected */
    /* renamed from: a */
    public void onPostExecute(C1104d dVar) {
        C1123b.m2659a().remove(this);
        m2538a();
        if (dVar != null) {
            int b = dVar.m2719b();
            ArrayList<ApkUpgradeInfo> arrayList = null;
            if (dVar.m2716d() == 0 && dVar.m2715e() == 0) {
                C1144b bVar = (C1144b) dVar;
                arrayList = bVar.list_;
                if (!C1174i.m2497a(bVar.notRcmList_)) {
                    ApkUpgradeInfo apkUpgradeInfo = bVar.notRcmList_.get(0);
                    Log.w("UpdateSDKCheckTask", "UpdateSDK get update info is not recommend,reason: " + apkUpgradeInfo.getNotRcmReason_() + ",is same signature: " + apkUpgradeInfo.getSameS_());
                }
                m2533a(arrayList);
                if (C1174i.m2497a(arrayList) && this.f1867b != null) {
                    Intent intent = new Intent();
                    intent.putExtra("status", 3);
                    intent.putExtra(UpdateKey.RESPONSE_CODE, b);
                    this.f1867b.onUpdateInfo(intent);
                }
            } else {
                m2529b(dVar);
                Log.e("UpdateSDKCheckTask", "get app update msg failed,responseCode is " + dVar.m2716d() + ",failreason: " + dVar.m2717c());
            }
            if (!C1174i.m2497a(arrayList)) {
                ApkUpgradeInfo apkUpgradeInfo2 = arrayList.get(0);
                if (this.f1867b != null) {
                    Intent intent2 = new Intent();
                    intent2.putExtra(UpdateKey.INFO, (Serializable) apkUpgradeInfo2);
                    intent2.putParcelableArrayListExtra(UpdateKey.INFO_LIST, arrayList);
                    intent2.putExtra("status", 7);
                    intent2.putExtra(UpdateKey.RESPONSE_CODE, b);
                    this.f1867b.onUpdateInfo(intent2);
                }
                if (apkUpgradeInfo2 != null) {
                    Log.i("UpdateSDKCheckTask", "ApkUpgradeInfo,version = " + apkUpgradeInfo2.getVersion_() + ",versionCode = " + apkUpgradeInfo2.getVersionCode_() + ",detailId = " + apkUpgradeInfo2.getDetailId_() + ",devType = " + apkUpgradeInfo2.getDevType_() + ",packageName = " + apkUpgradeInfo2.getPackage_() + ",oldVersionCode = " + apkUpgradeInfo2.getOldVersionCode_());
                } else {
                    Log.e("UpdateSDKCheckTask", "info == null");
                }
                if (this.f1868c.isShowImmediate()) {
                    m2537a(this.f1866a, apkUpgradeInfo2);
                }
            } else if (m2530b()) {
                Context context = this.f1866a;
                Toast.makeText(context, C1170g.m2515e(context, "upsdk_update_check_no_new_version"), 0).show();
            }
        } else if (this.f1867b != null) {
            Intent intent3 = new Intent();
            intent3.putExtra("status", 3);
            this.f1867b.onUpdateInfo(intent3);
        }
    }

    /* renamed from: a */
    public void m2532a(boolean z) {
        this.f1870e = z;
    }

    @Override // android.os.AsyncTask
    protected void onCancelled() {
        super.onCancelled();
        AsyncTaskC1099b bVar = this.f1872g;
        if (bVar != null) {
            bVar.m2739b();
        }
    }

    @Override // android.os.AsyncTask
    protected void onPreExecute() {
        super.onPreExecute();
        C1165d.m2543a().m2540a(this.f1867b);
        if (m2530b()) {
            Context context = this.f1866a;
            this.f1869d = Toast.makeText(context, C1170g.m2515e(context, "upsdk_checking_update_prompt"), 1);
            this.f1869d.show();
        }
    }
}
