package com.huawei.updatesdk.p039b.p040a.p042b;

import android.content.pm.PackageInfo;
import android.os.Build;
import android.util.ArrayMap;
import android.util.ArraySet;
import com.huawei.updatesdk.p022a.p023a.p028c.AbstractC1076g;
import com.huawei.updatesdk.p039b.p040a.p042b.C1108a;
import com.huawei.updatesdk.p039b.p040a.p042b.C1111c;
import java.io.File;
import java.security.PublicKey;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

/* compiled from: TbsSdkJava */
/* renamed from: com.huawei.updatesdk.b.a.b.b */
/* loaded from: classes.dex */
public class C1110b {

    /* renamed from: b */
    private static C1110b f1783b;

    /* renamed from: a */
    private final Map<String, C1108a> f1784a = new HashMap();

    private C1110b() {
    }

    /* renamed from: a */
    public static synchronized C1110b m2698a() {
        C1110b bVar;
        synchronized (C1110b.class) {
            if (f1783b == null) {
                f1783b = new C1110b();
            }
            bVar = f1783b;
        }
        return bVar;
    }

    /* renamed from: a */
    private static void m2696a(C1108a aVar) {
        m2698a().f1784a.put(aVar.m2701c(), aVar);
    }

    /* renamed from: b */
    private static ArrayList<String> m2695b(PackageInfo packageInfo) {
        ArraySet<String> arraySet;
        C1108a aVar = new C1108a();
        aVar.m2703a(packageInfo.packageName);
        File file = new File(packageInfo.applicationInfo.sourceDir);
        if (!file.exists()) {
            return null;
        }
        aVar.m2705a(file.lastModified());
        C1111c.C1112a a = C1111c.m2694a(file);
        ArrayMap<String, ArraySet<PublicKey>> arrayMap = a.f1785a;
        if (arrayMap == null || arrayMap.isEmpty() || (arraySet = a.f1786b) == null || arraySet.isEmpty()) {
            m2696a(aVar);
            return null;
        }
        ArrayList<String> arrayList = new ArrayList<>();
        for (Map.Entry<String, ArraySet<PublicKey>> entry : a.f1785a.entrySet()) {
            if (a.f1786b.contains(entry.getKey())) {
                Iterator<PublicKey> it = entry.getValue().iterator();
                while (it.hasNext()) {
                    arrayList.add(AbstractC1076g.m2856a(it.next().getEncoded()));
                }
            }
        }
        C1108a.C1109a aVar2 = new C1108a.C1109a();
        aVar2.m2699a(arrayList);
        aVar.m2704a(aVar2);
        m2696a(aVar);
        return arrayList;
    }

    /* renamed from: a */
    public List<String> m2697a(PackageInfo packageInfo) {
        String str;
        if (Build.VERSION.SDK_INT < 21 || packageInfo == null || (str = packageInfo.applicationInfo.sourceDir) == null) {
            return null;
        }
        long lastModified = new File(str).lastModified();
        C1108a aVar = m2698a().f1784a.get(packageInfo.packageName);
        if (aVar == null || aVar.m2702b() != lastModified) {
            return m2695b(packageInfo);
        }
        if (aVar.m2706a() == null) {
            return null;
        }
        return aVar.m2706a().m2700a();
    }
}
