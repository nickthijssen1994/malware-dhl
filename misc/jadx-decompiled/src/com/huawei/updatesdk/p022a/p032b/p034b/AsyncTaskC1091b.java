package com.huawei.updatesdk.p022a.p032b.p034b;

import android.content.Context;
import android.content.Intent;
import android.os.AsyncTask;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.text.TextUtils;
import com.huawei.updatesdk.p022a.p023a.p025b.p026a.p027a.C1069a;
import com.huawei.updatesdk.p022a.p023a.p028c.AbstractC1073d;
import com.huawei.updatesdk.p022a.p032b.p033a.C1089a;
import com.huawei.updatesdk.p022a.p032b.p036c.C1097b;
import com.huawei.updatesdk.p039b.p044c.C1119c;
import com.huawei.updatesdk.p039b.p045d.C1121a;
import com.huawei.updatesdk.p039b.p046e.p047a.C1123b;
import java.io.BufferedInputStream;
import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.HttpURLConnection;

/* compiled from: TbsSdkJava */
/* renamed from: com.huawei.updatesdk.a.b.b.b */
/* loaded from: classes.dex */
public class AsyncTaskC1091b extends AsyncTask<Void, Void, Void> {

    /* renamed from: a */
    private String f1749a;

    /* renamed from: b */
    private HttpURLConnection f1750b;

    /* renamed from: d */
    private C1090a f1752d;

    /* renamed from: c */
    private boolean f1751c = false;

    /* renamed from: e */
    private Handler f1753e = new HandlerC1093b(null);

    /* compiled from: TbsSdkJava */
    /* renamed from: com.huawei.updatesdk.a.b.b.b$a */
    /* loaded from: classes.dex */
    class RunnableC1092a implements Runnable {
        RunnableC1092a() {
        }

        @Override // java.lang.Runnable
        public void run() {
            if (AsyncTaskC1091b.this.f1750b != null) {
                AsyncTaskC1091b.this.f1751c = true;
                AsyncTaskC1091b.this.f1750b.disconnect();
            }
            AbstractC1073d.m2867a(new File(AsyncTaskC1091b.m2765e()));
        }
    }

    /* compiled from: TbsSdkJava */
    /* renamed from: com.huawei.updatesdk.a.b.b.b$b */
    /* loaded from: classes.dex */
    private static class HandlerC1093b extends Handler {
        private HandlerC1093b() {
        }

        /* synthetic */ HandlerC1093b(RunnableC1092a aVar) {
            this();
        }

        /* JADX WARN: Can't fix incorrect switch cases order, some code will duplicate */
        @Override // android.os.Handler
        public void handleMessage(Message message) {
            super.handleMessage(message);
            Object obj = message.obj;
            if (obj instanceof C1090a) {
                C1090a aVar = (C1090a) obj;
                Intent intent = new Intent();
                C1097b a = C1097b.m2757a(intent);
                switch (message.what) {
                    case 2:
                        intent.putExtra("download_apk_size", aVar.m2777e());
                        intent.putExtra("download_apk_already", aVar.m2784a());
                        C1119c.m2669b().m2670a(a);
                        return;
                    case 3:
                    case 5:
                        break;
                    case 4:
                        Context a2 = C1089a.m2785c().m2788a();
                        C1121a.m2662a(a2, AsyncTaskC1091b.m2765e() + "/appmarket.apk", aVar.m2779c());
                        break;
                    default:
                        return;
                }
                Bundle bundle = new Bundle();
                bundle.putInt("download_status_param", message.what);
                intent.putExtras(bundle);
                C1119c.m2669b().m2668b(a);
            }
        }
    }

    public AsyncTaskC1091b(C1090a aVar) {
        this.f1749a = "com.huawei.appmarket";
        this.f1752d = aVar;
        if (!TextUtils.isEmpty(aVar.m2779c())) {
            this.f1749a = aVar.m2779c();
        }
    }

    /* renamed from: a */
    private void m2775a(int i, long j, String str, int i2) {
        C1090a aVar = new C1090a();
        aVar.m2783a(i);
        aVar.m2782a(j);
        aVar.m2781a(str);
        Handler handler = this.f1753e;
        if (handler != null) {
            handler.sendMessage(handler.obtainMessage(i2, aVar));
        }
    }

    /* renamed from: a */
    private void m2773a(C1090a aVar, String str) {
        Throwable th;
        String str2;
        FileOutputStream fileOutputStream;
        FileNotFoundException e;
        Exception e2;
        FileOutputStream fileOutputStream2;
        if (aVar != null && !TextUtils.isEmpty(aVar.m2780b())) {
            try {
                try {
                    str2 = str + "/appmarket.apk";
                    fileOutputStream = null;
                    try {
                        fileOutputStream2 = new FileOutputStream(new File(str2));
                    } catch (FileNotFoundException e3) {
                        e = e3;
                    } catch (Exception e4) {
                        e2 = e4;
                    }
                } catch (IOException unused) {
                    while (true) {
                        C1069a.m2877b("DownloadMarketTask", "Close FileOutputStream failed!");
                        return;
                    }
                }
            } catch (Throwable th2) {
                th = th2;
            }
            try {
                if (!m2774a(aVar, fileOutputStream2, str2)) {
                    AbstractC1073d.m2867a(new File(m2765e()));
                }
                fileOutputStream2.close();
            } catch (FileNotFoundException e5) {
                e = e5;
                fileOutputStream = fileOutputStream2;
                C1069a.m2877b("DownloadMarketTask", "DOWNLOAD market package FileNotFoundException error:" + e.toString());
                if (fileOutputStream == null) {
                    return;
                }
                fileOutputStream.close();
            } catch (Exception e6) {
                e2 = e6;
                fileOutputStream = fileOutputStream2;
                C1069a.m2877b("DownloadMarketTask", "DOWNLOAD market package Exception error:" + e2.toString());
                if (fileOutputStream == null) {
                    return;
                }
                fileOutputStream.close();
            } catch (Throwable th3) {
                th = th3;
                if (fileOutputStream2 != null) {
                    try {
                        fileOutputStream2.close();
                    } catch (IOException unused2) {
                        C1069a.m2877b("DownloadMarketTask", "Close FileOutputStream failed!");
                    }
                }
                throw th;
            }
        }
    }

    /* renamed from: a */
    private void m2770a(InputStream inputStream, OutputStream outputStream) {
        if (inputStream != null) {
            try {
                inputStream.close();
            } catch (IOException e) {
                C1069a.m2877b("DownloadMarketTask", "downloadUrlToStream(String urlString,OutputStream outputStream) " + e.toString());
            }
        }
        if (outputStream != null) {
            try {
                outputStream.close();
            } catch (IOException e2) {
                C1069a.m2877b("DownloadMarketTask", "downloadUrlToStream(String urlString,OutputStream outputStream) " + e2.toString());
            }
        }
    }

    /* JADX WARN: Removed duplicated region for block: B:116:0x0192  */
    /* JADX WARN: Removed duplicated region for block: B:126:0x01ac  */
    /* JADX WARN: Removed duplicated region for block: B:153:0x00fb A[EXC_TOP_SPLITTER, SYNTHETIC] */
    /* JADX WARN: Removed duplicated region for block: B:72:0x011e  */
    /* JADX WARN: Removed duplicated region for block: B:74:0x0122  */
    /* renamed from: a */
    /* Code decompiled incorrectly, please refer to instructions dump */
    private boolean m2774a(C1090a aVar, OutputStream outputStream, String str) {
        InputStream inputStream;
        Throwable th;
        int i;
        String str2;
        boolean z;
        Exception e;
        int i2;
        String str3;
        Throwable th2;
        int i3;
        String str4;
        String str5;
        int i4;
        boolean z2 = false;
        OutputStream outputStream2 = null;
        long j = -1;
        int i5 = 0;
        try {
            this.f1750b = C1094c.m2764a().m2763a(aVar.m2780b());
            if (this.f1750b != null) {
                this.f1750b.connect();
                int responseCode = this.f1750b.getResponseCode();
                if (200 == responseCode || 206 == responseCode) {
                    long e2 = aVar.m2777e();
                    try {
                        inputStream = new BufferedInputStream(this.f1750b.getInputStream(), 8192);
                        try {
                            outputStream2 = new BufferedOutputStream(outputStream, 8192);
                            try {
                                byte[] bArr = new byte[8192];
                                long j2 = 0;
                                i5 = 0;
                                while (true) {
                                    try {
                                        int read = inputStream.read(bArr);
                                        if (read != -1) {
                                            try {
                                                outputStream2.write(bArr, 0, read);
                                                i5 += read;
                                                if (Math.abs(System.currentTimeMillis() - j2) > 1000) {
                                                    j2 = System.currentTimeMillis();
                                                    if (((long) i5) != e2) {
                                                        i5 = i5;
                                                        try {
                                                            m2775a(i5, e2, this.f1749a, 2);
                                                        } catch (Throwable th3) {
                                                            th2 = th3;
                                                            try {
                                                                m2770a(inputStream, outputStream2);
                                                            } catch (Exception e3) {
                                                                e = e3;
                                                                j = e2;
                                                                z = false;
                                                                try {
                                                                    C1069a.m2877b("DownloadMarketTask", "downloadUrlToStream(String urlString,OutputStream outputStream) " + e.toString());
                                                                    if (!z) {
                                                                    }
                                                                    m2770a(inputStream, outputStream2);
                                                                    C1123b.m2659a().remove(this);
                                                                    m2766d();
                                                                    return false;
                                                                } catch (Throwable th4) {
                                                                    th = th4;
                                                                    z2 = z;
                                                                    if (!z2) {
                                                                        if (this.f1751c) {
                                                                            str2 = this.f1749a;
                                                                            i = 3;
                                                                        } else {
                                                                            str2 = this.f1749a;
                                                                            i = 5;
                                                                        }
                                                                        m2775a(i5, j, str2, i);
                                                                    }
                                                                    m2770a(inputStream, outputStream2);
                                                                    C1123b.m2659a().remove(this);
                                                                    m2766d();
                                                                    throw th;
                                                                }
                                                            } catch (Throwable th5) {
                                                                th = th5;
                                                                j = e2;
                                                                if (!z2) {
                                                                }
                                                                m2770a(inputStream, outputStream2);
                                                                C1123b.m2659a().remove(this);
                                                                m2766d();
                                                                throw th;
                                                            }
                                                            try {
                                                                throw th2;
                                                            } catch (Exception e4) {
                                                                e = e4;
                                                                inputStream = null;
                                                                j = e2;
                                                                z = false;
                                                                C1069a.m2877b("DownloadMarketTask", "downloadUrlToStream(String urlString,OutputStream outputStream) " + e.toString());
                                                                if (!z) {
                                                                }
                                                                m2770a(inputStream, outputStream2);
                                                                C1123b.m2659a().remove(this);
                                                                m2766d();
                                                                return false;
                                                            } catch (Throwable th6) {
                                                                th = th6;
                                                                inputStream = null;
                                                                j = e2;
                                                                if (!z2) {
                                                                }
                                                                m2770a(inputStream, outputStream2);
                                                                C1123b.m2659a().remove(this);
                                                                m2766d();
                                                                throw th;
                                                            }
                                                        }
                                                    } else {
                                                        i5 = i5;
                                                    }
                                                }
                                            } catch (Throwable th7) {
                                                th2 = th7;
                                                i5 = i5;
                                                m2770a(inputStream, outputStream2);
                                                throw th2;
                                            }
                                        } else {
                                            try {
                                                break;
                                            } catch (Exception e5) {
                                                e = e5;
                                                j = e2;
                                                z = false;
                                                C1069a.m2877b("DownloadMarketTask", "downloadUrlToStream(String urlString,OutputStream outputStream) " + e.toString());
                                                if (!z) {
                                                    if (this.f1751c) {
                                                        str3 = this.f1749a;
                                                        i2 = 3;
                                                    } else {
                                                        str3 = this.f1749a;
                                                        i2 = 5;
                                                    }
                                                    m2775a(i5, j, str3, i2);
                                                }
                                                m2770a(inputStream, outputStream2);
                                                C1123b.m2659a().remove(this);
                                                m2766d();
                                                return false;
                                            } catch (Throwable th8) {
                                                th = th8;
                                                j = e2;
                                                if (!z2) {
                                                }
                                                m2770a(inputStream, outputStream2);
                                                C1123b.m2659a().remove(this);
                                                m2766d();
                                                throw th;
                                            }
                                        }
                                    } catch (Throwable th9) {
                                        th2 = th9;
                                        i5 = i5;
                                    }
                                }
                                m2770a(inputStream, outputStream2);
                                if (((long) i5) == e2 && e2 > 0) {
                                    try {
                                        if (!TextUtils.isEmpty(aVar.m2778d())) {
                                            if (aVar.m2778d().equalsIgnoreCase(AbstractC1073d.m2866a(str, "SHA-256"))) {
                                                z = true;
                                                if (!z) {
                                                    try {
                                                        i5 = i5;
                                                        try {
                                                            m2775a(i5, e2, this.f1749a, 4);
                                                        } catch (Exception e6) {
                                                            e = e6;
                                                            j = e2;
                                                            inputStream = null;
                                                            C1069a.m2877b("DownloadMarketTask", "downloadUrlToStream(String urlString,OutputStream outputStream) " + e.toString());
                                                            if (!z) {
                                                            }
                                                            m2770a(inputStream, outputStream2);
                                                            C1123b.m2659a().remove(this);
                                                            m2766d();
                                                            return false;
                                                        } catch (Throwable th10) {
                                                            th = th10;
                                                            j = e2;
                                                            z2 = z;
                                                            inputStream = null;
                                                            if (!z2) {
                                                            }
                                                            m2770a(inputStream, outputStream2);
                                                            C1123b.m2659a().remove(this);
                                                            m2766d();
                                                            throw th;
                                                        }
                                                    } catch (Exception e7) {
                                                        e = e7;
                                                        i5 = i5;
                                                    } catch (Throwable th11) {
                                                        th = th11;
                                                        i5 = i5;
                                                    }
                                                } else {
                                                    i5 = i5;
                                                }
                                                if (!z) {
                                                    if (this.f1751c) {
                                                        str4 = this.f1749a;
                                                        i3 = 3;
                                                    } else {
                                                        str4 = this.f1749a;
                                                        i3 = 5;
                                                    }
                                                    m2775a(i5, e2, str4, i3);
                                                }
                                                m2770a((InputStream) null, (OutputStream) null);
                                                C1123b.m2659a().remove(this);
                                                m2766d();
                                                return z;
                                            }
                                        }
                                    } catch (Exception e8) {
                                        e = e8;
                                        i5 = i5;
                                        j = e2;
                                        z = false;
                                        inputStream = null;
                                        C1069a.m2877b("DownloadMarketTask", "downloadUrlToStream(String urlString,OutputStream outputStream) " + e.toString());
                                        if (!z) {
                                        }
                                        m2770a(inputStream, outputStream2);
                                        C1123b.m2659a().remove(this);
                                        m2766d();
                                        return false;
                                    } catch (Throwable th12) {
                                        th = th12;
                                        i5 = i5;
                                        inputStream = null;
                                        j = e2;
                                        if (!z2) {
                                        }
                                        m2770a(inputStream, outputStream2);
                                        C1123b.m2659a().remove(this);
                                        m2766d();
                                        throw th;
                                    }
                                }
                                z = false;
                                if (!z) {
                                }
                                if (!z) {
                                }
                                m2770a((InputStream) null, (OutputStream) null);
                                C1123b.m2659a().remove(this);
                                m2766d();
                                return z;
                            } catch (Throwable th13) {
                                th2 = th13;
                            }
                        } catch (Throwable th14) {
                            th2 = th14;
                            outputStream2 = null;
                            i5 = 0;
                            m2770a(inputStream, outputStream2);
                            throw th2;
                        }
                    } catch (Throwable th15) {
                        th2 = th15;
                        inputStream = null;
                        outputStream2 = null;
                    }
                } else if (this.f1751c) {
                    str5 = this.f1749a;
                    i4 = 3;
                } else {
                    str5 = this.f1749a;
                    i5 = 0;
                    j = -1;
                    i4 = 5;
                }
            } else if (this.f1751c) {
                str5 = this.f1749a;
                i5 = 0;
                j = -1;
                i4 = 3;
            } else {
                str5 = this.f1749a;
                i5 = 0;
                j = -1;
                i4 = 5;
            }
            m2775a(i5, j, str5, i4);
            m2770a((InputStream) null, (OutputStream) null);
        } catch (Exception e9) {
            e = e9;
            inputStream = null;
        } catch (Throwable th16) {
            th = th16;
            inputStream = null;
        }
        C1123b.m2659a().remove(this);
        m2766d();
        return false;
    }

    /* renamed from: d */
    private void m2766d() {
        HttpURLConnection httpURLConnection = this.f1750b;
        if (httpURLConnection != null) {
            httpURLConnection.disconnect();
        }
    }

    /* JADX INFO: Access modifiers changed from: private */
    /* renamed from: e */
    public static String m2765e() {
        String b = C1089a.m2785c().m2786b();
        if (TextUtils.isEmpty(b)) {
            return "";
        }
        String str = b + "/updatesdk";
        File file = new File(str);
        return (file.exists() || file.mkdirs()) ? str : "";
    }

    /* JADX INFO: Access modifiers changed from: protected */
    /* renamed from: a */
    public Void doInBackground(Void... voidArr) {
        C1123b.m2658a(this);
        m2773a(this.f1752d, m2765e());
        return null;
    }

    /* renamed from: a */
    public void m2776a() {
        new Thread(new RunnableC1092a()).start();
    }

    /* renamed from: b */
    public void m2768b() {
        this.f1753e = null;
    }

    @Override // android.os.AsyncTask
    protected void onCancelled() {
        super.onCancelled();
        m2776a();
    }
}
