package com.huawei.updatesdk.p022a.p023a.p024a;

import android.content.Context;
import cn.com.union.fido.common.MIMEType;
import com.facebook.common.util.UriUtil;
import com.huawei.hms.android.HwBuildEx;
import com.huawei.updatesdk.p022a.p023a.p025b.p026a.p027a.C1069a;
import com.huawei.updatesdk.p022a.p023a.p028c.AbstractC1073d;
import com.huawei.updatesdk.p022a.p023a.p028c.C1071b;
import com.huawei.updatesdk.p022a.p023a.p028c.p030i.C1083b;
import com.jd.sentry.performance.network.instrumentation.urlconnection.ShooterUrlConnectionInstrumentation;
import java.io.BufferedInputStream;
import java.io.ByteArrayOutputStream;
import java.io.Closeable;
import java.io.DataOutputStream;
import java.io.IOException;
import java.net.HttpURLConnection;
import java.net.Proxy;
import java.net.URL;
import java.security.KeyManagementException;
import java.security.KeyStoreException;
import java.security.NoSuchAlgorithmException;
import java.security.cert.CertificateException;
import java.util.zip.GZIPOutputStream;
import javax.net.ssl.HttpsURLConnection;
import org.apache.http.conn.ssl.SSLSocketFactory;

/* compiled from: TbsSdkJava */
/* renamed from: com.huawei.updatesdk.a.a.a.b */
/* loaded from: classes.dex */
public class C1064b {

    /* renamed from: a */
    private HttpURLConnection f1697a = null;

    /* compiled from: TbsSdkJava */
    /* renamed from: com.huawei.updatesdk.a.a.a.b$a */
    /* loaded from: classes.dex */
    public static class C1065a {

        /* renamed from: a */
        private String f1698a;

        /* renamed from: b */
        private int f1699b;

        /* renamed from: a */
        public int m2891a() {
            return this.f1699b;
        }

        /* renamed from: b */
        public String m2888b() {
            return this.f1698a;
        }
    }

    /* renamed from: a */
    private HttpURLConnection m2894a(String str, Context context) throws IOException, CertificateException, NoSuchAlgorithmException, KeyStoreException, KeyManagementException, IllegalAccessException {
        HttpsURLConnection httpsURLConnection;
        URL url = new URL(str);
        Proxy b = C1083b.m2802b(context);
        if (UriUtil.HTTPS_SCHEME.equals(url.getProtocol())) {
            httpsURLConnection = (HttpsURLConnection) ShooterUrlConnectionInstrumentation.openConnection(b == null ? url.openConnection() : url.openConnection(b));
            httpsURLConnection.setSSLSocketFactory(C1067d.m2880a(context));
            httpsURLConnection.setHostnameVerifier(SSLSocketFactory.STRICT_HOSTNAME_VERIFIER);
        } else {
            httpsURLConnection = null;
        }
        return UriUtil.HTTP_SCHEME.equals(url.getProtocol()) ? (HttpURLConnection) ShooterUrlConnectionInstrumentation.openConnection(url.openConnection()) : httpsURLConnection;
    }

    /* JADX WARN: Multi-variable type inference failed */
    /* renamed from: a */
    private byte[] m2892a(byte[] bArr) {
        Throwable th;
        DataOutputStream dataOutputStream;
        ByteArrayOutputStream byteArrayOutputStream;
        IOException e;
        DataOutputStream dataOutputStream2;
        DataOutputStream dataOutputStream3;
        try {
            dataOutputStream = null;
            dataOutputStream2 = null;
            dataOutputStream2 = null;
            try {
                try {
                    byteArrayOutputStream = new ByteArrayOutputStream();
                    try {
                        dataOutputStream3 = new DataOutputStream(new GZIPOutputStream(byteArrayOutputStream, bArr.length));
                        dataOutputStream = null;
                    } catch (IOException e2) {
                        e = e2;
                    }
                } catch (IOException e3) {
                    e = e3;
                    byteArrayOutputStream = null;
                }
            } catch (Throwable th2) {
                th = th2;
            }
        } catch (IOException e4) {
            String str = "HttpsUtil";
            C1069a.m2878a(str, "gzip error!", e4);
            dataOutputStream = str;
        }
        try {
            dataOutputStream3.write(bArr, 0, bArr.length);
            dataOutputStream3.flush();
            dataOutputStream3.close();
        } catch (IOException e5) {
            e = e5;
            dataOutputStream2 = dataOutputStream3;
            C1069a.m2878a("HttpsUtil", "gzip error!", e);
            dataOutputStream = dataOutputStream2;
            if (dataOutputStream2 != null) {
                dataOutputStream2.close();
                dataOutputStream = dataOutputStream2;
            }
            return byteArrayOutputStream.toByteArray();
        } catch (Throwable th3) {
            th = th3;
            dataOutputStream = dataOutputStream3;
            if (dataOutputStream != null) {
                try {
                    dataOutputStream.close();
                } catch (IOException e6) {
                    C1069a.m2878a("HttpsUtil", "gzip error!", e6);
                }
            }
            throw th;
        }
        return byteArrayOutputStream.toByteArray();
    }

    /* JADX WARN: Removed duplicated region for block: B:30:0x00be  */
    /* renamed from: a */
    /* Code decompiled incorrectly, please refer to instructions dump */
    public C1065a m2893a(String str, String str2, String str3, String str4, Context context) throws IOException, CertificateException, IllegalAccessException, NoSuchAlgorithmException, KeyStoreException, KeyManagementException {
        DataOutputStream dataOutputStream;
        Throwable th;
        HttpURLConnection httpURLConnection;
        C1065a aVar = new C1065a();
        BufferedInputStream bufferedInputStream = null;
        try {
            httpURLConnection = m2894a(str, context);
            if (httpURLConnection == null) {
                if (httpURLConnection != null) {
                    httpURLConnection.disconnect();
                }
                AbstractC1073d.m2868a((Closeable) null);
            } else {
                try {
                    this.f1697a = httpURLConnection;
                    httpURLConnection.setDoInput(true);
                    httpURLConnection.setDoOutput(true);
                    httpURLConnection.setUseCaches(false);
                    httpURLConnection.setConnectTimeout(5000);
                    httpURLConnection.setReadTimeout(HwBuildEx.VersionCodes.CUR_DEVELOPMENT);
                    httpURLConnection.setRequestMethod("POST");
                    httpURLConnection.setRequestProperty("Content-Type", MIMEType.MIME_TYPE_GZ);
                    httpURLConnection.setRequestProperty("Content-Encoding", "gzip");
                    httpURLConnection.setRequestProperty("Connection", "Keep-Alive");
                    httpURLConnection.setRequestProperty("User-Agent", str4);
                    dataOutputStream = new DataOutputStream(httpURLConnection.getOutputStream());
                } catch (Throwable th2) {
                    th = th2;
                    dataOutputStream = null;
                    if (httpURLConnection != null) {
                        httpURLConnection.disconnect();
                    }
                    AbstractC1073d.m2868a(dataOutputStream);
                    AbstractC1073d.m2868a(bufferedInputStream);
                    throw th;
                }
                try {
                    dataOutputStream.write(m2892a(str2.getBytes(str3)));
                    dataOutputStream.flush();
                    int responseCode = httpURLConnection.getResponseCode();
                    aVar.f1699b = responseCode;
                    bufferedInputStream = responseCode == 200 ? new BufferedInputStream(httpURLConnection.getInputStream()) : new BufferedInputStream(httpURLConnection.getErrorStream());
                    C1071b bVar = new C1071b();
                    byte[] a = C1063a.m2896b().m2898a();
                    while (true) {
                        int read = bufferedInputStream.read(a);
                        if (read == -1) {
                            break;
                        }
                        bVar.m2870a(a, read);
                    }
                    C1063a.m2896b().m2897a(a);
                    aVar.f1698a = bVar.m2872a();
                    if (httpURLConnection != null) {
                        httpURLConnection.disconnect();
                    }
                    AbstractC1073d.m2868a(dataOutputStream);
                } catch (Throwable th3) {
                    th = th3;
                    if (httpURLConnection != null) {
                    }
                    AbstractC1073d.m2868a(dataOutputStream);
                    AbstractC1073d.m2868a(bufferedInputStream);
                    throw th;
                }
            }
            AbstractC1073d.m2868a(bufferedInputStream);
            return aVar;
        } catch (Throwable th4) {
            th = th4;
            httpURLConnection = null;
        }
    }

    /* renamed from: a */
    public void m2895a() {
        HttpURLConnection httpURLConnection = this.f1697a;
        if (httpURLConnection != null) {
            httpURLConnection.disconnect();
        }
    }
}
