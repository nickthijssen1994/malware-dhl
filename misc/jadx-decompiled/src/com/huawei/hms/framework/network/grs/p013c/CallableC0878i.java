package com.huawei.hms.framework.network.grs.p013c;

import android.content.Context;
import android.os.SystemClock;
import com.huawei.hms.framework.common.IoUtils;
import com.huawei.hms.framework.common.Logger;
import com.huawei.hms.framework.network.grs.GrsBaseInfo;
import com.huawei.hms.framework.network.grs.local.model.C0896a;
import com.huawei.hms.framework.network.grs.local.model.C0898c;
import com.huawei.hms.framework.network.grs.p012b.C0859b;
import com.huawei.hms.framework.network.grs.p016d.p017a.C0884a;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.util.HashSet;
import java.util.Map;
import java.util.concurrent.Callable;
import javax.net.ssl.HttpsURLConnection;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

/* compiled from: TbsSdkJava */
/* renamed from: com.huawei.hms.framework.network.grs.c.i */
/* loaded from: classes.dex */
public class CallableC0878i extends C0867b implements Callable<C0874e> {

    /* renamed from: h */
    private static final String f1057h = "i";

    /* renamed from: i */
    private GrsBaseInfo f1058i;

    public CallableC0878i(String str, int i, AbstractC0865a aVar, Context context, String str2, GrsBaseInfo grsBaseInfo) {
        super(str, i, aVar, context, str2, grsBaseInfo);
        this.f1058i = grsBaseInfo;
    }

    /* renamed from: h */
    private String m3775h() {
        HashSet<String> hashSet = new HashSet();
        C0896a a = C0859b.m3844a(m3834b().getPackageName(), this.f1058i).m3849a();
        if (a == null) {
            Logger.m3897w(f1057h, "get local assets appGrs is null.");
            return "";
        }
        Map<String, C0898c> b = a.m3712b();
        if (b == null || b.isEmpty()) {
            return "";
        }
        for (Map.Entry<String, C0898c> entry : b.entrySet()) {
            hashSet.add(entry.getValue().m3700b());
        }
        if (hashSet.isEmpty()) {
            return "";
        }
        JSONObject jSONObject = new JSONObject();
        JSONArray jSONArray = new JSONArray();
        for (String str : hashSet) {
            jSONArray.put(str);
        }
        try {
            jSONObject.put("services", jSONArray);
            Logger.m3898v(f1057h, "post service list is:%s,and appName is:%s", jSONObject.toString(), a.m3716a());
            return jSONObject.toString();
        } catch (JSONException unused) {
            return "";
        }
    }

    /* JADX WARN: Can't rename method to resolve collision */
    /* JADX WARN: Removed duplicated region for block: B:31:0x00d2  */
    @Override // java.util.concurrent.Callable
    /* Code decompiled incorrectly, please refer to instructions dump */
    public C0874e call() {
        long j;
        long j2;
        IOException e;
        HttpsURLConnection a;
        byte[] bArr;
        Logger.m3901i(f1057h, "Post call execute");
        long j3 = 0;
        try {
            j2 = SystemClock.elapsedRealtime();
            try {
                j3 = System.currentTimeMillis();
                a = C0884a.m3741a(m3833c(), m3834b(), m3831e());
                bArr = null;
            } catch (IOException e2) {
                e = e2;
                long elapsedRealtime = SystemClock.elapsedRealtime();
                j = System.currentTimeMillis();
                Logger.m3896w(f1057h, "RequestCallableV2 run task catch IOException", e);
                this.f1003a = new C0874e(e, elapsedRealtime - j2);
                this.f1003a.m3805a(m3833c());
                this.f1003a.m3807a(m3832d());
                this.f1003a.m3801b(j3);
                this.f1003a.m3806a(j);
                if (m3836a() != null) {
                }
                return this.f1003a;
            }
        } catch (IOException e3) {
            e = e3;
            j2 = 0;
        }
        if (a == null) {
            Logger.m3897w(f1057h, "create HttpsURLConnection instance by url return null.");
            return null;
        }
        a.setRequestProperty("Content-Type", "application/json; charset=UTF-8");
        a.setRequestMethod("POST");
        a.setDoOutput(true);
        a.setDoInput(true);
        a.connect();
        OutputStream outputStream = a.getOutputStream();
        outputStream.write(m3775h().getBytes("UTF-8"));
        outputStream.close();
        int responseCode = a.getResponseCode();
        if (responseCode == 200) {
            InputStream inputStream = a.getInputStream();
            bArr = IoUtils.toByteArray(inputStream);
            IoUtils.closeSecure(inputStream);
        }
        Map headerFields = a.getHeaderFields();
        a.disconnect();
        long elapsedRealtime2 = SystemClock.elapsedRealtime();
        j = System.currentTimeMillis();
        this.f1003a = new C0874e(responseCode, headerFields, bArr == null ? new byte[0] : bArr, elapsedRealtime2 - j2);
        this.f1003a.m3805a(m3833c());
        this.f1003a.m3807a(m3832d());
        this.f1003a.m3801b(j3);
        this.f1003a.m3806a(j);
        if (m3836a() != null) {
            m3836a().mo3815a(this.f1003a);
        }
        return this.f1003a;
    }
}
