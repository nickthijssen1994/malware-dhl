package com.huawei.hms.availableupdate;

import android.app.Activity;
import android.content.ActivityNotFoundException;
import android.content.Context;
import android.content.Intent;
import android.net.Uri;
import android.os.Build;
import android.os.Handler;
import android.os.Looper;
import android.text.TextUtils;
import android.view.KeyEvent;
import com.huawei.hms.activity.IBridgeActivityDelegate;
import com.huawei.hms.adapter.sysobs.SystemManager;
import com.huawei.hms.android.SystemUtils;
import com.huawei.hms.support.log.HMSLog;
import com.huawei.hms.update.provider.UpdateProvider;
import com.huawei.hms.utils.FileUtil;
import com.huawei.hms.utils.HMSPackageManager;
import com.huawei.hms.utils.PackageManagerHelper;
import com.huawei.hms.utils.ResourceLoaderUtil;
import com.huawei.updatesdk.UpdateSdkAPI;
import com.huawei.updatesdk.service.appmgr.bean.ApkUpgradeInfo;
import com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack;
import com.huawei.updatesdk.service.otaupdate.UpdateKey;
import java.io.File;
import java.io.Serializable;

/* compiled from: TbsSdkJava */
/* renamed from: com.huawei.hms.availableupdate.f0 */
/* loaded from: classes.dex */
public class C0792f0 extends AbstractC0802n implements AbstractC0791f {

    /* renamed from: j */
    public AbstractC0787e f904j;

    /* renamed from: k */
    public C0795g f905k;

    /* renamed from: l */
    public int f906l = 0;

    /* compiled from: TbsSdkJava */
    /* renamed from: com.huawei.hms.availableupdate.f0$a */
    /* loaded from: classes.dex */
    public static class RunnableC0793a implements Runnable {

        /* renamed from: a */
        public final /* synthetic */ AbstractC0791f f907a;

        /* renamed from: b */
        public final /* synthetic */ int f908b;

        /* renamed from: c */
        public final /* synthetic */ C0795g f909c;

        public RunnableC0793a(AbstractC0791f fVar, int i, C0795g gVar) {
            this.f907a = fVar;
            this.f908b = i;
            this.f909c = gVar;
        }

        @Override // java.lang.Runnable
        public void run() {
            this.f907a.mo4036a(this.f908b, this.f909c);
        }
    }

    /* compiled from: TbsSdkJava */
    /* renamed from: com.huawei.hms.availableupdate.f0$b */
    /* loaded from: classes.dex */
    public class C0794b implements CheckUpdateCallBack {

        /* renamed from: a */
        public final /* synthetic */ AbstractC0791f f910a;

        public C0794b(AbstractC0791f fVar) {
            this.f910a = fVar;
        }

        @Override // com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack
        public void onMarketInstallInfo(Intent intent) {
        }

        @Override // com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack
        public void onMarketStoreError(int i) {
            HMSLog.m3177e("UpdateWizard", "onMarketStoreError responseCode: " + i);
        }

        @Override // com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack
        public void onUpdateInfo(Intent intent) {
            if (intent != null) {
                C0792f0.this.m4033a(intent, this.f910a);
            }
        }

        @Override // com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack
        public void onUpdateStoreError(int i) {
            HMSLog.m3177e("UpdateWizard", "onUpdateStoreError responseCode: " + i);
        }
    }

    @Override // com.huawei.hms.availableupdate.AbstractC0802n
    /* renamed from: b */
    public void mo3979b(AbstractC0803o oVar) {
        HMSLog.m3175i("UpdateWizard", "Enter onDoWork.");
        if (oVar instanceof C0818y) {
            oVar.m3995b();
            mo3980a(C0806q.class);
            m4031a(this);
        } else if (oVar instanceof C0813v) {
            oVar.m3995b();
            m4024g();
        } else if (oVar instanceof C0812u) {
            mo3980a(C0814w.class);
            m4025f();
        } else if (oVar instanceof C0811t) {
            mo3980a(C0814w.class);
            m4025f();
        } else if (oVar instanceof C0777b0) {
            m4026e();
        } else if (oVar instanceof C0783c0) {
            m4026e();
        } else if (oVar instanceof C0786d0) {
            m4026e();
        }
    }

    /* renamed from: c */
    public final void m4028c() {
        AbstractC0787e eVar = this.f904j;
        if (eVar != null) {
            eVar.mo4052a();
            this.f904j = null;
        }
    }

    /* renamed from: d */
    public final void m4027d() {
        Activity b = m4001b();
        String netType = b != null ? SystemUtils.getNetType(b.getBaseContext()) : "";
        HMSLog.m3175i("UpdateWizard", "current network is " + netType);
        if ("WIFI".equals(netType)) {
            mo3980a(C0814w.class);
            m4025f();
            HMSLog.m3175i("UpdateWizard", "current network is wifi");
            return;
        }
        mo3980a(C0811t.class);
        HMSLog.m3175i("UpdateWizard", "current network is not wifi");
    }

    /* renamed from: e */
    public final void m4026e() {
        if (!m4002a(false)) {
            m3999c(8, this.f927f);
        } else {
            m4006a(8, this.f927f);
        }
    }

    /* renamed from: f */
    public final void m4025f() {
        Activity b = m4001b();
        if (b == null || b.isFinishing()) {
            mo3980a(C0783c0.class);
        } else if (m4035a(b)) {
            m4028c();
            this.f904j = new C0778c(new C0784d(b));
            this.f904j.mo4051a(this, this.f905k);
        }
    }

    /* renamed from: g */
    public void m4024g() {
        m3999c(13, this.f927f);
    }

    @Override // com.huawei.hms.activity.IBridgeActivityDelegate
    public int getRequestCode() {
        return 2006;
    }

    @Override // com.huawei.hms.availableupdate.AbstractC0802n, com.huawei.hms.activity.IBridgeActivityDelegate
    public void onBridgeActivityCreate(Activity activity) {
        super.onBridgeActivityCreate(activity);
        if (this.f924c != null) {
            this.f927f = 6;
            if (m4035a(activity)) {
                if (!this.f924c.isNeedConfirm() || TextUtils.isEmpty(this.f929h)) {
                    mo3980a(C0806q.class);
                    m4031a(this);
                    return;
                }
                mo3980a(C0818y.class);
            }
        }
    }

    @Override // com.huawei.hms.availableupdate.AbstractC0802n, com.huawei.hms.activity.IBridgeActivityDelegate
    public void onBridgeActivityDestroy() {
        m4028c();
        super.onBridgeActivityDestroy();
    }

    @Override // com.huawei.hms.activity.IBridgeActivityDelegate
    public boolean onBridgeActivityResult(int i, int i2, Intent intent) {
        IBridgeActivityDelegate iBridgeActivityDelegate;
        if (this.f926e && (iBridgeActivityDelegate = this.f923b) != null) {
            return iBridgeActivityDelegate.onBridgeActivityResult(i, i2, intent);
        }
        if (this.f927f != 6 || i != getRequestCode()) {
            return false;
        }
        if (m4004a(this.f928g, this.f930i)) {
            m3999c(0, this.f927f);
            return true;
        }
        m4026e();
        return true;
    }

    @Override // com.huawei.hms.availableupdate.AbstractC0802n, com.huawei.hms.activity.IBridgeActivityDelegate
    public void onKeyUp(int i, KeyEvent keyEvent) {
        IBridgeActivityDelegate iBridgeActivityDelegate;
        if (this.f926e && (iBridgeActivityDelegate = this.f923b) != null) {
            iBridgeActivityDelegate.onKeyUp(i, keyEvent);
        } else if (4 == i) {
            HMSLog.m3175i("UpdateWizard", "In onKeyUp, Call finish.");
            Activity b = m4001b();
            if (b != null && !b.isFinishing()) {
                b.setResult(0, null);
                b.finish();
            }
        }
    }

    /* renamed from: a */
    public static Uri m4034a(Context context, File file) {
        PackageManagerHelper packageManagerHelper = new PackageManagerHelper(context);
        String packageName = context.getPackageName();
        String str = packageName + UpdateProvider.AUTHORITIES_SUFFIX;
        if (Build.VERSION.SDK_INT > 23 && (context.getApplicationInfo().targetSdkVersion > 23 || packageManagerHelper.hasProvider(packageName, str))) {
            return UpdateProvider.getUriForFile(context, str, file);
        }
        return Uri.fromFile(file);
    }

    /* renamed from: a */
    public static void m4030a(AbstractC0791f fVar, int i, C0795g gVar) {
        if (fVar != null) {
            new Handler(Looper.getMainLooper()).post(new RunnableC0793a(fVar, i, gVar));
        }
    }

    /* renamed from: a */
    public final boolean m4035a(Activity activity) {
        if (HMSPackageManager.getInstance(activity).isApkUpdateNecessary(this.f924c.m3157c())) {
            return true;
        }
        m4008a();
        SystemManager.getInstance().notifyUpdateResult(0);
        return false;
    }

    @Override // com.huawei.hms.availableupdate.AbstractC0791f
    /* renamed from: a */
    public void mo4036a(int i, C0795g gVar) {
        HMSLog.m3175i("UpdateWizard", "Enter onCheckUpdate, status: " + C0796h.m4022a(i));
        if (i != 1000) {
            switch (i) {
                case 1201:
                case 1202:
                case 1203:
                    mo3980a(C0777b0.class);
                    return;
                default:
                    mo3980a(C0777b0.class);
                    return;
            }
        } else {
            this.f905k = gVar;
            m4027d();
        }
    }

    @Override // com.huawei.hms.availableupdate.AbstractC0791f
    /* renamed from: a */
    public void mo4037a(int i, int i2, int i3, File file) {
        HMSLog.m3175i("UpdateWizard", "Enter onDownloadPackage, status: " + C0796h.m4022a(i) + ", reveived: " + i2 + ", total: " + i3);
        if (i == 2000) {
            m4008a();
            if (file == null) {
                m4026e();
            } else if (FileUtil.verifyHash(this.f905k.f916e, file)) {
                m4029a(file);
            } else {
                HMSLog.m3175i("UpdateWizard", "Hash value mismatch for download file");
            }
        } else if (i == 2100) {
            AbstractC0803o oVar = this.f925d;
            if (oVar != null && (oVar instanceof C0814w)) {
                int i4 = 0;
                if (i2 >= 0 && i3 > 0) {
                    i4 = (int) ((((long) i2) * 100) / ((long) i3));
                }
                this.f906l = i4;
                ((C0814w) this.f925d).m3983b(i4);
            }
        } else if (i != 2101) {
            switch (i) {
                case 2201:
                    mo3980a(C0783c0.class);
                    return;
                case 2202:
                    mo3980a(C0812u.class);
                    return;
                case 2203:
                case 2204:
                    mo3980a(C0786d0.class);
                    return;
                default:
                    return;
            }
        }
    }

    /* renamed from: a */
    public final void m4029a(File file) {
        Activity b = m4001b();
        if (b != null && !b.isFinishing()) {
            Uri a = m4034a(b, file);
            if (a == null) {
                HMSLog.m3177e("UpdateWizard", "In startInstaller, Failed to creates a Uri from a file.");
                m4026e();
            } else if (m4035a(b)) {
                Intent intent = new Intent("android.intent.action.VIEW");
                intent.setDataAndType(a, "application/vnd.android.package-archive");
                intent.setFlags(3);
                intent.putExtra("android.intent.extra.NOT_UNKNOWN_SOURCE", true);
                try {
                    b.startActivityForResult(intent, getRequestCode());
                } catch (ActivityNotFoundException e) {
                    HMSLog.m3177e("UpdateWizard", "In startInstaller, Failed to start package installer." + e.getMessage());
                    m4026e();
                }
            }
        }
    }

    @Override // com.huawei.hms.availableupdate.AbstractC0802n
    /* renamed from: a */
    public void mo3981a(AbstractC0803o oVar) {
        HMSLog.m3175i("UpdateWizard", "Enter onCancel.");
        if (oVar instanceof C0818y) {
            m4024g();
        } else if (oVar instanceof C0806q) {
            m4028c();
            m4024g();
        } else if (oVar instanceof C0814w) {
            m4028c();
            mo3980a(C0813v.class);
        } else if (oVar instanceof C0813v) {
            mo3980a(C0814w.class);
            m4025f();
        } else if (oVar instanceof C0812u) {
            m4024g();
        } else if (oVar instanceof C0811t) {
            m4024g();
        } else {
            m4026e();
        }
    }

    @Override // com.huawei.hms.availableupdate.AbstractC0802n
    /* renamed from: a */
    public void mo3980a(Class<? extends AbstractC0803o> cls) {
        if (m4035a(m4001b())) {
            m4008a();
            try {
                AbstractC0803o oVar = (AbstractC0803o) cls.newInstance();
                if (!TextUtils.isEmpty(this.f929h) && (oVar instanceof C0818y)) {
                    this.f929h = ResourceLoaderUtil.getString("hms_update_title");
                    ((C0818y) oVar).m3976a(this.f929h);
                }
                if (this.f906l > 0 && (oVar instanceof C0814w)) {
                    ((C0814w) oVar).m3984a(this.f906l);
                }
                oVar.m3996a(this);
                this.f925d = oVar;
            } catch (IllegalAccessException | IllegalStateException | InstantiationException e) {
                HMSLog.m3177e("UpdateWizard", "In showDialog, Failed to show the dialog." + e.getMessage());
            }
        }
    }

    /* renamed from: a */
    public final void m4031a(AbstractC0791f fVar) {
        if (fVar != null) {
            Activity b = m4001b();
            if (b == null || b.isFinishing()) {
                m4030a(fVar, 1201, (C0795g) null);
            } else if (m4035a(b)) {
                UpdateSdkAPI.checkTargetAppUpdate(b, this.f924c.m3158b(), new C0794b(fVar));
            }
        }
    }

    /* renamed from: a */
    public final void m4033a(Intent intent, AbstractC0791f fVar) {
        try {
            int intExtra = intent.getIntExtra("status", -99);
            HMSLog.m3175i("UpdateWizard", "CheckUpdateCallBack status is " + intExtra);
            String stringExtra = intent.getStringExtra(UpdateKey.FAIL_REASON);
            if (!TextUtils.isEmpty(stringExtra)) {
                HMSLog.m3177e("UpdateWizard", "checkTargetAppUpdate reason is " + stringExtra);
            }
            if (intExtra == 7) {
                Serializable serializableExtra = intent.getSerializableExtra(UpdateKey.INFO);
                if (serializableExtra instanceof ApkUpgradeInfo) {
                    ApkUpgradeInfo apkUpgradeInfo = (ApkUpgradeInfo) serializableExtra;
                    String package_ = apkUpgradeInfo.getPackage_();
                    int versionCode_ = apkUpgradeInfo.getVersionCode_();
                    String downurl_ = apkUpgradeInfo.getDownurl_();
                    int size_ = apkUpgradeInfo.getSize_();
                    String sha256_ = apkUpgradeInfo.getSha256_();
                    if (TextUtils.isEmpty(package_) || !package_.equals(this.f924c.m3158b())) {
                        m4030a(fVar, 1201, (C0795g) null);
                    } else if (versionCode_ < this.f924c.m3157c()) {
                        HMSLog.m3177e("UpdateWizard", "CheckUpdateCallBack versionCode is " + versionCode_ + "bean.getClientVersionCode() is " + this.f924c.m3157c());
                        m4030a(fVar, 1203, (C0795g) null);
                    } else if (TextUtils.isEmpty(downurl_) || TextUtils.isEmpty(sha256_)) {
                        m4030a(fVar, 1201, (C0795g) null);
                    } else {
                        m4030a(fVar, 1000, new C0795g(package_, versionCode_, downurl_, size_, sha256_));
                    }
                }
            } else if (intExtra == 3) {
                m4030a(fVar, 1202, (C0795g) null);
            } else {
                m4030a(fVar, 1201, (C0795g) null);
            }
        } catch (Exception e) {
            HMSLog.m3177e("UpdateWizard", "intent has some error" + e.getMessage());
            m4030a(fVar, 1201, (C0795g) null);
        }
    }
}
