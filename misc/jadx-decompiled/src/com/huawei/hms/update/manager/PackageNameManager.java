package com.huawei.hms.update.manager;

import android.content.Context;
import android.content.Intent;
import android.text.TextUtils;
import com.huawei.hms.common.PackageConstants;
import com.huawei.hms.support.log.HMSLog;
import com.huawei.updatesdk.UpdateSdkAPI;
import com.huawei.updatesdk.service.appmgr.bean.ApkUpgradeInfo;
import com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack;
import com.huawei.updatesdk.service.otaupdate.UpdateKey;
import java.io.Serializable;

/* compiled from: TbsSdkJava */
/* loaded from: classes.dex */
public class PackageNameManager {

    /* renamed from: b */
    public static final Object f1426b = new Object();

    /* renamed from: c */
    public static PackageNameManager f1427c;

    /* renamed from: a */
    public Context f1428a;

    /* compiled from: TbsSdkJava */
    /* loaded from: classes.dex */
    public interface QueryPublishCallback {
        void onQueryResult();
    }

    /* compiled from: TbsSdkJava */
    /* renamed from: com.huawei.hms.update.manager.PackageNameManager$a */
    /* loaded from: classes.dex */
    public class C1023a implements CheckUpdateCallBack {

        /* renamed from: a */
        public final /* synthetic */ QueryPublishCallback f1429a;

        public C1023a(PackageNameManager packageNameManager, QueryPublishCallback queryPublishCallback) {
            this.f1429a = queryPublishCallback;
        }

        @Override // com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack
        public void onMarketInstallInfo(Intent intent) {
            if (HMSPublishStateHolder.getPublishState() != 1) {
                HMSPublishStateHolder.setPublishState(2);
            }
            this.f1429a.onQueryResult();
        }

        @Override // com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack
        public void onMarketStoreError(int i) {
            HMSLog.m3177e("PackageNameManager", "onMarketStoreError responseCode: " + i);
            if (HMSPublishStateHolder.getPublishState() != 1) {
                HMSPublishStateHolder.setPublishState(2);
            }
            this.f1429a.onQueryResult();
        }

        @Override // com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack
        public void onUpdateInfo(Intent intent) {
            if (intent != null) {
                try {
                    int intExtra = intent.getIntExtra("status", -99);
                    HMSLog.m3175i("PackageNameManager", "CheckUpdateCallBack status is " + intExtra);
                    String stringExtra = intent.getStringExtra(UpdateKey.FAIL_REASON);
                    if (!TextUtils.isEmpty(stringExtra)) {
                        HMSLog.m3177e("PackageNameManager", "checkTargetAppUpdate reason is " + stringExtra);
                    }
                    if (intExtra == 7) {
                        Serializable serializableExtra = intent.getSerializableExtra(UpdateKey.INFO);
                        if ((serializableExtra instanceof ApkUpgradeInfo) && ((ApkUpgradeInfo) serializableExtra).getPackage_().equalsIgnoreCase(PackageConstants.SERVICES_PACKAGE_ALL_SCENE)) {
                            HMSLog.m3175i("PackageNameManager", "com.huawei.hms has already be published");
                            HMSPublishStateHolder.setPublishState(1);
                        }
                    }
                } catch (Exception e) {
                    HMSLog.m3177e("PackageNameManager", "intent has some error" + e.getMessage());
                }
            }
            if (HMSPublishStateHolder.getPublishState() != 1) {
                HMSPublishStateHolder.setPublishState(2);
            }
            this.f1429a.onQueryResult();
        }

        @Override // com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack
        public void onUpdateStoreError(int i) {
            HMSLog.m3177e("PackageNameManager", "onUpdateStoreError responseCode: " + i);
            if (HMSPublishStateHolder.getPublishState() != 1) {
                HMSPublishStateHolder.setPublishState(2);
            }
            this.f1429a.onQueryResult();
        }
    }

    public PackageNameManager(Context context) {
        this.f1428a = context;
    }

    public static PackageNameManager getInstance(Context context) {
        synchronized (f1426b) {
            if (f1427c == null) {
                f1427c = new PackageNameManager(context);
            }
        }
        return f1427c;
    }

    public void queryPackageName(QueryPublishCallback queryPublishCallback) {
        UpdateSdkAPI.checkTargetAppUpdate(this.f1428a, PackageConstants.SERVICES_PACKAGE_ALL_SCENE, new C1023a(this, queryPublishCallback));
    }
}
