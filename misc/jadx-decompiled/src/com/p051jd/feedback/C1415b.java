package com.p051jd.feedback;

import android.content.Context;
import android.content.SharedPreferences;
import android.text.TextUtils;
import android.util.Log;
import com.google.gson.Gson;
import com.p051jd.feedback.network.C1432a;
import com.p051jd.feedback.network.result.MessageRequestResult;
import io.reactivex.Observer;
import io.reactivex.android.schedulers.AndroidSchedulers;
import io.reactivex.disposables.Disposable;
import io.reactivex.functions.Consumer;
import io.reactivex.schedulers.Schedulers;
import java.util.ArrayList;
import java.util.List;

/* compiled from: TbsSdkJava */
/* renamed from: com.jd.feedback.b */
/* loaded from: classes.dex */
public final class C1415b {

    /* renamed from: a */
    private static List<MessageRequestResult.FeedbackMessages> f2559a = new ArrayList();

    /* renamed from: b */
    private static Context f2560b;

    /* compiled from: TbsSdkJava */
    /* renamed from: com.jd.feedback.b$a */
    /* loaded from: classes.dex */
    public interface AbstractC1418a {
        /* renamed from: a */
        void mo1993a();

        /* renamed from: a */
        void mo1992a(int i);
    }

    /* renamed from: a */
    public static void m1997a(Context context) {
        f2560b = context.getApplicationContext();
        if (!TextUtils.isEmpty(FeedbackSDK.getUserId())) {
            f2559a.clear();
            SharedPreferences sharedPreferences = f2560b.getSharedPreferences("feedback_cache", 0);
            String string = sharedPreferences.getString("feedback_history_" + FeedbackSDK.getUserId(), "");
            if (!TextUtils.isEmpty(string)) {
                f2559a.add((MessageRequestResult.FeedbackMessages) new Gson().fromJson(string, MessageRequestResult.FeedbackMessages.class));
            }
        }
    }

    /* renamed from: a */
    public static List<MessageRequestResult.FeedbackMessages> m1998a() {
        return f2559a;
    }

    /* renamed from: a */
    public static void m1996a(final AbstractC1418a aVar) {
        if (!TextUtils.isEmpty(FeedbackSDK.getUserId())) {
            C1432a.m1963a("1").doOnNext(new Consumer<MessageRequestResult>() { // from class: com.jd.feedback.b.2

                /* renamed from: a */
                final /* synthetic */ int f2562a = 1;

                public final /* synthetic */ void accept(Object obj) {
                    MessageRequestResult messageRequestResult = (MessageRequestResult) obj;
                    Log.i("FeedbackHistoryCache", "feedback histories: " + new Gson().toJson(messageRequestResult));
                    if (this.f2562a == 1) {
                        C1415b.m1995a(new Gson().toJson(messageRequestResult.getData()));
                    }
                    if (C1415b.f2559a.size() >= this.f2562a) {
                        C1415b.f2559a.subList(this.f2562a - 1, C1415b.f2559a.size()).clear();
                    }
                    C1415b.f2559a.add(messageRequestResult.getData());
                }
            }).subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).subscribe(new Observer<MessageRequestResult>() { // from class: com.jd.feedback.b.1
                public final void onComplete() {
                }

                public final void onSubscribe(Disposable disposable) {
                }

                public final /* synthetic */ void onNext(Object obj) {
                    MessageRequestResult messageRequestResult = (MessageRequestResult) obj;
                    AbstractC1418a aVar2 = AbstractC1418a.this;
                    if (aVar2 != null) {
                        aVar2.mo1992a(messageRequestResult.getData().getList().size());
                    }
                }

                public final void onError(Throwable th) {
                    AbstractC1418a aVar2 = AbstractC1418a.this;
                    if (aVar2 != null) {
                        aVar2.mo1993a();
                    }
                    Log.e("FeedbackHistoryCache", "Pull feedback history error: " + th.getMessage(), th);
                    th.printStackTrace();
                }
            });
        }
    }

    /* renamed from: a */
    static /* synthetic */ void m1995a(String str) {
        SharedPreferences.Editor edit = f2560b.getSharedPreferences("feedback_cache", 0).edit();
        edit.putString("feedback_history_" + FeedbackSDK.getUserId(), str);
        edit.commit();
    }
}
