package com.p051jd.feedback;

import android.app.Dialog;
import android.content.Context;
import android.content.Intent;
import android.graphics.Color;
import android.net.Uri;
import android.os.Build;
import android.os.Bundle;
import android.text.Editable;
import android.text.TextUtils;
import android.text.TextWatcher;
import android.util.Log;
import android.view.MotionEvent;
import android.view.View;
import android.view.inputmethod.InputMethodManager;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.ScrollView;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.appcompat.widget.AppCompatImageView;
import androidx.constraintlayout.widget.ConstraintLayout;
import androidx.core.app.ActivityCompat;
import androidx.core.content.ContextCompat;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import com.facebook.react.views.textinput.ReactEditTextInputConnectionWrapper;
import com.google.android.flexbox.FlexboxLayoutManager;
import com.google.gson.Gson;
import com.jakewharton.rxbinding2.a.a;
import com.jakewharton.rxbinding2.b.c;
import com.jakewharton.rxbinding2.b.d;
import com.jakewharton.rxbinding2.b.f;
import com.p051jd.feedback.FeedbackSDK;
import com.p051jd.feedback.album.AbstractC1303a;
import com.p051jd.feedback.album.C1363b;
import com.p051jd.feedback.album.C1371d;
import com.p051jd.feedback.album.p064a.C1318e;
import com.p051jd.feedback.album.p064a.p067c.C1311a;
import com.p051jd.feedback.network.C1432a;
import com.p051jd.feedback.network.result.FeedbackRequestResult;
import com.p051jd.feedback.network.result.StatisticsRequestResult;
import com.p051jd.feedback.p074b.C1425g;
import com.p051jd.feedback.p075ui.C1438a;
import com.p051jd.feedback.p075ui.C1448b;
import com.p051jd.feedback.p075ui.C1451c;
import com.p051jd.feedback.p075ui.p076a.C1440a;
import com.uber.autodispose.l;
import io.reactivex.Notification;
import io.reactivex.Observable;
import io.reactivex.ObservableSource;
import io.reactivex.Observer;
import io.reactivex.android.schedulers.AndroidSchedulers;
import io.reactivex.disposables.Disposable;
import io.reactivex.functions.BiPredicate;
import io.reactivex.functions.Consumer;
import io.reactivex.functions.Function;
import io.reactivex.functions.Function3;
import io.reactivex.functions.Predicate;
import io.reactivex.schedulers.Schedulers;
import io.reactivex.subjects.ReplaySubject;
import java.io.File;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import java.util.concurrent.TimeUnit;
import java.util.regex.Pattern;

/* compiled from: TbsSdkJava */
/* renamed from: com.jd.feedback.FeedbackActivity */
/* loaded from: classes.dex */
public class FeedbackActivity extends AppCompatActivity {

    /* renamed from: A */
    private Observable<Object> f2049A;

    /* renamed from: E */
    private String f2053E;

    /* renamed from: F */
    private List<C1438a> f2054F;

    /* renamed from: G */
    private int f2055G;

    /* renamed from: a */
    ReplaySubject<Integer> f2064a;

    /* renamed from: b */
    Observable<Integer> f2065b;

    /* renamed from: c */
    Observable<Integer> f2066c;

    /* renamed from: d */
    private ConstraintLayout f2067d;

    /* renamed from: e */
    private View f2068e;

    /* renamed from: f */
    private ScrollView f2069f;

    /* renamed from: g */
    private TextView f2070g;

    /* renamed from: h */
    private EditText f2071h;

    /* renamed from: i */
    private TextView f2072i;

    /* renamed from: j */
    private RecyclerView f2073j;

    /* renamed from: k */
    private EditText f2074k;

    /* renamed from: l */
    private Button f2075l;

    /* renamed from: m */
    private AppCompatImageView f2076m;

    /* renamed from: n */
    private TextView f2077n;

    /* renamed from: o */
    private TextView f2078o;

    /* renamed from: p */
    private View f2079p;

    /* renamed from: q */
    private ImageView f2080q;

    /* renamed from: r */
    private TextView f2081r;

    /* renamed from: s */
    private Dialog f2082s;

    /* renamed from: t */
    private Dialog f2083t;

    /* renamed from: u */
    private Dialog f2084u;

    /* renamed from: v */
    private Dialog f2085v;

    /* renamed from: w */
    private C1440a<C1438a> f2086w;

    /* renamed from: x */
    private RecyclerView f2087x;

    /* renamed from: y */
    private C1451c f2088y;

    /* renamed from: z */
    private List<String> f2089z = new ArrayList();

    /* renamed from: B */
    private final String f2050B = "PHONE";

    /* renamed from: C */
    private final String f2051C = "COO_IMAGES";

    /* renamed from: D */
    private final String f2052D = "SELECTED_TYPE_INDEX";

    /* renamed from: H */
    private boolean f2056H = false;

    /* renamed from: I */
    private boolean f2057I = false;

    /* renamed from: J */
    private String f2058J = null;

    /* renamed from: K */
    private List<C1438a> f2059K = new ArrayList();

    /* renamed from: L */
    private ArrayList<C1371d> f2060L = new ArrayList<>();

    /* renamed from: M */
    private View.OnTouchListener f2061M = new View.OnTouchListener() { // from class: com.jd.feedback.FeedbackActivity.19
        @Override // android.view.View.OnTouchListener
        public final boolean onTouch(View view, MotionEvent motionEvent) {
            if (view.getId() == C1287R.C1290id.feedback_scrollview) {
                if (view.getId() != C1287R.C1290id.feedback_edit_content) {
                    FeedbackActivity.m2270a(FeedbackActivity.this, view);
                }
            } else if (view.getId() == C1287R.C1290id.feedback_edit_content) {
                if (motionEvent.getAction() == 1) {
                    FeedbackActivity.this.f2069f.requestDisallowInterceptTouchEvent(false);
                } else {
                    FeedbackActivity.this.f2069f.requestDisallowInterceptTouchEvent(true);
                }
            }
            return false;
        }
    };

    /* renamed from: N */
    private final int f2062N = 101;

    /* renamed from: O */
    private final int f2063O = 102;

    /* JADX WARN: Multi-variable type inference failed */
    public void onCreate(Bundle bundle) {
        String str;
        ArrayList<Uri> arrayList;
        List<C1438a> list;
        FeedbackActivity.super.onCreate(bundle);
        Intent intent = getIntent();
        if (intent.getStringExtra(FeedbackReplyActivity.f2130a) != null) {
            this.f2058J = intent.getStringExtra(FeedbackReplyActivity.f2130a);
            this.f2057I = true;
        }
        if (bundle != null) {
            this.f2056H = true;
            this.f2053E = bundle.getString("PHONE");
            this.f2054F = bundle.getParcelableArrayList("COO_IMAGES");
            this.f2055G = bundle.getInt("SELECTED_TYPE_INDEX");
        }
        this.f2059K.clear();
        this.f2060L.clear();
        if (!this.f2056H || (list = this.f2054F) == null) {
            Intent intent2 = getIntent();
            if (intent2 != null) {
                ArrayList parcelableArrayListExtra = intent2.getParcelableArrayListExtra(FeedbackSDK.INTENT_KEY_IMAGES2ADD);
                Log.d("FeedbackActivity", "imagesToAdd: ".concat(String.valueOf(parcelableArrayListExtra)));
                if (parcelableArrayListExtra != null) {
                    try {
                        Log.d("FeedbackActivity", "convert image paths to uris");
                        arrayList = C1425g.m1974a((List) parcelableArrayListExtra, true);
                    } catch (Exception e) {
                        Log.w("FeedbackActivity", "get image uri by path failed");
                        e.printStackTrace();
                        arrayList = new ArrayList<>();
                    }
                } else {
                    arrayList = new ArrayList<>();
                }
                Log.d("FeedbackActivity", "imageUrisToAdd: ".concat(String.valueOf(arrayList)));
                List<C1438a> a = m2266a(arrayList);
                if (a.size() > 3) {
                    this.f2059K.add(a.get(0));
                    this.f2059K.add(a.get(1));
                    this.f2059K.add(a.get(2));
                } else {
                    this.f2059K.addAll(a);
                }
            }
        } else {
            this.f2059K.addAll(list);
        }
        for (C1438a aVar : this.f2059K) {
            C1371d dVar = new C1371d();
            dVar.f2460b = aVar.f2578b;
            this.f2060L.add(dVar);
        }
        setContentView(C1287R.layout.activity_feed_back);
        this.f2077n = (TextView) findViewById(C1287R.C1290id.text_title);
        this.f2076m = findViewById(C1287R.C1290id.btn_back);
        this.f2076m.setOnClickListener(new View.OnClickListener() { // from class: com.jd.feedback.FeedbackActivity.1
            @Override // android.view.View.OnClickListener
            public final void onClick(View view) {
                FeedbackActivity.this.finish();
            }
        });
        this.f2068e = findViewById(C1287R.C1290id.feedback_titlebar_area);
        this.f2080q = (ImageView) findViewById(C1287R.C1290id.feedback_history);
        this.f2080q.setOnClickListener(new View.OnClickListener() { // from class: com.jd.feedback.FeedbackActivity.12
            /* JADX WARN: Type inference failed for: r3v1, types: [android.content.Context, com.jd.feedback.FeedbackActivity] */
            /* JADX WARN: Unknown variable types count: 1 */
            @Override // android.view.View.OnClickListener
            /* Code decompiled incorrectly, please refer to instructions dump */
            public final void onClick(View view) {
                ?? r3 = FeedbackActivity.this;
                r3.startActivity(new Intent((Context) r3, FeedbackHistoryActivity.class));
            }
        });
        this.f2081r = (TextView) findViewById(C1287R.C1290id.red_point);
        this.f2081r.setVisibility(8);
        this.f2069f = (ScrollView) findViewById(C1287R.C1290id.feedback_scrollview);
        this.f2070g = (TextView) findViewById(C1287R.C1290id.feedback_question_sentence);
        this.f2087x = findViewById(C1287R.C1290id.feedback_titles_view);
        this.f2087x.setLayoutManager(new FlexboxLayoutManager(this, 0, 1));
        this.f2088y = new C1451c(this.f2089z, new C1451c.AbstractC1453a() { // from class: com.jd.feedback.FeedbackActivity.22
        });
        this.f2087x.setAdapter(this.f2088y);
        this.f2071h = (EditText) findViewById(C1287R.C1290id.feedback_edit_content);
        this.f2065b = c.b(this.f2071h).map(new Function<d, Integer>() { // from class: com.jd.feedback.FeedbackActivity.23
            public final /* synthetic */ Object apply(Object obj) {
                return Integer.valueOf(((d) obj).b().toString().length());
            }
        });
        this.f2072i = (TextView) findViewById(C1287R.C1290id.feedback_control_text);
        this.f2064a = ReplaySubject.create();
        this.f2073j = findViewById(C1287R.C1290id.feedback_dragView);
        this.f2086w = new C1440a<>(this.f2059K);
        this.f2064a.onNext(Integer.valueOf(this.f2086w.m1946b()));
        this.f2073j.setLayoutManager(new LinearLayoutManager(this, 0, false));
        this.f2073j.setAdapter(this.f2086w);
        this.f2086w.f2580b = new C1440a.AbstractC1446c() { // from class: com.jd.feedback.FeedbackActivity.24
            @Override // com.p051jd.feedback.p075ui.p076a.C1440a.AbstractC1446c
            /* renamed from: a */
            public final void mo1943a() {
                if (FeedbackActivity.m2271a(FeedbackActivity.this, 101, new String[]{"android.permission.READ_EXTERNAL_STORAGE", "android.permission.CAMERA"})) {
                    FeedbackActivity.this.m2262c();
                }
            }

            @Override // com.p051jd.feedback.p075ui.p076a.C1440a.AbstractC1446c
            /* renamed from: a */
            public final void mo1942a(ImageView imageView, Object obj) {
                if (FeedbackActivity.m2271a(FeedbackActivity.this, 102, new String[]{"android.permission.READ_EXTERNAL_STORAGE"})) {
                    FeedbackSDK.getImageLoader().load(imageView, ((C1438a) obj).f2577a, null, null, FeedbackSDK.ImageLoader.OPTION_CENTER_CROP);
                }
            }

            @Override // com.p051jd.feedback.p075ui.p076a.C1440a.AbstractC1446c
            /* renamed from: a */
            public final void mo1941a(List list2, int i) {
                FeedbackActivity.this.f2064a.onNext(Integer.valueOf(list2.size() - 1));
                FeedbackActivity.this.f2060L.remove(i);
            }
        };
        this.f2075l = (Button) findViewById(C1287R.C1290id.feedback_submit_button);
        this.f2074k = (EditText) findViewById(C1287R.C1290id.feedback_personal_phone);
        this.f2066c = c.b(this.f2074k).map(new Function<d, Integer>() { // from class: com.jd.feedback.FeedbackActivity.25
            public final /* synthetic */ Object apply(Object obj) {
                return Integer.valueOf(((d) obj).b().toString().length());
            }
        });
        if (this.f2056H && (str = this.f2053E) != null) {
            this.f2074k.setText(str);
        } else if (!TextUtils.isEmpty(FeedbackSDK.getUserPhoneNumber())) {
            this.f2074k.setText(FeedbackSDK.getUserPhoneNumber());
        }
        this.f2074k.addTextChangedListener(new TextWatcher() { // from class: com.jd.feedback.FeedbackActivity.26
            @Override // android.text.TextWatcher
            public final void beforeTextChanged(CharSequence charSequence, int i, int i2, int i3) {
            }

            @Override // android.text.TextWatcher
            public final void onTextChanged(CharSequence charSequence, int i, int i2, int i3) {
                try {
                    String obj = FeedbackActivity.this.f2074k.getText().toString();
                    String a2 = FeedbackActivity.m2267a(obj);
                    if (!TextUtils.isEmpty(a2) && !obj.equals(a2)) {
                        FeedbackActivity.this.f2074k.setText(a2);
                        FeedbackActivity.this.f2074k.setSelection(a2.length());
                    }
                } catch (Exception e2) {
                    e2.printStackTrace();
                }
            }

            @Override // android.text.TextWatcher
            public final void afterTextChanged(Editable editable) {
                if (editable.toString().trim().length() == 0) {
                    FeedbackActivity.this.f2074k.setHint(C1292a.m2219i());
                }
            }
        });
        this.f2078o = (TextView) findViewById(C1287R.C1290id.phoneTextleft);
        this.f2079p = findViewById(C1287R.C1290id.phone_area);
        this.f2067d = findViewById(C1287R.C1290id.feedback_root);
        this.f2083t = new Dialog(this, C1287R.style.bgTransparent);
        this.f2083t.setContentView(C1287R.layout.dialog_fail);
        this.f2083t.setCanceledOnTouchOutside(false);
        this.f2083t.findViewById(C1287R.C1290id.btn_negative).setOnClickListener(new View.OnClickListener() { // from class: com.jd.feedback.FeedbackActivity.27
            @Override // android.view.View.OnClickListener
            public final void onClick(View view) {
                FeedbackActivity.this.f2083t.dismiss();
            }
        });
        this.f2049A = a.a(this.f2083t.findViewById(C1287R.C1290id.btn_positive)).doOnNext(new Consumer<Object>() { // from class: com.jd.feedback.FeedbackActivity.28
            public final void accept(Object obj) {
                FeedbackActivity.this.f2083t.dismiss();
            }
        });
        this.f2085v = new Dialog(this, C1287R.style.bgTransparent);
        this.f2085v.setContentView(C1287R.layout.dialog_pulling);
        this.f2085v.setCanceledOnTouchOutside(false);
        this.f2084u = new Dialog(this, C1287R.style.bgTransparent);
        this.f2084u.setContentView(C1287R.layout.dialog_success);
        this.f2082s = new Dialog(this, C1287R.style.bgTransparent);
        this.f2082s.setContentView(C1287R.layout.dialog_uploading);
        this.f2082s.setCanceledOnTouchOutside(false);
        getWindow().setSoftInputMode(18);
        m2273a();
        this.f2085v.show();
        FeedbackSDK.api_pullconfig(this, new FeedbackSDK.PullConfigListener() { // from class: com.jd.feedback.FeedbackActivity.2
            @Override // com.p051jd.feedback.FeedbackSDK.FeedbackRequestListener
            public final void onSuccess(String str2) {
                if (FeedbackActivity.this.f2085v != null) {
                    FeedbackActivity.this.f2085v.dismiss();
                }
                FeedbackActivity.this.m2273a();
                FeedbackActivity.this.m2264b();
            }

            @Override // com.p051jd.feedback.FeedbackSDK.FeedbackRequestListener
            public final void onFailure(Throwable th) {
                if (FeedbackActivity.this.f2085v != null) {
                    FeedbackActivity.this.f2085v.dismiss();
                }
                FeedbackActivity.this.m2264b();
            }
        });
        ((l) c.a(this.f2071h).doOnNext(new Consumer<f>() { // from class: com.jd.feedback.FeedbackActivity.3
            public final /* synthetic */ void accept(Object obj) {
                try {
                    String charSequence = ((f) obj).b().toString();
                    String a2 = FeedbackActivity.m2267a(charSequence);
                    if (!TextUtils.isEmpty(a2) && !charSequence.equals(a2)) {
                        FeedbackActivity.this.f2071h.setText(a2);
                        FeedbackActivity.this.f2071h.setSelection(a2.length());
                    }
                } catch (Exception e2) {
                    e2.printStackTrace();
                }
            }
        }).as(com.uber.autodispose.a.a(com.uber.autodispose.android.lifecycle.a.a(this)))).a();
        ((l) this.f2065b.doOnNext(new Consumer<Integer>() { // from class: com.jd.feedback.FeedbackActivity.7
            public final /* synthetic */ void accept(Object obj) {
                TextView textView = FeedbackActivity.this.f2072i;
                textView.setText(((Integer) obj) + "/500");
            }
        }).distinctUntilChanged(new BiPredicate<Integer, Integer>() { // from class: com.jd.feedback.FeedbackActivity.6
            public final /* synthetic */ boolean test(Object obj, Object obj2) {
                return ((Integer) obj).intValue() >= 480 && ((Integer) obj2).intValue() >= 480;
            }
        }).filter(new Predicate<Integer>() { // from class: com.jd.feedback.FeedbackActivity.5
            public final /* synthetic */ boolean test(Object obj) {
                return ((Integer) obj).intValue() >= 480;
            }
        }).as(com.uber.autodispose.a.a(com.uber.autodispose.android.lifecycle.a.a(this)))).a(new Observer<Integer>() { // from class: com.jd.feedback.FeedbackActivity.4
            public final void onComplete() {
            }

            public final void onSubscribe(Disposable disposable) {
            }

            public final void onError(Throwable th) {
                th.printStackTrace();
            }

            /* JADX WARN: Type inference failed for: r3v1, types: [android.content.Context, com.jd.feedback.FeedbackActivity] */
            /* JADX WARN: Unknown variable types count: 1 */
            /* Code decompiled incorrectly, please refer to instructions dump */
            public final /* synthetic */ void onNext(Object obj) {
                ?? r3 = FeedbackActivity.this;
                Toast.makeText((Context) r3, r3.getString(C1287R.string.lib_setting_feedback_text_size_limitcontent), 0).show();
            }
        });
        ((l) Observable.combineLatest(this.f2064a.startWith(0), this.f2065b.startWith(0), this.f2066c.startWith(0), new Function3<Integer, Integer, Integer, Boolean>() { // from class: com.jd.feedback.FeedbackActivity.9
            public final /* synthetic */ Object apply(Object obj, Object obj2, Object obj3) {
                Integer num = (Integer) obj;
                Integer num2 = (Integer) obj2;
                Log.d("FeedbackActivity", "combine imageSize=" + num + ", contentlength=" + num2 + ", phoneLength=" + ((Integer) obj3));
                if (FeedbackActivity.this.f2057I && (num.intValue() > 0 || num2.intValue() > 0)) {
                    return Boolean.TRUE;
                }
                if (FeedbackActivity.this.f2057I || ((num.intValue() <= 0 && num2.intValue() <= 0) || (C1292a.m2213o() && FeedbackActivity.this.f2074k.getText().toString().trim().length() <= 0))) {
                    return Boolean.FALSE;
                }
                return Boolean.TRUE;
            }
        }).doOnNext(new Consumer<Boolean>() { // from class: com.jd.feedback.FeedbackActivity.8
            public final /* synthetic */ void accept(Object obj) {
                FeedbackActivity.this.m2265a(((Boolean) obj).booleanValue());
            }
        }).as(com.uber.autodispose.a.a(com.uber.autodispose.android.lifecycle.a.a(this)))).a();
        ((l) Observable.merge(this.f2049A, a.a(this.f2075l)).doAfterNext(new Consumer<Object>() { // from class: com.jd.feedback.FeedbackActivity.17
            public final void accept(Object obj) {
                FeedbackActivity.m2247q(FeedbackActivity.this);
            }
        }).concatMap(new Function<Object, ObservableSource<FeedbackRequestResult>>() { // from class: com.jd.feedback.FeedbackActivity.16
            public final /* synthetic */ Object apply(Object obj) {
                Observable<String> observable;
                ArrayList arrayList2 = new ArrayList();
                StringBuilder sb = new StringBuilder("image paths: ");
                for (C1438a aVar2 : FeedbackActivity.this.f2086w.m1948a()) {
                    arrayList2.add(aVar2.f2577a);
                    sb.append(ReactEditTextInputConnectionWrapper.NEWLINE_RAW_VALUE);
                    sb.append(aVar2.f2578b);
                }
                Log.d("FeedbackActivity", sb.toString());
                if (FeedbackActivity.this.f2057I) {
                    observable = C1427c.m1971a(arrayList2, FeedbackActivity.this.f2058J);
                } else {
                    observable = C1427c.m1972a(arrayList2);
                }
                return observable.observeOn(Schedulers.computation()).toList().doOnSuccess(new Consumer<List<String>>() { // from class: com.jd.feedback.FeedbackActivity.16.2
                    public final /* synthetic */ void accept(Object obj2) {
                        if (((List) obj2).size() < FeedbackActivity.this.f2086w.m1948a().size()) {
                            throw new Exception("部分图片上传失败");
                        }
                    }
                }).flatMapObservable(new Function<List<String>, ObservableSource<FeedbackRequestResult>>() { // from class: com.jd.feedback.FeedbackActivity.16.1
                    public final /* synthetic */ Object apply(Object obj2) {
                        List list2 = (List) obj2;
                        Log.i("FeedbackActivity", "-------------意见反馈开始");
                        String str2 = !FeedbackActivity.this.f2057I ? (String) FeedbackActivity.this.f2089z.get(FeedbackActivity.this.f2088y.f2591a) : null;
                        String obj3 = FeedbackActivity.this.f2071h.getText().toString();
                        String obj4 = FeedbackActivity.this.f2074k.getText().toString();
                        Log.d("FeedbackActivity", "\ntype: " + str2 + "\ntext: " + obj3 + "\nphone: " + obj4 + "\nurls: " + list2);
                        if (FeedbackActivity.this.f2057I) {
                            return C1432a.m1960a(obj3, list2, FeedbackActivity.this.f2058J);
                        }
                        return C1432a.m1961a(str2, obj3, obj4, list2);
                    }
                });
            }
        }).observeOn(AndroidSchedulers.mainThread()).doOnEach(new Consumer<Notification<FeedbackRequestResult>>() { // from class: com.jd.feedback.FeedbackActivity.15
            public final /* synthetic */ void accept(Object obj) {
                Log.i("FeedbackActivity", "-------------意见反馈结束");
                FeedbackActivity.m2252l(FeedbackActivity.this);
            }
        }).doOnError(new Consumer<Throwable>() { // from class: com.jd.feedback.FeedbackActivity.14
            public final /* synthetic */ void accept(Object obj) {
                Throwable th = (Throwable) obj;
                Log.w("FeedbackActivity", "反馈失败 ：" + th.getMessage());
                th.printStackTrace();
                FeedbackActivity.this.f2083t.show();
            }
        }).retry().doOnNext(new Consumer<FeedbackRequestResult>() { // from class: com.jd.feedback.FeedbackActivity.13
            public final /* synthetic */ void accept(Object obj) {
                FeedbackActivity.this.f2084u.show();
            }
        }).delay(2, TimeUnit.SECONDS).doOnNext(new Consumer<FeedbackRequestResult>() { // from class: com.jd.feedback.FeedbackActivity.11
            public final /* synthetic */ void accept(Object obj) {
                Log.d("FeedbackActivity", "after delay at : " + Thread.currentThread().getName());
            }
        }).as(com.uber.autodispose.a.a(com.uber.autodispose.android.lifecycle.a.a(this)))).a(new Consumer<FeedbackRequestResult>() { // from class: com.jd.feedback.FeedbackActivity.10
            public final /* synthetic */ void accept(Object obj) {
                Log.d("FeedbackActivity", "after delay finish at : " + Thread.currentThread().getName());
                FeedbackActivity.this.finish();
            }
        });
        if (this.f2057I) {
            this.f2070g.setVisibility(8);
            this.f2087x.setVisibility(8);
            this.f2078o.setVisibility(8);
            this.f2074k.setVisibility(8);
            this.f2079p.setVisibility(8);
        }
    }

    protected void onSaveInstanceState(Bundle bundle) {
        FeedbackActivity.super.onSaveInstanceState(bundle);
        EditText editText = this.f2074k;
        if (editText != null) {
            bundle.putString("PHONE", editText.getText().toString());
        }
        C1440a<C1438a> aVar = this.f2086w;
        if (aVar != null) {
            bundle.putParcelableArrayList("COO_IMAGES", new ArrayList<>(aVar.m1948a()));
        }
        C1451c cVar = this.f2088y;
        if (cVar != null) {
            bundle.putInt("SELECTED_TYPE_INDEX", cVar.f2591a);
        }
    }

    /* JADX WARN: Multi-variable type inference failed */
    /* renamed from: a */
    private List<C1438a> m2266a(List<Uri> list) {
        ArrayList arrayList = new ArrayList();
        if (list != null && list.size() > 0) {
            for (Uri uri : list) {
                String a = C1425g.m1976a((Context) this, uri);
                if (a != null) {
                    arrayList.add(new C1438a(uri, a));
                }
            }
        }
        return arrayList;
    }

    /* renamed from: a */
    public void m2273a() {
        this.f2068e.setBackgroundColor(Color.parseColor(C1292a.m2224d()));
        this.f2077n.setTextColor(Color.parseColor(C1292a.m2226c()));
        if (this.f2057I) {
            this.f2077n.setText(getResources().getString(C1287R.string.feedback_title_reply));
        } else {
            this.f2077n.setText(C1292a.m2228b());
        }
        if (this.f2057I || !C1292a.m2212p()) {
            this.f2080q.setVisibility(8);
            this.f2081r.setVisibility(8);
        } else {
            this.f2080q.setVisibility(0);
        }
        this.f2070g.setText(C1292a.m2223e());
        this.f2089z.clear();
        this.f2089z.addAll(C1292a.m2222f());
        this.f2088y.m1936a(this.f2089z);
        if (this.f2056H) {
            this.f2088y.m1938a(this.f2055G);
        }
        this.f2088y.notifyDataSetChanged();
        this.f2071h.setHint(C1292a.m2221g());
        if (!C1292a.m2214n() || this.f2057I) {
            this.f2079p.setVisibility(8);
            this.f2078o.setVisibility(8);
            this.f2074k.setVisibility(8);
        } else {
            this.f2079p.setVisibility(0);
            this.f2078o.setVisibility(0);
            TextView textView = this.f2078o;
            StringBuilder sb = new StringBuilder();
            sb.append(C1292a.m2220h());
            sb.append(C1292a.m2213o() ? "(必填)" : "");
            textView.setText(sb.toString());
            this.f2074k.setVisibility(0);
            this.f2074k.setHint(C1292a.m2219i());
        }
        this.f2075l.setText(C1292a.m2218j());
        this.f2075l.setTextColor(Color.parseColor(C1292a.m2217k()));
        this.f2067d.setBackgroundColor(Color.parseColor(C1292a.m2215m()));
        if (this.f2057I) {
            if (this.f2086w.m1946b() > 0 || this.f2071h.getText().toString().trim().length() > 0) {
                m2265a(true);
            } else {
                m2265a(false);
            }
        } else if ((this.f2086w.m1946b() > 0 || this.f2071h.getText().toString().trim().length() > 0) && (!C1292a.m2213o() || this.f2074k.getText().toString().trim().length() > 0)) {
            m2265a(true);
        } else {
            m2265a(false);
        }
    }

    /* renamed from: b */
    public void m2264b() {
        if (!TextUtils.isEmpty(FeedbackSDK.getUserId())) {
            if (this.f2057I || this.f2080q.getVisibility() != 0) {
                this.f2081r.setVisibility(8);
            } else {
                FeedbackSDK.api_getFeedbackStatistics(this, new FeedbackSDK.FeedbackRequestListener() { // from class: com.jd.feedback.FeedbackActivity.18
                    @Override // com.p051jd.feedback.FeedbackSDK.FeedbackRequestListener
                    public final void onSuccess(String str) {
                        StatisticsRequestResult statisticsRequestResult = (StatisticsRequestResult) new Gson().fromJson(str, StatisticsRequestResult.class);
                        if (statisticsRequestResult.getData().getUnreadReplyCount() > 0) {
                            FeedbackActivity.this.f2081r.setVisibility(0);
                            FeedbackActivity.this.f2081r.setText(String.valueOf(statisticsRequestResult.getData().getUnreadReplyCount()));
                            return;
                        }
                        FeedbackActivity.this.f2081r.setVisibility(8);
                    }

                    @Override // com.p051jd.feedback.FeedbackSDK.FeedbackRequestListener
                    public final void onFailure(Throwable th) {
                        FeedbackActivity.this.f2081r.setVisibility(8);
                    }
                });
            }
        }
    }

    protected void onStart() {
        FeedbackActivity.super.onStart();
        m2264b();
    }

    /* renamed from: a */
    public void m2265a(boolean z) {
        this.f2075l.setEnabled(z);
        this.f2075l.setClickable(z);
        if (z) {
            this.f2075l.setBackgroundColor(Color.parseColor(C1292a.m2216l()));
        } else {
            this.f2075l.setBackgroundColor(getResources().getColor(C1287R.color.frame_gray));
        }
    }

    protected void onDestroy() {
        FeedbackActivity.super.onDestroy();
        Dialog dialog = this.f2084u;
        if (dialog != null) {
            dialog.dismiss();
        }
        Dialog dialog2 = this.f2083t;
        if (dialog2 != null) {
            dialog2.dismiss();
        }
        Dialog dialog3 = this.f2085v;
        if (dialog3 != null) {
            dialog3.dismiss();
        }
    }

    /* JADX WARN: Multi-variable type inference failed */
    public void onRequestPermissionsResult(int i, String[] strArr, int[] iArr) {
        switch (i) {
            case 101:
                StringBuffer stringBuffer = new StringBuffer();
                for (int i2 = 0; i2 < iArr.length; i2++) {
                    if (iArr[i2] != 0) {
                        if (stringBuffer.length() > 0) {
                            stringBuffer.append("、");
                        }
                        if (strArr[i2].endsWith("STORAGE")) {
                            stringBuffer.append("存储空间");
                        } else if (strArr[i2].endsWith("CAMERA")) {
                            stringBuffer.append("相机");
                        }
                    }
                }
                if (stringBuffer.length() > 0) {
                    stringBuffer.insert(0, "请在设置-->权限管理中开启本应用的");
                    stringBuffer.append("访问权限");
                    C1448b.m1940a(this, stringBuffer.toString()).show();
                    return;
                }
                m2262c();
                return;
            case 102:
                if (iArr[0] != 0) {
                    Log.d("FeedbackActivity", "存储访问权限被拒绝，不加载图片.");
                    this.f2059K.clear();
                    this.f2060L.clear();
                    this.f2086w.f2579a = this.f2059K;
                    C1448b.m1940a(this, "请在设置-->权限管理中开启本应用的存储空间访问权限").show();
                }
                this.f2086w.notifyDataSetChanged();
                return;
            default:
                return;
        }
    }

    /* JADX WARN: Multi-variable type inference failed */
    /* renamed from: c */
    public void m2262c() {
        C1318e a = C1363b.m2105b(this).mo2197a();
        a.f2248f = true;
        C1318e eVar = a;
        eVar.f2249g = 4;
        C1318e eVar2 = eVar;
        eVar2.f2277k = 3;
        eVar2.f2241e = this.f2060L;
        C1311a.C1313a a2 = C1311a.m2195a((Context) this);
        a2.f2267f = "选择图片";
        eVar2.f2240d = a2.m2193a();
        C1318e eVar3 = eVar2;
        eVar3.f2238b = new AbstractC1303a<ArrayList<C1371d>>() { // from class: com.jd.feedback.FeedbackActivity.21
            @Override // com.p051jd.feedback.album.AbstractC1303a
            /* renamed from: a */
            public final /* synthetic */ void mo2162a(@NonNull ArrayList<C1371d> arrayList) {
                ArrayList<C1371d> arrayList2 = arrayList;
                FeedbackActivity.this.f2060L = arrayList2;
                ArrayList arrayList3 = new ArrayList();
                Iterator<C1371d> it = arrayList2.iterator();
                while (it.hasNext()) {
                    C1371d next = it.next();
                    if (new File(next.f2460b).exists()) {
                        arrayList3.add(new C1438a(Uri.parse("content://media/external/images/media/" + next.f2459a), next.f2460b));
                    }
                }
                C1440a aVar = FeedbackActivity.this.f2086w;
                aVar.f2579a.clear();
                aVar.f2579a.addAll(arrayList3);
                aVar.notifyDataSetChanged();
                FeedbackActivity.this.f2064a.onNext(Integer.valueOf(FeedbackActivity.this.f2086w.m1948a().size()));
            }
        };
        C1318e eVar4 = eVar3;
        eVar4.f2239c = new AbstractC1303a<String>() { // from class: com.jd.feedback.FeedbackActivity.20
            @Override // com.p051jd.feedback.album.AbstractC1303a
            /* renamed from: a */
            public final /* bridge */ /* synthetic */ void mo2162a(@NonNull String str) {
            }
        };
        eVar4.m2189a();
    }

    /* JADX WARN: Multi-variable type inference failed */
    /* renamed from: a */
    static /* synthetic */ boolean m2271a(FeedbackActivity feedbackActivity, int i, String[] strArr) {
        boolean z = false;
        if (Build.VERSION.SDK_INT >= 23) {
            ArrayList arrayList = new ArrayList();
            for (String str : strArr) {
                if (ContextCompat.checkSelfPermission(feedbackActivity, str) != 0) {
                    arrayList.add(str);
                }
            }
            Log.d("FeedbackActivity", "check deniedPermissions: " + arrayList.size());
            if (arrayList.size() > 0) {
                ActivityCompat.requestPermissions(feedbackActivity, (String[]) arrayList.toArray(new String[arrayList.size()]), i);
                Log.d("FeedbackActivity", "check permission: ".concat(String.valueOf(z)));
                return z;
            }
        }
        z = true;
        Log.d("FeedbackActivity", "check permission: ".concat(String.valueOf(z)));
        return z;
    }

    /* renamed from: a */
    static /* synthetic */ String m2267a(String str) {
        if (str == null) {
            return str;
        }
        return Pattern.compile("onload(.*?)=", 42).matcher(Pattern.compile("vbscript:", 2).matcher(Pattern.compile("javascript:", 2).matcher(Pattern.compile("e\u00adxpression\\((.*?)\\)", 42).matcher(Pattern.compile("eval\\((.*?)\\)", 42).matcher(Pattern.compile("<script(.*?)>", 42).matcher(Pattern.compile("</script>", 2).matcher(Pattern.compile("src[\r\n]*=[\r\n]*\\\"(.*?)\\\"", 42).matcher(Pattern.compile("src[\r\n]*=[\r\n]*\\'(.*?)\\'", 42).matcher(Pattern.compile("<script>(.*?)</script>", 2).matcher(str.replaceAll("", "")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("")).replaceAll("");
    }

    /* renamed from: l */
    static /* synthetic */ void m2252l(FeedbackActivity feedbackActivity) {
        Dialog dialog = feedbackActivity.f2082s;
        if (dialog != null) {
            dialog.dismiss();
        }
    }

    /* renamed from: q */
    static /* synthetic */ void m2247q(FeedbackActivity feedbackActivity) {
        feedbackActivity.f2082s.show();
    }

    /* renamed from: a */
    static /* synthetic */ void m2270a(FeedbackActivity feedbackActivity, View view) {
        InputMethodManager inputMethodManager = (InputMethodManager) feedbackActivity.getSystemService("input_method");
        if (inputMethodManager.isActive()) {
            inputMethodManager.hideSoftInputFromWindow(view.getWindowToken(), 0);
        }
    }
}
