package com.p051jd.libs.hybrid.offlineload.loader;

import android.os.Build;
import android.text.TextUtils;
import com.jd.libs.hybrid.offlineload.entity.OfflineEntity;
import com.jingdong.common.network.HttpGroupUtils;
import com.jingdong.common.utils.Configuration;
import com.jingdong.jdsdk.network.toolbox.HttpError;
import com.jingdong.jdsdk.network.toolbox.HttpGroup;
import com.jingdong.jdsdk.network.toolbox.HttpResponse;
import com.jingdong.jdsdk.network.toolbox.HttpSetting;
import com.jingdong.jdsdk.network.utils.Base64;
import com.jingdong.jdsdk.utils.JSONObjectProxy;
import com.p051jd.framework.json.JDJSON;
import com.p051jd.libs.hybrid.base.C1841a;
import com.p051jd.libs.hybrid.base.p095b.C1853c;
import com.p051jd.push.common.constant.Constants;

/* renamed from: com.jd.libs.hybrid.offlineload.loader.OfflineEntityLoader */
/* loaded from: classes.dex */
public class OfflineEntityLoader {

    /* renamed from: com.jd.libs.hybrid.offlineload.loader.OfflineEntityLoader$Callback */
    /* loaded from: classes.dex */
    public interface Callback<T> {

        /* renamed from: com.jd.libs.hybrid.offlineload.loader.OfflineEntityLoader$Callback$a */
        /* loaded from: classes.dex */
        public static class C1890a extends Exception {
        }

        /* renamed from: a */
        void mo1185a(Exception exc);

        /* renamed from: a */
        void mo1184a(T t);
    }

    /* renamed from: com.jd.libs.hybrid.offlineload.loader.OfflineEntityLoader$a */
    /* loaded from: classes.dex */
    static abstract class AbstractC1891a implements HttpGroup.OnAllListener {
        AbstractC1891a() {
        }

        public void onEnd(HttpResponse httpResponse) {
        }

        public void onError(HttpError httpError) {
        }

        public void onProgress(int i, int i2) {
        }

        public void onStart() {
        }
    }

    /* renamed from: a */
    private static String m1203a() {
        try {
            return C1841a.m1343c().getPackageManager().getPackageInfo(C1841a.m1343c().getPackageName(), 0).versionName;
        } catch (Exception e) {
            C1853c.m1312a("OfflineEntityLoader", e);
            return "";
        }
    }

    /* renamed from: a */
    private static void m1201a(HttpSetting httpSetting) {
        httpSetting.putQueryParam(Configuration.CLIENT, "android");
        httpSetting.putQueryParam("clientVersion", m1203a());
        httpSetting.putQueryParam(Constants.JdPushMsg.JSON_KEY_OS_VERSION, Build.VERSION.RELEASE);
        httpSetting.putQueryParam("d_model", Build.MODEL);
    }

    /* JADX INFO: Access modifiers changed from: private */
    /* renamed from: b */
    public static String m1198b(String str) {
        String str2;
        String concat;
        if (!TextUtils.isEmpty(str)) {
            try {
                int length = str.length();
                if (length > 3) {
                    int i = length - 3;
                    int charAt = str.charAt(i) - '0';
                    if (charAt < 0 || charAt > 9) {
                        str2 = "OfflineEntityLoader";
                        concat = "Fail to decrypt. Encrypted string's insert-count is wrong, count = ".concat(String.valueOf(charAt));
                    } else {
                        return new String(Base64.decode((str.substring(0, i) + str.substring(length - 2)).substring(charAt)), "utf-8");
                    }
                } else {
                    str2 = "OfflineEntityLoader";
                    concat = "Fail to decrypt. Encrypted string too short, string = ".concat(String.valueOf(str));
                }
                C1853c.m1306e(str2, concat);
            } catch (Exception e) {
                C1853c.m1313a("OfflineEntityLoader", "Fail to decrypt.", (Throwable) e);
            }
        }
        C1853c.m1306e("OfflineEntityLoader", "Return the raw data = ".concat(String.valueOf(str)));
        return str;
    }

    /* renamed from: a */
    public void m1202a(final Callback<String> callback) {
        HttpSetting httpSetting = new HttpSetting();
        httpSetting.setCacheMode(2);
        httpSetting.setPost(false);
        if (C1841a.C1843b.m1325e()) {
            httpSetting.setUseHttps(false);
        }
        if (C1841a.C1843b.m1328b()) {
            httpSetting.setFunctionId("hybrid");
            httpSetting.putJsonParam("api-version", "1.2.0");
            httpSetting.putJsonParam("app-key", C1841a.m1340d());
            httpSetting.putJsonParam("app-type", "android");
            m1201a(httpSetting);
            httpSetting.setHost(C1841a.C1843b.m1327c());
        } else {
            httpSetting.setFinalUrl(C1841a.C1843b.m1332a() + "?api-version=1.2.0&app-key=" + C1841a.m1340d() + "&app-type=android&client=android&clientVersion=" + m1203a());
        }
        httpSetting.setListener(new AbstractC1891a() { // from class: com.jd.libs.hybrid.offlineload.loader.OfflineEntityLoader.1
            @Override // com.p051jd.libs.hybrid.offlineload.loader.OfflineEntityLoader.AbstractC1891a
            public final void onEnd(HttpResponse httpResponse) {
                try {
                    JSONObjectProxy jSONObject = httpResponse.getJSONObject();
                    if (jSONObject == null || !jSONObject.has("data")) {
                        callback.mo1185a((Exception) new IllegalArgumentException());
                        return;
                    }
                    callback.mo1184a((Callback) OfflineEntityLoader.m1198b(jSONObject.getString("data")));
                } catch (Exception e) {
                    Callback callback2 = callback;
                    if (callback2 != null) {
                        callback2.mo1185a(e);
                    }
                }
            }

            @Override // com.p051jd.libs.hybrid.offlineload.loader.OfflineEntityLoader.AbstractC1891a
            public final void onError(HttpError httpError) {
                Callback callback2 = callback;
                if (callback2 != null) {
                    callback2.mo1185a((Exception) httpError);
                }
            }
        });
        C1853c.m1308c("OfflineEntityLoader", "Start to request all configs.");
        HttpGroupUtils.getHttpGroupaAsynPool().add(httpSetting);
    }

    /* renamed from: a */
    public void m1199a(String str, final Callback<OfflineEntity> callback) {
        HttpSetting httpSetting = new HttpSetting();
        httpSetting.setCacheMode(2);
        httpSetting.setPost(false);
        if (C1841a.C1843b.m1325e()) {
            httpSetting.setUseHttps(false);
        }
        if (C1841a.C1843b.m1328b()) {
            httpSetting.setFunctionId("hybridResourceItem");
            httpSetting.putJsonParam("id", str);
            httpSetting.putJsonParam("app-key", C1841a.m1340d());
            httpSetting.putJsonParam("app-type", "android");
            httpSetting.putJsonParam("api-version", "1.2.0");
            m1201a(httpSetting);
            httpSetting.setHost(C1841a.C1843b.m1327c());
        } else {
            httpSetting.setFinalUrl(C1841a.C1843b.m1332a() + "/resource/item?id=" + str + "&api-version=1.2.0&app-key=" + C1841a.m1340d() + "&app-type=android&client=android&clientVersion=" + m1203a());
            if (C1841a.m1346b()) {
                httpSetting.setUseHttps(false);
            }
        }
        httpSetting.setListener(new AbstractC1891a() { // from class: com.jd.libs.hybrid.offlineload.loader.OfflineEntityLoader.2
            @Override // com.p051jd.libs.hybrid.offlineload.loader.OfflineEntityLoader.AbstractC1891a
            public final void onEnd(HttpResponse httpResponse) {
                try {
                    JSONObjectProxy jSONObject = httpResponse.getJSONObject();
                    if (jSONObject != null && jSONObject.has("data")) {
                        String b = OfflineEntityLoader.m1198b(jSONObject.getString("data"));
                        if (!TextUtils.isEmpty(b) && !b.equalsIgnoreCase("null")) {
                            if (callback != null) {
                                OfflineEntity offlineEntity = (OfflineEntity) JDJSON.parseObject(b, OfflineEntity.class);
                                if (offlineEntity.useful()) {
                                    callback.mo1184a((Callback) offlineEntity);
                                    return;
                                } else {
                                    callback.mo1185a((Exception) new IllegalArgumentException());
                                    return;
                                }
                            } else {
                                return;
                            }
                        }
                        callback.mo1185a((Exception) new Callback.C1890a());
                        return;
                    }
                    callback.mo1185a((Exception) new IllegalArgumentException());
                } catch (Exception e) {
                    Callback callback2 = callback;
                    if (callback2 != null) {
                        callback2.mo1185a(e);
                    }
                }
            }

            @Override // com.p051jd.libs.hybrid.offlineload.loader.OfflineEntityLoader.AbstractC1891a
            public final void onError(HttpError httpError) {
                Callback callback2 = callback;
                if (callback2 != null) {
                    callback2.mo1185a((Exception) httpError);
                }
            }
        });
        C1853c.m1308c("OfflineEntityLoader", "Start to request config for appId = ".concat(String.valueOf(str)));
        HttpGroupUtils.getHttpGroupaAsynPool().add(httpSetting);
    }
}
