package com.p051jd.phc;

import android.content.Context;
import android.text.TextUtils;
import android.util.Base64;
import com.huawei.hms.support.hianalytics.HiAnalyticsConstant;
import java.nio.ByteBuffer;
import java.nio.ByteOrder;
import java.nio.charset.Charset;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;
import org.json.JSONObject;
import phc.a;
import phc.b;
import phc.c;
import phc.d;

/* compiled from: TbsSdkJava */
/* renamed from: com.jd.phc.PHCEngine */
/* loaded from: classes.dex */
public class PHCEngine {

    /* renamed from: a */
    public static Server f3566a = Server.Official;

    /* renamed from: b */
    private static PHCEngine f3567b;

    /* renamed from: c */
    private Context f3568c;

    /* renamed from: d */
    private String f3569d;

    /* compiled from: TbsSdkJava */
    /* renamed from: com.jd.phc.PHCEngine$Server */
    /* loaded from: classes.dex */
    public enum Server {
        Pre,
        Official
    }

    /* compiled from: TbsSdkJava */
    /* renamed from: com.jd.phc.PHCEngine$a */
    /* loaded from: classes.dex */
    public interface AbstractC2020a {
        void onGetNormalDSecretFailed(String str, String str2);
    }

    /* compiled from: TbsSdkJava */
    /* renamed from: com.jd.phc.PHCEngine$PHCCipherSuite */
    /* loaded from: classes.dex */
    public enum PHCCipherSuite {
        AES_CBC_PKCS5Padding(0),
        AES_CTR_NoPadding(1),
        RC4(2),
        RC4_CRC32CHECKSUM(4);
        
        private int value;

        PHCCipherSuite(int i) {
            this.value = i;
        }

        public int value() {
            return this.value;
        }
    }

    private PHCEngine(Context context) {
        this.f3568c = context.getApplicationContext();
        this.f3569d = context.getPackageName();
    }

    /* renamed from: a */
    public static PHCEngine m868a(Context context) {
        if (f3567b == null) {
            synchronized (PHCEngine.class) {
                if (f3567b == null) {
                    f3567b = new PHCEngine(context);
                }
            }
        }
        return f3567b;
    }

    /* renamed from: a */
    public void m866a(AbstractC2020a aVar) {
        m867a(Server.Official, aVar);
    }

    /* renamed from: a */
    public void m867a(Server server, AbstractC2020a aVar) {
        f3566a = server;
        if (aVar != null && d.b()) {
            new b(this.f3568c, aVar).execute((Object[]) null);
        }
    }

    /* renamed from: a */
    public void m863a(boolean z) {
        a.a(z);
    }

    /* renamed from: a */
    public String m864a(Map<String, String> map, PHCCipherSuite pHCCipherSuite) throws IllegalArgumentException {
        if (map == null || map.isEmpty() || pHCCipherSuite == null) {
            throw new IllegalArgumentException("plaintext can not null;");
        }
        try {
            long currentTimeMillis = System.currentTimeMillis();
            ByteBuffer order = ByteBuffer.allocate(8).order(ByteOrder.BIG_ENDIAN);
            order.putLong(currentTimeMillis);
            int i = d.c;
            byte[] bArr = d.a;
            String str = d.b;
            if (bArr == null) {
                bArr = Base64.decode("BHqxx7mF6ozKsygZ3HUozSM7rED0qHts6lZNeFRdOls=", 2);
                str = "JM9F1ywUPwflvMIpYPok0tt5k9kW4ArJEU3lfLhxBqw=";
                i = -1;
            }
            byte[] a = PHCNativeLoader.m862a().m858a(bArr, str, this.f3569d, order.array());
            JSONObject jSONObject = new JSONObject();
            for (String str2 : map.keySet()) {
                jSONObject.put(str2, Base64.encodeToString(PHCNativeLoader.m862a().m859a(a, pHCCipherSuite.value(), map.get(str2).getBytes()), 2));
            }
            JSONObject jSONObject2 = new JSONObject();
            jSONObject2.put("hdid", str);
            jSONObject2.put("ts", currentTimeMillis);
            jSONObject2.put("ridx", i);
            jSONObject2.put("cipher", jSONObject);
            jSONObject2.put("ciphertype", pHCCipherSuite.value());
            jSONObject2.put(HiAnalyticsConstant.HaKey.BI_KEY_VERSION, c.a());
            jSONObject2.put("appname", this.f3569d);
            return jSONObject2.toString();
        } catch (Exception e) {
            if (!a.a) {
                return "";
            }
            e.printStackTrace();
            return "";
        } catch (Throwable th) {
            if (!a.a) {
                return "";
            }
            th.printStackTrace();
            return "";
        }
    }

    /* renamed from: a */
    public Map<String, String> m865a(String str) throws IllegalArgumentException {
        if (!TextUtils.isEmpty(str)) {
            try {
                JSONObject jSONObject = new JSONObject(str);
                long optLong = jSONObject.optLong("ts");
                jSONObject.optString(HiAnalyticsConstant.HaKey.BI_KEY_VERSION);
                int optInt = jSONObject.optInt("ciphertype");
                String optString = jSONObject.optString("cipher");
                String optString2 = jSONObject.optString("hdid");
                String optString3 = jSONObject.optString("appname");
                int optInt2 = jSONObject.optInt("ridx");
                byte[] bArr = d.a;
                if (optInt2 == -1) {
                    bArr = Base64.decode("BHqxx7mF6ozKsygZ3HUozSM7rED0qHts6lZNeFRdOls=", 2);
                } else if (bArr == null) {
                    return null;
                }
                ByteBuffer order = ByteBuffer.allocate(8).order(ByteOrder.BIG_ENDIAN);
                order.putLong(optLong);
                byte[] a = PHCNativeLoader.m862a().m858a(bArr, optString2, optString3, order.array());
                JSONObject jSONObject2 = new JSONObject(optString);
                HashMap hashMap = new HashMap();
                Iterator<String> keys = jSONObject2.keys();
                while (keys.hasNext()) {
                    String next = keys.next();
                    hashMap.put(next, new String(PHCNativeLoader.m862a().m856b(a, optInt, Base64.decode(jSONObject2.optString(next), 2)), Charset.forName("UTF-8")));
                }
                return hashMap;
            } catch (Exception e) {
                if (a.a) {
                    e.printStackTrace();
                }
                return null;
            } catch (Throwable th) {
                if (a.a) {
                    th.printStackTrace();
                }
                return null;
            }
        } else {
            throw new IllegalArgumentException("plaintext can not null;");
        }
    }
}
