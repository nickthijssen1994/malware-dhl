package com.p051jd.fireeye.security;

import android.content.Context;
import android.content.SharedPreferences;
import android.text.TextUtils;
import android.util.Base64;
import com.alibaba.fastjson.asm.Opcodes;
import com.p051jd.fireeye.common.C1455a;
import com.p051jd.fireeye.common.C1459e;
import com.p051jd.fireeye.common.C1462g;
import com.p051jd.fireeye.common.C1463h;
import com.p051jd.fireeye.common.C1482r;
import com.p051jd.fireeye.common.C1483s;
import com.p051jd.fireeye.network.AbstractC1495h;
import com.p051jd.lib.p083un.utils.UnTimeUtils;
import com.p051jd.push.common.constant.Constants;
import org.json.JSONException;
import org.json.JSONObject;

/* compiled from: TbsSdkJava */
/* renamed from: com.jd.fireeye.security.TrackOrder */
/* loaded from: classes.dex */
public class TrackOrder {
    private static final String BETA_FIRST_ORDER_URL;
    private static final String FIRST_ORDER_URL;
    private static final String TAG;
    private static final String TRACK_KEY;
    private static final String TRACK_SIGNATURE;
    private static final String TRACK_SOURCE_NAME;
    private static SharedPreferences shareStore;

    private static String getFirstOrderURL() {
        return C1498b.m1624e() ? BETA_FIRST_ORDER_URL : FIRST_ORDER_URL;
    }

    public static void putTrackOrderParams(Context context, JSONObject jSONObject) {
        C1462g.m1888b(TAG, "come to putTrackOrderParams");
        initialShareStoreFile(context);
        if (shareStore != null) {
            if (jSONObject != null) {
                String str = "";
                String optString = jSONObject.optString("tracking");
                String optString2 = jSONObject.optString(Constants.JdPushMsg.JSON_KEY_PKG_NAME_full);
                try {
                    SharedPreferences.Editor edit = shareStore.edit();
                    if (!TextUtils.isEmpty(optString)) {
                        edit.putString(TRACK_KEY, optString);
                    }
                    if (!TextUtils.isEmpty(optString2)) {
                        String str2 = new String(Base64.encode(optString2.getBytes(), 2));
                        try {
                            edit.putString(TRACK_SOURCE_NAME, str2).putString(TRACK_SIGNATURE, C1455a.m1933a(context, optString2));
                            str = str2;
                        } catch (Throwable unused) {
                            str = str2;
                        }
                    }
                    edit.commit();
                } catch (Throwable unused2) {
                }
                if (C1462g.f2620a) {
                    C1462g.m1888b(TAG, "put trackid = " + optString + ",packName = " + optString2 + ",encryptSrc = " + str);
                    return;
                }
                return;
            }
            C1462g.m1892a(TAG, "TrackParams is Empty!!!");
        }
    }

    public static JSONObject getTrackOrderParams(Context context) {
        initialShareStoreFile(context);
        JSONObject jSONObject = new JSONObject();
        try {
            C1462g.m1888b(TAG, "come to getTrackOrderParams");
            String str = "";
            String str2 = "";
            if (shareStore != null) {
                str = shareStore.getString(TRACK_KEY, "");
                str2 = shareStore.getString(TRACK_SIGNATURE, "");
                if (C1462g.f2620a) {
                    C1462g.m1888b(TAG, "trackKey = " + str + ",signature = " + str2);
                }
            }
            if (str == null) {
                str = "";
            }
            jSONObject.put("fe_order_track", str);
            if (str2 == null) {
                str2 = "";
            }
            jSONObject.put("advertise_app", str2);
            String a = C1498b.m1635a();
            if (C1462g.f2620a) {
                C1462g.m1888b(TAG, "devicecode = " + a);
            }
            if (!C1483s.m1699b(a)) {
                a = C1482r.m1714b(context);
                if (C1462g.f2620a) {
                    C1462g.m1888b(TAG, "get uuid in sdk,devicecode = " + a);
                }
            }
            C1459e.C1460a encryptDeviceCode = getEncryptDeviceCode(a);
            if (encryptDeviceCode != null) {
                a = encryptDeviceCode.f2613a + "-" + encryptDeviceCode.f2614b;
                jSONObject.put("eufv", "1");
            }
            jSONObject.put(Constants.JdPushMsg.JSON_KEY_UUID, a);
            jSONObject.put("union_id", C1498b.m1630b());
            jSONObject.put("channel_id", C1498b.m1628c());
            jSONObject.put("appkey", "1b41a7042ce724d9ecaa5a15fe9fab7a");
        } catch (Throwable th) {
            th.printStackTrace();
        }
        if (C1462g.f2620a) {
            C1462g.m1888b(TAG, String.format("getTrackOrderParams json: \n%s", C1463h.m1884a(jSONObject.toString())));
        }
        return jSONObject;
    }

    public static void getFirstOrderTracking(Context context, String str, JSONObject jSONObject) {
        if (TextUtils.equals(str, "0")) {
            requestAndSaveTracking(jSONObject);
        } else if (TextUtils.equals(str, "1")) {
            putTrackOrderParams(context, jSONObject);
        }
    }

    private static void requestAndSaveTracking(JSONObject jSONObject) {
        if (jSONObject != null) {
            if (C1462g.f2620a) {
                C1462g.m1888b(TAG, String.format("requestAndSaveTracking param json: \n%s", C1463h.m1884a(jSONObject.toString())));
            }
            if (!TextUtils.isEmpty(jSONObject.optString("firstorderUnion"))) {
                C1501e eVar = new C1501e(getFirstOrderURL(), jSONObject);
                eVar.m1679a((AbstractC1495h) new C1502f(jSONObject));
                eVar.m1682a(UnTimeUtils.MIN);
                eVar.m1677a("TrackOrder." + System.currentTimeMillis());
                eVar.m1666d();
            }
        }
    }

    public static JSONObject buildFirstOrderRequest(JSONObject jSONObject) throws JSONException {
        JSONObject jSONObject2 = new JSONObject();
        if (jSONObject != null) {
            String optString = jSONObject.optString("firstorderUnion");
            String optString2 = jSONObject.optString("firstorderChannel");
            String optString3 = jSONObject.optString(Constants.JdPushMsg.JSON_KEY_PKG_NAME_full);
            String optString4 = jSONObject.optString("callerPackage");
            String a = C1455a.m1933a(C1498b.f2700a, optString3);
            String optString5 = jSONObject.optString("firstorderExtended1");
            if (optString5.length() > 127) {
                optString5 = optString5.substring(0, Opcodes.IAND);
            }
            String optString6 = jSONObject.optString("firstorderExtended2");
            if (optString6.length() > 127) {
                optString6 = optString6.substring(0, Opcodes.IAND);
            }
            String optString7 = jSONObject.optString("firstorderExtended3");
            if (optString7.length() > 511) {
                optString7 = optString7.substring(0, 510);
            }
            String optString8 = jSONObject.optString("firstorderExtended4");
            if (optString8.length() > 511) {
                optString8 = optString8.substring(0, 510);
            }
            jSONObject2.put("appkey", "1b41a7042ce724d9ecaa5a15fe9fab7a");
            jSONObject2.put("union", optString);
            jSONObject2.put("channel", optString2);
            jSONObject2.put("appSign", a);
            String a2 = C1498b.m1635a();
            C1459e.C1460a encryptDeviceCode = getEncryptDeviceCode(a2);
            if (encryptDeviceCode != null) {
                a2 = encryptDeviceCode.f2613a + "-" + encryptDeviceCode.f2614b;
                jSONObject2.put("eufv", "1");
            }
            jSONObject2.put("device", a2);
            jSONObject2.put("package", optString3);
            jSONObject2.put("callerPackage", optString4);
            jSONObject2.put("extendedData1", optString5);
            jSONObject2.put("extendedData2", optString6);
            jSONObject2.put("extendedData3", optString7);
            jSONObject2.put("extendedData4", optString8);
            StringBuilder sb = new StringBuilder();
            sb.append(C1483s.m1698c("1b41a7042ce724d9ecaa5a15fe9fab7a" + optString + optString2 + C1498b.m1635a() + optString3 + optString4 + a));
            StringBuilder sb2 = new StringBuilder();
            sb2.append(optString5);
            sb2.append(optString6);
            sb2.append(optString7);
            sb2.append(optString8);
            sb.append(C1483s.m1698c(sb2.toString()));
            jSONObject2.put("sign", C1483s.m1698c(sb.toString()));
        }
        return jSONObject2;
    }

    private static void initialShareStoreFile(Context context) {
        if (shareStore == null) {
            if (context == null) {
                C1462g.m1892a(TAG, "create file but context is null!!!");
            } else {
                shareStore = context.getSharedPreferences("jd_order_identify_encrypt_client", 0);
            }
        }
    }

    private static C1459e.C1460a getEncryptDeviceCode(String str) {
        try {
            if (TextUtils.isEmpty(str) || !str.contains("-")) {
                return null;
            }
            return C1459e.m1901a(str);
        } catch (Exception unused) {
            return null;
        }
    }
}
