package com.p051jd.hybrid.downloader;

import android.content.Context;
import com.android.volley.VolleyLog;
import com.p051jd.framework.network.JDResponse;
import com.p051jd.framework.network.error.JDError;
import com.p051jd.framework.network.file.JDFileGuider;
import com.p051jd.framework.network.file.JDFileResponseListener;
import com.p051jd.framework.network.request.JDFileRequest;
import com.p051jd.hybrid.downloader.C1563f;
import com.p051jd.hybrid.downloader.p081b.AbstractC1555b;
import com.p051jd.libs.hybrid.base.p095b.C1853c;
import java.io.File;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

/* renamed from: com.jd.hybrid.downloader.b */
/* loaded from: classes.dex */
public class C1551b {

    /* renamed from: b */
    private static C1551b f2790b;

    /* renamed from: a */
    private Context f2791a;

    /* renamed from: c */
    private Map<C1556c, JDFileRequest> f2792c;

    /* renamed from: com.jd.hybrid.downloader.b$a */
    /* loaded from: classes.dex */
    public static class C1552a {

        /* renamed from: a */
        Context f2793a;

        private C1552a(Context context) {
            this.f2793a = context;
        }

        /* synthetic */ C1552a(Context context, byte b) {
            this(context);
        }
    }

    /* renamed from: com.jd.hybrid.downloader.b$b */
    /* loaded from: classes.dex */
    class C1553b implements JDFileResponseListener<File> {

        /* renamed from: b */
        private final JDFileRequest f2795b;

        /* renamed from: c */
        private final C1556c f2796c;

        /* renamed from: d */
        private final C1545a f2797d;

        private C1553b(JDFileRequest jDFileRequest, C1556c cVar) {
            C1551b.this = r1;
            this.f2795b = jDFileRequest;
            this.f2796c = cVar;
            this.f2797d = cVar.m1556f();
        }

        /* synthetic */ C1553b(C1551b bVar, JDFileRequest jDFileRequest, C1556c cVar, byte b) {
            this(jDFileRequest, cVar);
        }

        /* renamed from: a */
        private void m1567a() {
            C1551b.this.f2792c.remove(this.f2796c);
        }

        @Override // com.p051jd.framework.network.JDResponseListener
        public final void onCancel() {
            C1853c.m1308c("DownloadClient", "Download cancel " + this.f2796c.m1560b());
            m1567a();
            C1545a aVar = this.f2797d;
            if (aVar != null) {
                aVar.onCancel();
            }
        }

        @Override // com.p051jd.framework.network.JDResponseListener
        public final void onEnd(JDResponse<File> jDResponse) {
            C1853c.m1308c("DownloadClient", "Download complete " + this.f2796c.m1560b());
            AbstractC1555b h = this.f2796c.m1554h();
            if (h == null || h.mo1566a(jDResponse.getData())) {
                m1567a();
                C1545a aVar = this.f2797d;
                if (aVar != null) {
                    aVar.onEnd(jDResponse);
                    return;
                }
                return;
            }
            C1853c.m1308c("DownloadClient", "File not available " + jDResponse.getData().getAbsolutePath());
            jDResponse.getData().delete();
            onError(new JDError("文件校验失败"));
        }

        @Override // com.p051jd.framework.network.JDResponseListener
        public final void onError(JDError jDError) {
            C1853c.m1306e("DownloadClient", "Download error (" + this.f2796c.m1560b() + ") Error: code = " + jDError.getStatusCode() + ", msg = " + jDError.getMessage());
            C1853c.m1312a("DownloadClient", jDError);
            m1567a();
            C1545a aVar = this.f2797d;
            if (aVar != null) {
                aVar.onError(jDError);
            }
        }

        @Override // com.p051jd.framework.network.file.JDFileResponseListener
        public final void onPause() {
            if (this.f2797d != null) {
                this.f2796c.m1556f().onPause();
            }
        }

        @Override // com.p051jd.framework.network.file.JDFileResponseListener
        public final void onProgress(int i, int i2) {
            C1545a aVar = this.f2797d;
            if (aVar != null) {
                aVar.onProgress(i, i2);
            }
        }

        @Override // com.p051jd.framework.network.JDResponseListener
        public final void onStart() {
            C1853c.m1308c("DownloadClient", "Download start " + this.f2796c.m1560b());
            C1545a aVar = this.f2797d;
            if (aVar != null) {
                aVar.onStart();
            }
        }
    }

    private C1551b(Context context) {
        this.f2792c = new ConcurrentHashMap();
        this.f2791a = context.getApplicationContext();
    }

    private /* synthetic */ C1551b(Context context, byte b) {
        this(context);
    }

    /* renamed from: a */
    public static C1552a m1574a(Context context) {
        return new C1552a(context, (byte) 0);
    }

    /* renamed from: a */
    public static C1551b m1575a() {
        if (f2790b == null) {
            C1853c.m1306e("DownloadClient", "Hybrid SDK is not initialized!");
        }
        return f2790b;
    }

    /* renamed from: a */
    public static void m1573a(C1552a aVar) {
        if (f2790b == null) {
            synchronized (C1556c.class) {
                if (f2790b == null) {
                    f2790b = new C1551b(aVar.f2793a, (byte) 0);
                }
            }
            return;
        }
        throw new RuntimeException("duplicate initialize!");
    }

    /* renamed from: a */
    public JDFileRequest m1571a(C1556c cVar) {
        if (this.f2792c.containsKey(cVar)) {
            C1853c.m1308c("DownloadClient", "Existed download request, priority = " + cVar.m1555g() + ", url: " + cVar.m1560b());
            return this.f2792c.get(cVar);
        }
        JDFileGuider jDFileGuider = new JDFileGuider();
        jDFileGuider.setSpace(cVar.m1557e() ? 2 : 1);
        jDFileGuider.setChildDirName(cVar.m1559c());
        jDFileGuider.setFileName(cVar.m1558d());
        jDFileGuider.setMode(1);
        jDFileGuider.setImmutable(false);
        JDFileRequest jDFileRequest = new JDFileRequest(cVar.m1560b());
        jDFileRequest.setResponseListener((JDFileResponseListener<File>) new C1553b(this, jDFileRequest, cVar, (byte) 0));
        jDFileRequest.setSavePath(jDFileGuider);
        jDFileRequest.setAttemptsTime(0);
        this.f2792c.put(cVar, jDFileRequest);
        int g = cVar.m1555g();
        C1563f a = C1563f.m1550a(this.f2791a);
        C1563f.C1566b bVar = new C1563f.C1566b(jDFileRequest, g);
        if (VolleyLog.DEBUG) {
            C1853c.m1308c("JDFileDownloader", "==== total file request count ===> " + a.f2817a.incrementAndGet());
        }
        C1563f.RunnableC1565a aVar = new C1563f.RunnableC1565a(bVar.f2828a, bVar.f2829b);
        a.f2819c.offer(Integer.valueOf(aVar.hashCode()));
        a.f2818b.execute(aVar);
        C1853c.m1309b("DownloadClient", null, cVar.m1565a() + "加入下载列表");
        C1853c.m1308c("DownloadClient", "Add to download queue, priority = " + cVar.m1555g() + ", url: " + cVar.m1560b());
        return jDFileRequest;
    }

    /* renamed from: a */
    public List<JDFileRequest> m1570a(List<C1556c> list, boolean z) {
        if (list.size() > 1 && !z) {
            Collections.sort(list);
        }
        ArrayList arrayList = new ArrayList(list.size());
        for (C1556c cVar : list) {
            arrayList.add(m1571a(cVar));
        }
        return arrayList;
    }
}
