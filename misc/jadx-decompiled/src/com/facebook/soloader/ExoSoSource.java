package com.facebook.soloader;

import android.content.Context;
import com.facebook.soloader.UnpackingSoSource;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.LinkedHashSet;

/* compiled from: TbsSdkJava */
/* loaded from: classes.dex */
public final class ExoSoSource extends UnpackingSoSource {
    public ExoSoSource(Context context, String str) {
        super(context, str);
    }

    @Override // com.facebook.soloader.UnpackingSoSource
    protected UnpackingSoSource.Unpacker makeUnpacker() throws IOException {
        return new ExoUnpacker(this);
    }

    /* compiled from: TbsSdkJava */
    /* loaded from: classes.dex */
    private final class ExoUnpacker extends UnpackingSoSource.Unpacker {
        private final FileDso[] mDsos;

        /* JADX WARN: Code restructure failed: missing block: B:28:0x00e3, code lost:
            throw new java.lang.RuntimeException("illegal line in exopackage metadata: [" + r12 + "]");
         */
        /* JADX WARN: Removed duplicated region for block: B:40:0x00fc A[Catch: Throwable -> 0x0104, all -> 0x0100, TRY_ENTER, TryCatch #0 {all -> 0x0100, blocks: (B:9:0x0063, B:29:0x00e4, B:39:0x00f8, B:40:0x00fc, B:41:0x00ff), top: B:57:0x0063 }] */
        /* JADX WARN: Removed duplicated region for block: B:51:0x0110  */
        /* JADX WARN: Removed duplicated region for block: B:59:0x00f8 A[EXC_TOP_SPLITTER, SYNTHETIC] */
        /* JADX WARN: Removed duplicated region for block: B:65:0x010c A[EXC_TOP_SPLITTER, SYNTHETIC] */
        /* Code decompiled incorrectly, please refer to instructions dump */
        ExoUnpacker(UnpackingSoSource unpackingSoSource) throws IOException {
            Throwable th;
            Throwable th2;
            Throwable th3;
            Throwable th4;
            boolean z;
            Context context = ExoSoSource.this.mContext;
            File file = new File("/data/local/tmp/exopackage/" + context.getPackageName() + "/native-libs/");
            ArrayList arrayList = new ArrayList();
            LinkedHashSet linkedHashSet = new LinkedHashSet();
            String[] supportedAbis = SysUtil.getSupportedAbis();
            int length = supportedAbis.length;
            int i = 0;
            int i2 = 0;
            loop0: while (i2 < length) {
                String str = supportedAbis[i2];
                File file2 = new File(file, str);
                if (file2.isDirectory()) {
                    linkedHashSet.add(str);
                    File file3 = new File(file2, "metadata.txt");
                    if (!file3.isFile()) {
                        continue;
                    } else {
                        FileReader fileReader = new FileReader(file3);
                        try {
                            try {
                                BufferedReader bufferedReader = new BufferedReader(fileReader);
                                while (true) {
                                    try {
                                        String readLine = bufferedReader.readLine();
                                        if (readLine == null) {
                                            bufferedReader.close();
                                            fileReader.close();
                                            break;
                                        } else if (readLine.length() != 0) {
                                            int indexOf = readLine.indexOf(32);
                                            if (indexOf == -1) {
                                                break loop0;
                                            }
                                            String str2 = readLine.substring(i, indexOf) + ".so";
                                            int size = arrayList.size();
                                            while (true) {
                                                if (i >= size) {
                                                    z = false;
                                                    break;
                                                } else if (((FileDso) arrayList.get(i)).name.equals(str2)) {
                                                    z = true;
                                                    break;
                                                } else {
                                                    i++;
                                                }
                                            }
                                            if (z) {
                                                i = 0;
                                            } else {
                                                String substring = readLine.substring(indexOf + 1);
                                                arrayList.add(new FileDso(str2, substring, new File(file2, substring)));
                                                i = 0;
                                            }
                                        }
                                    } catch (Throwable th5) {
                                        th4 = th5;
                                        th3 = null;
                                        if (th3 == null) {
                                        }
                                        throw th4;
                                    }
                                }
                            } catch (Throwable th6) {
                                th2 = th6;
                                th = null;
                                if (th == null) {
                                    try {
                                        fileReader.close();
                                    } catch (Throwable unused) {
                                    }
                                } else {
                                    fileReader.close();
                                }
                                throw th2;
                            }
                        } catch (Throwable th7) {
                            try {
                                throw th7;
                            } catch (Throwable th8) {
                                th2 = th8;
                                th = th7;
                                if (th == null) {
                                }
                                throw th2;
                            }
                        }
                    }
                }
                i2++;
                i = 0;
            }
            unpackingSoSource.setSoSourceAbis((String[]) linkedHashSet.toArray(new String[linkedHashSet.size()]));
            this.mDsos = (FileDso[]) arrayList.toArray(new FileDso[arrayList.size()]);
        }

        @Override // com.facebook.soloader.UnpackingSoSource.Unpacker
        protected UnpackingSoSource.DsoManifest getDsoManifest() throws IOException {
            return new UnpackingSoSource.DsoManifest(this.mDsos);
        }

        @Override // com.facebook.soloader.UnpackingSoSource.Unpacker
        protected UnpackingSoSource.InputDsoIterator openDsoIterator() throws IOException {
            return new FileBackedInputDsoIterator();
        }

        /* compiled from: TbsSdkJava */
        /* loaded from: classes.dex */
        private final class FileBackedInputDsoIterator extends UnpackingSoSource.InputDsoIterator {
            private int mCurrentDso;

            private FileBackedInputDsoIterator() {
            }

            @Override // com.facebook.soloader.UnpackingSoSource.InputDsoIterator
            public boolean hasNext() {
                return this.mCurrentDso < ExoUnpacker.this.mDsos.length;
            }

            @Override // com.facebook.soloader.UnpackingSoSource.InputDsoIterator
            public UnpackingSoSource.InputDso next() throws IOException {
                FileDso[] fileDsoArr = ExoUnpacker.this.mDsos;
                int i = this.mCurrentDso;
                this.mCurrentDso = i + 1;
                FileDso fileDso = fileDsoArr[i];
                FileInputStream fileInputStream = new FileInputStream(fileDso.backingFile);
                try {
                    return new UnpackingSoSource.InputDso(fileDso, fileInputStream);
                } catch (Throwable th) {
                    fileInputStream.close();
                    throw th;
                }
            }
        }
    }

    /* compiled from: TbsSdkJava */
    /* loaded from: classes.dex */
    private static final class FileDso extends UnpackingSoSource.Dso {
        final File backingFile;

        FileDso(String str, String str2, File file) {
            super(str, str2);
            this.backingFile = file;
        }
    }
}
