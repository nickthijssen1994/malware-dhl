package com.jingdong.sdk.oklog.p129a;

import android.os.Handler;
import android.os.HandlerThread;
import android.os.Looper;
import android.os.Message;
import android.text.TextUtils;
import android.util.Log;
import com.huawei.hms.push.constant.RemoteMessageConst;
import com.jingdong.sdk.oklog.OKLog;
import com.jingdong.sdk.oklog.OKLogConfig;
import com.jingdong.sdk.oklog.reporter.AbsLogReporter;
import java.util.HashMap;
import java.util.Locale;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

/* renamed from: com.jingdong.sdk.oklog.a.d */
/* loaded from: classes.dex */
public class C2245d implements AbstractC2247e {

    /* renamed from: a */
    private static final String f4229a = System.getProperty("line.separator");

    /* renamed from: b */
    private AbsLogReporter f4230b;

    /* renamed from: c */
    private HandlerC2246a f4231c;

    /* renamed from: com.jingdong.sdk.oklog.a.d$a */
    /* loaded from: classes.dex */
    static class HandlerC2246a extends Handler {

        /* renamed from: a */
        AbsLogReporter f4232a;

        public HandlerC2246a(Looper looper, AbsLogReporter absLogReporter) {
            super(looper);
            this.f4232a = absLogReporter;
        }

        @Override // android.os.Handler
        public void handleMessage(Message message) {
            try {
                HashMap<String, String> hashMap = new HashMap<>();
                String str = "";
                String str2 = "";
                Object[] objArr = (Object[]) message.obj;
                int i = message.what;
                if (objArr != null && objArr.length == 4) {
                    String str3 = (String) objArr[0];
                    String str4 = (String) objArr[1];
                    Throwable th = (Throwable) objArr[2];
                    String str5 = (String) objArr[3];
                    if (th != null) {
                        str2 = th.toString();
                        int indexOf = str2.indexOf(":");
                        if (indexOf != -1) {
                            str2 = str2.substring(0, indexOf);
                        }
                        str = Log.getStackTraceString(th);
                        if (!TextUtils.isEmpty(str) && str.contains(C2245d.f4229a)) {
                            str = str.replaceAll(C2245d.f4229a, " <br> ");
                        }
                        if (!TextUtils.isEmpty(str)) {
                            str = " <br> " + str;
                        }
                    }
                    HashMap<String, String> additionalData = this.f4232a.getAdditionalData();
                    if (additionalData != null) {
                        hashMap.putAll(additionalData);
                    }
                    hashMap.put("exceptionType", str2);
                    hashMap.put("className", str5);
                    hashMap.put("methodStack", str);
                    hashMap.put(RemoteMessageConst.MessageBody.MSG, str4);
                    Locale locale = Locale.ENGLISH;
                    Object[] objArr2 = new Object[1];
                    double currentTimeMillis = (double) System.currentTimeMillis();
                    Double.isNaN(currentTimeMillis);
                    objArr2[0] = Double.valueOf((currentTimeMillis + 0.0d) / 1000.0d);
                    hashMap.put("occurTime", String.format(locale, "%.6f", objArr2));
                    hashMap.put("logLevel", C2248f.m75a(i));
                    hashMap.put("logTag", str3);
                    this.f4232a.report(hashMap);
                }
            } catch (Throwable unused) {
            }
        }
    }

    public C2245d(AbsLogReporter absLogReporter) {
        this.f4230b = absLogReporter;
        HandlerThread handlerThread = new HandlerThread("OKLog-ReportHandler", 1);
        handlerThread.start();
        this.f4231c = new HandlerC2246a(handlerThread.getLooper(), absLogReporter);
    }

    /* renamed from: a */
    private int m89a(StackTraceElement[] stackTraceElementArr) {
        for (int i = 5; i < stackTraceElementArr.length; i++) {
            String className = stackTraceElementArr[i].getClassName();
            if (!(m91a(className) || className.equals(C2245d.class.getName()) || className.equals(OKLogConfig.class.getName()) || className.equals(OKLog.class.getName()))) {
                return i;
            }
        }
        return 0;
    }

    /* renamed from: a */
    private void m90a(String str, int i, Throwable th, Object... objArr) {
        AbsLogReporter absLogReporter = this.f4230b;
        if (absLogReporter != null && absLogReporter.isReportable(i)) {
            String a = C2248f.m72a(objArr);
            if (th != null || !TextUtils.isEmpty(a)) {
                m92a(i, str, a, th);
            }
        }
    }

    /* renamed from: a */
    public static boolean m91a(String str) {
        if (OKLogConfig.LOG_WRAPPER_CLASS_NAMES != null) {
            for (String str2 : OKLogConfig.LOG_WRAPPER_CLASS_NAMES) {
                if (str2.equals(str)) {
                    return true;
                }
            }
        }
        return false;
    }

    /* renamed from: b */
    private String m88b() {
        StackTraceElement[] stackTrace = Thread.currentThread().getStackTrace();
        return stackTrace[Math.min(m89a(stackTrace), stackTrace.length)].getClassName();
    }

    /* renamed from: a */
    public void m92a(int i, String str, String str2, Throwable th) {
        AbsLogReporter absLogReporter = this.f4230b;
        if (absLogReporter != null && absLogReporter.isReportable(i)) {
            String b = m88b();
            Message obtainMessage = this.f4231c.obtainMessage();
            obtainMessage.what = i;
            obtainMessage.obj = new Object[]{str, str2, th, b};
            this.f4231c.sendMessage(obtainMessage);
        }
    }

    @Override // com.jingdong.sdk.oklog.p129a.AbstractC2247e
    /* renamed from: a */
    public void mo87a(AbstractC2244a aVar) {
    }

    @Override // com.jingdong.sdk.oklog.p129a.AbstractC2247e
    /* renamed from: a */
    public void mo86a(String str, String str2) {
        if (this.f4230b != null) {
            if (TextUtils.isEmpty(str2)) {
                mo85a(str, "Empty/Null json content");
                return;
            }
            try {
                String trim = str2.trim();
                if (trim.startsWith("{")) {
                    mo85a(str, new JSONObject(trim).toString(2));
                } else if (trim.startsWith("[")) {
                    mo85a(str, new JSONArray(trim).toString(2));
                } else {
                    mo83b("Invalid Json", new Object[0]);
                }
            } catch (JSONException unused) {
                mo83b("Invalid Json", new Object[0]);
            }
        }
    }

    @Override // com.jingdong.sdk.oklog.p129a.AbstractC2247e
    /* renamed from: a */
    public void mo85a(String str, Object... objArr) {
        m90a(str, 3, (Throwable) null, objArr);
    }

    @Override // com.jingdong.sdk.oklog.p129a.AbstractC2247e
    /* renamed from: a */
    public void mo84a(Throwable th, String str, Object... objArr) {
        m90a(str, 3, th, objArr);
    }

    @Override // com.jingdong.sdk.oklog.p129a.AbstractC2247e
    /* renamed from: b */
    public void mo83b(String str, Object... objArr) {
        m90a(str, 6, (Throwable) null, objArr);
    }

    @Override // com.jingdong.sdk.oklog.p129a.AbstractC2247e
    /* renamed from: b */
    public void mo82b(Throwable th, String str, Object... objArr) {
        m90a(str, 6, th, objArr);
    }

    @Override // com.jingdong.sdk.oklog.p129a.AbstractC2247e
    /* renamed from: c */
    public void mo81c(String str, Object... objArr) {
        m90a(str, 4, (Throwable) null, objArr);
    }

    @Override // com.jingdong.sdk.oklog.p129a.AbstractC2247e
    /* renamed from: c */
    public void mo80c(Throwable th, String str, Object... objArr) {
        m90a(str, 4, th, objArr);
    }

    @Override // com.jingdong.sdk.oklog.p129a.AbstractC2247e
    /* renamed from: d */
    public void mo79d(String str, Object... objArr) {
        m90a(str, 5, (Throwable) null, objArr);
    }

    @Override // com.jingdong.sdk.oklog.p129a.AbstractC2247e
    /* renamed from: d */
    public void mo78d(Throwable th, String str, Object... objArr) {
        m90a(str, 5, th, objArr);
    }

    @Override // com.jingdong.sdk.oklog.p129a.AbstractC2247e
    /* renamed from: e */
    public void mo77e(String str, Object... objArr) {
        m90a(str, 2, (Throwable) null, objArr);
    }

    @Override // com.jingdong.sdk.oklog.p129a.AbstractC2247e
    /* renamed from: e */
    public void mo76e(Throwable th, String str, Object... objArr) {
        m90a(str, 2, th, objArr);
    }
}
