package com.jingdong.app.mall.bundle.mobileConfig;

import android.app.Application;
import android.os.Build;
import android.os.Handler;
import android.os.Looper;
import android.text.TextUtils;
import android.util.Log;
import com.jingdong.app.mall.bundle.mobileConfig.JDMobileConfig;
import com.jingdong.app.mall.bundle.mobileConfig.net.C2116a;
import com.jingdong.app.mall.bundle.mobileConfig.net.ConfigRequestParams;
import com.jingdong.app.mall.bundle.mobileConfig.net.IConfigFetcher;
import com.jingdong.app.mall.bundle.mobileConfig.net.IConfigFetcherCallBack;
import com.jingdong.app.mall.bundle.mobileConfig.p120a.C2106c;
import com.jingdong.app.mall.bundle.mobileConfig.p120a.C2107d;
import com.jingdong.app.mall.bundle.mobileConfig.p120a.C2108e;
import com.jingdong.app.mall.bundle.mobileConfig.p120a.C2109f;
import com.jingdong.app.mall.bundle.mobileConfig.p120a.C2114h;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;
import java.util.concurrent.CopyOnWriteArrayList;
import org.json.JSONObject;

/* renamed from: com.jingdong.app.mall.bundle.mobileConfig.a */
/* loaded from: classes.dex */
public class C2101a {

    /* renamed from: r */
    private static String f3764r;

    /* renamed from: s */
    private static String f3765s;

    /* renamed from: t */
    private static String f3766t;

    /* renamed from: u */
    private static C2108e f3767u = new C2108e();

    /* renamed from: y */
    private static C2101a f3768y;

    /* renamed from: b */
    private Application f3770b;

    /* renamed from: c */
    private String f3771c;

    /* renamed from: d */
    private String f3772d;

    /* renamed from: e */
    private String f3773e;

    /* renamed from: f */
    private String f3774f;

    /* renamed from: g */
    private String f3775g;

    /* renamed from: h */
    private String f3776h;

    /* renamed from: i */
    private JDMobileConfig.IUserIdCallBack f3777i;

    /* renamed from: j */
    private JDMobileConfig.IUUIDCallBack f3778j;

    /* renamed from: m */
    private String f3781m;

    /* renamed from: n */
    private int f3782n;

    /* renamed from: o */
    private String f3783o;

    /* renamed from: q */
    private Map<String, Map<String, Map<String, String>>> f3785q;

    /* renamed from: w */
    private IConfigFetcher f3787w;

    /* renamed from: x */
    private Handler f3788x;

    /* renamed from: k */
    private boolean f3779k = false;

    /* renamed from: l */
    private boolean f3780l = false;

    /* renamed from: p */
    private String f3784p = "http://";

    /* renamed from: v */
    private CopyOnWriteArrayList<JDMoblieConfigListener> f3786v = new CopyOnWriteArrayList<>();

    /* renamed from: a */
    boolean f3769a = true;

    private C2101a() {
    }

    /* renamed from: a */
    public static C2101a m735a() {
        if (f3768y == null) {
            synchronized (C2101a.class) {
                if (f3768y == null) {
                    f3768y = new C2101a();
                }
            }
        }
        return f3768y;
    }

    /* renamed from: a */
    public void m726a(JSONObject jSONObject) {
        C2115b.m661a("fetch data success");
        if (jSONObject == null) {
            C2115b.m661a("data is null!");
            return;
        }
        C2115b.m661a("data:" + jSONObject.toString());
        Map<String, Map<String, Map<String, String>>> b = m722b(jSONObject);
        if (b != null) {
            this.f3785q = b;
            boolean a = C2107d.m697a(this.f3785q);
            C2115b.m661a("persistObject:" + a);
            this.f3788x.post(new Runnable() { // from class: com.jingdong.app.mall.bundle.mobileConfig.a.2
                @Override // java.lang.Runnable
                public void run() {
                    synchronized (C2101a.this.f3786v) {
                        C2115b.m661a("notiry listeners");
                        Iterator it = C2101a.this.f3786v.iterator();
                        while (it.hasNext()) {
                            ((JDMoblieConfigListener) it.next()).onConfigUpdate();
                        }
                    }
                }
            });
        }
    }

    /* renamed from: b */
    private Map<String, Map<String, Map<String, String>>> m722b(JSONObject jSONObject) {
        HashMap hashMap = new HashMap();
        try {
            Iterator<String> keys = jSONObject.keys();
            while (keys.hasNext()) {
                String next = keys.next();
                JSONObject jSONObject2 = jSONObject.getJSONObject(next);
                HashMap hashMap2 = new HashMap();
                if (jSONObject2 != null) {
                    Iterator<String> keys2 = jSONObject2.keys();
                    while (keys2.hasNext()) {
                        String next2 = keys2.next();
                        JSONObject jSONObject3 = jSONObject2.getJSONObject(next2);
                        if (jSONObject3 != null) {
                            Iterator<String> keys3 = jSONObject3.keys();
                            HashMap hashMap3 = new HashMap();
                            while (keys3.hasNext()) {
                                String next3 = keys3.next();
                                hashMap3.put(next3, jSONObject3.optString(next3));
                            }
                            hashMap2.put(next2, hashMap3);
                        }
                    }
                }
                hashMap.put(next, hashMap2);
                Log.d(f3764r, next);
            }
            C2115b.m661a("jsonToMap success!");
            return hashMap;
        } catch (Exception e) {
            e.printStackTrace();
            C2115b.m660b("jsonToMap error!");
            return null;
        }
    }

    /* renamed from: a */
    public String m734a(long j) {
        return m735a().m711m() + m735a().m713k() + C2109f.m692b() + m735a().m712l() + C2109f.m691c() + j + C2109f.m690d() + m735a().m714j() + C2109f.m689e() + m735a().m725b() + C2109f.m688f() + m735a().m715i() + C2109f.m687g() + Build.VERSION.RELEASE + C2109f.m684j() + C2109f.m679o() + C2109f.m683k() + C2109f.m680n() + C2109f.m682l() + C2109f.m681m() + C2109f.m686h() + m735a().m710n() + "\",\"" + C2109f.m685i() + "\":\"" + m735a().m721c() + "\"}";
    }

    /* renamed from: a */
    public String m727a(String str, String str2, String str3, String str4) {
        if (TextUtils.isEmpty(str)) {
            C2115b.m660b("namespace is empty!");
            return str4;
        } else if (TextUtils.isEmpty(str2)) {
            C2115b.m660b("configName is empty!");
            return str4;
        } else if (TextUtils.isEmpty(str3)) {
            C2115b.m660b("key is empty!");
            return str4;
        } else if (this.f3785q == null) {
            C2115b.m661a("restored map is null");
            return str4;
        } else {
            Map<String, String> a = m728a(str, str2);
            if (a == null) {
                C2115b.m661a("no configName found:" + str2);
                return str4;
            }
            String str5 = a.get(str3);
            return str5 != null ? str5 : str4;
        }
    }

    /* renamed from: a */
    public Map<String, String> m728a(String str, String str2) {
        if (TextUtils.isEmpty(str)) {
            C2115b.m660b("namespace is empty!");
            return null;
        } else if (TextUtils.isEmpty(str2)) {
            C2115b.m660b("configName is empty!");
            return null;
        } else {
            Map<String, Map<String, Map<String, String>>> map = this.f3785q;
            if (map == null) {
                C2115b.m661a("restored map is null");
                return null;
            }
            Map<String, Map<String, String>> map2 = map.get(str);
            if (map2 == null) {
                C2115b.m661a("no namespace found:" + str);
                return null;
            }
            Map<String, String> map3 = map2.get(str2);
            if (map3 != null) {
                return map3;
            }
            C2115b.m661a("no configName found:" + str2);
            return null;
        }
    }

    /* renamed from: a */
    void m733a(JDMobileConfig.Builder builder) {
        String str;
        if (!this.f3780l) {
            this.f3779k = builder.isDebug;
            this.f3770b = builder.application;
            this.f3775g = builder.appId;
            this.f3776h = builder.userId;
            this.f3777i = builder.userIdCallBack;
            if (builder.useBetaHost) {
                this.f3783o = f3765s;
                this.f3773e = "avatar-basic-config";
                this.f3774f = C2106c.m702a();
                str = "http://";
            } else {
                this.f3783o = f3766t;
                this.f3773e = "avatar-basic-config";
                this.f3774f = C2106c.m702a();
                str = "https://";
            }
            this.f3784p = str;
            this.f3781m = !TextUtils.isEmpty(builder.appVersionName) ? builder.appVersionName : C2114h.m664a(this.f3770b);
            this.f3782n = builder.appVersionCode != 0 ? builder.appVersionCode : C2114h.m663b(this.f3770b);
            this.f3778j = builder.uuidCallBack;
            this.f3772d = builder.uuid;
            this.f3787w = builder.fetcher == null ? new C2116a() : builder.fetcher;
            this.f3788x = new Handler(Looper.getMainLooper());
            C2115b.m661a(String.format("appId:%s, versionName:%s, versionCode:%s .", this.f3775g, this.f3781m, Integer.valueOf(this.f3782n)));
            this.f3769a = builder.useLocalCache;
            m716h();
            if (builder.fetchDataWithInit) {
                C2115b.m661a("fetchDataWithInit:true");
                m720d();
            }
            this.f3780l = true;
        }
    }

    /* renamed from: a */
    public void m732a(JDMoblieConfigListener jDMoblieConfigListener) {
        synchronized (this.f3786v) {
            this.f3786v.add(jDMoblieConfigListener);
        }
    }

    /* renamed from: a */
    void m729a(String str) {
        this.f3776h = str;
    }

    /* renamed from: b */
    public String m725b() {
        JDMobileConfig.IUUIDCallBack iUUIDCallBack = this.f3778j;
        return iUUIDCallBack != null ? iUUIDCallBack.uuid() : !TextUtils.isEmpty(this.f3772d) ? this.f3772d : !TextUtils.isEmpty(this.f3771c) ? this.f3771c : "";
    }

    /* renamed from: b */
    public void m724b(JDMoblieConfigListener jDMoblieConfigListener) {
        synchronized (this.f3786v) {
            this.f3786v.remove(jDMoblieConfigListener);
        }
    }

    /* renamed from: b */
    void m723b(String str) {
        this.f3772d = str;
    }

    /* renamed from: c */
    public String m721c() {
        JDMobileConfig.IUserIdCallBack iUserIdCallBack = this.f3777i;
        return iUserIdCallBack != null ? iUserIdCallBack.userId() : !TextUtils.isEmpty(this.f3776h) ? this.f3776h : "";
    }

    /* renamed from: d */
    public boolean m720d() {
        if (!f3767u.m695a()) {
            return false;
        }
        if (this.f3787w == null) {
            C2115b.m660b("network fetcher is null, may not init yet, return!!");
            return false;
        }
        ConfigRequestParams configRequestParams = new ConfigRequestParams(m710n(), m721c());
        configRequestParams.gatewayAppid = m712l();
        configRequestParams.gatewaySecKey = m709o();
        this.f3787w.fetch(configRequestParams, new IConfigFetcherCallBack() { // from class: com.jingdong.app.mall.bundle.mobileConfig.a.1
            @Override // com.jingdong.app.mall.bundle.mobileConfig.net.IConfigFetcherCallBack
            public void onError(Exception exc) {
                StringBuilder sb = new StringBuilder();
                sb.append("fetcher data error. ");
                sb.append(exc == null ? "" : exc.getMessage());
                C2115b.m660b(sb.toString());
            }

            @Override // com.jingdong.app.mall.bundle.mobileConfig.net.IConfigFetcherCallBack
            public void onSuccess(JSONObject jSONObject) {
                C2101a.this.m726a(jSONObject);
            }
        });
        return true;
    }

    /* renamed from: e */
    public Map<String, Map<String, Map<String, String>>> m719e() {
        return this.f3785q;
    }

    /* renamed from: f */
    public Application m718f() {
        return this.f3770b;
    }

    /* renamed from: g */
    boolean m717g() {
        return this.f3779k;
    }

    /* renamed from: h */
    public void m716h() {
        if (!this.f3769a) {
            C2115b.m660b("useLocalCache=false, so not restore local cache!");
            return;
        }
        try {
            this.f3785q = (Map) C2107d.m699a();
            C2115b.m661a("restoreConfig success");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    /* renamed from: i */
    public int m715i() {
        return this.f3782n;
    }

    /* renamed from: j */
    public String m714j() {
        return this.f3781m;
    }

    /* renamed from: k */
    public String m713k() {
        return this.f3783o;
    }

    /* renamed from: l */
    public String m712l() {
        return this.f3773e;
    }

    /* renamed from: m */
    public String m711m() {
        return this.f3784p;
    }

    /* renamed from: n */
    public String m710n() {
        return this.f3775g;
    }

    /* renamed from: o */
    public String m709o() {
        return this.f3774f;
    }
}
