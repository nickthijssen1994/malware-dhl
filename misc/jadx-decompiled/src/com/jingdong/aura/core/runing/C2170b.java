package com.jingdong.aura.core.runing;

import android.annotation.SuppressLint;
import android.app.Application;
import android.os.AsyncTask;
import android.os.Build;
import android.os.Looper;
import com.jingdong.aura.core.p122b.C2150e;
import com.jingdong.aura.core.p122b.C2153h;
import com.jingdong.aura.core.p122b.p124b.C2131b;
import com.jingdong.aura.core.reflection.C2166b;
import com.jingdong.aura.core.runing.resource.AbstractC2182a;
import com.jingdong.aura.core.util.C2201d;
import com.jingdong.aura.core.util.C2205h;
import com.jingdong.aura.core.util.p127a.AbstractC2197b;
import com.jingdong.aura.core.util.p127a.C2198c;
import java.io.File;
import java.util.zip.ZipFile;
import org.osgi.framework.BundleEvent;
import org.osgi.framework.a;
import org.osgi.framework.g;

/* compiled from: TbsSdkJava */
/* renamed from: com.jingdong.aura.core.runing.b */
/* loaded from: classes.dex */
public class C2170b implements g {

    /* renamed from: a */
    private static final AbstractC2197b f4065a = C2198c.m255a(C2170b.class);

    /* renamed from: b */
    private void m347b(a aVar) {
    }

    /* renamed from: c */
    private void m346c(a aVar) {
    }

    /* compiled from: TbsSdkJava */
    /* renamed from: com.jingdong.aura.core.runing.b$a */
    /* loaded from: classes.dex */
    private class AsyncTaskC2172a extends AsyncTask<a, Void, Void> {
        private AsyncTaskC2172a() {
        }

        /* JADX INFO: Access modifiers changed from: protected */
        /* renamed from: a */
        public Void doInBackground(a... aVarArr) {
            C2170b.this.m344e(aVarArr[0]);
            return null;
        }
    }

    @SuppressLint({"NewApi"})
    public void bundleChanged(BundleEvent bundleEvent) {
        int type = bundleEvent.getType();
        if (type == 4) {
            m343f(bundleEvent.getBundle());
        } else if (type == 8) {
            m346c(bundleEvent.getBundle());
        } else if (type != 16) {
            switch (type) {
                case 0:
                    m348a(bundleEvent.getBundle());
                    return;
                case 1:
                    m347b(bundleEvent.getBundle());
                    return;
                case 2:
                    if (m352a()) {
                        if (Looper.myLooper() == null) {
                            Looper.prepare();
                        }
                        m344e(bundleEvent.getBundle());
                        return;
                    } else if (C2131b.m575f()) {
                        AsyncTaskC2172a aVar = new AsyncTaskC2172a();
                        if (Build.VERSION.SDK_INT > 11) {
                            aVar.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, bundleEvent.getBundle());
                            return;
                        } else {
                            aVar.execute(bundleEvent.getBundle());
                            return;
                        }
                    } else {
                        m344e(bundleEvent.getBundle());
                        return;
                    }
                default:
                    return;
            }
        } else {
            m345d(bundleEvent.getBundle());
        }
    }

    /* renamed from: a */
    private void m348a(a aVar) {
        long currentTimeMillis = System.currentTimeMillis();
        C2153h hVar = (C2153h) aVar;
        if (C2176f.m325a(aVar.n()) == null) {
            C2179i a = C2179i.m307a(hVar.m414b().mo480a());
            AbstractC2197b bVar = f4065a;
            bVar.mo258c("Bundle installation info " + aVar.n() + ":" + a.f4086e);
            C2176f.m324a(aVar.n(), a);
        }
        try {
            if (m350a(hVar.m414b().mo480a())) {
                f4065a.mo258c("process resources");
                AbstractC2182a.m301a(C2181k.f4098a, C2181k.f4101d, hVar.m414b().mo480a().getAbsolutePath());
            } else {
                f4065a.mo258c("public bundle do not process resources");
            }
        } catch (Throwable th) {
            AbstractC2197b bVar2 = f4065a;
            bVar2.mo260b("Could not load resource in bundle " + hVar.m402n(), th);
        }
        f4065a.mo258c("loaded() spend " + (System.currentTimeMillis() - currentTimeMillis) + " milliseconds");
        C2150e.m429a("AuraMaiDianBundleLoaded", aVar.n(), hVar.m401o(), String.valueOf(System.currentTimeMillis() - currentTimeMillis), "BundleLifecycleHandler.loaded");
    }

    /* renamed from: d */
    private void m345d(a aVar) {
        C2176f.m323b(aVar.n());
    }

    /* JADX INFO: Access modifiers changed from: private */
    /* renamed from: e */
    public void m344e(a aVar) {
        C2153h hVar = (C2153h) aVar;
        long currentTimeMillis = System.currentTimeMillis();
        C2179i a = C2176f.m325a(hVar.m402n());
        if (a != null) {
            String str = a.f4082a;
            if (C2205h.m224b(str)) {
                try {
                    m349a(str, hVar.m411e()).onCreate();
                } catch (Throwable th) {
                    f4065a.mo260b("Error to start application >>>", th);
                }
            }
        }
        AbstractC2197b bVar = f4065a;
        bVar.mo258c("started() spend " + (System.currentTimeMillis() - currentTimeMillis) + " milliseconds");
    }

    /* renamed from: a */
    protected static Application m349a(String str, ClassLoader classLoader) {
        Class<?> loadClass = classLoader.loadClass(str);
        if (loadClass != null) {
            Application application = (Application) loadClass.newInstance();
            C2166b.f4044i.m377a(application, C2181k.f4098a);
            return application;
        }
        throw new ClassNotFoundException(str);
    }

    /* renamed from: f */
    private void m343f(a aVar) {
        Application application = C2176f.f4073a.get(aVar.n());
        if (application != null) {
            application.onTerminate();
            C2176f.f4073a.remove(aVar.n());
        }
    }

    /* renamed from: a */
    private boolean m352a() {
        if (Build.VERSION.SDK_INT >= 28) {
            return false;
        }
        try {
            return C2205h.m224b((String) Class.forName("android.os.SystemProperties").getDeclaredMethod("get", String.class).invoke(null, "ro.lewa.version"));
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /* renamed from: a */
    private boolean m350a(File file) {
        Throwable th;
        Exception e;
        ZipFile zipFile;
        boolean z = true;
        ZipFile zipFile2 = null;
        try {
            try {
                zipFile = new ZipFile(file);
            } catch (Exception e2) {
                e = e2;
            }
        } catch (Throwable th2) {
            th = th2;
        }
        try {
            if (zipFile.getEntry("resources.arsc") == null) {
                z = false;
            }
            C2201d.m245a(zipFile);
            return z;
        } catch (Exception e3) {
            e = e3;
            zipFile2 = zipFile;
            f4065a.mo263a(e.getMessage(), e);
            C2201d.m245a(zipFile2);
            return true;
        } catch (Throwable th3) {
            th = th3;
            zipFile2 = zipFile;
            C2201d.m245a(zipFile2);
            throw th;
        }
    }
}
