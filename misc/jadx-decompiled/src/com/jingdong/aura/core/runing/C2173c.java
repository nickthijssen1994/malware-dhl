package com.jingdong.aura.core.runing;

import android.content.pm.PackageInfo;
import android.text.TextUtils;
import com.jingdong.aura.core.p121a.C2119a;
import com.jingdong.aura.core.p121a.C2122c;
import com.jingdong.aura.core.p121a.C2124d;
import com.jingdong.aura.core.p122b.C2125a;
import com.jingdong.aura.core.p122b.C2135c;
import com.jingdong.aura.core.p122b.C2150e;
import com.jingdong.aura.core.p122b.C2153h;
import com.jingdong.aura.core.p122b.p124b.C2131b;
import com.jingdong.aura.core.util.C2201d;
import com.jingdong.aura.core.util.C2205h;
import com.jingdong.aura.core.util.C2206i;
import com.jingdong.aura.core.util.p127a.AbstractC2197b;
import com.jingdong.aura.core.util.p127a.C2198c;
import java.io.File;
import java.util.Hashtable;
import java.util.Iterator;
import java.util.List;
import java.util.zip.ZipFile;
import org.osgi.framework.BundleException;
import org.osgi.framework.a;

/* compiled from: TbsSdkJava */
/* renamed from: com.jingdong.aura.core.runing.c */
/* loaded from: classes.dex */
public class C2173c {

    /* renamed from: a */
    private static Hashtable<Integer, String> f4067a = new Hashtable<>();

    /* renamed from: b */
    private static int f4068b = 0;

    /* renamed from: c */
    private static AbstractC2197b f4069c = C2198c.m255a(C2173c.class);

    /* renamed from: a */
    public static String m339a(String str) {
        for (int i = 0; i < f4067a.size(); i++) {
            if ((f4067a.get(Integer.valueOf(i)) + "").contains(str + "")) {
                return f4067a.get(Integer.valueOf(i)) + "";
            }
        }
        return "";
    }

    /* renamed from: a */
    private static void m337a(String str, String str2) {
        Hashtable<Integer, String> hashtable = f4067a;
        Integer valueOf = Integer.valueOf(f4068b);
        hashtable.put(valueOf, " Not found class " + str + " because " + str2);
        f4068b = f4068b + 1;
        f4068b = f4068b % 10;
    }

    /* renamed from: b */
    public static void m336b(String str) {
        if (str != null) {
            try {
                synchronized (str) {
                    C2124d.m627a();
                    String b = C2122c.m632a().m628b(str);
                    if (C2205h.m229a(b)) {
                        b = C2119a.m656a().m642e(str);
                    }
                    if (TextUtils.isEmpty(b)) {
                        AbstractC2197b bVar = f4069c;
                        bVar.mo256e("Failed to find the bundle in BundleInfoList for component " + b);
                        m337a(str, "not found in BundleInfoList!");
                        return;
                    }
                    m334c(b);
                }
            } catch (Exception e) {
                if (!C2206i.m217a(str)) {
                    C2150e.m428a("ClassNotFound", "checkInstallBundleIfNeed failed " + str, "ClassLoadFromBundle", e);
                    return;
                }
                throw e;
            }
        }
    }

    /* renamed from: c */
    public static void m334c(String str) {
        if (!TextUtils.isEmpty(str)) {
            if (C2124d.m626a(str) || C2119a.m656a().m646c(str)) {
                m331e(str);
            } else {
                m337a(str, "not found in mInternalBundles!");
            }
        }
    }

    /* renamed from: d */
    static Class<?> m332d(String str) {
        ClassLoader e;
        List<a> g = C2131b.m574g();
        Class<?> cls = null;
        if (g != null && !g.isEmpty()) {
            Iterator<a> it = g.iterator();
            while (it.hasNext()) {
                C2153h hVar = (a) it.next();
                C2179i a = C2176f.m325a(hVar.m402n());
                if (a != null && (a.f4086e.contains(str) || a.f4087f.contains(str))) {
                    try {
                        cls = m340a(hVar, str, g);
                        continue;
                    } catch (Exception e2) {
                        if (!C2206i.m217a(str)) {
                            C2150e.m428a("ClassNotFound", "loadClassFromInstalledBundles failed " + str, "loadClassFromInstalledBundles", e2);
                            continue;
                        } else {
                            throw e2;
                        }
                    }
                }
                if (cls != null) {
                    return cls;
                }
            }
        }
        if (g != null && !g.isEmpty()) {
            Iterator<a> it2 = C2131b.m574g().iterator();
            while (it2.hasNext()) {
                C2153h hVar2 = (a) it2.next();
                hVar2.m410f().mo473d();
                try {
                    hVar2.m406j();
                } catch (BundleException e3) {
                    e3.printStackTrace();
                }
                if (hVar2.m410f().mo474c() && (e = hVar2.m411e()) != null) {
                    try {
                        cls = e.loadClass(str);
                        if (cls != null) {
                            return cls;
                        }
                    } catch (ClassNotFoundException unused) {
                        continue;
                    }
                }
            }
        }
        return cls;
    }

    /* renamed from: a */
    private static Class<?> m340a(C2153h hVar, String str, List<a> list) {
        hVar.m410f().mo473d();
        ClassLoader e = hVar.m411e();
        try {
            hVar.m406j();
        } catch (BundleException e2) {
            e2.printStackTrace();
        }
        if (e != null) {
            try {
                Class<?> loadClass = e.loadClass(str);
                if (loadClass != null) {
                    return loadClass;
                }
            } catch (ClassNotFoundException e3) {
                StringBuilder sb = new StringBuilder();
                sb.append("Can't find class ");
                sb.append(str);
                sb.append(" in BundleClassLoader:");
                sb.append(hVar.m402n());
                sb.append("[");
                sb.append(list == null ? 0 : list.size());
                sb.append("]. classloader = ");
                sb.append(e == null ? "null" : "not null");
                sb.append(". packageversion ");
                sb.append(m341a());
                throw new ClassNotFoundException(sb.toString(), e3);
            }
        }
        StringBuilder sb2 = new StringBuilder();
        sb2.append("Can't find class ");
        sb2.append(str);
        sb2.append(" in BundleClassLoader: ");
        sb2.append(hVar.m402n());
        sb2.append(" [");
        sb2.append(list.size());
        sb2.append("]");
        sb2.append(e == null ? "classloader is null" : "classloader not null");
        sb2.append(" packageversion ");
        sb2.append(m341a());
        throw new ClassNotFoundException(sb2.toString());
    }

    /* renamed from: e */
    private static void m331e(String str) {
        List<String> a = C2119a.m656a().m654a(str);
        if (a != null && a.size() > 0) {
            for (int i = 0; i < a.size(); i++) {
                m331e(a.get(i));
            }
        }
        if (C2131b.m590a(str) == null && !m330f(str) && C2125a.m620a().m616a(str) == null) {
            m329g(str);
        }
    }

    /* renamed from: f */
    private static boolean m330f(String str) {
        if (!C2135c.m528c() || str == null) {
            return false;
        }
        String concat = "lib".concat(str).concat(".so");
        String d = C2131b.m577d("com.jingdong.aura.AppDirectory.debug");
        if (d == null) {
            return false;
        }
        File file = new File(new File(d, "lib"), concat);
        if (!file.exists()) {
            return false;
        }
        m333c(str, "disk size not enough from ClassLoadFromBundle.loadDebugBundleFile for bundle " + str);
        try {
            C2125a.m620a().m615a(str, file, (long) C2206i.m214b(C2181k.f4098a, file.getAbsolutePath()), C2201d.m247a(file.getAbsolutePath()));
            return true;
        } catch (Throwable th) {
            th.printStackTrace();
            return false;
        }
    }

    /* renamed from: g */
    private static void m329g(String str) {
        File file;
        String str2;
        long j;
        if (!C2119a.m656a().m646c(str)) {
            File i = m327i(str);
            if (i == null) {
                m335b(str, "lib".concat(str).concat(".so"));
                return;
            }
            file = i;
        } else {
            file = null;
        }
        m333c(str, "disk size not enough from ClassLoadFromBundle.loadOriginalBundle_2 for bundle " + str);
        try {
            C2119a.C2120a f = C2119a.m656a().m641f(str);
            if (f != null) {
                long j2 = f.f3833i;
                str2 = f.f3835k;
                j = j2;
            } else {
                str2 = "";
                j = 0;
            }
            C2125a.m620a().m615a(str, file, j, str2);
        } catch (Throwable th) {
            f4069c.mo260b("failed to install bundle " + str, th);
            throw new RuntimeException("Aura failed to install bundle " + str + ", from ClassLoadFromBundle.loadOriginalBundle_1 ", th);
        }
    }

    /* renamed from: h */
    private static File m328h(String str) {
        File file = null;
        if (str == null) {
            return null;
        }
        String d = C2131b.m577d("com.jingdong.aura.AppDirectory");
        if (d != null) {
            file = new File(new File(d, "lib"), str);
        }
        if (file == null || !file.exists()) {
            return (C2181k.f4098a == null || C2181k.f4098a.getApplicationInfo() == null || C2181k.f4098a.getApplicationInfo().nativeLibraryDir == null) ? file : new File(C2181k.f4098a.getApplicationInfo().nativeLibraryDir, str);
        }
        return file;
    }

    /* renamed from: b */
    private static void m335b(String str, String str2) {
        String str3;
        long j;
        m333c(str, "disk size not enough from ClassLoadFromBundle.installFromApkZip for bundle" + str);
        try {
            C2119a.C2120a f = C2119a.m656a().m641f(str);
            if (f != null) {
                long j2 = f.f3833i;
                str3 = f.f3835k;
                j = j2;
            } else {
                str3 = "";
                j = 0;
            }
            C2125a.m620a().m614a(str, C2124d.m624b(str2), j, str3);
        } catch (Exception e) {
            f4069c.mo263a("Failed to install bundle " + str2 + " from APK zipfile ", e);
            throw new RuntimeException("Failed to install bundle " + str2 + " from APK zipfile ", e);
        }
    }

    /* renamed from: a */
    private static int m341a() {
        PackageInfo packageInfo;
        try {
            packageInfo = C2181k.f4098a.getPackageManager().getPackageInfo(C2181k.f4098a.getPackageName(), 0);
        } catch (Throwable th) {
            f4069c.mo260b("Error to get PackageInfo >>>", th);
            packageInfo = new PackageInfo();
        }
        return packageInfo.versionCode;
    }

    /* renamed from: c */
    private static void m333c(String str, String str2) {
        if (!C2135c.m537a(str)) {
            f4069c.mo256e("disk size not enough");
            throw new RuntimeException(str2);
        }
    }

    /* renamed from: i */
    private static File m327i(String str) {
        String concat = "lib".concat(str).concat(".so");
        File h = m328h(concat);
        if (h == null) {
            return null;
        }
        if (m338a(str, h)) {
            return h;
        }
        if (C2124d.m626a(str)) {
            return null;
        }
        AbstractC2197b bVar = f4069c;
        bVar.mo256e(" can not find the library " + concat + " for bundle" + str);
        throw new RuntimeException("can not find the library " + concat + " for bundle" + str + " from ClassLoadFromBundle.loadOriginalBundle_3");
    }

    /* renamed from: a */
    private static boolean m338a(String str, File file) {
        ZipFile zipFile;
        Throwable th;
        try {
            zipFile = new ZipFile(file);
            try {
                if (!file.exists() || !file.isFile() || !file.canRead() || file.length() <= 0) {
                    StringBuilder sb = new StringBuilder();
                    sb.append(file.exists() ? "exist" : "not exit");
                    sb.append(file.isFile() ? "isFile" : "not file");
                    sb.append(file.canRead() ? "canRead" : "can note read");
                    sb.append(file.length());
                    sb.toString();
                    C2201d.m245a(zipFile);
                    return false;
                }
                C2201d.m245a(zipFile);
                return true;
            } catch (Exception unused) {
                C2201d.m245a(zipFile);
                return false;
            } catch (Throwable th2) {
                th = th2;
                C2201d.m245a(zipFile);
                throw th;
            }
        } catch (Exception unused2) {
            zipFile = null;
        } catch (Throwable th3) {
            th = th3;
            zipFile = null;
        }
    }
}
