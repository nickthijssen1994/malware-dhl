package com.jingdong.aura.core.reflection;

import android.app.Application;
import android.app.Instrumentation;
import android.content.Intent;
import android.content.pm.ApplicationInfo;
import android.content.pm.PackageManager;
import android.content.res.Resources;
import android.os.Build;
import android.os.Handler;
import android.os.Looper;
import android.os.Message;
import androidx.databinding.DataBinderMapperProxy;
import com.jingdong.aura.core.p122b.C2150e;
import com.jingdong.aura.core.reflection.C2167c;
import com.jingdong.aura.core.reflection.Hack;
import com.jingdong.aura.core.runing.C2175e;
import com.jingdong.aura.core.runing.C2180j;
import com.jingdong.aura.core.runing.C2181k;
import com.jingdong.aura.core.runing.resource.AbstractC2184b;
import com.jingdong.aura.core.shadow.C2193c;
import com.jingdong.aura.core.util.p127a.AbstractC2197b;
import com.jingdong.aura.core.util.p127a.C2198c;
import com.jingdong.aura.wrapper.mhCallback.C2227a;
import java.lang.ref.WeakReference;
import java.lang.reflect.Field;
import java.lang.reflect.Method;
import java.util.List;
import java.util.Map;

/* compiled from: TbsSdkJava */
/* renamed from: com.jingdong.aura.core.reflection.a */
/* loaded from: classes.dex */
public class C2163a {

    /* renamed from: a */
    private static final AbstractC2197b f3991a = C2198c.m255a(C2163a.class);

    /* renamed from: c */
    private static Object f3993c = null;

    /* renamed from: b */
    private static Object f3992b = null;

    /* compiled from: TbsSdkJava */
    /* renamed from: com.jingdong.aura.core.reflection.a$b */
    /* loaded from: classes.dex */
    static final class C2165b implements Handler.Callback {

        /* renamed from: a */
        final Object f3994a;

        /* renamed from: b */
        final Handler f3995b;

        C2165b(Handler handler, Object obj) {
            this.f3995b = handler;
            this.f3994a = obj;
        }

        @Override // android.os.Handler.Callback
        public boolean handleMessage(Message message) {
            RuntimeException runtimeException;
            RuntimeException runtimeException2;
            try {
                C2163a.m365c();
                C2163a.m366b(message);
                C2227a.m163a().m162a(message);
                this.f3995b.handleMessage(message);
                C2163a.m365c();
                return true;
            } finally {
                if (runtimeException != null) {
                    throw runtimeException;
                }
            }
        }
    }

    /* compiled from: TbsSdkJava */
    /* renamed from: com.jingdong.aura.core.reflection.a$a */
    /* loaded from: classes.dex */
    static class RunnableC2164a implements Runnable {
        RunnableC2164a() {
        }

        @Override // java.lang.Runnable
        public void run() {
            try {
                Object unused = C2163a.f3993c = C2166b.f4037b.m377a(C2166b.f4022a.m389a(), new Object[0]);
            } catch (Exception e) {
                e.printStackTrace();
            }
            synchronized (C2166b.f4037b) {
                C2166b.f4037b.notify();
            }
        }
    }

    /* renamed from: a */
    public static Object m376a() {
        if (f3993c == null) {
            if (Thread.currentThread().getId() == Looper.getMainLooper().getThread().getId()) {
                f3993c = C2166b.f4037b.m377a(null, new Object[0]);
            } else {
                Handler handler = new Handler(Looper.getMainLooper());
                synchronized (C2166b.f4037b) {
                    handler.post(new RunnableC2164a());
                    C2166b.f4037b.wait();
                }
            }
        }
        return f3993c;
    }

    /* renamed from: b */
    public static Handler m367b() {
        Object a = m376a();
        if (a != null) {
            try {
                Handler handler = (Handler) C2166b.f4022a.m385b("mH").m378b(Hack.m391a("android.app.ActivityThread$H").m389a()).m381a((Hack.C2161d<Object, T2>) a);
                Field declaredField = Handler.class.getDeclaredField("mCallback");
                declaredField.setAccessible(true);
                declaredField.set(handler, new C2165b(handler, a));
                return null;
            } catch (Hack.HackDeclaration.HackAssertionException e) {
                e.printStackTrace();
                return null;
            }
        } else {
            throw new Exception("Failed to get ActivityThread.sCurrentActivityThread");
        }
    }

    /* renamed from: c */
    public static void m365c() {
        Object a = m376a();
        if (a != null) {
            Object a2 = m373a(C2181k.f4098a, a, C2181k.f4098a.getPackageName());
            if (a2 == null && (a2 = m374a(C2181k.f4098a, a)) == null) {
                throw new RuntimeException("can't create loadedApk");
            } else if (!(C2166b.f4007L.m381a((Hack.C2161d<Object, ClassLoader>) a2) instanceof C2175e)) {
                C2166b.f4007L.m379a((Hack.C2161d<Object, ClassLoader>) a2, C2181k.f4099b);
                C2166b.f4009N.m379a((Hack.C2161d<Object, Resources>) a2, C2181k.f4101d);
            }
        } else {
            throw new Exception("Failed to get ActivityThread.sCurrentActivityThread");
        }
    }

    /* renamed from: a */
    public static Object m373a(Application application, Object obj, String str) {
        WeakReference weakReference = (WeakReference) C2166b.f4041f.m381a((Hack.C2161d<Object, Map<String, Object>>) obj).get(str);
        if (weakReference == null || weakReference.get() == null) {
            return null;
        }
        f3992b = weakReference.get();
        return weakReference.get();
    }

    /* renamed from: a */
    public static Object m374a(Application application, Object obj) {
        Method method;
        try {
            ApplicationInfo applicationInfo = application.getPackageManager().getApplicationInfo(application.getPackageName(), 1152);
            application.getPackageManager();
            Resources resources = application.getResources();
            if (resources instanceof AbstractC2184b) {
                method = resources.getClass().getSuperclass().getSuperclass().getDeclaredMethod("getCompatibilityInfo", new Class[0]);
            } else if (resources.getClass().getName().equals("android.content.res.MiuiResources")) {
                method = resources.getClass().getSuperclass().getDeclaredMethod("getCompatibilityInfo", new Class[0]);
            } else {
                method = resources.getClass().getDeclaredMethod("getCompatibilityInfo", new Class[0]);
            }
            method.setAccessible(true);
            Class<?> cls = Class.forName("android.content.res.CompatibilityInfo");
            Object invoke = method.invoke(application.getResources(), new Object[0]);
            Method declaredMethod = C2166b.f4022a.m389a().getDeclaredMethod("getPackageInfoNoCheck", ApplicationInfo.class, cls);
            declaredMethod.setAccessible(true);
            Object invoke2 = declaredMethod.invoke(obj, applicationInfo, invoke);
            f3992b = invoke2;
            return invoke2;
        } catch (Throwable th) {
            th.printStackTrace();
            throw new RuntimeException(th);
        }
    }

    /* renamed from: a */
    public static void m368a(String str, ClassLoader classLoader) {
        Object a = m376a();
        if (a != null) {
            Object a2 = m373a(C2181k.f4098a, a, str);
            if (a2 == null) {
                a2 = m374a(C2181k.f4098a, a);
            }
            if (a2 != null) {
                C2166b.f4007L.m379a((Hack.C2161d<Object, ClassLoader>) a2, classLoader);
                return;
            }
            throw new Exception("Failed to get ActivityThread.mLoadedApk");
        }
        throw new Exception("Failed to get ActivityThread.sCurrentActivityThread");
    }

    /* renamed from: a */
    public static void m369a(String str, Application application) {
        Object a = m376a();
        if (a != null) {
            Object a2 = m373a(application, a, application.getPackageName());
            if (a2 != null) {
                C2166b.f4005J.m379a((Hack.C2161d<Object, Application>) a2, application);
                C2166b.f4039d.m379a((Hack.C2161d<Object, Application>) a, application);
                return;
            }
            throw new Exception("Failed to get ActivityThread.mLoadedApk");
        }
        throw new Exception("Failed to get ActivityThread.sCurrentActivityThread");
    }

    /* renamed from: a */
    public static void m375a(Application application, Resources resources) {
        Object a = m376a();
        if (a != null) {
            Object a2 = m373a(application, a, application.getPackageName());
            if (a2 == null) {
                a2 = m374a(application, a);
                if (a2 == null) {
                    throw new RuntimeException("Failed to get ActivityThread.mLoadedApk");
                } else if (!(C2166b.f4007L.m381a((Hack.C2161d<Object, ClassLoader>) a2) instanceof C2175e)) {
                    C2166b.f4007L.m379a((Hack.C2161d<Object, ClassLoader>) a2, C2181k.f4099b);
                }
            }
            C2166b.f4009N.m379a((Hack.C2161d<Object, Resources>) a2, resources);
            C2166b.f4052q.m379a((Hack.C2161d<Object, Resources>) application.getBaseContext(), resources);
            C2166b.f4053r.m379a((Hack.C2161d<Object, Resources.Theme>) application.getBaseContext(), (Object) null);
            return;
        }
        throw new Exception("Failed to get ActivityThread.sCurrentActivityThread");
    }

    /* renamed from: d */
    public static Instrumentation m364d() {
        Object a = m376a();
        if (a != null) {
            return C2166b.f4040e.m381a((Hack.C2161d<Object, Instrumentation>) a);
        }
        throw new Exception("Failed to get ActivityThread.sCurrentActivityThread");
    }

    /* renamed from: a */
    public static void m372a(Instrumentation instrumentation) {
        Object a = m376a();
        if (a != null) {
            C2166b.f4040e.m379a((Hack.C2161d<Object, Instrumentation>) a, instrumentation);
            return;
        }
        throw new Exception("Failed to get ActivityThread.sCurrentActivityThread");
    }

    /* renamed from: e */
    public static void m363e() {
        C2180j jVar = new C2180j(C2181k.f4098a.getBaseContext());
        Object a = C2166b.f4042g.m381a((Hack.C2161d<Object, Object>) null);
        C2181k.f4100c = (PackageManager) C2166b.f4032aj.m384a(C2181k.f4098a.getBaseContext(), a);
        C2166b.f4042g.m380a((Hack.C2161d<Object, Object>) null, (C2167c.AbstractC2168a<?>) jVar);
        try {
            PackageManager packageManager = C2181k.f4098a.getPackageManager();
            Field declaredField = Class.forName("android.app.ApplicationPackageManager").getDeclaredField("mPM");
            declaredField.setAccessible(true);
            declaredField.set(packageManager, C2166b.f4042g.m381a((Hack.C2161d<Object, Object>) null));
        } catch (Throwable th) {
            th.printStackTrace();
        }
    }

    /* renamed from: f */
    public static DataBinderMapperProxy m362f() {
        try {
            Hack.C2161d a = new Hack.C2159b(Class.forName("androidx.databinding.DataBindingUtil")).m388a("sMapper");
            DataBinderMapperProxy dataBinderMapperProxy = new DataBinderMapperProxy(a.m381a((Hack.C2161d) null));
            a.m379a((Hack.C2161d) null, dataBinderMapperProxy);
            return dataBinderMapperProxy;
        } catch (Throwable unused) {
            return null;
        }
    }

    /* renamed from: b */
    public static void m366b(Message message) {
        Intent c;
        try {
            if (message.what == 100) {
                Object obj = message.obj;
                Field declaredField = Class.forName("android.app.ActivityThread$ActivityClientRecord").getDeclaredField("intent");
                declaredField.setAccessible(true);
                Intent c2 = C2193c.m275c((Intent) declaredField.get(obj));
                if (c2 != null) {
                    declaredField.set(obj, c2);
                }
            }
            if (message.what == 159 && Build.VERSION.SDK_INT >= 28) {
                Object obj2 = message.obj;
                Field declaredField2 = Class.forName("android.app.servertransaction.ClientTransaction").getDeclaredField("mActivityCallbacks");
                declaredField2.setAccessible(true);
                Class<?> cls = Class.forName("android.app.servertransaction.LaunchActivityItem");
                Field declaredField3 = cls.getDeclaredField("mIntent");
                declaredField3.setAccessible(true);
                for (Object obj3 : (List) declaredField2.get(obj2)) {
                    if (cls.isInstance(obj3) && (c = C2193c.m275c((Intent) declaredField3.get(obj3))) != null) {
                        declaredField3.set(obj3, c);
                    }
                }
            }
        } catch (Throwable th) {
            C2150e.m428a("hackLaunchActivityMessage", "hackLaunchActivityMessage failed, message.what: " + message.what, "hackLaunchActivityMessage", th);
        }
    }
}
