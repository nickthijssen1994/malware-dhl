package com.jingdong.aura.core.p122b;

import com.jingdong.aura.core.p122b.p123a.C2127b;
import com.jingdong.aura.core.p122b.p124b.C2131b;
import com.jingdong.aura.core.p122b.p125c.AbstractC2139a;
import com.jingdong.aura.core.p122b.p125c.C2140b;
import com.jingdong.aura.core.p122b.p125c.C2148h;
import com.jingdong.aura.core.runing.C2181k;
import com.jingdong.aura.core.util.p127a.AbstractC2197b;
import com.jingdong.aura.core.util.p127a.C2198c;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.Hashtable;
import java.util.List;
import org.osgi.framework.BundleException;
import org.osgi.framework.a;
import org.osgi.framework.b;
import org.osgi.framework.c;
import org.osgi.framework.e;

/* compiled from: TbsSdkJava */
/* renamed from: com.jingdong.aura.core.b.h */
/* loaded from: classes.dex */
public class C2153h implements a {

    /* renamed from: a */
    private static final AbstractC2197b f3954a = C2198c.m255a(C2153h.class);

    /* renamed from: b */
    private AbstractC2139a f3955b;

    /* renamed from: c */
    private final File f3956c;

    /* renamed from: d */
    private ClassLoader f3957d;

    /* renamed from: e */
    private final C2152g f3958e;

    /* renamed from: f */
    private int f3959f;

    /* renamed from: g */
    private Hashtable<String, String> f3960g;

    /* renamed from: h */
    private String f3961h;

    /* renamed from: i */
    private boolean f3962i;

    /* renamed from: j */
    private List<b> f3963j;

    /* renamed from: k */
    private List<c> f3964k;

    /* renamed from: l */
    private List<Object> f3965l;

    /* renamed from: m */
    private List<e> f3966m;

    /* renamed from: n */
    private C2154i[] f3967n;

    /* renamed from: o */
    private int f3968o;

    public C2153h(File file, String str, long j, C2152g gVar, InputStream inputStream, File file2, boolean z, String str2) {
        this.f3960g = new Hashtable<>();
        this.f3968o = 0;
        this.f3962i = false;
        this.f3966m = null;
        this.f3964k = null;
        this.f3963j = null;
        this.f3965l = null;
        this.f3967n = null;
        long currentTimeMillis = System.currentTimeMillis();
        this.f3961h = str;
        this.f3958e = gVar;
        this.f3958e.m420a(this);
        this.f3959f = C2131b.m570k();
        this.f3956c = file;
        try {
            if (inputStream != null) {
                this.f3955b = new C2140b(str, j, file, inputStream, str2);
            } else if (file2 != null) {
                this.f3955b = new C2140b(str, j, file, file2, str2);
            }
            this.f3968o = 2;
            m400p();
            if (z) {
                m415a(false);
                C2131b.m586a(str, (a) this);
                C2131b.m596a(1, (a) this);
            }
            if (f3954a.mo259c()) {
                AbstractC2197b bVar = f3954a;
                bVar.mo258c("Framework: Bundle " + toString() + " created. " + (System.currentTimeMillis() - currentTimeMillis) + " ms");
            }
        } catch (IOException e) {
            f3954a.mo263a(e.getMessage(), e);
            throw new BundleException("new BundleArchive failed", e);
        }
    }

    /* JADX WARN: Multi-variable type inference failed */
    /* JADX WARN: Removed duplicated region for block: B:18:0x007d A[Catch: Exception -> 0x00aa, TRY_LEAVE, TryCatch #3 {Exception -> 0x00aa, blocks: (B:16:0x0060, B:18:0x007d), top: B:32:0x0060 }] */
    /* JADX WARN: Removed duplicated region for block: B:38:? A[RETURN, SYNTHETIC] */
    /* JADX WARN: Type inference failed for: r11v1 */
    /* JADX WARN: Type inference failed for: r11v4 */
    /* JADX WARN: Type inference failed for: r3v12, types: [boolean] */
    /* JADX WARN: Type inference failed for: r3v2 */
    /* JADX WARN: Type inference failed for: r3v6, types: [java.io.DataInputStream] */
    /* JADX WARN: Type inference failed for: r3v8 */
    /* JADX WARN: Type inference failed for: r3v9 */
    /* Code decompiled incorrectly, please refer to instructions dump */
    public C2153h(File file, C2152g gVar, long j) {
        Throwable th;
        DataInputStream dataInputStream;
        long j2;
        boolean z;
        Exception e;
        DataInputStream dataInputStream2;
        try {
            try {
                this.f3960g = new Hashtable<>();
                z = false;
                this.f3968o = 0;
                j2 = System.currentTimeMillis();
                dataInputStream = 0;
                try {
                    dataInputStream2 = new DataInputStream(new FileInputStream(new File(file, "meta")));
                } catch (Exception e2) {
                    e = e2;
                }
            } catch (Throwable th2) {
                th = th2;
            }
        } catch (IOException unused) {
        }
        try {
            try {
                this.f3961h = dataInputStream2.readUTF();
                this.f3959f = dataInputStream2.readInt();
                dataInputStream = dataInputStream2.readBoolean();
                this.f3962i = dataInputStream;
                dataInputStream2.close();
            } catch (Exception e3) {
                e = e3;
                dataInputStream = dataInputStream2;
                f3954a.mo263a(e.getMessage(), e);
                if (dataInputStream != 0) {
                    dataInputStream.close();
                }
                this.f3958e = gVar;
                this.f3958e.m420a(this);
                this.f3956c = file;
                gVar = 2;
                this.f3968o = 2;
                this.f3955b = new C2140b(this.f3961h, file, j);
                m415a(z);
                C2131b.m586a(this.f3961h, (a) this);
                C2131b.m596a(1, (a) this);
                if (!f3954a.mo259c()) {
                }
            } catch (Throwable th3) {
                th = th3;
                dataInputStream = dataInputStream2;
                if (dataInputStream != 0) {
                    try {
                        dataInputStream.close();
                    } catch (IOException unused2) {
                    }
                }
                throw th;
            }
            this.f3955b = new C2140b(this.f3961h, file, j);
            m415a(z);
            C2131b.m586a(this.f3961h, (a) this);
            C2131b.m596a(1, (a) this);
            if (!f3954a.mo259c()) {
                AbstractC2197b bVar = f3954a;
                bVar.mo258c("Framework: Bundle " + toString() + " loaded. " + (System.currentTimeMillis() - j2) + " ms");
                return;
            }
            return;
        } catch (Exception e4) {
            throw new BundleException("Could not load bundle " + this.f3961h, e4);
        }
        this.f3958e = gVar;
        this.f3958e.m420a(this);
        this.f3956c = file;
        gVar = 2;
        this.f3968o = 2;
    }

    /* renamed from: a */
    public static void m417a(File file, String str, int i, InputStream inputStream, String str2) {
        try {
            long b = C2148h.m437b(file);
            AbstractC2197b bVar = f3954a;
            bVar.mo261b("old max version=" + b + ", want new versioncode = " + i);
            long j = (long) i;
            if (b < j) {
                new C2140b(str, j, file, inputStream, str2);
            }
        } catch (Exception e) {
            AbstractC2197b bVar2 = f3954a;
            bVar2.mo261b("location:" + str + ", " + e.getMessage());
            throw new BundleException("Could not update bundle " + str, e);
        }
    }

    /* renamed from: a */
    public int m418a() {
        return this.f3968o;
    }

    /* renamed from: b */
    public AbstractC2139a m414b() {
        return this.f3955b;
    }

    /* renamed from: c */
    public int m413c() {
        return this.f3959f;
    }

    /* renamed from: d */
    public boolean m412d() {
        return this.f3962i;
    }

    /* renamed from: e */
    public ClassLoader m411e() {
        return this.f3957d;
    }

    /* renamed from: f */
    public AbstractC2139a m410f() {
        return this.f3955b;
    }

    /* renamed from: g */
    public synchronized void m409g() {
        this.f3955b.mo473d();
    }

    /* renamed from: h */
    public String m408h() {
        return m410f().mo476b().m463c() + "/lib:" + C2181k.f4098a.getApplicationInfo().nativeLibraryDir + ":" + System.getProperty("java.library.path");
    }

    /* renamed from: i */
    public String m407i() {
        return m410f().mo476b().m463c() + "/lib";
    }

    /* renamed from: a */
    private synchronized void m415a(boolean z) {
        if (this.f3968o != 4) {
            if (this.f3957d == null) {
                this.f3957d = C2127b.m607a(this);
            }
            if (z) {
                this.f3968o = 4;
            }
            C2131b.m596a(0, (a) this);
        }
    }

    /* renamed from: j */
    public synchronized void m406j() {
        if (this.f3968o == 1) {
            throw new IllegalStateException("Cannot start uninstalled bundle " + toString());
        } else if (this.f3968o != 32) {
            if (this.f3968o == 2) {
                m415a(true);
            }
            this.f3968o = 8;
            this.f3958e.m419a(true);
            this.f3968o = 32;
            C2131b.m596a(2, (a) this);
            if (f3954a.mo259c()) {
                AbstractC2197b bVar = f3954a;
                bVar.mo258c("Framework: Bundle " + toString() + " started.");
            }
        }
    }

    /* renamed from: k */
    public synchronized void m405k() {
        if (this.f3968o == 1) {
            throw new IllegalStateException("Cannot stop uninstalled bundle " + toString());
        } else if (this.f3968o == 32) {
            this.f3968o = 16;
            if (f3954a.mo259c()) {
                AbstractC2197b bVar = f3954a;
                bVar.mo258c("Framework: Bundle " + toString() + " stopped.");
            }
            this.f3968o = 4;
            C2131b.m596a(4, (a) this);
            this.f3958e.m419a(false);
        }
    }

    /* renamed from: l */
    public void m404l() {
        this.f3962i = true;
        m400p();
        if (this.f3959f <= C2131b.m569l()) {
            m406j();
        }
    }

    /* renamed from: a */
    public void m416a(InputStream inputStream, int i, String str) {
        if (this.f3968o != 1) {
            try {
                this.f3955b.mo478a(this.f3961h, i, this.f3956c, inputStream, str);
            } catch (Throwable th) {
                throw new BundleException("Could not update bundle " + toString(), th);
            }
        } else {
            throw new IllegalStateException("Cannot update uninstalled bundle " + toString());
        }
    }

    /* renamed from: m */
    public void m403m() {
        int i = this.f3968o;
        if (i != 1) {
            if (i == 32) {
                try {
                    m405k();
                } catch (Throwable th) {
                    C2131b.m595a(2, (a) this, th);
                }
            }
            this.f3968o = 1;
            new File(this.f3956c, "meta").delete();
            this.f3957d = null;
            C2131b.m582b(toString());
            C2131b.m596a(16, (a) this);
            this.f3958e.m419a(false);
            this.f3958e.m420a((C2153h) null);
            return;
        }
        throw new IllegalStateException("Bundle " + toString() + " is already uninstalled.");
    }

    /* renamed from: n */
    public String m402n() {
        return this.f3961h;
    }

    /* renamed from: o */
    public int m401o() {
        AbstractC2139a aVar = this.f3955b;
        if (aVar == null) {
            return 0;
        }
        return aVar.mo472e();
    }

    public String toString() {
        return this.f3961h;
    }

    /* JADX WARN: Multi-variable type inference failed */
    /* JADX WARN: Type inference failed for: r0v3, types: [java.lang.Throwable, java.io.IOException] */
    /* JADX WARN: Type inference failed for: r0v9 */
    /* renamed from: p */
    public void m400p() {
        Throwable th;
        DataOutputStream e;
        File file;
        IOException e2;
        DataOutputStream dataOutputStream;
        try {
            try {
                file = new File(this.f3956c, "meta");
            } catch (Throwable th2) {
                th = th2;
            }
            try {
                if (!file.getParentFile().exists()) {
                    file.getParentFile().mkdirs();
                }
                FileOutputStream fileOutputStream = new FileOutputStream(file);
                dataOutputStream = new DataOutputStream(fileOutputStream);
                try {
                    dataOutputStream.writeUTF(this.f3961h);
                    dataOutputStream.writeInt(this.f3959f);
                    dataOutputStream.writeBoolean(this.f3962i);
                    dataOutputStream.flush();
                    fileOutputStream.getFD().sync();
                    dataOutputStream.close();
                } catch (IOException e3) {
                    e2 = e3;
                    f3954a.mo263a(e2.getMessage(), e2);
                    if (dataOutputStream != null) {
                        dataOutputStream.close();
                    }
                }
            } catch (IOException e4) {
                e2 = e4;
                dataOutputStream = null;
            } catch (Throwable th3) {
                th = th3;
                e = 0;
                if (e != 0) {
                    try {
                        e.close();
                    } catch (IOException e5) {
                        f3954a.mo263a(e5.getMessage(), e5);
                    }
                }
                throw th;
            }
        } catch (IOException e6) {
            while (true) {
                e = e6;
                f3954a.mo263a(e.getMessage(), e);
                return;
            }
        }
    }
}
