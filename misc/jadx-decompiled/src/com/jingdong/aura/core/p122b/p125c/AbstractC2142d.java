package com.jingdong.aura.core.p122b.p125c;

import android.text.TextUtils;
import com.jingdong.aura.core.p122b.C2135c;
import com.jingdong.aura.core.p122b.C2150e;
import com.jingdong.aura.core.util.C2201d;
import com.jingdong.aura.core.util.p127a.AbstractC2197b;
import com.jingdong.aura.core.util.p127a.C2198c;
import com.jingdong.aura.wrapper.C2211a;
import dalvik.system.DexFile;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;

/* compiled from: TbsSdkJava */
/* renamed from: com.jingdong.aura.core.b.c.d */
/* loaded from: classes.dex */
public abstract class AbstractC2142d {

    /* renamed from: a */
    static final AbstractC2197b f3934a = C2198c.m255a(AbstractC2142d.class);

    /* renamed from: c */
    final String f3936c;

    /* renamed from: d */
    final int f3937d;

    /* renamed from: e */
    final File f3938e;

    /* renamed from: f */
    final File f3939f;

    /* renamed from: b */
    final boolean f3935b = C2135c.m497m();

    /* renamed from: g */
    private DexFile f3940g = null;

    /* renamed from: b */
    public abstract void mo442b();

    AbstractC2142d(String str, int i, File file, File file2) {
        this.f3936c = str;
        this.f3937d = i;
        this.f3939f = file;
        this.f3938e = file2;
    }

    /* renamed from: a */
    public boolean m453a() {
        if (new File(this.f3938e, "bundle.dex").exists()) {
            return true;
        }
        this.f3940g = null;
        return false;
    }

    /* renamed from: c */
    public DexFile m451c() {
        if (this.f3940g == null) {
            try {
                m452a(new File(this.f3938e, "bundle.dex"));
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
        return this.f3940g;
    }

    /* renamed from: d */
    public void m450d() {
        if (this.f3935b) {
            if (!C2135c.m486u() || C2211a.m205a()) {
                File file = new File(this.f3938e, "bundle.dex");
                if (!file.exists()) {
                    m446h();
                    this.f3940g = null;
                    return;
                }
                String b = C2201d.m244b(file.getAbsolutePath());
                if (!TextUtils.isEmpty(b)) {
                    String g = m447g();
                    if (!TextUtils.isEmpty(g) && !g.equals(b)) {
                        AbstractC2197b bVar = f3934a;
                        bVar.mo258c("dex md5 check failed, delete the dex file. " + file.getAbsolutePath() + ". meta stored md5 = " + g + ", now dex md5 = " + b);
                        file.delete();
                        m446h();
                        this.f3940g = null;
                        String str = this.f3936c;
                        int i = this.f3937d;
                        C2150e.m430a(str, i, "dex md5 check failed, delete the dex file. " + file.getAbsolutePath() + ". meta stored md5 = " + g + ", now dex md5 = " + b, "ensureDexFileByMd5", (Throwable) null);
                    }
                }
            }
        }
    }

    /* renamed from: e */
    public void m449e() {
        new File(this.f3938e, "bundle.dex").delete();
        m446h();
    }

    /* renamed from: a */
    void m452a(File file) {
        if (this.f3940g == null) {
            this.f3940g = DexFile.loadDex(this.f3939f.getAbsolutePath(), file.getAbsolutePath(), 0);
        }
        if (this.f3940g == null) {
            C2150e.m430a(this.f3936c, this.f3937d, "can't load dex file " + file.getAbsolutePath(), "BundleArchiveRevision.loadDex", (Throwable) null);
        }
    }

    /* renamed from: f */
    void m448f() {
        Throwable th;
        File file;
        DataOutputStream dataOutputStream;
        Exception e;
        if (this.f3935b) {
            try {
                file = new File(this.f3938e, "metadex");
                dataOutputStream = null;
            } catch (Throwable th2) {
                th = th2;
            }
            try {
                if (!file.getParentFile().exists()) {
                    file.getParentFile().mkdirs();
                }
                DataOutputStream dataOutputStream2 = new DataOutputStream(new FileOutputStream(file));
                try {
                    File file2 = new File(this.f3938e, "bundle.dex");
                    if (file2.exists()) {
                        dataOutputStream2.writeUTF(C2201d.m244b(file2.getAbsolutePath()));
                    }
                    dataOutputStream2.flush();
                    try {
                        dataOutputStream2.close();
                        try {
                            dataOutputStream2.close();
                        } catch (IOException e2) {
                            f3934a.mo263a(e2.getMessage(), e2);
                        }
                    } catch (IOException e3) {
                        f3934a.mo263a(e3.getMessage(), e3);
                        try {
                            dataOutputStream2.close();
                        } catch (IOException e4) {
                            f3934a.mo263a(e4.getMessage(), e4);
                        }
                    }
                } catch (Exception e5) {
                    e = e5;
                    AbstractC2197b bVar = f3934a;
                    bVar.mo263a("Could not save metadex data " + file.getAbsolutePath(), e);
                    throw new IOException("Could not save metadex data " + file.getAbsolutePath(), e);
                }
            } catch (Exception e6) {
                e = e6;
            } catch (Throwable th3) {
                th = th3;
                if (0 != 0) {
                    try {
                        dataOutputStream.close();
                    } catch (IOException e7) {
                        f3934a.mo263a(e7.getMessage(), e7);
                    }
                }
                throw th;
            }
        }
    }

    /* renamed from: g */
    private String m447g() {
        File file = new File(this.f3938e, "metadex");
        String str = null;
        if (!file.exists()) {
            return null;
        }
        try {
            DataInputStream dataInputStream = new DataInputStream(new FileInputStream(file));
            str = dataInputStream.readUTF();
            dataInputStream.close();
            return str;
        } catch (IOException e) {
            f3934a.mo263a("readDexMd5FromMetaFile failed. ", e);
            return str;
        }
    }

    /* renamed from: h */
    private void m446h() {
        new File(this.f3938e, "metadex").delete();
    }
}
