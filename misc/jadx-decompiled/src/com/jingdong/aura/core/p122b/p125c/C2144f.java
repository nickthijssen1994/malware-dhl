package com.jingdong.aura.core.p122b.p125c;

import android.os.Build;
import com.jingdong.aura.core.p122b.C2135c;
import com.jingdong.aura.core.p122b.C2150e;
import com.jingdong.aura.core.util.C2194a;
import com.jingdong.aura.core.util.C2208k;
import com.jingdong.aura.core.util.p127a.AbstractC2197b;
import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;
import java.util.concurrent.Executor;
import java.util.concurrent.Executors;

/* compiled from: TbsSdkJava */
/* renamed from: com.jingdong.aura.core.b.c.f */
/* loaded from: classes.dex */
public class C2144f extends AbstractC2142d {
    C2144f(String str, int i, File file, File file2) {
        super(str, i, file, file2);
    }

    @Override // com.jingdong.aura.core.p122b.p125c.AbstractC2142d
    /* renamed from: b */
    public synchronized void mo442b() {
        if (!m453a()) {
            File file = new File(this.f3938e, "bundle.dex");
            file.delete();
            if (!C2194a.m272a().m271a(file)) {
                AbstractC2197b bVar = f3934a;
                bVar.mo256e("Failed to get file lock for " + this.f3939f.getAbsolutePath());
            }
            if (Build.VERSION.SDK_INT < C2135c.m547C() || !C2208k.m207b().booleanValue()) {
                m452a(file);
            } else {
                m444a(this.f3939f.getAbsolutePath(), file.getAbsolutePath());
            }
            C2194a.m272a().m268b(file);
            try {
                m448f();
            } catch (IOException e) {
                e.printStackTrace();
                C2150e.m430a(this.f3936c, this.f3937d, "updateMetadata failed.", "optDexFile", e);
            }
        }
    }

    /* renamed from: a */
    private void m444a(String str, String str2) {
        File file = new File(str2);
        if (!file.exists()) {
            file.getParentFile().mkdirs();
        }
        ArrayList arrayList = new ArrayList();
        arrayList.add("dex2oat");
        arrayList.add("--dex-file=" + str);
        arrayList.add("--oat-file=" + str2);
        arrayList.add("--instruction-set=" + C2208k.m208a());
        if (Build.VERSION.SDK_INT >= C2135c.m547C()) {
            arrayList.add("--compiler-filter=quicken");
        } else {
            arrayList.add("--compiler-filter=interpret-only");
        }
        ProcessBuilder processBuilder = new ProcessBuilder(arrayList);
        processBuilder.redirectErrorStream(true);
        Process start = processBuilder.start();
        C2145a.m443a(start.getInputStream());
        C2145a.m443a(start.getErrorStream());
        try {
            int waitFor = start.waitFor();
            if (waitFor != 0) {
                throw new IOException("dex2oat works unsuccessfully, exit code: " + waitFor);
            }
        } catch (InterruptedException e) {
            throw new IOException("dex2oat is interrupted, msg: " + e.getMessage(), e);
        }
    }

    /* compiled from: TbsSdkJava */
    /* renamed from: com.jingdong.aura.core.b.c.f$a */
    /* loaded from: classes.dex */
    private static class C2145a {

        /* renamed from: a */
        static final Executor f3941a = Executors.newSingleThreadExecutor();

        /* renamed from: a */
        static void m443a(final InputStream inputStream) {
            f3941a.execute(new Runnable() { // from class: com.jingdong.aura.core.b.c.f.a.1
                @Override // java.lang.Runnable
                public void run() {
                    if (inputStream != null) {
                        do {
                            try {
                            } catch (IOException unused) {
                            } catch (Throwable th) {
                                try {
                                    inputStream.close();
                                } catch (Exception unused2) {
                                }
                                throw th;
                            }
                        } while (inputStream.read(new byte[256]) > 0);
                        try {
                            inputStream.close();
                        } catch (Exception unused3) {
                        }
                    }
                }
            });
        }
    }
}
