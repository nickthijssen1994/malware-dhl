package com.jingdong.aura.core.p122b.p125c;

import android.os.Build;
import com.jingdong.aura.core.p122b.C2135c;
import com.jingdong.aura.core.p122b.C2150e;
import com.jingdong.aura.core.util.p127a.AbstractC2197b;
import com.jingdong.aura.core.util.p127a.C2198c;
import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.util.List;
import java.util.SortedMap;
import java.util.TreeMap;
import org.osgi.framework.BundleException;

/* compiled from: TbsSdkJava */
/* renamed from: com.jingdong.aura.core.b.c.b */
/* loaded from: classes.dex */
public class C2140b implements AbstractC2139a {

    /* renamed from: a */
    private static final AbstractC2197b f3921a = C2198c.m255a(C2140b.class);

    /* renamed from: b */
    private File f3922b;

    /* renamed from: c */
    private final C2141c f3923c;

    /* renamed from: d */
    private final SortedMap<Long, C2141c> f3924d;

    public C2140b(String str, File file, long j) {
        this.f3924d = C2148h.m440a(file);
        SortedMap<Long, C2141c> sortedMap = this.f3924d;
        if (sortedMap == null || sortedMap.isEmpty()) {
            throw new IOException("No valid revisions in bundle archive directory: " + file);
        }
        this.f3922b = file;
        long longValue = this.f3924d.lastKey().longValue();
        if (j > 0 && this.f3924d.containsKey(Long.valueOf(j))) {
            longValue = j;
        }
        C2141c cVar = new C2141c(str, longValue, new File(file, "package_" + String.valueOf(longValue)));
        if (cVar.m471a()) {
            this.f3924d.put(Long.valueOf(longValue), cVar);
            this.f3923c = cVar;
            return;
        }
        C2150e.m430a(str, (int) j, "new BundleArchiveRevision failed. ", "BundleArchive_1_store", (Throwable) null);
        throw new BundleException("check BundleArchiveRevision failed from BundleArchive_1");
    }

    public C2140b(String str, long j, File file, InputStream inputStream, String str2) {
        this.f3924d = new TreeMap();
        this.f3922b = file;
        C2141c cVar = new C2141c(str, j, new File(file, "package_" + String.valueOf(j)), inputStream, str2);
        int i = 0;
        while (!cVar.m471a()) {
            i++;
            C2150e.m430a(str, (int) j, "new BundleArchiveRevision failed. count = " + i, "BundleArchive_2_inputStream", (Throwable) null);
            cVar = new C2141c(str, j, new File(file, "package_" + String.valueOf(j)), inputStream, str2);
            if (i >= C2135c.m503k()) {
                throw new BundleException("check BundleArchiveRevision failed from BundleArchive_2");
            }
        }
        this.f3924d.put(Long.valueOf(j), cVar);
        this.f3923c = cVar;
    }

    public C2140b(String str, long j, File file, File file2, String str2) {
        this.f3924d = new TreeMap();
        this.f3922b = file;
        C2141c cVar = new C2141c(str, j, new File(file, "package_" + String.valueOf(j)), file2, str2);
        int i = 0;
        while (!cVar.m471a()) {
            i++;
            C2150e.m430a(str, (int) j, "new BundleArchiveRevision failed. count = " + i, "BundleArchive_3_file", (Throwable) null);
            cVar = new C2141c(str, j, new File(file, "package_" + String.valueOf(j)), file2, str2);
            if (i >= C2135c.m503k()) {
                throw new BundleException("check BundleArchiveRevision failed from BundleArchive_3");
            }
        }
        this.f3924d.put(Long.valueOf(j), cVar);
        this.f3923c = cVar;
    }

    @Override // com.jingdong.aura.core.p122b.p125c.AbstractC2139a
    /* renamed from: a */
    public Class<?> mo477a(String str, ClassLoader classLoader) {
        return this.f3923c.m467a(str, classLoader);
    }

    @Override // com.jingdong.aura.core.p122b.p125c.AbstractC2139a
    /* renamed from: a */
    public File mo479a(String str) {
        return this.f3923c.m468a(str);
    }

    @Override // com.jingdong.aura.core.p122b.p125c.AbstractC2139a
    /* renamed from: a */
    public File mo480a() {
        return this.f3923c.m460d();
    }

    @Override // com.jingdong.aura.core.p122b.p125c.AbstractC2139a
    /* renamed from: b */
    public C2141c mo476b() {
        return this.f3923c;
    }

    @Override // com.jingdong.aura.core.p122b.p125c.AbstractC2139a
    /* renamed from: b */
    public List<URL> mo475b(String str) {
        return this.f3923c.m464b(str);
    }

    @Override // com.jingdong.aura.core.p122b.p125c.AbstractC2139a
    /* renamed from: c */
    public boolean mo474c() {
        if (Build.VERSION.SDK_INT >= 29) {
            return true;
        }
        return this.f3923c.m459e();
    }

    @Override // com.jingdong.aura.core.p122b.p125c.AbstractC2139a
    /* renamed from: a */
    public C2141c mo478a(String str, int i, File file, InputStream inputStream, String str2) {
        SortedMap<Long, C2141c> sortedMap = this.f3924d;
        if (sortedMap == null || sortedMap.lastKey().longValue() < ((long) i)) {
            long j = (long) i;
            C2141c cVar = new C2141c(str, j, new File(file, "package_" + String.valueOf(j)), inputStream, str2);
            int i2 = 0;
            while (!cVar.m471a()) {
                int i3 = i2 + 1;
                C2150e.m430a(str, i, "new BundleArchiveRevision failed. count = " + i3, "newRevision_inputStream", (Throwable) null);
                C2141c cVar2 = new C2141c(str, j, new File(file, "package_" + String.valueOf(j)), inputStream, str2);
                if (i3 < C2135c.m503k()) {
                    i2 = i3;
                    cVar = cVar2;
                } else {
                    throw new BundleException("check BundleArchiveRevision failed from newRevision_inputStream");
                }
            }
            this.f3924d.put(Long.valueOf(j), cVar);
            return cVar;
        }
        AbstractC2197b bVar = f3921a;
        bVar.mo256e("packageName " + str + " versionCode " + i + " is small than exist " + this.f3924d.lastKey());
        return null;
    }

    @Override // com.jingdong.aura.core.p122b.p125c.AbstractC2139a
    /* renamed from: d */
    public void mo473d() {
        if (Build.VERSION.SDK_INT < 29) {
            this.f3923c.m458f();
        }
    }

    @Override // com.jingdong.aura.core.p122b.p125c.AbstractC2139a
    /* renamed from: e */
    public int mo472e() {
        C2141c cVar = this.f3923c;
        if (cVar == null) {
            return 0;
        }
        return (int) cVar.m466b();
    }
}
