package com.jingdong.aura.wrapper.p128a;

import android.app.Application;
import android.util.Log;
import com.jingdong.aura.core.p121a.C2119a;
import com.jingdong.aura.core.p122b.C2125a;
import com.jingdong.aura.core.p122b.C2135c;
import com.jingdong.aura.core.util.C2201d;
import com.jingdong.aura.core.util.p127a.AbstractC2197b;
import com.jingdong.aura.core.util.p127a.C2198c;
import com.jingdong.aura.wrapper.AuraConfig;
import com.jingdong.aura.wrapper.C2226c;
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Enumeration;
import java.util.List;
import java.util.zip.ZipEntry;
import java.util.zip.ZipFile;
import org.osgi.framework.a;

/* compiled from: TbsSdkJava */
/* renamed from: com.jingdong.aura.wrapper.a.a */
/* loaded from: classes.dex */
public class C2212a {

    /* renamed from: a */
    private static final AbstractC2197b f4152a = C2198c.m255a(C2212a.class);

    /* renamed from: b */
    private static C2212a f4153b;

    /* renamed from: c */
    private Application f4154c;

    /* renamed from: d */
    private boolean f4155d;

    /* renamed from: e */
    private boolean f4156e;

    /* renamed from: a */
    public static synchronized C2212a m200a() {
        C2212a aVar;
        synchronized (C2212a.class) {
            if (f4153b != null) {
                return f4153b;
            }
            synchronized (C2212a.class) {
                if (f4153b == null) {
                    f4153b = new C2212a();
                }
                aVar = f4153b;
            }
            return aVar;
        }
    }

    C2212a() {
    }

    /* renamed from: a */
    public void m199a(Application application) {
        this.f4154c = application;
        this.f4155d = true;
    }

    /* JADX WARN: Removed duplicated region for block: B:46:0x00b2 A[Catch: all -> 0x00c1, TRY_ENTER, TRY_LEAVE, TryCatch #1 {, blocks: (B:3:0x0001, B:5:0x0005, B:8:0x000e, B:32:0x008f, B:34:0x0094, B:43:0x00aa, B:46:0x00b2, B:50:0x00b8, B:52:0x00bd, B:53:0x00c0), top: B:56:0x0001, inners: #7 }] */
    /* renamed from: a */
    /* Code decompiled incorrectly, please refer to instructions dump */
    public synchronized void m194a(boolean z, boolean z2) {
        Throwable th;
        ZipFile zipFile;
        IOException e;
        if (!this.f4155d) {
            f4152a.mo256e("Bundle Installer not initialized yet, process abort!");
            return;
        }
        if (!this.f4156e || z2) {
            ZipFile zipFile2 = null;
            try {
                try {
                    zipFile = new ZipFile(this.f4154c.getApplicationInfo().sourceDir);
                } catch (IOException e2) {
                    e = e2;
                }
            } catch (Throwable th2) {
                th = th2;
                zipFile = zipFile2;
            }
            try {
                List<String> a = m196a(zipFile, "lib/" + C2135c.m548B() + "/libcom.", ".so");
                if (a != null && a.size() > 0) {
                    C2135c.m542a(a.size(), true);
                }
                if (z) {
                    ArrayList arrayList = new ArrayList();
                    for (String str : a) {
                        for (String str2 : AuraConfig.AUTO) {
                            if (str.contains(str2)) {
                                arrayList.add(str);
                            }
                        }
                    }
                    m195a(zipFile, arrayList, this.f4154c);
                } else {
                    m193b(zipFile, a, this.f4154c);
                }
                if (!z2) {
                    C2226c.m166c(this.f4154c);
                }
                try {
                    zipFile.close();
                } catch (IOException e3) {
                    e = e3;
                    e.printStackTrace();
                    if (z2) {
                    }
                }
            } catch (IOException e4) {
                e = e4;
                zipFile2 = zipFile;
                Log.e("BundlesInstaller", "IOException while processLibsBundles >>>", e);
                if (zipFile2 != null) {
                    try {
                        zipFile2.close();
                    } catch (IOException e5) {
                        e = e5;
                        e.printStackTrace();
                        if (z2) {
                        }
                    }
                }
                if (z2) {
                }
            } catch (Throwable th3) {
                th = th3;
                if (zipFile != null) {
                    try {
                        zipFile.close();
                    } catch (IOException e6) {
                        e6.printStackTrace();
                    }
                }
                throw th;
            }
            if (z2) {
                this.f4156e = true;
            }
        }
    }

    /* renamed from: a */
    private List<String> m196a(ZipFile zipFile, String str, String str2) {
        ArrayList arrayList = new ArrayList();
        try {
            Enumeration<? extends ZipEntry> entries = zipFile.entries();
            while (entries.hasMoreElements()) {
                String name = ((ZipEntry) entries.nextElement()).getName();
                if (name.startsWith(str) && name.endsWith(str2)) {
                    arrayList.add(name);
                }
            }
        } catch (Throwable th) {
            Log.e("BundlesInstaller", "Exception while get bundles in assets or lib", th);
        }
        return arrayList;
    }

    /* renamed from: a */
    public void m195a(ZipFile zipFile, List<String> list, Application application) {
        for (String str : list) {
            m197a(zipFile, str, application);
        }
        for (String str2 : AuraConfig.AUTO) {
            a a = C2125a.m620a().m616a(str2);
            if (a != null) {
                try {
                    a.l();
                } catch (Throwable th) {
                    Log.e("BundlesInstaller", "Could not auto start bundle: " + a.n(), th);
                }
            }
        }
    }

    /* renamed from: b */
    private void m193b(ZipFile zipFile, List<String> list, Application application) {
        for (String str : AuraConfig.DELAY) {
            String a = m198a(list, str);
            if (a != null && a.length() > 0) {
                m197a(zipFile, a, application);
                list.remove(a);
            }
        }
        for (String str2 : list) {
            m197a(zipFile, str2, application);
        }
        for (String str3 : AuraConfig.AUTO) {
            a a2 = C2125a.m620a().m616a(str3);
            if (a2 != null) {
                try {
                    a2.l();
                } catch (Throwable th) {
                    Log.e("BundlesInstaller", "Could not auto start bundle: " + a2.n(), th);
                }
            }
        }
    }

    /* renamed from: a */
    private String m198a(List<String> list, String str) {
        if (list == null || str == null) {
            return null;
        }
        for (String str2 : list) {
            if (str2.contains(str)) {
                return str2;
            }
        }
        return null;
    }

    /* renamed from: a */
    private boolean m197a(ZipFile zipFile, String str, Application application) {
        String str2;
        long j;
        f4152a.mo258c("processLibsBundle entryName " + str);
        String a = C2226c.m169a(str);
        String b = C2226c.m167b(str);
        if (b == null || b.length() <= 0) {
            return false;
        }
        File file = new File(new File(C2201d.m249a().getParentFile(), "lib"), a);
        if (C2125a.m620a().m616a(b) != null) {
            return false;
        }
        try {
            C2119a.C2120a f = C2119a.m656a().m641f(b);
            if (f != null) {
                long j2 = f.f3833i;
                str2 = f.f3835k;
                j = j2;
            } else {
                str2 = "";
                j = 0;
            }
            if (file.exists()) {
                C2125a.m620a().m615a(b, file, j, str2);
            } else {
                C2125a.m620a().m614a(b, zipFile.getInputStream(zipFile.getEntry(str)), j, str2);
            }
            f4152a.mo258c("Succeed to install bundle " + b);
            return true;
        } catch (Throwable th) {
            Log.e("BundlesInstaller", "Could not install bundle.", th);
            return false;
        }
    }
}
