package com.jingdong.aura.wrapper;

import android.app.Application;
import android.util.Log;
import com.jingdong.aura.core.p121a.C2119a;
import com.jingdong.aura.core.p121a.C2121b;
import com.jingdong.aura.core.p121a.C2122c;
import com.jingdong.aura.core.p122b.C2125a;
import com.jingdong.aura.core.p122b.C2135c;
import com.jingdong.aura.core.p122b.C2153h;
import com.jingdong.aura.core.p122b.p124b.C2131b;
import com.jingdong.aura.core.runing.C2179i;
import com.jingdong.aura.core.util.C2201d;
import com.jingdong.aura.core.util.p127a.AbstractC2197b;
import com.jingdong.aura.core.util.p127a.C2198c;
import com.jingdong.aura.wrapper.p128a.C2212a;
import com.jingdong.aura.wrapper.p128a.C2213b;
import com.jingdong.aura.wrapper.p128a.C2218c;
import java.util.Properties;
import org.osgi.framework.BundleException;
import org.osgi.framework.b;

/* compiled from: TbsSdkJava */
/* loaded from: classes.dex */
public class AuraInitializer {
    private static AbstractC2197b log = C2198c.m254a("AuraInitializer");
    private Application mApplication;
    private long mInitStartTime;
    private boolean mIsUpdate;
    private String mPackageName;
    private Properties mProperties = new Properties();
    private boolean mTryInstall = false;

    /* compiled from: TbsSdkJava */
    /* renamed from: com.jingdong.aura.wrapper.AuraInitializer$a */
    /* loaded from: classes.dex */
    public interface AbstractC2210a {
        /* renamed from: a */
        boolean m206a(String str);
    }

    public AuraInitializer(Application application, String str, boolean z) {
        this.mApplication = application;
        this.mPackageName = str;
        this.mIsUpdate = C2226c.m165d(application);
    }

    public void init() {
        this.mInitStartTime = System.currentTimeMillis();
        try {
            C2125a.m620a().m619a(this.mApplication);
            AbstractC2197b bVar = log;
            bVar.mo261b("Aura framework inited end " + this.mPackageName + " " + (System.currentTimeMillis() - this.mInitStartTime) + " ms");
            C2211a.m204a(this.mApplication);
        } catch (Throwable th) {
            Log.e("AuraInitializer", "Could not init  framework !!!", th);
            throw new RuntimeException(" initialization fail" + th.getMessage());
        }
    }

    public void startUp(String str) {
        if (str != null) {
            try {
                if (C2135c.m528c()) {
                    this.mProperties.put("com.jingdong.aura.AppDirectory.debug", str);
                }
            } catch (Throwable th) {
                throw new RuntimeException("Could not set Globals !!!", th);
            }
        }
        this.mProperties.put("com.jingdong.aura.AppDirectory", C2201d.m249a().getParent());
        if (C2226c.m171a()) {
            C2125a.m620a().m612a((b) new C2222b());
        }
        if (this.mIsUpdate) {
            this.mProperties.put("osgi.init", "true");
        }
        C2121b.m637a(this.mApplication, this.mIsUpdate);
        AbstractC2197b bVar = log;
        bVar.mo261b("Aura framework prepare starting in process " + this.mPackageName + " " + (System.currentTimeMillis() - this.mInitStartTime) + " ms");
        C2125a.m620a().m618a(this.mApplication, this.mProperties);
        AbstractC2197b bVar2 = log;
        bVar2.mo261b("Aura framework end startUp in process " + this.mPackageName + " " + (System.currentTimeMillis() - this.mInitStartTime) + " ms");
        C2122c.m629b();
    }

    public void preInstallBundles() {
        installBundles();
    }

    public static void loadBundle(String str) {
        C2125a.m620a().m608c(str);
        C2153h a = C2131b.m590a(str);
        if (a != null) {
            C2153h hVar = a;
            if (hVar != null) {
                hVar.m409g();
            }
            try {
                a.l();
            } catch (BundleException e) {
                e.printStackTrace();
            }
        }
    }

    public static boolean update(String str, String str2, int i, String str3) {
        boolean a = C2125a.m620a().m613a(str, str2, i, str3);
        if (a) {
            C2119a.m656a().m655a(C2179i.m305a(str2, str3));
            C2122c.m629b();
        }
        return a;
    }

    private void installBundles() {
        if (this.mIsUpdate) {
            final C2212a a = C2212a.m200a();
            final C2218c a2 = C2218c.m185a();
            a.m199a(this.mApplication);
            a2.m184a(this.mApplication);
            C2213b.m191a(new C2213b.AbstractRunnableC2217c("AuraInstallerTask") { // from class: com.jingdong.aura.wrapper.AuraInitializer.1
                @Override // java.lang.Runnable
                public void run() {
                    a.m194a(true, false);
                    a2.m183a(true, true);
                }
            });
            return;
        }
        C2226c.m164e(this.mApplication);
        C2226c.m166c(this.mApplication);
        C2226c.m168b(this.mApplication);
    }

    public void setBundleSecurityVerifier(AbstractC2210a aVar) {
        C2125a.m620a().m617a(aVar);
    }
}
