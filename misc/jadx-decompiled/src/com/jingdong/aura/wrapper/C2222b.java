package com.jingdong.aura.wrapper;

import android.os.Handler;
import android.os.HandlerThread;
import android.os.Looper;
import android.os.Message;
import android.os.Process;
import android.text.TextUtils;
import android.widget.Toast;
import com.jingdong.aura.R$string;
import com.jingdong.aura.core.nativelib.AuraNative;
import com.jingdong.aura.core.p122b.C2125a;
import com.jingdong.aura.core.p122b.C2150e;
import com.jingdong.aura.core.runing.C2181k;
import com.jingdong.aura.core.util.C2205h;
import java.io.File;
import org.osgi.framework.BundleEvent;
import org.osgi.framework.b;

/* compiled from: TbsSdkJava */
/* renamed from: com.jingdong.aura.wrapper.b */
/* loaded from: classes.dex */
public class C2222b implements b {

    /* renamed from: a */
    public static String f4173a = "";

    /* renamed from: b */
    HandlerC2224a f4174b = new HandlerC2224a();

    /* renamed from: c */
    private Handler f4175c;

    /* renamed from: d */
    private HandlerThread f4176d;

    /* compiled from: TbsSdkJava */
    /* renamed from: com.jingdong.aura.wrapper.b$b */
    /* loaded from: classes.dex */
    private final class HandlerC2225b extends Handler {
        public HandlerC2225b(Looper looper) {
            super(looper);
        }

        @Override // android.os.Handler
        public void handleMessage(Message message) {
            File b;
            if (message != null) {
                String str = (String) message.obj;
                if (!TextUtils.isEmpty(str) && (b = C2125a.m620a().m610b(str)) != null) {
                    if (C2125a.m620a().m609c() != null) {
                        if (!C2125a.m620a().m609c().m206a(b.getAbsolutePath())) {
                            C2222b.this.m172a(str);
                        }
                    } else if (!C2222b.this.m173a(b) && !AuraNative.m396a(b.getAbsolutePath())) {
                        C2222b.this.m172a(str);
                    }
                }
            }
        }
    }

    /* JADX INFO: Access modifiers changed from: private */
    /* renamed from: a */
    public boolean m173a(File file) {
        return C2205h.m222c(C2211a.m203a(file.getAbsolutePath()), f4173a);
    }

    /* JADX INFO: Access modifiers changed from: private */
    /* renamed from: a */
    public void m172a(final String str) {
        new Handler(Looper.getMainLooper()).post(new Runnable() { // from class: com.jingdong.aura.wrapper.b.1
            @Override // java.lang.Runnable
            public void run() {
                Toast.makeText(C2181k.f4098a, R$string.aura_bundlebroken, 0).show();
                C2150e.m428a(str, "组件损坏,请重新安装", "ApkUtils.initHostKey_1", null);
                C2222b.this.f4174b.sendEmptyMessageDelayed(0, 5000);
            }
        });
    }

    /* compiled from: TbsSdkJava */
    /* renamed from: com.jingdong.aura.wrapper.b$a */
    /* loaded from: classes.dex */
    public static class HandlerC2224a extends Handler {
        @Override // android.os.Handler
        public void handleMessage(Message message) {
            Process.killProcess(Process.myPid());
        }
    }

    public C2222b() {
        this.f4176d = null;
        this.f4176d = new HandlerThread("Check bundle security");
        this.f4176d.start();
        this.f4175c = new HandlerC2225b(this.f4176d.getLooper());
    }

    public void bundleChanged(BundleEvent bundleEvent) {
        int type = bundleEvent.getType();
        if (type == 1 || type == 8) {
            Message obtain = Message.obtain();
            obtain.obj = bundleEvent.getBundle().n();
            this.f4175c.sendMessage(obtain);
        }
    }
}
