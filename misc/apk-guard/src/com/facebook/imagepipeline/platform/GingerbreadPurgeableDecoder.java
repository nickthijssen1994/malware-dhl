package com.facebook.imagepipeline.platform;

import android.graphics.Bitmap;
import android.graphics.BitmapFactory.Options;
import android.os.MemoryFile;
import com.facebook.common.internal.DoNotStrip;
import com.facebook.common.internal.Preconditions;
import com.facebook.common.internal.Throwables;
import com.facebook.common.memory.PooledByteBuffer;
import com.facebook.common.references.CloseableReference;
import com.facebook.common.webp.WebpBitmapFactory;
import com.facebook.common.webp.WebpSupportStatus;
import com.facebook.imagepipeline.nativecode.DalvikPurgeableDecoder;
import java.io.FileDescriptor;
import java.io.IOException;
import java.lang.reflect.Method;
import javax.annotation.Nullable;

@DoNotStrip
public class GingerbreadPurgeableDecoder
  extends DalvikPurgeableDecoder
{
  private static Method sGetFileDescriptorMethod;
  @Nullable
  private final WebpBitmapFactory mWebpBitmapFactory = WebpSupportStatus.loadWebpBitmapFactoryIfExists();
  
  public GingerbreadPurgeableDecoder() {}
  
  private static MemoryFile copyToMemoryFile(CloseableReference paramCloseableReference, int paramInt, byte[] paramArrayOfByte)
  {
    throw new Runtime("d2j fail translate: java.lang.RuntimeException: fail exe a9 = a8\n\tat com.googlecode.dex2jar.ir.ts.an.BaseAnalyze.exec(BaseAnalyze.java:92)\n\tat com.googlecode.dex2jar.ir.ts.an.BaseAnalyze.exec(BaseAnalyze.java:1)\n\tat com.googlecode.dex2jar.ir.ts.Cfg.dfs(Cfg.java:255)\n\tat com.googlecode.dex2jar.ir.ts.an.BaseAnalyze.analyze0(BaseAnalyze.java:75)\n\tat com.googlecode.dex2jar.ir.ts.an.BaseAnalyze.analyze(BaseAnalyze.java:69)\n\tat com.googlecode.dex2jar.ir.ts.UnSSATransformer.transform(UnSSATransformer.java:274)\n\tat com.googlecode.d2j.dex.Dex2jar$2.optimize(Dex2jar.java:163)\n\tat com.googlecode.d2j.dex.Dex2Asm.convertCode(Dex2Asm.java:414)\n\tat com.googlecode.d2j.dex.ExDex2Asm.convertCode(ExDex2Asm.java:42)\n\tat com.googlecode.d2j.dex.Dex2jar$2.convertCode(Dex2jar.java:128)\n\tat com.googlecode.d2j.dex.Dex2Asm.convertMethod(Dex2Asm.java:509)\n\tat com.googlecode.d2j.dex.Dex2Asm.convertClass(Dex2Asm.java:406)\n\tat com.googlecode.d2j.dex.Dex2Asm.convertDex(Dex2Asm.java:422)\n\tat com.googlecode.d2j.dex.Dex2jar.doTranslate(Dex2jar.java:172)\n\tat com.googlecode.d2j.dex.Dex2jar.to(Dex2jar.java:272)\n\tat com.googlecode.dex2jar.tools.Dex2jarCmd.doCommandLine(Dex2jarCmd.java:108)\n\tat com.googlecode.dex2jar.tools.BaseCmd.doMain(BaseCmd.java:288)\n\tat com.googlecode.dex2jar.tools.Dex2jarCmd.main(Dex2jarCmd.java:32)\nCaused by: java.lang.NullPointerException\n");
  }
  
  private Bitmap decodeFileDescriptorAsPurgeable(CloseableReference paramCloseableReference, int paramInt, byte[] paramArrayOfByte, BitmapFactory.Options paramOptions)
  {
    WebpBitmapFactory localWebpBitmapFactory = null;
    Object localObject = null;
    try
    {
      paramCloseableReference = copyToMemoryFile(paramCloseableReference, paramInt, paramArrayOfByte);
      paramArrayOfByte = paramCloseableReference;
      try
      {
        localObject = getMemoryFileDescriptor(paramCloseableReference);
        localWebpBitmapFactory = mWebpBitmapFactory;
        if (localWebpBitmapFactory != null)
        {
          localWebpBitmapFactory = mWebpBitmapFactory;
          paramOptions = Preconditions.checkNotNull(localWebpBitmapFactory.decodeFileDescriptor((FileDescriptor)localObject, null, paramOptions), "BitmapFactory returned null");
          paramOptions = (Bitmap)paramOptions;
          if (paramCloseableReference == null) {
            break label130;
          }
          paramCloseableReference.close();
          return paramOptions;
        }
        paramOptions = new IllegalStateException("WebpBitmapFactory is null");
        throw paramOptions;
      }
      catch (Throwable paramCloseableReference)
      {
        break label120;
      }
      catch (IOException paramArrayOfByte)
      {
        localObject = paramCloseableReference;
        paramCloseableReference = paramArrayOfByte;
      }
      throw Throwables.propagate(paramCloseableReference);
    }
    catch (Throwable paramCloseableReference)
    {
      paramArrayOfByte = (byte[])localObject;
    }
    catch (IOException paramCloseableReference)
    {
      localObject = localWebpBitmapFactory;
    }
    label120:
    if (paramArrayOfByte != null) {
      paramArrayOfByte.close();
    }
    throw paramCloseableReference;
    label130:
    return paramOptions;
  }
  
  private Method getFileDescriptorMethod()
  {
    try
    {
      Method localMethod1 = sGetFileDescriptorMethod;
      if (localMethod1 == null) {
        try
        {
          localMethod1 = MemoryFile.class.getDeclaredMethod("getFileDescriptor", new Class[0]);
          sGetFileDescriptorMethod = localMethod1;
        }
        catch (Exception localException)
        {
          throw Throwables.propagate(localException);
        }
      }
      Method localMethod2 = sGetFileDescriptorMethod;
      return localMethod2;
    }
    catch (Throwable localThrowable)
    {
      throw localThrowable;
    }
  }
  
  private FileDescriptor getMemoryFileDescriptor(MemoryFile paramMemoryFile)
  {
    try
    {
      Method localMethod = getFileDescriptorMethod();
      paramMemoryFile = localMethod.invoke(paramMemoryFile, new Object[0]);
      return (FileDescriptor)paramMemoryFile;
    }
    catch (Exception paramMemoryFile)
    {
      throw Throwables.propagate(paramMemoryFile);
    }
  }
  
  protected Bitmap decodeByteArrayAsPurgeable(CloseableReference paramCloseableReference, BitmapFactory.Options paramOptions)
  {
    return decodeFileDescriptorAsPurgeable(paramCloseableReference, ((PooledByteBuffer)paramCloseableReference.get()).size(), null, paramOptions);
  }
  
  protected Bitmap decodeJPEGByteArrayAsPurgeable(CloseableReference paramCloseableReference, int paramInt, BitmapFactory.Options paramOptions)
  {
    byte[] arrayOfByte;
    if (DalvikPurgeableDecoder.endsWithEOI(paramCloseableReference, paramInt)) {
      arrayOfByte = null;
    } else {
      arrayOfByte = DalvikPurgeableDecoder.EOF_MARKER;
    }
    return decodeFileDescriptorAsPurgeable(paramCloseableReference, paramInt, arrayOfByte, paramOptions);
  }
}
