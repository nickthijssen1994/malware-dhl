package com.facebook.react.views.text.frescosupport;

import android.content.Context;
import android.content.ContextWrapper;
import android.content.res.Resources;
import android.net.Uri;
import android.net.Uri.Builder;
import com.facebook.drawee.controller.AbstractDraweeControllerBuilder;
import com.facebook.react.bridge.Dynamic;
import com.facebook.react.bridge.JSApplicationIllegalArgumentException;
import com.facebook.react.bridge.ReadableArray;
import com.facebook.react.bridge.ReadableMap;
import com.facebook.react.bridge.ReadableType;
import com.facebook.react.uimanager.ReactShadowNodeImpl;
import com.facebook.react.views.text.ReactTextInlineImageShadowNode;
import com.facebook.react.views.text.TextInlineImageSpan;
import java.util.Locale;
import javax.annotation.Nullable;

public class FrescoBasedReactTextInlineImageShadowNode
  extends ReactTextInlineImageShadowNode
{
  @Nullable
  private final Object mCallerContext;
  private final AbstractDraweeControllerBuilder mDraweeControllerBuilder;
  private ReadableMap mHeaders;
  private float mHeight = NaN.0F;
  private int mTintColor = 0;
  @Nullable
  private Uri mUri;
  private float mWidth = NaN.0F;
  
  public FrescoBasedReactTextInlineImageShadowNode(AbstractDraweeControllerBuilder paramAbstractDraweeControllerBuilder, Object paramObject)
  {
    mDraweeControllerBuilder = paramAbstractDraweeControllerBuilder;
    mCallerContext = paramObject;
  }
  
  private static Uri getResourceDrawableUri(Context paramContext, String paramString)
  {
    if ((paramString != null) && (!paramString.isEmpty()))
    {
      paramString = paramString.toLowerCase(Locale.getDefault()).replace("-", "_");
      int i = paramContext.getResources().getIdentifier(paramString, "drawable", paramContext.getPackageName());
      return new Uri.Builder().scheme("res").path(String.valueOf(i)).build();
    }
    return null;
  }
  
  public TextInlineImageSpan buildInlineImageSpan()
  {
    Resources localResources = getThemedContext().getResources();
    int i = (int)Math.ceil(mWidth);
    return new FrescoBasedReactTextInlineImageSpan(localResources, (int)Math.ceil(mHeight), i, mTintColor, getUri(), getHeaders(), getDraweeControllerBuilder(), getCallerContext());
  }
  
  public Object getCallerContext()
  {
    return mCallerContext;
  }
  
  public AbstractDraweeControllerBuilder getDraweeControllerBuilder()
  {
    return mDraweeControllerBuilder;
  }
  
  public ReadableMap getHeaders()
  {
    return mHeaders;
  }
  
  public Uri getUri()
  {
    return mUri;
  }
  
  public boolean isVirtual()
  {
    return true;
  }
  
  public void setHeaders(ReadableMap paramReadableMap)
  {
    mHeaders = paramReadableMap;
  }
  
  public void setHeight(Dynamic paramDynamic)
  {
    if (paramDynamic.getType() == ReadableType.Number)
    {
      mHeight = ((float)paramDynamic.asDouble());
      return;
    }
    throw new JSApplicationIllegalArgumentException("Inline images must not have percentage based height");
  }
  
  public void setSource(ReadableArray paramReadableArray)
  {
    Object localObject1 = null;
    localObject2 = null;
    String str;
    if ((paramReadableArray != null) && (paramReadableArray.size() != 0)) {
      str = paramReadableArray.getMap(0).getString("uri");
    } else {
      str = null;
    }
    if (str != null) {}
    for (;;)
    {
      try
      {
        paramReadableArray = Uri.parse(str);
      }
      catch (Exception paramReadableArray)
      {
        paramReadableArray = localObject2;
        continue;
      }
      try
      {
        localObject1 = paramReadableArray.getScheme();
        if (localObject1 == null) {
          paramReadableArray = localObject2;
        }
      }
      catch (Exception localException) {}
    }
    localObject1 = paramReadableArray;
    if (paramReadableArray == null) {
      localObject1 = getResourceDrawableUri(getThemedContext(), str);
    }
    if (localObject1 != mUri) {
      markUpdated();
    }
    mUri = ((Uri)localObject1);
  }
  
  public void setTintColor(int paramInt)
  {
    mTintColor = paramInt;
  }
  
  public void setWidth(Dynamic paramDynamic)
  {
    if (paramDynamic.getType() == ReadableType.Number)
    {
      mWidth = ((float)paramDynamic.asDouble());
      return;
    }
    throw new JSApplicationIllegalArgumentException("Inline images must not have percentage based width");
  }
}
