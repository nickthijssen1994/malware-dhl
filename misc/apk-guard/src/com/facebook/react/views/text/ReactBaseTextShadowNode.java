package com.facebook.react.views.text;

import android.annotation.TargetApi;
import android.content.ContextWrapper;
import android.graphics.Color;
import android.os.Build.VERSION;
import android.text.Spannable;
import android.text.SpannableStringBuilder;
import com.facebook.react.bridge.JSApplicationIllegalArgumentException;
import com.facebook.react.bridge.ReadableMap;
import com.facebook.react.uimanager.IllegalViewOperationException;
import com.facebook.react.uimanager.LayoutShadowNode;
import com.facebook.react.uimanager.PixelUtil;
import com.facebook.react.uimanager.ReactShadowNode;
import com.facebook.react.uimanager.ReactShadowNodeImpl;
import com.facebook.yoga.YogaDirection;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import javax.annotation.Nullable;

@TargetApi(23)
public abstract class ReactBaseTextShadowNode
  extends LayoutShadowNode
{
  public static final int DEFAULT_TEXT_SHADOW_COLOR = 1426063360;
  private static final String INLINE_IMAGE_PLACEHOLDER = "I";
  public static final String PROP_SHADOW_COLOR = "textShadowColor";
  public static final String PROP_SHADOW_OFFSET = "textShadowOffset";
  public static final String PROP_SHADOW_OFFSET_HEIGHT = "height";
  public static final String PROP_SHADOW_OFFSET_WIDTH = "width";
  public static final String PROP_SHADOW_RADIUS = "textShadowRadius";
  public static final String PROP_TEXT_TRANSFORM = "textTransform";
  public static final int UNSET = -1;
  protected int mBackgroundColor;
  protected int mColor;
  protected boolean mContainsImages;
  @Nullable
  protected String mFontFamily;
  protected int mFontStyle;
  protected int mFontWeight;
  protected float mHeightOfTallestInlineImage;
  protected boolean mIncludeFontPadding;
  protected boolean mIsBackgroundColorSet = false;
  protected boolean mIsColorSet = false;
  protected boolean mIsLineThroughTextDecorationSet;
  protected boolean mIsUnderlineTextDecorationSet;
  protected int mJustificationMode;
  protected int mNumberOfLines = -1;
  protected int mTextAlign = 0;
  protected TextAttributes mTextAttributes;
  protected int mTextBreakStrategy;
  protected int mTextShadowColor;
  protected float mTextShadowOffsetDx;
  protected float mTextShadowOffsetDy;
  protected float mTextShadowRadius;
  protected TextTransform mTextTransform;
  
  public ReactBaseTextShadowNode()
  {
    if (Build.VERSION.SDK_INT < 23) {
      i = 0;
    } else {
      i = 1;
    }
    mTextBreakStrategy = i;
    int i = Build.VERSION.SDK_INT;
    mJustificationMode = 0;
    mTextTransform = TextTransform.UNSET;
    mTextShadowOffsetDx = 0.0F;
    mTextShadowOffsetDy = 0.0F;
    mTextShadowRadius = 0.0F;
    mTextShadowColor = 1426063360;
    mIsUnderlineTextDecorationSet = false;
    mIsLineThroughTextDecorationSet = false;
    mIncludeFontPadding = true;
    mFontStyle = -1;
    mFontWeight = -1;
    mFontFamily = null;
    mContainsImages = false;
    mHeightOfTallestInlineImage = NaN.0F;
    mTextAttributes = new TextAttributes();
  }
  
  private static boolean buildSpannedFromShadowNode(ReactBaseTextShadowNode paramReactBaseTextShadowNode, SpannableStringBuilder paramSpannableStringBuilder, List paramList, TextAttributes paramTextAttributes, int paramInt)
  {
    TextAttributes localTextAttributes;
    if (paramTextAttributes != null) {
      localTextAttributes = paramTextAttributes.applyChild(mTextAttributes);
    } else {
      localTextAttributes = mTextAttributes;
    }
    int j = paramReactBaseTextShadowNode.getChildCount();
    int i = 0;
    boolean bool1 = false;
    while (i < j)
    {
      ReactShadowNodeImpl localReactShadowNodeImpl = paramReactBaseTextShadowNode.getChildAt(i);
      if ((localReactShadowNodeImpl instanceof ReactRawTextShadowNode))
      {
        ReactRawTextShadowNode localReactRawTextShadowNode = (ReactRawTextShadowNode)localReactShadowNodeImpl;
        bool2 = bool1;
        if (localReactRawTextShadowNode.getText() != null)
        {
          paramSpannableStringBuilder.append(TextTransform.apply(localReactRawTextShadowNode.getText(), localTextAttributes.getTextTransform()));
          bool2 = bool1;
        }
      }
      else if ((localReactShadowNodeImpl instanceof ReactBaseTextShadowNode))
      {
        bool2 = buildSpannedFromShadowNode((ReactBaseTextShadowNode)localReactShadowNodeImpl, paramSpannableStringBuilder, paramList, localTextAttributes, paramSpannableStringBuilder.length());
      }
      else
      {
        if (!(localReactShadowNodeImpl instanceof ReactTextInlineImageShadowNode)) {
          break label202;
        }
        paramSpannableStringBuilder.append("I");
        paramList.add(new SetSpanOperation(paramSpannableStringBuilder.length() - 1, paramSpannableStringBuilder.length(), ((ReactTextInlineImageShadowNode)localReactShadowNodeImpl).buildInlineImageSpan()));
        bool2 = bool1;
      }
      localReactShadowNodeImpl.markUpdateSeen();
      i += 1;
      bool1 = bool2;
      continue;
      label202:
      paramReactBaseTextShadowNode = new StringBuilder();
      paramReactBaseTextShadowNode.append("Unexpected view type nested under text node: ");
      paramReactBaseTextShadowNode.append(localReactShadowNodeImpl.getClass());
      throw new IllegalViewOperationException(paramReactBaseTextShadowNode.toString());
    }
    i = paramSpannableStringBuilder.length();
    boolean bool2 = bool1;
    if (i >= paramInt)
    {
      if (mIsColorSet) {
        paramList.add(new SetSpanOperation(paramInt, i, new ReactForegroundColorSpan(mColor)));
      }
      if (mIsBackgroundColorSet) {
        paramList.add(new SetSpanOperation(paramInt, i, new ReactBackgroundColorSpan(mBackgroundColor)));
      }
      if (Build.VERSION.SDK_INT >= 21)
      {
        f = localTextAttributes.getEffectiveLetterSpacing();
        if ((!Float.isNaN(f)) && ((paramTextAttributes == null) || (paramTextAttributes.getEffectiveLetterSpacing() != f))) {
          paramList.add(new SetSpanOperation(paramInt, i, new CustomLetterSpacingSpan(f)));
        }
      }
      j = localTextAttributes.getEffectiveFontSize();
      if ((paramTextAttributes == null) || (paramTextAttributes.getEffectiveFontSize() != j)) {
        paramList.add(new SetSpanOperation(paramInt, i, new ReactAbsoluteSizeSpan(j)));
      }
      if ((mFontStyle != -1) || (mFontWeight != -1) || (mFontFamily != null)) {
        paramList.add(new SetSpanOperation(paramInt, i, new CustomStyleSpan(mFontStyle, mFontWeight, mFontFamily, paramReactBaseTextShadowNode.getThemedContext().getAssets())));
      }
      if (mIsUnderlineTextDecorationSet) {
        paramList.add(new SetSpanOperation(paramInt, i, new ReactUnderlineSpan()));
      }
      if (mIsLineThroughTextDecorationSet) {
        paramList.add(new SetSpanOperation(paramInt, i, new ReactStrikethroughSpan()));
      }
      if (((mTextShadowOffsetDx != 0.0F) || (mTextShadowOffsetDy != 0.0F) || (mTextShadowRadius != 0.0F)) && (Color.alpha(mTextShadowColor) != 0)) {
        paramList.add(new SetSpanOperation(paramInt, i, new ShadowStyleSpan(mTextShadowOffsetDx, mTextShadowOffsetDy, mTextShadowRadius, mTextShadowColor)));
      }
      float f = localTextAttributes.getEffectiveLineHeight();
      bool2 = bool1;
      if (!Float.isNaN(f)) {
        if (paramTextAttributes != null)
        {
          bool2 = bool1;
          if (paramTextAttributes.getEffectiveLineHeight() == f) {}
        }
        else
        {
          paramList.add(new SetSpanOperation(paramInt, i, new CustomLineHeightSpan(f)));
          bool2 = true;
        }
      }
      paramList.add(new SetSpanOperation(paramInt, i, new ReactTagSpan(paramReactBaseTextShadowNode.getReactTag())));
    }
    return bool2;
  }
  
  private int getTextAlign()
  {
    int i = mTextAlign;
    if (getLayoutDirection() == YogaDirection.RIGHT)
    {
      if (i == 5) {
        return 3;
      }
      if (i == 3) {
        return 5;
      }
    }
    return i;
  }
  
  private static int parseNumericFontWeight(String paramString)
  {
    if ((paramString.length() == 3) && (paramString.endsWith("00")) && (paramString.charAt(0) <= '9') && (paramString.charAt(0) >= '1')) {
      return (paramString.charAt(0) - '0') * 100;
    }
    return -1;
  }
  
  protected static Spannable spannedFromShadowNode(ReactBaseTextShadowNode paramReactBaseTextShadowNode, String paramString)
  {
    SpannableStringBuilder localSpannableStringBuilder = new SpannableStringBuilder();
    Object localObject = new ArrayList();
    if (paramString != null) {
      localSpannableStringBuilder.append(TextTransform.apply(paramString, mTextAttributes.getTextTransform()));
    }
    boolean bool = Float.isNaN(mTextAttributes.getLineHeight());
    int j = 0;
    if ((bool) && (mTextAttributes.isUseLineSpacingFromFallbacks())) {
      buildSpannedFromShadowNode(paramReactBaseTextShadowNode, localSpannableStringBuilder, (List)localObject, null, 0);
    } else if ((!buildSpannedFromShadowNode(paramReactBaseTextShadowNode, localSpannableStringBuilder, (List)localObject, null, 0)) && (Build.VERSION.SDK_INT >= 28)) {
      if (Float.isNaN(mTextAttributes.getFontSize()))
      {
        if (mTextAttributes.getAllowFontScaling()) {
          i = (int)Math.ceil(PixelUtil.toPixelFromSP(14.0F));
        } else {
          i = (int)Math.ceil(PixelUtil.toPixelFromDIP(14.0F));
        }
        ((List)localObject).add(new SetSpanOperation(0, localSpannableStringBuilder.length(), new CustomLineHeightSpan(i * 1.15F)));
      }
      else
      {
        ((List)localObject).add(new SetSpanOperation(0, localSpannableStringBuilder.length(), new CustomLineHeightSpan(PixelUtil.toPixelFromSP(mTextAttributes.getFontSize() * 1.15F))));
      }
    }
    mContainsImages = false;
    float f1 = NaN.0F;
    paramString = ((List)localObject).iterator();
    int i = j;
    while (paramString.hasNext())
    {
      localObject = (SetSpanOperation)paramString.next();
      float f2 = f1;
      if ((what instanceof TextInlineImageSpan))
      {
        j = ((TextInlineImageSpan)what).getHeight();
        mContainsImages = true;
        if (!Float.isNaN(f1))
        {
          f2 = f1;
          if (j <= f1) {}
        }
        else
        {
          f2 = j;
        }
      }
      ((SetSpanOperation)localObject).execute(localSpannableStringBuilder, i);
      i += 1;
      f1 = f2;
    }
    mTextAttributes.setHeightOfTallestInlineImage(f1);
    return localSpannableStringBuilder;
  }
  
  public void setAllowFontScaling(boolean paramBoolean)
  {
    if (paramBoolean != mTextAttributes.getAllowFontScaling())
    {
      mTextAttributes.setAllowFontScaling(paramBoolean);
      markUpdated();
    }
  }
  
  public void setBackgroundColor(Integer paramInteger)
  {
    if (!isVirtualAnchor())
    {
      boolean bool;
      if (paramInteger != null) {
        bool = true;
      } else {
        bool = false;
      }
      mIsBackgroundColorSet = bool;
      if (mIsBackgroundColorSet) {
        mBackgroundColor = paramInteger.intValue();
      }
      markUpdated();
    }
  }
  
  public void setColor(Integer paramInteger)
  {
    boolean bool;
    if (paramInteger != null) {
      bool = true;
    } else {
      bool = false;
    }
    mIsColorSet = bool;
    if (mIsColorSet) {
      mColor = paramInteger.intValue();
    }
    markUpdated();
  }
  
  public void setFontFamily(String paramString)
  {
    mFontFamily = paramString;
    markUpdated();
  }
  
  public void setFontSize(float paramFloat)
  {
    mTextAttributes.setFontSize(paramFloat);
    markUpdated();
  }
  
  public void setFontStyle(String paramString)
  {
    int i;
    if ("italic".equals(paramString)) {
      i = 2;
    } else if ("normal".equals(paramString)) {
      i = 0;
    } else {
      i = -1;
    }
    if (i != mFontStyle)
    {
      mFontStyle = i;
      markUpdated();
    }
  }
  
  public void setFontWeight(String paramString)
  {
    int k = -1;
    int j;
    if (paramString != null) {
      j = parseNumericFontWeight(paramString);
    } else {
      j = -1;
    }
    int i;
    if ((j < 500) && (!"bold".equals(paramString)))
    {
      if (!"normal".equals(paramString))
      {
        i = k;
        if (j != -1)
        {
          i = k;
          if (j >= 500) {}
        }
      }
      else
      {
        i = 0;
      }
    }
    else {
      i = 1;
    }
    if (i != mFontWeight)
    {
      mFontWeight = i;
      markUpdated();
    }
  }
  
  public void setIncludeFontPadding(boolean paramBoolean)
  {
    mIncludeFontPadding = paramBoolean;
  }
  
  public void setLetterSpacing(float paramFloat)
  {
    mTextAttributes.setLetterSpacing(paramFloat);
    markUpdated();
  }
  
  public void setLineHeight(float paramFloat)
  {
    mTextAttributes.setLineHeight(paramFloat);
    markUpdated();
  }
  
  public void setMaxFontSizeMultiplier(float paramFloat)
  {
    if (paramFloat != mTextAttributes.getMaxFontSizeMultiplier())
    {
      mTextAttributes.setMaxFontSizeMultiplier(paramFloat);
      markUpdated();
    }
  }
  
  public void setNumberOfLines(int paramInt)
  {
    int i = paramInt;
    if (paramInt == 0) {
      i = -1;
    }
    mNumberOfLines = i;
    markUpdated();
  }
  
  public void setTextAlign(String paramString)
  {
    if ("justify".equals(paramString))
    {
      if (Build.VERSION.SDK_INT >= 26) {
        mJustificationMode = 1;
      }
      mTextAlign = 3;
    }
    else
    {
      if (Build.VERSION.SDK_INT >= 26) {
        mJustificationMode = 0;
      }
      if ((paramString != null) && (!"auto".equals(paramString)))
      {
        if ("left".equals(paramString))
        {
          mTextAlign = 3;
        }
        else if ("right".equals(paramString))
        {
          mTextAlign = 5;
        }
        else if ("center".equals(paramString))
        {
          mTextAlign = 1;
        }
        else
        {
          StringBuilder localStringBuilder = new StringBuilder();
          localStringBuilder.append("Invalid textAlign: ");
          localStringBuilder.append(paramString);
          throw new JSApplicationIllegalArgumentException(localStringBuilder.toString());
        }
      }
      else {
        mTextAlign = 0;
      }
    }
    markUpdated();
  }
  
  public void setTextBreakStrategy(String paramString)
  {
    if (Build.VERSION.SDK_INT < 23) {
      return;
    }
    if ((paramString != null) && (!"highQuality".equals(paramString)))
    {
      if ("simple".equals(paramString))
      {
        mTextBreakStrategy = 0;
      }
      else if ("balanced".equals(paramString))
      {
        mTextBreakStrategy = 2;
      }
      else
      {
        StringBuilder localStringBuilder = new StringBuilder();
        localStringBuilder.append("Invalid textBreakStrategy: ");
        localStringBuilder.append(paramString);
        throw new JSApplicationIllegalArgumentException(localStringBuilder.toString());
      }
    }
    else {
      mTextBreakStrategy = 1;
    }
    markUpdated();
  }
  
  public void setTextDecorationLine(String paramString)
  {
    int i = 0;
    mIsUnderlineTextDecorationSet = false;
    mIsLineThroughTextDecorationSet = false;
    if (paramString != null)
    {
      paramString = paramString.split(" ");
      int j = paramString.length;
      while (i < j)
      {
        Object localObject = paramString[i];
        if ("underline".equals(localObject)) {
          mIsUnderlineTextDecorationSet = true;
        } else if ("line-through".equals(localObject)) {
          mIsLineThroughTextDecorationSet = true;
        }
        i += 1;
      }
    }
    markUpdated();
  }
  
  public void setTextShadowColor(int paramInt)
  {
    if (paramInt != mTextShadowColor)
    {
      mTextShadowColor = paramInt;
      markUpdated();
    }
  }
  
  public void setTextShadowOffset(ReadableMap paramReadableMap)
  {
    mTextShadowOffsetDx = 0.0F;
    mTextShadowOffsetDy = 0.0F;
    if (paramReadableMap != null)
    {
      if ((paramReadableMap.hasKey("width")) && (!paramReadableMap.isNull("width"))) {
        mTextShadowOffsetDx = PixelUtil.toPixelFromDIP(paramReadableMap.getDouble("width"));
      }
      if ((paramReadableMap.hasKey("height")) && (!paramReadableMap.isNull("height"))) {
        mTextShadowOffsetDy = PixelUtil.toPixelFromDIP(paramReadableMap.getDouble("height"));
      }
    }
    markUpdated();
  }
  
  public void setTextShadowRadius(float paramFloat)
  {
    if (paramFloat != mTextShadowRadius)
    {
      mTextShadowRadius = paramFloat;
      markUpdated();
    }
  }
  
  public void setTextTransform(String paramString)
  {
    if (paramString == null)
    {
      mTextAttributes.setTextTransform(TextTransform.UNSET);
    }
    else if ("none".equals(paramString))
    {
      mTextAttributes.setTextTransform(TextTransform.NONE);
    }
    else if ("uppercase".equals(paramString))
    {
      mTextAttributes.setTextTransform(TextTransform.UPPERCASE);
    }
    else if ("lowercase".equals(paramString))
    {
      mTextAttributes.setTextTransform(TextTransform.LOWERCASE);
    }
    else
    {
      if (!"capitalize".equals(paramString)) {
        break label111;
      }
      mTextAttributes.setTextTransform(TextTransform.CAPITALIZE);
    }
    markUpdated();
    return;
    label111:
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append("Invalid textTransform: ");
    localStringBuilder.append(paramString);
    throw new JSApplicationIllegalArgumentException(localStringBuilder.toString());
  }
  
  public void setUseLineSpacingFromFallbacks(boolean paramBoolean)
  {
    if (paramBoolean != mTextAttributes.isUseLineSpacingFromFallbacks())
    {
      mTextAttributes.setUseLineSpacingFromFallbacks(paramBoolean);
      markUpdated();
    }
  }
  
  private static class SetSpanOperation
  {
    protected int end;
    protected int start;
    protected ReactSpan what;
    
    SetSpanOperation(int paramInt1, int paramInt2, ReactSpan paramReactSpan)
    {
      start = paramInt1;
      end = paramInt2;
      what = paramReactSpan;
    }
    
    public void execute(SpannableStringBuilder paramSpannableStringBuilder, int paramInt)
    {
      int i;
      if (start == 0) {
        i = 18;
      } else {
        i = 34;
      }
      paramSpannableStringBuilder.setSpan(what, start, end, paramInt << 16 & 0xFF0000 | i & 0xFF00FFFF);
    }
  }
}
