package com.facebook.react.animated;

import com.facebook.react.bridge.JSApplicationIllegalArgumentException;
import com.facebook.react.bridge.JavaOnlyMap;
import com.facebook.react.bridge.ReadableMap;
import com.facebook.react.bridge.ReadableMapKeySetIterator;
import com.facebook.react.uimanager.ReactStylesDiffMap;
import com.facebook.react.uimanager.UIImplementation;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;

class PropsAnimatedNode
  extends AnimatedNode
{
  private int mConnectedViewTag = -1;
  private final ReactStylesDiffMap mDiffMap;
  private final NativeAnimatedNodesManager mNativeAnimatedNodesManager;
  private final JavaOnlyMap mPropMap;
  private final Map<String, Integer> mPropNodeMapping;
  private final UIImplementation mUIImplementation;
  
  PropsAnimatedNode(ReadableMap paramReadableMap, NativeAnimatedNodesManager paramNativeAnimatedNodesManager, UIImplementation paramUIImplementation)
  {
    paramReadableMap = paramReadableMap.getMap("props");
    ReadableMapKeySetIterator localReadableMapKeySetIterator = paramReadableMap.keySetIterator();
    mPropNodeMapping = new HashMap();
    while (localReadableMapKeySetIterator.hasNextKey())
    {
      String str = localReadableMapKeySetIterator.nextKey();
      int i = paramReadableMap.getInt(str);
      mPropNodeMapping.put(str, Integer.valueOf(i));
    }
    mPropMap = new JavaOnlyMap();
    mDiffMap = new ReactStylesDiffMap(mPropMap);
    mNativeAnimatedNodesManager = paramNativeAnimatedNodesManager;
    mUIImplementation = paramUIImplementation;
  }
  
  public void connectToView(int paramInt)
  {
    if (mConnectedViewTag == -1)
    {
      mConnectedViewTag = paramInt;
      return;
    }
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append("Animated node ");
    localStringBuilder.append(mTag);
    localStringBuilder.append(" is already attached to a view");
    throw new JSApplicationIllegalArgumentException(localStringBuilder.toString());
  }
  
  public void disconnectFromView(int paramInt)
  {
    if (mConnectedViewTag == paramInt)
    {
      mConnectedViewTag = -1;
      return;
    }
    throw new JSApplicationIllegalArgumentException("Attempting to disconnect view that has not been connected with the given animated node");
  }
  
  public void restoreDefaultValues()
  {
    ReadableMapKeySetIterator localReadableMapKeySetIterator = mPropMap.keySetIterator();
    while (localReadableMapKeySetIterator.hasNextKey()) {
      mPropMap.putNull(localReadableMapKeySetIterator.nextKey());
    }
    mUIImplementation.synchronouslyUpdateViewOnUIThread(mConnectedViewTag, mDiffMap);
  }
  
  public final void updateView()
  {
    if (mConnectedViewTag == -1) {
      return;
    }
    Object localObject = mPropNodeMapping.entrySet().iterator();
    while (((Iterator)localObject).hasNext())
    {
      Map.Entry localEntry = (Map.Entry)((Iterator)localObject).next();
      AnimatedNode localAnimatedNode = mNativeAnimatedNodesManager.getNodeById(((Integer)localEntry.getValue()).intValue());
      if (localAnimatedNode != null)
      {
        if ((localAnimatedNode instanceof StyleAnimatedNode))
        {
          ((StyleAnimatedNode)localAnimatedNode).collectViewUpdates(mPropMap);
        }
        else if ((localAnimatedNode instanceof ValueAnimatedNode))
        {
          mPropMap.putDouble((String)localEntry.getKey(), ((ValueAnimatedNode)localAnimatedNode).getValue());
        }
        else
        {
          localObject = new StringBuilder();
          ((StringBuilder)localObject).append("Unsupported type of node used in property node ");
          ((StringBuilder)localObject).append(localAnimatedNode.getClass());
          throw new IllegalArgumentException(((StringBuilder)localObject).toString());
        }
      }
      else {
        throw new IllegalArgumentException("Mapped property node does not exists");
      }
    }
    mUIImplementation.synchronouslyUpdateViewOnUIThread(mConnectedViewTag, mDiffMap);
  }
}
