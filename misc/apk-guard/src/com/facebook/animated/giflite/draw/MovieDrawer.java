package com.facebook.animated.giflite.draw;

import android.graphics.Bitmap;
import android.graphics.Canvas;
import android.graphics.Movie;
import javax.annotation.Nullable;

public class MovieDrawer
{
  private final Canvas mCanvas;
  private final Movie mMovie;
  @Nullable
  private Bitmap mPreviousBitmap;
  private final MovieScaleHolder mScaleHolder;
  
  public MovieDrawer(Movie paramMovie)
  {
    mMovie = paramMovie;
    mScaleHolder = new MovieScaleHolder(paramMovie.width(), paramMovie.height());
    mCanvas = new Canvas();
  }
  
  public void drawFrame(int paramInt1, int paramInt2, int paramInt3, Bitmap paramBitmap)
  {
    try
    {
      mMovie.setTime(paramInt1);
      if ((mPreviousBitmap != null) && (mPreviousBitmap.isRecycled())) {
        mPreviousBitmap = null;
      }
      if (mPreviousBitmap != paramBitmap)
      {
        mPreviousBitmap = paramBitmap;
        mCanvas.setBitmap(paramBitmap);
      }
      mScaleHolder.updateViewPort(paramInt2, paramInt3);
      mCanvas.save();
      mCanvas.scale(mScaleHolder.getScale(), mScaleHolder.getScale());
      mMovie.draw(mCanvas, mScaleHolder.getLeft(), mScaleHolder.getTop());
      mCanvas.restore();
      return;
    }
    catch (Throwable paramBitmap)
    {
      throw paramBitmap;
    }
  }
}
