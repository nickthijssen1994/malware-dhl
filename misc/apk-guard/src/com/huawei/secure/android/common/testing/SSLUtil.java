package com.huawei.secure.android.common.testing;

import android.os.Build.VERSION;
import com.huawei.secure.android.common.testing.util.Log;
import java.security.NoSuchAlgorithmException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Locale;
import javax.net.ssl.SSLContext;
import javax.net.ssl.SSLSocket;

public abstract class SSLUtil
{
  private static final String ACTION_UPDATE_ALL = "TLSv1.3";
  private static final String PAGE_KEY = "SSLUtil";
  private static final String PROTOCOL_TLSv1_0 = "TLSv1";
  private static final String PROTOCOL_TLSv1_2 = "TLSv1.2";
  private static final String TLS = "TLS";
  private static final String[] c = { "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256", "TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384", "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256", "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384", "TLS_DHE_RSA_WITH_AES_128_GCM_SHA256", "TLS_DHE_RSA_WITH_AES_256_GCM_SHA384", "TLS_DHE_DSS_WITH_AES_128_GCM_SHA256", "TLS_DHE_DSS_WITH_AES_256_GCM_SHA384" };
  private static final String[] line = { "TLS_RSA", "CBC", "TEA", "SHA0", "MD2", "MD4", "RIPEMD", "NULL", "RC4", "DES", "DESX", "DES40", "RC2", "MD5", "ANON", "TLS_EMPTY_RENEGOTIATION_INFO_SCSV" };
  private static final String[] s = { "TLS_DHE_DSS_WITH_AES_128_CBC_SHA", "TLS_DHE_RSA_WITH_AES_128_CBC_SHA", "TLS_DHE_DSS_WITH_AES_256_CBC_SHA", "TLS_DHE_RSA_WITH_AES_256_CBC_SHA", "TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA", "TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA", "TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA", "TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA" };
  
  public SSLUtil() {}
  
  public static String[] getEnabledCipherSuites(SSLSocket paramSSLSocket)
  {
    return paramSSLSocket.getEnabledCipherSuites();
  }
  
  public static String[] getEnabledProtocols(SSLSocket paramSSLSocket)
  {
    return paramSSLSocket.getEnabledProtocols();
  }
  
  public static void printTLSAndCipher(SSLSocket paramSSLSocket)
  {
    String[] arrayOfString = paramSSLSocket.getEnabledProtocols();
    int k = arrayOfString.length;
    int j = 0;
    int i = 0;
    Object localObject;
    while (i < k)
    {
      localObject = arrayOfString[i];
      StringBuilder localStringBuilder = new StringBuilder();
      localStringBuilder.append("new enable protocols is : ");
      localStringBuilder.append((String)localObject);
      Log.append("SSLUtil", localStringBuilder.toString());
      i += 1;
    }
    paramSSLSocket = paramSSLSocket.getEnabledCipherSuites();
    k = paramSSLSocket.length;
    i = j;
    while (i < k)
    {
      arrayOfString = paramSSLSocket[i];
      localObject = new StringBuilder();
      ((StringBuilder)localObject).append("new cipher suites is : ");
      ((StringBuilder)localObject).append(arrayOfString);
      Log.append("SSLUtil", ((StringBuilder)localObject).toString());
      i += 1;
    }
  }
  
  public static boolean setBlackListCipherSuites(SSLSocket paramSSLSocket)
  {
    if (paramSSLSocket == null) {
      return false;
    }
    return setBlackListCipherSuites(paramSSLSocket, line);
  }
  
  public static boolean setBlackListCipherSuites(SSLSocket paramSSLSocket, String[] paramArrayOfString)
  {
    if (paramSSLSocket == null) {
      return false;
    }
    String[] arrayOfString = paramSSLSocket.getEnabledCipherSuites();
    ArrayList localArrayList = new ArrayList();
    int m = arrayOfString.length;
    int i = 0;
    for (;;)
    {
      int k = 1;
      if (i >= m) {
        break;
      }
      String str1 = arrayOfString[i];
      String str2 = str1.toUpperCase(Locale.ENGLISH);
      int n = paramArrayOfString.length;
      int j = 0;
      while (j < n)
      {
        if (str2.contains(paramArrayOfString[j].toUpperCase(Locale.ENGLISH)))
        {
          j = k;
          break label97;
        }
        j += 1;
      }
      j = 0;
      label97:
      if (j == 0) {
        localArrayList.add(str1);
      }
      i += 1;
    }
    if (!localArrayList.isEmpty())
    {
      paramSSLSocket.setEnabledCipherSuites((String[])localArrayList.toArray(new String[localArrayList.size()]));
      return true;
    }
    return false;
  }
  
  public static void setEnableSafeCipherSuites(SSLSocket paramSSLSocket)
  {
    if (paramSSLSocket == null) {
      return;
    }
    if (!setWhiteListCipherSuites(paramSSLSocket)) {
      setBlackListCipherSuites(paramSSLSocket);
    }
  }
  
  public static void setEnabledProtocols(SSLSocket paramSSLSocket)
  {
    if (paramSSLSocket == null) {
      return;
    }
    if (Build.VERSION.SDK_INT >= 29) {
      paramSSLSocket.setEnabledProtocols(new String[] { "TLSv1.3", "TLSv1.2" });
    }
    if ((Build.VERSION.SDK_INT >= 16) && (Build.VERSION.SDK_INT < 29))
    {
      paramSSLSocket.setEnabledProtocols(new String[] { "TLSv1.2" });
      return;
    }
    if (Build.VERSION.SDK_INT < 16) {
      paramSSLSocket.setEnabledProtocols(new String[] { "TLSv1" });
    }
  }
  
  public static boolean setEnabledProtocols(SSLSocket paramSSLSocket, String[] paramArrayOfString)
  {
    if (paramSSLSocket != null)
    {
      if (paramArrayOfString == null) {
        return false;
      }
      try
      {
        paramSSLSocket.setEnabledProtocols(paramArrayOfString);
        return true;
      }
      catch (Exception paramSSLSocket)
      {
        paramArrayOfString = new StringBuilder();
        paramArrayOfString.append("setEnabledProtocols: exception : ");
        paramArrayOfString.append(paramSSLSocket.getMessage());
        Log.e("SSLUtil", paramArrayOfString.toString());
      }
    }
    return false;
  }
  
  public static SSLContext setSSLContext()
    throws NoSuchAlgorithmException
  {
    if (Build.VERSION.SDK_INT >= 29) {
      return SSLContext.getInstance("TLSv1.3");
    }
    if (Build.VERSION.SDK_INT >= 16) {
      return SSLContext.getInstance("TLSv1.2");
    }
    return SSLContext.getInstance("TLS");
  }
  
  public static void setSSLSocketOptions(SSLSocket paramSSLSocket)
  {
    if (paramSSLSocket == null) {
      return;
    }
    setEnabledProtocols(paramSSLSocket);
    setEnableSafeCipherSuites(paramSSLSocket);
  }
  
  public static boolean setWhiteListCipherSuites(SSLSocket paramSSLSocket)
  {
    if (paramSSLSocket == null) {
      return false;
    }
    if (Build.VERSION.SDK_INT > 19) {
      return setWhiteListCipherSuites(paramSSLSocket, c);
    }
    return setWhiteListCipherSuites(paramSSLSocket, s);
  }
  
  public static boolean setWhiteListCipherSuites(SSLSocket paramSSLSocket, String[] paramArrayOfString)
  {
    if (paramSSLSocket == null) {
      return false;
    }
    String[] arrayOfString = paramSSLSocket.getEnabledCipherSuites();
    ArrayList localArrayList = new ArrayList();
    paramArrayOfString = Arrays.asList(paramArrayOfString);
    int j = arrayOfString.length;
    int i = 0;
    while (i < j)
    {
      String str = arrayOfString[i];
      if (paramArrayOfString.contains(str.toUpperCase(Locale.ENGLISH))) {
        localArrayList.add(str);
      }
      i += 1;
    }
    if (!localArrayList.isEmpty())
    {
      paramSSLSocket.setEnabledCipherSuites((String[])localArrayList.toArray(new String[localArrayList.size()]));
      return true;
    }
    return false;
  }
}
