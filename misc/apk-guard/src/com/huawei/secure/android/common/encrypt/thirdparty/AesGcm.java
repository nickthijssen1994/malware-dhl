package com.huawei.secure.android.common.encrypt.thirdparty;

import android.os.Build.VERSION;
import android.text.TextUtils;
import com.huawei.secure.android.common.encrypt.utils.EncryptUtil;
import com.huawei.secure.android.common.encrypt.utils.HexUtil;
import java.io.UnsupportedEncodingException;
import java.security.GeneralSecurityException;
import java.security.spec.AlgorithmParameterSpec;
import java.util.Arrays;
import javax.crypto.Cipher;
import javax.crypto.spec.GCMParameterSpec;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;

public final class AesGcm
{
  private static final String CIPHER = "AES";
  private static final int CONTEXT_MENU_DELETE_ID = 16;
  private static final String NULL_LABEL = "";
  private static final String PAGE_KEY = "security:";
  private static final int SELECT_FOLDER = 12;
  private static final String SQL_UPDATE_6_4 = "AES/GCM/NoPadding";
  private static final int TYPE_DIALOG = 2;
  private static final String seed = "AesGcm";
  
  private AesGcm() {}
  
  private static byte[] decodeBase64(byte[] paramArrayOfByte)
  {
    byte[] arrayOfByte = new byte[12];
    System.arraycopy(paramArrayOfByte, 0, arrayOfByte, 0, 12);
    return arrayOfByte;
  }
  
  private static String decrypt(String paramString)
  {
    if ((!TextUtils.isEmpty(paramString)) && (paramString.length() >= 24)) {
      return paramString.substring(0, 24);
    }
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(seed, "IV is invalid.");
    return "";
  }
  
  public static String decrypt(String paramString1, String paramString2)
  {
    if ((!TextUtils.isEmpty(paramString1)) && (!TextUtils.isEmpty(paramString2)) && (isBuildVersionHigherThan19()))
    {
      paramString2 = HexUtil.hexStr2ByteArray(paramString2);
      if (paramString2.length < 16)
      {
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(seed, "key length is not right");
        return "";
      }
      return decrypt(paramString1, paramString2);
    }
    return "";
  }
  
  public static String decrypt(String paramString1, String paramString2, String paramString3)
  {
    if ((!TextUtils.isEmpty(paramString1)) && (!TextUtils.isEmpty(paramString2)) && (!TextUtils.isEmpty(paramString3)) && (isBuildVersionHigherThan19()))
    {
      paramString2 = HexUtil.hexStr2ByteArray(paramString2);
      paramString3 = HexUtil.hexStr2ByteArray(paramString3);
      if ((paramString2.length >= 16) && (paramString3.length >= 12)) {
        return decrypt(paramString1, paramString2, paramString3);
      }
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(seed, "key length or iv length is not right");
      return "";
    }
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(seed, "gcm decrypt param is not right");
    return "";
  }
  
  public static String decrypt(String paramString, byte[] paramArrayOfByte)
  {
    if ((!TextUtils.isEmpty(paramString)) && (paramArrayOfByte != null) && (paramArrayOfByte.length >= 16) && (isBuildVersionHigherThan19()))
    {
      try
      {
        paramArrayOfByte = new SecretKeySpec(paramArrayOfByte, "AES");
        localObject = Cipher.getInstance("AES/GCM/NoPadding");
        String str = decrypt(paramString);
        paramString = getContent(paramString);
        boolean bool = TextUtils.isEmpty(str);
        if (!bool)
        {
          bool = TextUtils.isEmpty(paramString);
          if (!bool)
          {
            ((Cipher)localObject).init(2, paramArrayOfByte, getGcmAlgorithmParams(HexUtil.hexStr2ByteArray(str)));
            paramString = ((Cipher)localObject).doFinal(HexUtil.hexStr2ByteArray(paramString));
            paramString = new String(paramString, "UTF-8");
            return paramString;
          }
        }
        paramString = seed;
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramString, "ivParameter or encrypedWord is null");
        return "";
      }
      catch (UnsupportedEncodingException paramString) {}catch (GeneralSecurityException paramString) {}
      paramArrayOfByte = seed;
      Object localObject = new StringBuilder();
      ((StringBuilder)localObject).append("GCM decrypt data exception: ");
      ((StringBuilder)localObject).append(((Exception)paramString).getMessage());
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramArrayOfByte, ((StringBuilder)localObject).toString());
      return "";
    }
    return "";
  }
  
  public static String decrypt(String paramString, byte[] paramArrayOfByte1, byte[] paramArrayOfByte2)
  {
    if ((!TextUtils.isEmpty(paramString)) && (paramArrayOfByte1 != null) && (paramArrayOfByte1.length >= 16) && (paramArrayOfByte2 != null) && (paramArrayOfByte2.length >= 12) && (isBuildVersionHigherThan19())) {
      try
      {
        paramString = decrypt(HexUtil.hexStr2ByteArray(paramString), paramArrayOfByte1, paramArrayOfByte2);
        paramString = new String(paramString, "UTF-8");
        return paramString;
      }
      catch (UnsupportedEncodingException paramString)
      {
        paramArrayOfByte1 = seed;
        paramArrayOfByte2 = new StringBuilder();
        paramArrayOfByte2.append("GCM decrypt data exception: ");
        paramArrayOfByte2.append(paramString.getMessage());
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramArrayOfByte1, paramArrayOfByte2.toString());
        return "";
      }
    }
    return "";
  }
  
  private static byte[] decrypt(byte[] paramArrayOfByte)
  {
    byte[] arrayOfByte = new byte[paramArrayOfByte.length - 12];
    System.arraycopy(paramArrayOfByte, 12, arrayOfByte, 0, paramArrayOfByte.length - 12);
    return arrayOfByte;
  }
  
  public static byte[] decrypt(byte[] paramArrayOfByte1, byte[] paramArrayOfByte2)
  {
    byte[] arrayOfByte = decodeBase64(paramArrayOfByte1);
    return decrypt(decrypt(paramArrayOfByte1), paramArrayOfByte2, arrayOfByte);
  }
  
  public static byte[] decrypt(byte[] paramArrayOfByte1, byte[] paramArrayOfByte2, byte[] paramArrayOfByte3)
  {
    if ((paramArrayOfByte1 != null) && (paramArrayOfByte1.length != 0) && (paramArrayOfByte2 != null) && (paramArrayOfByte2.length >= 16) && (isBuildVersionHigherThan19())) {
      try
      {
        paramArrayOfByte2 = new SecretKeySpec(paramArrayOfByte2, "AES");
        Cipher localCipher = Cipher.getInstance("AES/GCM/NoPadding");
        localCipher.init(2, paramArrayOfByte2, getGcmAlgorithmParams(paramArrayOfByte3));
        paramArrayOfByte1 = localCipher.doFinal(paramArrayOfByte1);
        return paramArrayOfByte1;
      }
      catch (GeneralSecurityException paramArrayOfByte1)
      {
        paramArrayOfByte2 = seed;
        paramArrayOfByte3 = new StringBuilder();
        paramArrayOfByte3.append("GCM decrypt data exception: ");
        paramArrayOfByte3.append(paramArrayOfByte1.getMessage());
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramArrayOfByte2, paramArrayOfByte3.toString());
        return new byte[0];
      }
    }
    return new byte[0];
  }
  
  public static String decryptWithCryptHead(String paramString, byte[] paramArrayOfByte)
  {
    if ((!TextUtils.isEmpty(paramString)) && (paramArrayOfByte != null) && (paramArrayOfByte.length >= 16))
    {
      paramString = AesCbc.buildUrl(paramString);
      if ("".equals(paramString)) {
        return "";
      }
      int i = paramString.indexOf(':');
      if (i >= 0)
      {
        byte[] arrayOfByte = HexUtil.hexStr2ByteArray(paramString.substring(0, i));
        return decrypt(HexUtil.byteArray2HexStr(HexUtil.hexStr2ByteArray(paramString.substring(i + 1))), paramArrayOfByte, arrayOfByte);
      }
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(seed, " gcm cipherText data missing colon");
      return "";
    }
    return "";
  }
  
  public static String decryptWithCryptHead(byte[] paramArrayOfByte1, byte[] paramArrayOfByte2)
  {
    try
    {
      paramArrayOfByte1 = new String(decryptWithCryptHeadReturnByte(paramArrayOfByte1, paramArrayOfByte2), "UTF-8");
      return paramArrayOfByte1;
    }
    catch (UnsupportedEncodingException paramArrayOfByte1)
    {
      for (;;) {}
    }
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(seed, "UnsupportedEncodingException");
    return "";
  }
  
  public static byte[] decryptWithCryptHeadReturnByte(byte[] paramArrayOfByte1, byte[] paramArrayOfByte2)
  {
    if ((paramArrayOfByte1 != null) && (paramArrayOfByte2 != null) && (paramArrayOfByte2.length >= 16))
    {
      paramArrayOfByte1 = AesCbc.get(paramArrayOfByte1);
      if (paramArrayOfByte1.length == 0) {
        return new byte[0];
      }
      int i = get(paramArrayOfByte1);
      if (i >= 0)
      {
        byte[] arrayOfByte1 = Arrays.copyOf(paramArrayOfByte1, i);
        int j = paramArrayOfByte1.length - arrayOfByte1.length - 1;
        byte[] arrayOfByte2 = new byte[j];
        System.arraycopy(paramArrayOfByte1, i + 1, arrayOfByte2, 0, j);
        return decrypt(arrayOfByte2, paramArrayOfByte2, arrayOfByte1);
      }
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(seed, " gcm cipherText data missing colon");
      return new byte[0];
    }
    return new byte[0];
  }
  
  public static String encrypt(String paramString1, String paramString2)
  {
    if ((!TextUtils.isEmpty(paramString1)) && (!TextUtils.isEmpty(paramString2)) && (isBuildVersionHigherThan19()))
    {
      paramString2 = HexUtil.hexStr2ByteArray(paramString2);
      if (paramString2.length < 16)
      {
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(seed, "key length is not right");
        return "";
      }
      return encrypt(paramString1, paramString2);
    }
    return "";
  }
  
  public static String encrypt(String paramString1, String paramString2, String paramString3)
  {
    if ((!TextUtils.isEmpty(paramString1)) && (!TextUtils.isEmpty(paramString2)) && (!TextUtils.isEmpty(paramString3)) && (isBuildVersionHigherThan19()))
    {
      paramString2 = HexUtil.hexStr2ByteArray(paramString2);
      byte[] arrayOfByte = HexUtil.hexStr2ByteArray(paramString3);
      if ((paramString2.length >= 16) && (paramString3.length() >= 12)) {
        return encrypt(paramString1, paramString2, arrayOfByte);
      }
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(seed, "key length or iv length is not right");
      return "";
    }
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(seed, "gcm encrypt parameter is not right");
    return "";
  }
  
  public static String encrypt(String paramString, byte[] paramArrayOfByte)
  {
    if ((!TextUtils.isEmpty(paramString)) && (paramArrayOfByte != null) && (paramArrayOfByte.length >= 16) && (isBuildVersionHigherThan19()))
    {
      Object localObject = EncryptUtil.generateSecureRandom(12);
      paramArrayOfByte = hash(paramString, paramArrayOfByte, (byte[])localObject);
      if ((paramArrayOfByte != null) && (paramArrayOfByte.length != 0))
      {
        paramString = HexUtil.byteArray2HexStr((byte[])localObject);
        paramArrayOfByte = HexUtil.byteArray2HexStr(paramArrayOfByte);
        localObject = new StringBuilder();
        ((StringBuilder)localObject).append(paramString);
        ((StringBuilder)localObject).append(paramArrayOfByte);
        return ((StringBuilder)localObject).toString();
      }
      return "";
    }
    return "";
  }
  
  public static String encrypt(String paramString, byte[] paramArrayOfByte1, byte[] paramArrayOfByte2)
  {
    if ((!TextUtils.isEmpty(paramString)) && (paramArrayOfByte1 != null) && (paramArrayOfByte1.length >= 16) && (paramArrayOfByte2 != null) && (paramArrayOfByte2.length >= 12) && (isBuildVersionHigherThan19())) {
      return HexUtil.byteArray2HexStr(hash(paramString, paramArrayOfByte1, paramArrayOfByte2));
    }
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(seed, "gcm encrypt param is not right");
    return "";
  }
  
  public static byte[] encrypt(byte[] paramArrayOfByte1, byte[] paramArrayOfByte2)
  {
    byte[] arrayOfByte = EncryptUtil.generateSecureRandom(12);
    return toBase64(arrayOfByte, encrypt(paramArrayOfByte1, paramArrayOfByte2, arrayOfByte));
  }
  
  public static byte[] encrypt(byte[] paramArrayOfByte1, byte[] paramArrayOfByte2, byte[] paramArrayOfByte3)
  {
    if ((paramArrayOfByte1 != null) && (paramArrayOfByte1.length != 0) && (paramArrayOfByte2 != null) && (paramArrayOfByte2.length >= 16) && (paramArrayOfByte3 != null) && (paramArrayOfByte3.length >= 12) && (isBuildVersionHigherThan19())) {
      try
      {
        paramArrayOfByte2 = new SecretKeySpec(paramArrayOfByte2, "AES");
        Cipher localCipher = Cipher.getInstance("AES/GCM/NoPadding");
        localCipher.init(1, paramArrayOfByte2, getGcmAlgorithmParams(paramArrayOfByte3));
        paramArrayOfByte1 = localCipher.doFinal(paramArrayOfByte1);
        return paramArrayOfByte1;
      }
      catch (GeneralSecurityException paramArrayOfByte1)
      {
        paramArrayOfByte2 = seed;
        paramArrayOfByte3 = new StringBuilder();
        paramArrayOfByte3.append("GCM encrypt data error");
        paramArrayOfByte3.append(paramArrayOfByte1.getMessage());
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramArrayOfByte2, paramArrayOfByte3.toString());
        return new byte[0];
      }
    }
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(seed, "gcm encrypt param is not right");
    return new byte[0];
  }
  
  private static int get(byte[] paramArrayOfByte)
  {
    if (paramArrayOfByte[12] == 58) {
      return 12;
    }
    return -1;
  }
  
  private static String getContent(String paramString)
  {
    if ((!TextUtils.isEmpty(paramString)) && (paramString.length() >= 24)) {
      return paramString.substring(24);
    }
    return "";
  }
  
  public static AlgorithmParameterSpec getGcmAlgorithmParams(byte[] paramArrayOfByte)
  {
    if (Build.VERSION.SDK_INT < 21) {
      return new IvParameterSpec(paramArrayOfByte);
    }
    return new GCMParameterSpec(128, paramArrayOfByte);
  }
  
  private static byte[] hash(String paramString, byte[] paramArrayOfByte1, byte[] paramArrayOfByte2)
  {
    if ((!TextUtils.isEmpty(paramString)) && (paramArrayOfByte1 != null) && (paramArrayOfByte1.length >= 16) && (paramArrayOfByte2 != null) && (paramArrayOfByte2.length >= 12) && (isBuildVersionHigherThan19())) {
      try
      {
        paramString = encrypt(paramString.getBytes("UTF-8"), paramArrayOfByte1, paramArrayOfByte2);
        return paramString;
      }
      catch (UnsupportedEncodingException paramString)
      {
        paramArrayOfByte1 = seed;
        paramArrayOfByte2 = new StringBuilder();
        paramArrayOfByte2.append("GCM encrypt data error");
        paramArrayOfByte2.append(paramString.getMessage());
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramArrayOfByte1, paramArrayOfByte2.toString());
        return new byte[0];
      }
    }
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(seed, "gcm encrypt param is not right");
    return new byte[0];
  }
  
  public static boolean isBuildVersionHigherThan19()
  {
    return Build.VERSION.SDK_INT >= 19;
  }
  
  private static byte[] toBase64(byte[] paramArrayOfByte1, byte[] paramArrayOfByte2)
  {
    byte[] arrayOfByte = new byte[paramArrayOfByte1.length + paramArrayOfByte2.length];
    System.arraycopy(paramArrayOfByte1, 0, arrayOfByte, 0, paramArrayOfByte1.length);
    System.arraycopy(paramArrayOfByte2, 0, arrayOfByte, paramArrayOfByte1.length, paramArrayOfByte2.length);
    return arrayOfByte;
  }
}
