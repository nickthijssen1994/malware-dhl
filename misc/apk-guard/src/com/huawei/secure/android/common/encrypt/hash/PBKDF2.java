package com.huawei.secure.android.common.encrypt.hash;

import android.os.Build.VERSION;
import android.text.TextUtils;
import com.huawei.secure.android.common.encrypt.utils.EncryptUtil;
import com.huawei.secure.android.common.encrypt.utils.HexUtil;
import java.security.GeneralSecurityException;
import java.security.NoSuchAlgorithmException;
import java.security.spec.InvalidKeySpecException;
import javax.crypto.SecretKey;
import javax.crypto.SecretKeyFactory;
import javax.crypto.spec.PBEKeySpec;

public abstract class PBKDF2
{
  private static final String CONDITIONS_NUMBER = "PBKDF2WithHmacSHA1";
  private static final String EVENTLOG_URL = "PBKDF2WithHmacSHA256";
  private static final int FORMAT_ISO_8859_7 = 8;
  private static final String RANGE_STARTS = "";
  private static final int TAG_AUDIO = 32;
  private static final int TRANSITION_TIME = 1000;
  private static final int UNKNOWN_INT = 10000;
  private static final String name = "PBKDF2";
  private static final int x = 16;
  
  public PBKDF2() {}
  
  private static boolean encode(byte[] paramArrayOfByte1, byte[] paramArrayOfByte2)
  {
    if (paramArrayOfByte1 != null)
    {
      if (paramArrayOfByte2 == null) {
        return false;
      }
      int j = paramArrayOfByte1.length ^ paramArrayOfByte2.length;
      int i = 0;
      while ((i < paramArrayOfByte1.length) && (i < paramArrayOfByte2.length))
      {
        j |= paramArrayOfByte1[i] ^ paramArrayOfByte2[i];
        i += 1;
      }
      if (j == 0) {
        return true;
      }
    }
    return false;
  }
  
  private static byte[] getKey(char[] paramArrayOfChar, byte[] paramArrayOfByte, int paramInt1, int paramInt2, boolean paramBoolean)
  {
    try
    {
      paramArrayOfByte = new PBEKeySpec(paramArrayOfChar, paramArrayOfByte, paramInt1, paramInt2);
      if (paramBoolean) {
        paramArrayOfChar = SecretKeyFactory.getInstance("PBKDF2WithHmacSHA256");
      } else {
        paramArrayOfChar = SecretKeyFactory.getInstance("PBKDF2WithHmacSHA1");
      }
      paramArrayOfChar = paramArrayOfChar.generateSecret(paramArrayOfByte).getEncoded();
      return paramArrayOfChar;
    }
    catch (InvalidKeySpecException paramArrayOfChar) {}catch (NoSuchAlgorithmException paramArrayOfChar) {}
    paramArrayOfByte = name;
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append("pbkdf exception : ");
    localStringBuilder.append(((GeneralSecurityException)paramArrayOfChar).getMessage());
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramArrayOfByte, localStringBuilder.toString());
    return new byte[0];
  }
  
  public static byte[] pbkdf2(char[] paramArrayOfChar, byte[] paramArrayOfByte, int paramInt1, int paramInt2)
  {
    return getKey(paramArrayOfChar, paramArrayOfByte, paramInt1, paramInt2, false);
  }
  
  public static String pbkdf2Encrypt(String paramString)
  {
    return pbkdf2Encrypt(paramString, 10000);
  }
  
  public static String pbkdf2Encrypt(String paramString, int paramInt)
  {
    return pbkdf2Encrypt(paramString, EncryptUtil.generateSecureRandom(8), paramInt, 32);
  }
  
  public static String pbkdf2Encrypt(String paramString, byte[] paramArrayOfByte, int paramInt1, int paramInt2)
  {
    if (TextUtils.isEmpty(paramString))
    {
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(name, "pwd is null.");
      return "";
    }
    if (paramInt1 < 1000)
    {
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(name, "iterations times is not enough.");
      return "";
    }
    if ((paramArrayOfByte != null) && (paramArrayOfByte.length >= 8))
    {
      if (paramInt2 < 32)
      {
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(name, "cipherLen length is not enough");
        return "";
      }
      paramString = pbkdf2(paramString.toCharArray(), paramArrayOfByte, paramInt1, paramInt2 * 8);
      StringBuilder localStringBuilder = new StringBuilder();
      localStringBuilder.append(HexUtil.byteArray2HexStr(paramArrayOfByte));
      localStringBuilder.append(HexUtil.byteArray2HexStr(paramString));
      return localStringBuilder.toString();
    }
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(name, "salt parameter is null or length is not enough");
    return "";
  }
  
  public static String pbkdf2EncryptNew(String paramString)
  {
    return pbkdf2EncryptNew(paramString, 10000);
  }
  
  public static String pbkdf2EncryptNew(String paramString, int paramInt)
  {
    return pbkdf2EncryptNew(paramString, EncryptUtil.generateSecureRandom(16), paramInt, 32);
  }
  
  public static String pbkdf2EncryptNew(String paramString, byte[] paramArrayOfByte, int paramInt1, int paramInt2)
  {
    if (TextUtils.isEmpty(paramString))
    {
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(name, "pwd is null.");
      return "";
    }
    if (paramInt1 < 1000)
    {
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(name, "iterations times is not enough.");
      return "";
    }
    if ((paramArrayOfByte != null) && (paramArrayOfByte.length >= 16))
    {
      if (paramInt2 < 32)
      {
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(name, "cipherLen length is not enough");
        return "";
      }
      if (Build.VERSION.SDK_INT < 26)
      {
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.i(name, "sha 1");
        paramString = pbkdf2(paramString.toCharArray(), paramArrayOfByte, paramInt1, paramInt2 * 8);
      }
      else
      {
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.i(name, "sha 256");
        paramString = pbkdf2SHA256(paramString.toCharArray(), paramArrayOfByte, paramInt1, paramInt2 * 8);
      }
      StringBuilder localStringBuilder = new StringBuilder();
      localStringBuilder.append(HexUtil.byteArray2HexStr(paramArrayOfByte));
      localStringBuilder.append(HexUtil.byteArray2HexStr(paramString));
      return localStringBuilder.toString();
    }
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(name, "salt parameter is null or length is not enough");
    return "";
  }
  
  public static byte[] pbkdf2SHA256(char[] paramArrayOfChar, byte[] paramArrayOfByte, int paramInt1, int paramInt2)
  {
    if (Build.VERSION.SDK_INT < 26)
    {
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(name, "system version not high than 26");
      return new byte[0];
    }
    return getKey(paramArrayOfChar, paramArrayOfByte, paramInt1, paramInt2, true);
  }
  
  public static boolean validatePassword(String paramString1, String paramString2)
  {
    return validatePassword(paramString1, paramString2, 10000);
  }
  
  public static boolean validatePassword(String paramString1, String paramString2, int paramInt)
  {
    if ((!TextUtils.isEmpty(paramString1)) && (!TextUtils.isEmpty(paramString2)))
    {
      if (paramString2.length() < 16) {
        return false;
      }
      String str = paramString2.substring(0, 16);
      paramString2 = paramString2.substring(16);
      return encode(pbkdf2(paramString1.toCharArray(), HexUtil.hexStr2ByteArray(str), paramInt, 256), HexUtil.hexStr2ByteArray(paramString2));
    }
    return false;
  }
  
  public static boolean validatePasswordNew(String paramString1, String paramString2)
  {
    return validatePasswordNew(paramString1, paramString2, 10000);
  }
  
  public static boolean validatePasswordNew(String paramString1, String paramString2, int paramInt)
  {
    if ((!TextUtils.isEmpty(paramString1)) && (!TextUtils.isEmpty(paramString2)))
    {
      if (paramString2.length() < 32) {
        return false;
      }
      String str = paramString2.substring(0, 32);
      paramString2 = paramString2.substring(32);
      if (Build.VERSION.SDK_INT < 26) {
        paramString1 = pbkdf2(paramString1.toCharArray(), HexUtil.hexStr2ByteArray(str), paramInt, 256);
      } else {
        paramString1 = pbkdf2SHA256(paramString1.toCharArray(), HexUtil.hexStr2ByteArray(str), paramInt, 256);
      }
      return encode(paramString1, HexUtil.hexStr2ByteArray(paramString2));
    }
    return false;
  }
}
