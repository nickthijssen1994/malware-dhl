package com.huawei.secure.android.common.webview;

import android.net.Uri;
import android.text.TextUtils;
import android.util.Log;
import android.webkit.URLUtil;
import com.huawei.secure.android.common.util.LogsUtil;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.List;

public class UriUtil
{
  private static final String FRAGMENT = "UriUtil";
  
  public UriUtil() {}
  
  private static String getDomain(String paramString)
  {
    if (TextUtils.isEmpty(paramString))
    {
      LogsUtil.init("UriUtil", "whiteListUrl is null");
      return null;
    }
    if (!URLUtil.isNetworkUrl(paramString)) {
      return paramString;
    }
    return getHostByURI(paramString);
  }
  
  public static String getHostByURI(String paramString)
  {
    if (TextUtils.isEmpty(paramString))
    {
      LogsUtil.init("UriUtil", "url is null");
      return paramString;
    }
    try
    {
      boolean bool = URLUtil.isNetworkUrl(paramString);
      if (!bool)
      {
        LogsUtil.a("UriUtil", "url don't starts with http or https");
        return "";
      }
      paramString = paramString.replaceAll("[\\\\#]", "/");
      paramString = new URL(paramString).getHost();
      return paramString;
    }
    catch (MalformedURLException paramString)
    {
      StringBuilder localStringBuilder = new StringBuilder();
      localStringBuilder.append("getHostByURI error  MalformedURLException : ");
      localStringBuilder.append(paramString.getMessage());
      LogsUtil.a("UriUtil", localStringBuilder.toString());
    }
    return "";
  }
  
  public static boolean isUrlHostAndPathInWhitelist(String paramString, String[] paramArrayOfString)
  {
    if ((paramArrayOfString != null) && (paramArrayOfString.length != 0))
    {
      int j = paramArrayOfString.length;
      int i = 0;
      while (i < j)
      {
        if (isUrlHostAndPathMatchWhitelist(paramString, paramArrayOfString[i])) {
          return true;
        }
        i += 1;
      }
      return false;
    }
    LogsUtil.a("UriUtil", "whitelist is null");
    return false;
  }
  
  public static boolean isUrlHostAndPathMatchWhitelist(String paramString1, String paramString2)
  {
    if (!TextUtils.isEmpty(paramString1))
    {
      if (TextUtils.isEmpty(paramString2)) {
        return false;
      }
      if ((!paramString1.contains("..")) && (!paramString1.contains("@")))
      {
        if (!paramString2.equals(paramString1))
        {
          Object localObject = new StringBuilder();
          ((StringBuilder)localObject).append(paramString2);
          ((StringBuilder)localObject).append("?");
          if (!paramString1.startsWith(((StringBuilder)localObject).toString()))
          {
            localObject = new StringBuilder();
            ((StringBuilder)localObject).append(paramString2);
            ((StringBuilder)localObject).append("#");
            if (paramString1.startsWith(((StringBuilder)localObject).toString())) {
              return true;
            }
            if (!paramString2.endsWith("/")) {
              return false;
            }
            localObject = Uri.parse(paramString2).getPathSegments();
            if (Uri.parse(paramString1).getPathSegments().size() - ((List)localObject).size() != 1) {
              return false;
            }
            return paramString1.startsWith(paramString2);
          }
        }
        else
        {
          return true;
        }
      }
      else {
        Log.e("UriUtil", "url contains unsafe char");
      }
    }
    else
    {
      return false;
    }
    return true;
  }
  
  public static boolean isUrlHostInWhitelist(String paramString, String[] paramArrayOfString)
  {
    if ((paramArrayOfString != null) && (paramArrayOfString.length != 0))
    {
      int j = paramArrayOfString.length;
      int i = 0;
      while (i < j)
      {
        if (isUrlHostMatchWhitelist(paramString, paramArrayOfString[i])) {
          return true;
        }
        i += 1;
      }
      return false;
    }
    LogsUtil.a("UriUtil", "whitelist is null");
    return false;
  }
  
  public static boolean isUrlHostMatchWhitelist(String paramString1, String paramString2)
  {
    paramString1 = getHostByURI(paramString1);
    if ((!TextUtils.isEmpty(paramString1)) && (!TextUtils.isEmpty(paramString2)))
    {
      paramString2 = getDomain(paramString2);
      if (TextUtils.isEmpty(paramString2))
      {
        Log.e("UriUtil", "whitelist host is null");
        return false;
      }
      if (paramString2.equals(paramString1)) {
        return true;
      }
      if (paramString1.endsWith(paramString2)) {
        try
        {
          int i = paramString1.length();
          int j = paramString2.length();
          paramString1 = paramString1.substring(0, i - j);
          boolean bool = paramString1.endsWith(".");
          if (!bool) {
            return false;
          }
          bool = paramString1.matches("^[A-Za-z0-9.-]+$");
          return bool;
        }
        catch (Exception paramString1)
        {
          paramString2 = new StringBuilder();
          paramString2.append("Exception : ");
          paramString2.append(paramString1.getMessage());
          LogsUtil.a("UriUtil", paramString2.toString());
          return false;
        }
        catch (IndexOutOfBoundsException paramString1)
        {
          paramString2 = new StringBuilder();
          paramString2.append("IndexOutOfBoundsException");
          paramString2.append(paramString1.getMessage());
          LogsUtil.a("UriUtil", paramString2.toString());
        }
      }
      return false;
    }
    LogsUtil.a("UriUtil", "url or whitelist is null");
    return false;
  }
  
  public static boolean isUrlHostSameWhitelist(String paramString1, String paramString2)
  {
    if ((!TextUtils.isEmpty(paramString1)) && (!TextUtils.isEmpty(paramString2))) {
      return TextUtils.equals(getHostByURI(paramString1), getDomain(paramString2));
    }
    Log.e("UriUtil", "isUrlHostSameWhitelist: url or host is null");
    return false;
  }
  
  public static boolean isUrlHostSameWhitelist(String paramString, String[] paramArrayOfString)
  {
    if ((paramArrayOfString != null) && (paramArrayOfString.length != 0))
    {
      int j = paramArrayOfString.length;
      int i = 0;
      while (i < j)
      {
        if (isUrlHostSameWhitelist(paramString, paramArrayOfString[i])) {
          return true;
        }
        i += 1;
      }
      return false;
    }
    LogsUtil.a("UriUtil", "whitelist is null");
    return false;
  }
}
