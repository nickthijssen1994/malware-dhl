package com.huawei.secure.android.common.encrypt.inject;

import android.text.TextUtils;
import android.util.Base64;
import com.huawei.secure.android.common.encrypt.keystore.runtime.RSASignKS;
import com.huawei.secure.android.common.encrypt.utils.EncryptUtil;
import java.io.UnsupportedEncodingException;
import java.security.GeneralSecurityException;
import java.security.InvalidAlgorithmParameterException;
import java.security.InvalidKeyException;
import java.security.NoSuchAlgorithmException;
import java.security.PrivateKey;
import java.security.PublicKey;
import java.security.Signature;
import java.security.SignatureException;
import java.security.interfaces.RSAPrivateKey;
import java.security.interfaces.RSAPublicKey;
import java.security.spec.MGF1ParameterSpec;
import java.security.spec.PSSParameterSpec;

public abstract class RSASign
{
  private static final String ACTION_UPDATE_ALL = "SHA256WithRSA";
  private static final String B = "RSASign";
  private static final String CHARSET = "UTF-8";
  private static final String NULL_LABEL = "";
  private static final String PAGE_KEY = "SHA256WithRSA/PSS";
  
  public RSASign() {}
  
  private static boolean d(String paramString1, String paramString2, String paramString3, boolean paramBoolean)
  {
    if ((!TextUtils.isEmpty(paramString1)) && (!TextUtils.isEmpty(paramString3)) && (!TextUtils.isEmpty(paramString2)))
    {
      paramString3 = EncryptUtil.getPublicKey(paramString3);
      if (paramBoolean) {
        return newVerifySign(paramString1, paramString2, paramString3);
      }
      return verifySign(paramString1, paramString2, paramString3);
    }
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(B, "content or public key or sign value is null");
    return false;
  }
  
  private static String digest(String paramString1, String paramString2, boolean paramBoolean)
  {
    if ((!TextUtils.isEmpty(paramString1)) && (!TextUtils.isEmpty(paramString2)))
    {
      paramString2 = EncryptUtil.getPrivateKey(paramString2);
      if (paramBoolean) {
        return newSign(paramString1, paramString2);
      }
      return sign(paramString1, paramString2);
    }
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(B, "sign content or key is null");
    return "";
  }
  
  private static String digest(String paramString, PrivateKey paramPrivateKey, boolean paramBoolean)
  {
    try
    {
      paramString = Base64.encodeToString(sign(paramString.getBytes("UTF-8"), paramPrivateKey, paramBoolean), 0);
      return paramString;
    }
    catch (UnsupportedEncodingException paramString)
    {
      paramPrivateKey = B;
      StringBuilder localStringBuilder = new StringBuilder();
      localStringBuilder.append("sign UnsupportedEncodingException: ");
      localStringBuilder.append(paramString.getMessage());
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramPrivateKey, localStringBuilder.toString());
    }
    return "";
  }
  
  private static boolean encrypt(String paramString1, String paramString2, PublicKey paramPublicKey, boolean paramBoolean)
  {
    try
    {
      paramBoolean = verifySign(paramString1.getBytes("UTF-8"), Base64.decode(paramString2, 0), paramPublicKey, paramBoolean);
      return paramBoolean;
    }
    catch (Exception paramString1)
    {
      paramString2 = B;
      paramPublicKey = new StringBuilder();
      paramPublicKey.append("base64 decode Exception : ");
      paramPublicKey.append(paramString1.getMessage());
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramString2, paramPublicKey.toString());
      return false;
    }
    catch (UnsupportedEncodingException paramString1)
    {
      paramString2 = B;
      paramPublicKey = new StringBuilder();
      paramPublicKey.append("verifySign UnsupportedEncodingException: ");
      paramPublicKey.append(paramString1.getMessage());
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramString2, paramPublicKey.toString());
    }
    return false;
  }
  
  public static String newSign(String paramString1, String paramString2)
  {
    if (!RSASignKS.isBuildVersionHigherThan22())
    {
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(B, "sdk version is too low");
      return "";
    }
    return digest(paramString1, paramString2, true);
  }
  
  public static String newSign(String paramString, PrivateKey paramPrivateKey)
  {
    if (!RSASignKS.isBuildVersionHigherThan22())
    {
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(B, "sdk version is too low");
      return "";
    }
    return digest(paramString, paramPrivateKey, true);
  }
  
  public static boolean newVerifySign(String paramString1, String paramString2, String paramString3)
  {
    if (!RSASignKS.isBuildVersionHigherThan22())
    {
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(B, "sdk version is too low");
      return false;
    }
    return d(paramString1, paramString2, paramString3, true);
  }
  
  public static boolean newVerifySign(String paramString1, String paramString2, PublicKey paramPublicKey)
  {
    if (!RSASignKS.isBuildVersionHigherThan22())
    {
      com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(B, "sdk version is too low");
      return false;
    }
    return encrypt(paramString1, paramString2, paramPublicKey, true);
  }
  
  public static String sign(String paramString1, String paramString2)
  {
    return digest(paramString1, paramString2, false);
  }
  
  public static String sign(String paramString, PrivateKey paramPrivateKey)
  {
    return digest(paramString, paramPrivateKey, false);
  }
  
  public static byte[] sign(byte[] paramArrayOfByte, PrivateKey paramPrivateKey, boolean paramBoolean)
  {
    byte[] arrayOfByte = new byte[0];
    if ((paramArrayOfByte != null) && (paramPrivateKey != null) && (RSAEncrypt.isPrivateKeyLengthRight((RSAPrivateKey)paramPrivateKey)))
    {
      if (paramBoolean) {}
      try
      {
        Signature localSignature = Signature.getInstance("SHA256WithRSA/PSS");
        localObject = localSignature;
        MGF1ParameterSpec localMGF1ParameterSpec = MGF1ParameterSpec.SHA256;
        localSignature.setParameter(new PSSParameterSpec("SHA-256", "MGF1", localMGF1ParameterSpec, 32, 1));
        break label75;
        localObject = Signature.getInstance("SHA256WithRSA");
        label75:
        ((Signature)localObject).initSign(paramPrivateKey);
        ((Signature)localObject).update(paramArrayOfByte);
        paramArrayOfByte = ((Signature)localObject).sign();
        return paramArrayOfByte;
      }
      catch (Exception paramArrayOfByte)
      {
        paramPrivateKey = B;
        localObject = new StringBuilder();
        ((StringBuilder)localObject).append("sign Exception: ");
        ((StringBuilder)localObject).append(paramArrayOfByte.getMessage());
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramPrivateKey, ((StringBuilder)localObject).toString());
        return arrayOfByte;
      }
      catch (InvalidAlgorithmParameterException paramArrayOfByte)
      {
        paramPrivateKey = B;
        localObject = new StringBuilder();
        ((StringBuilder)localObject).append("sign InvalidAlgorithmParameterException: ");
        ((StringBuilder)localObject).append(paramArrayOfByte.getMessage());
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramPrivateKey, ((StringBuilder)localObject).toString());
        return arrayOfByte;
      }
      catch (SignatureException paramArrayOfByte)
      {
        paramPrivateKey = B;
        localObject = new StringBuilder();
        ((StringBuilder)localObject).append("sign SignatureException: ");
        ((StringBuilder)localObject).append(paramArrayOfByte.getMessage());
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramPrivateKey, ((StringBuilder)localObject).toString());
        return arrayOfByte;
      }
      catch (InvalidKeyException paramArrayOfByte)
      {
        paramPrivateKey = B;
        localObject = new StringBuilder();
        ((StringBuilder)localObject).append("sign InvalidKeyException: ");
        ((StringBuilder)localObject).append(paramArrayOfByte.getMessage());
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramPrivateKey, ((StringBuilder)localObject).toString());
        return arrayOfByte;
      }
      catch (NoSuchAlgorithmException paramArrayOfByte)
      {
        paramPrivateKey = B;
        Object localObject = new StringBuilder();
        ((StringBuilder)localObject).append("sign NoSuchAlgorithmException: ");
        ((StringBuilder)localObject).append(paramArrayOfByte.getMessage());
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramPrivateKey, ((StringBuilder)localObject).toString());
        return arrayOfByte;
      }
    }
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(B, "content or privateKey is null , or length is too short");
    return arrayOfByte;
  }
  
  public static boolean verifySign(String paramString1, String paramString2, String paramString3)
  {
    return d(paramString1, paramString2, paramString3, false);
  }
  
  public static boolean verifySign(String paramString1, String paramString2, PublicKey paramPublicKey)
  {
    return encrypt(paramString1, paramString2, paramPublicKey, false);
  }
  
  public static boolean verifySign(byte[] paramArrayOfByte1, byte[] paramArrayOfByte2, PublicKey paramPublicKey, boolean paramBoolean)
  {
    if ((paramArrayOfByte1 != null) && (paramPublicKey != null) && (paramArrayOfByte2 != null) && (RSAEncrypt.isPublicKeyLengthRight((RSAPublicKey)paramPublicKey)))
    {
      if (paramBoolean) {}
      try
      {
        Signature localSignature2 = Signature.getInstance("SHA256WithRSA/PSS");
        Signature localSignature1 = localSignature2;
        MGF1ParameterSpec localMGF1ParameterSpec = MGF1ParameterSpec.SHA256;
        localSignature2.setParameter(new PSSParameterSpec("SHA-256", "MGF1", localMGF1ParameterSpec, 32, 1));
        break label76;
        localSignature1 = Signature.getInstance("SHA256WithRSA");
        label76:
        localSignature1.initVerify(paramPublicKey);
        localSignature1.update(paramArrayOfByte1);
        paramBoolean = localSignature1.verify(paramArrayOfByte2);
        return paramBoolean;
      }
      catch (Exception paramArrayOfByte1)
      {
        paramArrayOfByte2 = B;
        paramPublicKey = new StringBuilder();
        paramPublicKey.append("exception : ");
        paramPublicKey.append(paramArrayOfByte1.getMessage());
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramArrayOfByte2, paramPublicKey.toString());
        return false;
      }
      catch (GeneralSecurityException paramArrayOfByte1)
      {
        paramArrayOfByte2 = B;
        paramPublicKey = new StringBuilder();
        paramPublicKey.append("check sign exception: ");
        paramPublicKey.append(paramArrayOfByte1.getMessage());
        com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(paramArrayOfByte2, paramPublicKey.toString());
        return false;
      }
    }
    com.huawei.secure.android.common.encrypt.utils.StringBuilder.append(B, "content or publicKey is null , or length is too short");
    return false;
  }
}
