package com.huawei.updatesdk.org.shared.book;

import android.os.AsyncTask;
import android.text.TextUtils;
import com.huawei.updatesdk.a.b.d.c.d;
import com.huawei.updatesdk.org.android.asm.Attribute;
import com.huawei.updatesdk.org.android.book.Label;
import com.huawei.updatesdk.org.shared.book.util.Frame;
import com.huawei.updatesdk.org.shared.book.util.a;
import com.huawei.updatesdk.text.speech.tts.Settings;
import java.io.IOException;
import java.io.InterruptedIOException;
import java.net.ConnectException;
import java.net.SocketTimeoutException;
import java.util.List;
import java.util.concurrent.Executor;
import org.apache.http.conn.ConnectTimeoutException;
import org.json.JSONException;
import org.json.JSONObject;

public class f
  extends AsyncTask<com.huawei.updatesdk.a.b.d.c.c, Void, d>
{
  protected Frame a = null;
  private int b = 0;
  private com.huawei.updatesdk.org.shared.book.util.Item c = null;
  private a j = null;
  private com.huawei.updatesdk.org.android.book.ByteVector l = null;
  
  public f(Frame paramFrame, a paramA)
  {
    a = paramFrame;
    j = paramA;
  }
  
  private com.huawei.updatesdk.org.shared.book.util.Item a(String paramString1, String paramString2, com.huawei.updatesdk.org.shared.book.util.Item paramItem)
  {
    try
    {
      paramItem.fromJson(new JSONObject(paramString2));
      paramItem.put(0);
      return paramItem;
    }
    catch (IllegalAccessException paramString1) {}catch (InstantiationException paramString1) {}catch (ClassNotFoundException paramString1) {}catch (JSONException paramString1) {}
    com.huawei.updatesdk.org.android.remote.calendar.widget.Log.println("StoreTask", "parse json error", (Throwable)paramString1);
    return paramItem;
  }
  
  private void a(com.huawei.updatesdk.org.shared.book.util.Item paramItem)
  {
    if ((!isCancelled()) && (j != null))
    {
      Object localObject1 = paramItem;
      Object localObject2;
      if (paramItem == null)
      {
        com.huawei.updatesdk.org.android.remote.calendar.widget.Log.append("StoreTask", "notifyResult, response is null");
        localObject1 = a;
        StringBuilder localStringBuilder;
        try
        {
          localObject1 = Type.a(((Frame)localObject1).get());
          paramItem = (com.huawei.updatesdk.org.shared.book.util.Item)localObject1;
        }
        catch (IllegalAccessException localIllegalAccessException)
        {
          localStringBuilder = new StringBuilder();
        }
        catch (InstantiationException localInstantiationException)
        {
          localStringBuilder = new StringBuilder();
        }
        localStringBuilder.append("notifyResult, create response error, method:");
        localStringBuilder.append(a.get());
        com.huawei.updatesdk.org.android.remote.calendar.widget.Log.println("StoreTask", localStringBuilder.toString(), localInstantiationException);
        if (paramItem == null)
        {
          paramItem = new com.huawei.updatesdk.org.shared.book.util.Item();
          localObject2 = com.huawei.updatesdk.org.shared.book.util.f.a;
        }
        else
        {
          localObject2 = com.huawei.updatesdk.org.shared.book.util.f.c;
        }
        paramItem.a((com.huawei.updatesdk.org.shared.book.util.f)localObject2);
        paramItem.put(1);
        localObject2 = paramItem;
      }
      j.a(a, (com.huawei.updatesdk.org.shared.book.util.Item)localObject2);
    }
  }
  
  private boolean a(String paramString)
  {
    return (TextUtils.isEmpty(paramString)) || (!Attribute.write(paramString));
  }
  
  private void add(com.huawei.updatesdk.org.shared.book.util.Item paramItem, int paramInt, com.huawei.updatesdk.org.shared.book.util.f paramF, Throwable paramThrowable)
  {
    if (paramItem != null)
    {
      paramItem.put(paramInt);
      paramItem.a(paramF);
      paramItem.setContent(paramThrowable.toString());
    }
  }
  
  private void add(com.huawei.updatesdk.org.shared.book.util.Item paramItem, Throwable paramThrowable, String paramString)
  {
    boolean bool = paramThrowable instanceof ConnectException;
    int i = 1;
    com.huawei.updatesdk.org.shared.book.util.f localF;
    if (bool) {
      localF = com.huawei.updatesdk.org.shared.book.util.f.d;
    }
    for (;;)
    {
      add(paramItem, i, localF, paramThrowable);
      break label177;
      if (((paramThrowable instanceof SocketTimeoutException)) || ((paramThrowable instanceof ConnectTimeoutException)))
      {
        localF = com.huawei.updatesdk.org.shared.book.util.f.d;
        i = 2;
      }
      else if ((paramThrowable instanceof IllegalArgumentException))
      {
        localF = com.huawei.updatesdk.org.shared.book.util.f.a;
        i = 5;
      }
      else if ((paramThrowable instanceof IllegalAccessException))
      {
        localF = com.huawei.updatesdk.org.shared.book.util.f.c;
      }
      else if ((paramThrowable instanceof ArrayIndexOutOfBoundsException))
      {
        localF = com.huawei.updatesdk.org.shared.book.util.f.r;
        i = 6;
      }
      else
      {
        if (((paramThrowable instanceof InterruptedException)) || ((paramThrowable instanceof InterruptedIOException))) {
          break label159;
        }
        if (!(paramThrowable instanceof IOException)) {
          break;
        }
        localF = com.huawei.updatesdk.org.shared.book.util.f.b;
      }
    }
    if (paramItem != null)
    {
      paramItem.setContent(paramThrowable.toString());
      break label177;
      label159:
      add(paramItem, 0, com.huawei.updatesdk.org.shared.book.util.f.f, paramThrowable);
      android.util.Log.e("StoreTask", "UpdateSDK task is canceled");
    }
    label177:
    e(paramString, paramThrowable);
  }
  
  private void b(String paramString)
  {
    if (TextUtils.isEmpty(paramString)) {
      paramString = "UpdateSDK response error, resData == null";
    } else {
      paramString = "UpdateSDK response error, resData is not json string";
    }
    android.util.Log.e("StoreTask", paramString);
  }
  
  private boolean b(com.huawei.updatesdk.org.shared.book.util.Item paramItem)
  {
    if (isCancelled()) {
      return false;
    }
    if ((paramItem.a() != 1) && (paramItem.a() != 2)) {
      return false;
    }
    int i = b;
    b = (i + 1);
    if (i >= 3)
    {
      localStringBuilder = new StringBuilder();
      localStringBuilder.append("retry completed total times = ");
      localStringBuilder.append(b);
      localStringBuilder.append(",response.responseCode = ");
      localStringBuilder.append(paramItem.a());
      com.huawei.updatesdk.org.android.remote.calendar.widget.Log.e("StoreTask", localStringBuilder.toString());
      return false;
    }
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append("retry times = ");
    localStringBuilder.append(b);
    localStringBuilder.append(",response.responseCode = ");
    localStringBuilder.append(paramItem.a());
    com.huawei.updatesdk.org.android.remote.calendar.widget.Log.e("StoreTask", localStringBuilder.toString());
    return true;
  }
  
  private void d()
  {
    a(c);
  }
  
  private void e(String paramString, Throwable paramThrowable)
  {
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append("invoke store error");
    localStringBuilder.append(", exceptionType:");
    localStringBuilder.append(paramThrowable.getClass().getName());
    localStringBuilder.append(", url:");
    localStringBuilder.append(paramString);
    localStringBuilder.append(", method:");
    localStringBuilder.append(a.get());
    paramString = new StringBuilder();
    paramString.append(", retryTimes:");
    paramString.append(b);
    localStringBuilder.append(paramString.toString());
    paramString = localStringBuilder.toString();
    com.huawei.updatesdk.org.android.remote.calendar.widget.Log.println("StoreTask", paramString, paramThrowable);
    paramThrowable = new StringBuilder();
    paramThrowable.append("UpdateSDK call store error: ");
    paramThrowable.append(paramString);
    android.util.Log.e("StoreTask", paramThrowable.toString());
  }
  
  protected com.huawei.updatesdk.org.shared.book.util.Item a()
  {
    Object localObject1 = null;
    Object localObject2 = null;
    com.huawei.updatesdk.org.shared.book.util.Item localItem1;
    try
    {
      com.huawei.updatesdk.org.shared.book.util.Item localItem3 = Type.a(a.get());
      com.huawei.updatesdk.org.shared.book.util.Item localItem2 = localItem3;
      localObject1 = localObject2;
      localItem1 = localItem2;
      try
      {
        boolean bool = com.huawei.updatesdk.org.android.asm.data.f.isNetworkAvailable(com.huawei.updatesdk.org.shared.module.Item.next().getContext());
        if (!bool)
        {
          localObject1 = localObject2;
          localItem1 = localItem2;
          localItem3.put(3);
          localObject1 = localObject2;
          localItem1 = localItem2;
          localItem3.a(com.huawei.updatesdk.org.shared.book.util.f.g);
          localItem1 = localItem2;
        }
        else
        {
          localObject1 = localObject2;
          localItem1 = localItem2;
          String str2 = a.a();
          localObject1 = localObject2;
          localItem1 = localItem2;
          String str1 = a.d();
          localObject2 = str1;
          localObject1 = localObject2;
          localItem1 = localItem2;
          Object localObject3 = new StringBuilder();
          localObject1 = localObject2;
          localItem1 = localItem2;
          ((StringBuilder)localObject3).append("callStore, method:");
          localObject1 = localObject2;
          localItem1 = localItem2;
          ((StringBuilder)localObject3).append(a.get());
          localObject1 = localObject2;
          localItem1 = localItem2;
          ((StringBuilder)localObject3).append(", url:");
          localObject1 = localObject2;
          localItem1 = localItem2;
          ((StringBuilder)localObject3).append(str1);
          localObject1 = localObject2;
          localItem1 = localItem2;
          ((StringBuilder)localObject3).append(", body:");
          localObject1 = localObject2;
          localItem1 = localItem2;
          ((StringBuilder)localObject3).append(str2);
          localObject1 = localObject2;
          localItem1 = localItem2;
          com.huawei.updatesdk.org.android.remote.calendar.widget.Log.e("StoreTask", ((StringBuilder)localObject3).toString());
          localObject1 = localObject2;
          localItem1 = localItem2;
          l = new com.huawei.updatesdk.org.android.book.ByteVector();
          localObject1 = localObject2;
          localItem1 = localItem2;
          localObject3 = l.a(str1, str2, "UTF-8", getItem(), com.huawei.updatesdk.org.shared.module.Item.next().getContext());
          localObject1 = localObject2;
          localItem1 = localItem2;
          String str3 = ((Label)localObject3).b();
          localObject1 = localObject2;
          localItem1 = localItem2;
          localItem3.a(((Label)localObject3).a());
          localObject1 = localObject2;
          localItem1 = localItem2;
          StringBuilder localStringBuilder = new StringBuilder();
          localObject1 = localObject2;
          localItem1 = localItem2;
          localStringBuilder.append("UpdateSDK call store responsecode: ");
          localObject1 = localObject2;
          localItem1 = localItem2;
          localStringBuilder.append(localItem3.c());
          localObject1 = localObject2;
          localItem1 = localItem2;
          android.util.Log.i("StoreTask", localStringBuilder.toString());
          localObject1 = localObject2;
          localItem1 = localItem2;
          int i = ((Label)localObject3).a();
          if (i / 100 == 5)
          {
            localObject1 = localObject2;
            localItem1 = localItem2;
            localItem3.put(0);
            return localItem3;
          }
          localObject1 = localObject2;
          localItem1 = localItem2;
          bool = a(str3);
          if (bool)
          {
            localObject1 = localObject2;
            localItem1 = localItem2;
            localItem3.put(1);
            localObject1 = localObject2;
            localItem1 = localItem2;
            localItem3.a(com.huawei.updatesdk.org.shared.book.util.f.l);
            localObject1 = localObject2;
            localItem1 = localItem2;
            b(str3);
            localItem1 = localItem2;
          }
          else
          {
            localObject1 = localObject2;
            localItem1 = localItem2;
            localItem3 = a(str2, str3, localItem3);
            localItem2 = localItem3;
            localObject1 = localObject2;
            localItem1 = localItem2;
            localObject3 = new StringBuilder();
            localObject1 = localObject2;
            localItem1 = localItem2;
            ((StringBuilder)localObject3).append("callStore response, method:");
            localObject1 = localObject2;
            localItem1 = localItem2;
            ((StringBuilder)localObject3).append(a.get());
            localObject1 = localObject2;
            localItem1 = localItem2;
            ((StringBuilder)localObject3).append(", url:");
            localObject1 = localObject2;
            localItem1 = localItem2;
            ((StringBuilder)localObject3).append(str1);
            localObject1 = localObject2;
            localItem1 = localItem2;
            ((StringBuilder)localObject3).append(", body:");
            localObject1 = localObject2;
            localItem1 = localItem2;
            ((StringBuilder)localObject3).append(str2);
            localObject1 = localObject2;
            localItem1 = localItem2;
            ((StringBuilder)localObject3).append(", Receive Json msg:");
            localObject1 = localObject2;
            localItem1 = localItem2;
            ((StringBuilder)localObject3).append(localItem3.toJson());
            localObject1 = localObject2;
            localItem1 = localItem2;
            com.huawei.updatesdk.org.android.remote.calendar.widget.Log.e("StoreTask", ((StringBuilder)localObject3).toString());
            localItem1 = localItem2;
          }
        }
      }
      catch (Throwable localThrowable1) {}
      add(localItem1, localThrowable2, (String)localObject1);
    }
    catch (Throwable localThrowable2)
    {
      localItem1 = null;
    }
    localObject1 = localItem1;
    if (localItem1 == null)
    {
      localObject1 = new com.huawei.updatesdk.org.shared.book.util.Item();
      ((com.huawei.updatesdk.org.shared.book.util.Item)localObject1).put(5);
      ((com.huawei.updatesdk.org.shared.book.util.Item)localObject1).a(com.huawei.updatesdk.org.shared.book.util.f.a);
    }
    return localObject1;
  }
  
  protected com.huawei.updatesdk.org.shared.book.util.Item a(Frame... paramVarArgs)
  {
    paramVarArgs = new StringBuilder();
    paramVarArgs.append("doInBackground, method:");
    paramVarArgs.append(a.get());
    com.huawei.updatesdk.org.android.remote.calendar.widget.Log.e("StoreTask", paramVarArgs.toString());
    com.huawei.updatesdk.text.speech.tts.ByteVector.write(this);
    paramVarArgs = b();
    a localA = j;
    if (localA != null) {
      localA.b(a, paramVarArgs);
    }
    return paramVarArgs;
  }
  
  protected void add(com.huawei.updatesdk.org.shared.book.util.Item paramItem)
  {
    paramItem = new StringBuilder();
    paramItem.append("onPostExecute, method:");
    paramItem.append(a.get());
    com.huawei.updatesdk.org.android.remote.calendar.widget.Log.e("StoreTask", paramItem.toString());
    com.huawei.updatesdk.text.speech.tts.ByteVector.get().remove(this);
    d();
  }
  
  public final void add(Executor paramExecutor)
  {
    executeOnExecutor(paramExecutor, new Frame[] { a });
  }
  
  public final com.huawei.updatesdk.org.shared.book.util.Item b()
  {
    Object localObject1 = null;
    Object localObject2;
    do
    {
      if ((b > 0) && (localObject1 != null))
      {
        localObject2 = new StringBuilder();
        ((StringBuilder)localObject2).append("call store error! responseCode:");
        ((StringBuilder)localObject2).append(localObject1.a());
        ((StringBuilder)localObject2).append(", retryTimes:");
        ((StringBuilder)localObject2).append(b);
        com.huawei.updatesdk.org.android.remote.calendar.widget.Log.e("StoreTask", ((StringBuilder)localObject2).toString());
      }
      localObject2 = a();
      localObject1 = localObject2;
      write((com.huawei.updatesdk.org.shared.book.util.Item)localObject2);
    } while (b((com.huawei.updatesdk.org.shared.book.util.Item)localObject2));
    c = ((com.huawei.updatesdk.org.shared.book.util.Item)localObject2);
    return c;
  }
  
  public void c()
  {
    com.huawei.updatesdk.org.android.book.ByteVector localByteVector = l;
    if (localByteVector != null)
    {
      localByteVector.put();
      l = null;
    }
  }
  
  protected String getItem()
  {
    String str = Settings.init();
    if (TextUtils.isEmpty(str)) {
      return "Android/1.0";
    }
    return str;
  }
  
  public void write(com.huawei.updatesdk.org.shared.book.util.Item paramItem) {}
}
