package com.huawei.updatesdk.org.android.book;

import android.os.Build.VERSION;
import java.security.NoSuchAlgorithmException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Locale;
import javax.net.ssl.SSLContext;
import javax.net.ssl.SSLSocket;

public abstract class TlsSniSocketFactory
{
  private static final String[] DEFAULT = { "TLS_DHE_DSS_WITH_AES_128_CBC_SHA", "TLS_DHE_RSA_WITH_AES_128_CBC_SHA", "TLS_DHE_DSS_WITH_AES_256_CBC_SHA", "TLS_DHE_RSA_WITH_AES_256_CBC_SHA", "TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA", "TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA", "TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA", "TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA" };
  private static final String[] TAG = { "TLS_DHE_RSA_WITH_AES_128_GCM_SHA256", "TLS_DHE_RSA_WITH_AES_256_GCM_SHA384", "TLS_DHE_DSS_WITH_AES_128_GCM_SHA256", "TLS_DHE_DSS_WITH_AES_256_GCM_SHA384", "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256", "TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384", "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256", "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384" };
  private static final String[] result = { "TLS_RSA", "CBC", "TEA", "SHA0", "MD2", "MD4", "RIPEMD", "NULL", "RC4", "DES", "DESX", "DES40", "RC2", "MD5", "ANON", "TLS_EMPTY_RENEGOTIATION_INFO_SCSV" };
  
  private static void apply(SSLSocket paramSSLSocket, String[] paramArrayOfString)
  {
    if (paramSSLSocket != null)
    {
      if (paramArrayOfString == null) {
        return;
      }
      String[] arrayOfString = paramSSLSocket.getEnabledCipherSuites();
      ArrayList localArrayList = new ArrayList();
      int k = arrayOfString.length;
      int i = 0;
      while (i < k)
      {
        String str1 = arrayOfString[i];
        String str2 = str1.toUpperCase(Locale.ENGLISH);
        int m = paramArrayOfString.length;
        int j = 0;
        while (j < m)
        {
          if (str2.contains(paramArrayOfString[j].toUpperCase(Locale.ENGLISH)))
          {
            j = 1;
            break label96;
          }
          j += 1;
        }
        j = 0;
        label96:
        if (j == 0) {
          localArrayList.add(str1);
        }
        i += 1;
      }
      if (!localArrayList.isEmpty()) {
        paramSSLSocket.setEnabledCipherSuites((String[])localArrayList.toArray(new String[localArrayList.size()]));
      }
    }
  }
  
  public static SSLContext build()
    throws NoSuchAlgorithmException
  {
    int i = Build.VERSION.SDK_INT;
    String str;
    if (i >= 29) {
      str = "TLSv1.3";
    }
    for (;;)
    {
      return SSLContext.getInstance(str);
      if (i >= 16) {
        str = "TLSv1.2";
      } else {
        str = "TLS";
      }
    }
  }
  
  private static boolean create(SSLSocket paramSSLSocket, String[] paramArrayOfString)
  {
    if (paramSSLSocket == null) {
      return false;
    }
    String[] arrayOfString = paramSSLSocket.getEnabledCipherSuites();
    ArrayList localArrayList = new ArrayList();
    paramArrayOfString = Arrays.asList(paramArrayOfString);
    int j = arrayOfString.length;
    int i = 0;
    while (i < j)
    {
      String str = arrayOfString[i];
      if (paramArrayOfString.contains(str.toUpperCase(Locale.ENGLISH))) {
        localArrayList.add(str);
      }
      i += 1;
    }
    if (!localArrayList.isEmpty())
    {
      paramSSLSocket.setEnabledCipherSuites((String[])localArrayList.toArray(new String[localArrayList.size()]));
      return true;
    }
    return false;
  }
  
  public static void createSocket(SSLSocket paramSSLSocket)
  {
    if (paramSSLSocket == null) {
      return;
    }
    init(paramSSLSocket);
    establishAndVerify(paramSSLSocket);
  }
  
  private static void establishAndVerify(SSLSocket paramSSLSocket)
  {
    if (paramSSLSocket == null) {
      return;
    }
    if (!getInstance(paramSSLSocket)) {
      apply(paramSSLSocket, result);
    }
  }
  
  private static boolean getInstance(SSLSocket paramSSLSocket)
  {
    if (paramSSLSocket == null) {
      return false;
    }
    if (Build.VERSION.SDK_INT > 19) {}
    for (String[] arrayOfString = TAG;; arrayOfString = DEFAULT) {
      return create(paramSSLSocket, arrayOfString);
    }
  }
  
  private static void init(SSLSocket paramSSLSocket)
  {
    if (paramSSLSocket == null) {
      return;
    }
    if (Build.VERSION.SDK_INT >= 29) {
      paramSSLSocket.setEnabledProtocols(new String[] { "TLSv1.3", "TLSv1.2" });
    }
    int i = Build.VERSION.SDK_INT;
    String[] arrayOfString;
    if ((i >= 16) && (i < 29))
    {
      arrayOfString = new String[1];
      arrayOfString[0] = "TLSv1.2";
    }
    else
    {
      if (Build.VERSION.SDK_INT >= 16) {
        return;
      }
      arrayOfString = new String[1];
      arrayOfString[0] = "TLSv1";
    }
    paramSSLSocket.setEnabledProtocols(arrayOfString);
  }
}
