package com.huawei.hms.update.manager;

import android.content.Context;
import android.content.Intent;
import android.text.TextUtils;
import com.huawei.hms.support.model.HMSLog;
import com.huawei.updatesdk.UpdateSdkAPI;
import com.huawei.updatesdk.service.appmgr.bean.ApkUpgradeInfo;
import com.huawei.updatesdk.service.otaupdate.CheckUpdateCallBack;

public class PackageNameManager
{
  public static PackageNameManager mInstance;
  public static final Object mLock = new Object();
  public Context mCtxt;
  
  public PackageNameManager(Context paramContext)
  {
    mCtxt = paramContext;
  }
  
  public static PackageNameManager getInstance(Context paramContext)
  {
    Object localObject = mLock;
    try
    {
      if (mInstance == null) {
        mInstance = new PackageNameManager(paramContext);
      }
      return mInstance;
    }
    catch (Throwable paramContext)
    {
      throw paramContext;
    }
  }
  
  public void queryPackageName(final QueryPublishCallback paramQueryPublishCallback)
  {
    UpdateSdkAPI.checkTargetAppUpdate(mCtxt, "com.huawei.hms", new a(paramQueryPublishCallback));
  }
  
  public static abstract interface QueryPublishCallback
  {
    public abstract void onQueryResult();
  }
  
  public class a
    implements CheckUpdateCallBack
  {
    public a(PackageNameManager.QueryPublishCallback paramQueryPublishCallback) {}
    
    public void onMarketInstallInfo(Intent paramIntent)
    {
      if (HMSPublishStateHolder.getPublishState() != 1) {
        HMSPublishStateHolder.setPublishState(2);
      }
      paramQueryPublishCallback.onQueryResult();
    }
    
    public void onMarketStoreError(int paramInt)
    {
      StringBuilder localStringBuilder = new StringBuilder();
      localStringBuilder.append("onMarketStoreError responseCode: ");
      localStringBuilder.append(paramInt);
      HMSLog.toString("PackageNameManager", localStringBuilder.toString());
      if (HMSPublishStateHolder.getPublishState() != 1) {
        HMSPublishStateHolder.setPublishState(2);
      }
      paramQueryPublishCallback.onQueryResult();
    }
    
    public void onUpdateInfo(Intent paramIntent)
    {
      if (paramIntent != null) {
        try
        {
          int i = paramIntent.getIntExtra("status", -99);
          localObject = new StringBuilder();
          ((StringBuilder)localObject).append("CheckUpdateCallBack status is ");
          ((StringBuilder)localObject).append(i);
          HMSLog.append("PackageNameManager", ((StringBuilder)localObject).toString());
          localObject = paramIntent.getStringExtra("failreason");
          boolean bool = TextUtils.isEmpty((CharSequence)localObject);
          if (!bool)
          {
            StringBuilder localStringBuilder = new StringBuilder();
            localStringBuilder.append("checkTargetAppUpdate reason is ");
            localStringBuilder.append((String)localObject);
            HMSLog.toString("PackageNameManager", localStringBuilder.toString());
          }
          if (i == 7)
          {
            paramIntent = paramIntent.getSerializableExtra("updatesdk_update_info");
            if ((paramIntent instanceof ApkUpgradeInfo))
            {
              paramIntent = (ApkUpgradeInfo)paramIntent;
              bool = paramIntent.getPackage_().equalsIgnoreCase("com.huawei.hms");
              if (bool)
              {
                HMSLog.append("PackageNameManager", "com.huawei.hms has already be published");
                HMSPublishStateHolder.setPublishState(1);
              }
            }
          }
        }
        catch (Exception paramIntent)
        {
          Object localObject = new StringBuilder();
          ((StringBuilder)localObject).append("intent has some error");
          ((StringBuilder)localObject).append(((Exception)paramIntent).getMessage());
          HMSLog.toString("PackageNameManager", ((StringBuilder)localObject).toString());
        }
      }
      if (HMSPublishStateHolder.getPublishState() != 1) {
        HMSPublishStateHolder.setPublishState(2);
      }
      paramQueryPublishCallback.onQueryResult();
    }
    
    public void onUpdateStoreError(int paramInt)
    {
      StringBuilder localStringBuilder = new StringBuilder();
      localStringBuilder.append("onUpdateStoreError responseCode: ");
      localStringBuilder.append(paramInt);
      HMSLog.toString("PackageNameManager", localStringBuilder.toString());
      if (HMSPublishStateHolder.getPublishState() != 1) {
        HMSPublishStateHolder.setPublishState(2);
      }
      paramQueryPublishCallback.onQueryResult();
    }
  }
}
