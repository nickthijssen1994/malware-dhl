package com.huawei.hms.configurations;

import android.app.Activity;
import android.app.AlertDialog.Builder;
import android.app.Dialog;
import android.app.Fragment;
import android.app.PendingIntent;
import android.content.Context;
import android.content.ContextWrapper;
import android.content.DialogInterface.OnCancelListener;
import android.content.Intent;
import android.content.IntentSender.SendIntentException;
import android.content.res.Resources;
import android.os.Build.VERSION;
import android.os.Bundle;
import com.huawei.hms.activity.BridgeActivity;
import com.huawei.hms.activity.EnableServiceActivity;
import com.huawei.hms.activity.ForegroundIntentBuilder;
import com.huawei.hms.api.BindingFailedResolution;
import com.huawei.hms.api.ResolutionDelegate;
import com.huawei.hms.common.ErrorDialogFragment;
import com.huawei.hms.common.HuaweiApi;
import com.huawei.hms.common.internal.ConnectionErrorMessages;
import com.huawei.hms.common.internal.DialogRedirect;
import com.huawei.hms.common.internal.Preconditions;
import com.huawei.hms.common.jgit.AvailabilityException;
import com.huawei.hms.common.jgit.HuaweiApiCallable;
import com.huawei.hms.support.model.HMSLog;
import com.huawei.hms.update.labs.UpdateBean;
import com.huawei.hms.update.manager.HMSPublishStateHolder;
import com.huawei.hms.update.manager.UpdateManager;
import com.huawei.hms.utils.Checker;
import com.huawei.hms.utils.HMSPackageManager;
import com.huawei.hms.utils.PackageManagerHelper;
import com.huawei.hms.utils.PackageManagerHelper.PackageStates;
import com.huawei.hms.utils.ResourceLoaderUtil;
import com.huawei.hms.utils.Util;
import com.huawei.provider.tasks.Task;
import com.huawei.provider.tasks.TaskCompletionSource;

final class ItemHandler
  extends HuaweiApiAvailability
{
  private static final ItemHandler instance = new ItemHandler();
  
  private ItemHandler() {}
  
  private void addFile(Object paramObject)
    throws AvailabilityException
  {
    AvailabilityException localAvailabilityException = new AvailabilityException();
    if ((paramObject instanceof HuaweiApi)) {
      paramObject = localAvailabilityException.getConnectionResult((HuaweiApi)paramObject);
    } else {
      paramObject = localAvailabilityException.getConnectionResult((HuaweiApiCallable)paramObject);
    }
    if (paramObject.getErrorCode() == 0) {
      return;
    }
    paramObject = new StringBuilder();
    paramObject.append("The service is unavailable: ");
    paramObject.append(localAvailabilityException.getMessage());
    HMSLog.append("HuaweiApiAvailabilityImpl", paramObject.toString());
    throw localAvailabilityException;
  }
  
  private static Intent createIntent(Activity paramActivity, String paramString)
  {
    return BridgeActivity.getIntentStartBridgeActivity(paramActivity, paramString);
  }
  
  private static int getIdentifier(Context paramContext)
  {
    if (paramContext == null) {
      return 0;
    }
    return paramContext.getResources().getIdentifier("androidhwext:style/Theme.Emui", null, null);
  }
  
  public static ItemHandler getInstance()
  {
    return instance;
  }
  
  private static Intent newInstance(Context paramContext, String paramString)
  {
    return BridgeActivity.getIntentStartBridgeActivity(paramContext, paramString);
  }
  
  protected static int show(Activity paramActivity)
  {
    if ((getIdentifier(paramActivity) != 0) && (Build.VERSION.SDK_INT >= 16)) {
      return 0;
    }
    return 3;
  }
  
  private static Dialog show(Activity paramActivity, int paramInt, DialogRedirect paramDialogRedirect, DialogInterface.OnCancelListener paramOnCancelListener)
  {
    if (paramInt == 0) {
      return null;
    }
    AlertDialog.Builder localBuilder = new AlertDialog.Builder(paramActivity, show(paramActivity));
    localBuilder.setMessage(ConnectionErrorMessages.getErrorMessage(paramActivity, paramInt));
    if (paramOnCancelListener != null) {
      localBuilder.setOnCancelListener(paramOnCancelListener);
    }
    localBuilder.setPositiveButton(ConnectionErrorMessages.getErrorDialogButtonMessage(paramActivity, paramInt), paramDialogRedirect);
    paramActivity = ConnectionErrorMessages.getErrorTitle(paramActivity, paramInt);
    if (paramActivity != null) {
      localBuilder.setTitle(paramActivity);
    }
    return localBuilder.create();
  }
  
  private Intent show(Activity paramActivity, int paramInt)
  {
    if (!Util.isAvailableLibExist(paramActivity.getApplicationContext())) {
      return null;
    }
    if ((paramInt != 1) && (paramInt != 2))
    {
      if (paramInt != 6) {
        return null;
      }
      return BridgeActivity.getIntentStartBridgeActivity(paramActivity, BindingFailedResolution.class.getName());
    }
    return UpdateManager.startUpdateIntent(paramActivity);
  }
  
  private static void show(Activity paramActivity, Dialog paramDialog, String paramString, DialogInterface.OnCancelListener paramOnCancelListener)
  {
    Checker.checkNonNull(paramActivity, "activity must not be null.");
    ErrorDialogFragment.newInstance(paramDialog, paramOnCancelListener).show(paramActivity.getFragmentManager(), paramString);
  }
  
  public Task checkApiAccessible(HuaweiApi paramHuaweiApi, HuaweiApi... paramVarArgs)
  {
    Task localTask = new TaskCompletionSource().getTask();
    if (paramHuaweiApi != null) {
      try
      {
        addFile(paramHuaweiApi);
      }
      catch (AvailabilityException paramHuaweiApi)
      {
        break label60;
      }
    }
    if (paramVarArgs != null)
    {
      int j = paramVarArgs.length;
      int i = 0;
      while (i < j)
      {
        paramHuaweiApi = paramVarArgs[i];
        addFile(paramHuaweiApi);
        i += 1;
        continue;
        label60:
        paramVarArgs = new StringBuilder();
        paramVarArgs.append("checkApi has AvailabilityException ");
        paramVarArgs.append(paramHuaweiApi.getMessage());
        HMSLog.append("HuaweiApiAvailabilityImpl", paramVarArgs.toString());
      }
    }
    return localTask;
  }
  
  public Task checkApiAccessible(HuaweiApiCallable paramHuaweiApiCallable, HuaweiApiCallable... paramVarArgs)
  {
    Task localTask = new TaskCompletionSource().getTask();
    if (paramHuaweiApiCallable != null) {
      try
      {
        addFile(paramHuaweiApiCallable);
      }
      catch (AvailabilityException paramHuaweiApiCallable)
      {
        break label60;
      }
    }
    if (paramVarArgs != null)
    {
      int j = paramVarArgs.length;
      int i = 0;
      while (i < j)
      {
        paramHuaweiApiCallable = paramVarArgs[i];
        addFile(paramHuaweiApiCallable);
        i += 1;
        continue;
        label60:
        paramVarArgs = new StringBuilder();
        paramVarArgs.append("HuaweiApiCallable checkApi has AvailabilityException ");
        paramVarArgs.append(paramHuaweiApiCallable.getMessage());
        HMSLog.append("HuaweiApiAvailabilityImpl", paramVarArgs.toString());
      }
    }
    return localTask;
  }
  
  public PendingIntent getErrPendingIntent(Context paramContext, int paramInt1, int paramInt2)
  {
    Object localObject = new StringBuilder();
    ((StringBuilder)localObject).append("Enter getResolveErrorPendingIntent, errorCode: ");
    ((StringBuilder)localObject).append(paramInt1);
    ((StringBuilder)localObject).append(" requestCode: ");
    ((StringBuilder)localObject).append(paramInt2);
    HMSLog.append("HuaweiApiAvailabilityImpl", ((StringBuilder)localObject).toString());
    localObject = getInstance(paramContext, paramInt1);
    if (localObject != null) {
      return PendingIntent.getActivity(paramContext, paramInt2, (Intent)localObject, 134217728);
    }
    return null;
  }
  
  public PendingIntent getErrPendingIntent(Context paramContext, ConnectionResult paramConnectionResult)
  {
    Preconditions.checkNotNull(paramContext);
    Preconditions.checkNotNull(paramConnectionResult);
    return show(paramContext, paramConnectionResult.getErrorCode());
  }
  
  public Dialog getErrorDialog(Activity paramActivity, int paramInt1, int paramInt2)
  {
    Checker.checkNonNull(paramActivity, "activity must not be null.");
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append("Enter getErrorDialog, errorCode: ");
    localStringBuilder.append(paramInt1);
    HMSLog.append("HuaweiApiAvailabilityImpl", localStringBuilder.toString());
    return getErrorDialog(paramActivity, paramInt1, paramInt2, null);
  }
  
  public Dialog getErrorDialog(Activity paramActivity, int paramInt1, int paramInt2, DialogInterface.OnCancelListener paramOnCancelListener)
  {
    Checker.checkNonNull(paramActivity, "activity must not be null.");
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append("Enter getErrorDialog, errorCode: ");
    localStringBuilder.append(paramInt1);
    HMSLog.append("HuaweiApiAvailabilityImpl", localStringBuilder.toString());
    return show(paramActivity, paramInt1, DialogRedirect.getInstance(paramActivity, show(paramActivity, paramInt1), paramInt2), paramOnCancelListener);
  }
  
  public String getErrorString(int paramInt)
  {
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append("Enter getErrorString, errorCode: ");
    localStringBuilder.append(paramInt);
    HMSLog.append("HuaweiApiAvailabilityImpl", localStringBuilder.toString());
    return ConnectionResult.toString(paramInt);
  }
  
  public Task getHuaweiServicesReady(Activity paramActivity)
  {
    Preconditions.checkNotNull(paramActivity);
    Object localObject = new TaskCompletionSource[1];
    localObject[0] = new TaskCompletionSource();
    Task localTask = localObject[0].getTask();
    int i = isHuaweiMobileServicesAvailable(paramActivity.getApplicationContext(), 30000000);
    Intent localIntent1 = getResolveErrorIntent(paramActivity, i);
    Intent localIntent2 = BridgeActivity.getIntentStartBridgeActivity(paramActivity, ResolutionDelegate.class.getName());
    if (localIntent1 != null)
    {
      ForegroundIntentBuilder.registerResponseCallback("CALLBACK_METHOD", new MethodWriter(this, (TaskCompletionSource[])localObject));
      localObject = new Bundle();
      ((Bundle)localObject).putParcelable("resolution", localIntent1);
      localIntent2.putExtras((Bundle)localObject);
      paramActivity.startActivity(localIntent2);
      return localTask;
    }
    if (i == 3)
    {
      localIntent1 = new Intent();
      localIntent1.setClass(paramActivity, EnableServiceActivity.class);
      paramActivity.startActivity(localIntent1);
      return localTask;
    }
    if (i == 0)
    {
      HMSLog.append("HuaweiApiAvailabilityImpl", "The HMS service is available.");
      return localTask;
    }
    HMSLog.toString("HuaweiApiAvailabilityImpl", "Framework can not solve the availability problem.");
    localObject[0].setException(new AvailabilityException());
    return localTask;
  }
  
  public Intent getInstance(Context paramContext, int paramInt)
  {
    Object localObject = new StringBuilder();
    ((StringBuilder)localObject).append("Enter getResolveErrorIntent, errorCode: ");
    ((StringBuilder)localObject).append(paramInt);
    HMSLog.append("HuaweiApiAvailabilityImpl", ((StringBuilder)localObject).toString());
    if ((paramInt != 1) && (paramInt != 2))
    {
      if (paramInt != 6) {
        return null;
      }
      return newInstance(paramContext, BindingFailedResolution.class.getName());
    }
    localObject = new UpdateBean();
    ((UpdateBean)localObject).setHmsOrApkUpgrade(true);
    if (HMSPublishStateHolder.getPublishState() == 0) {
      ((UpdateBean)localObject).setClientPackageName(HMSPackageManager.getInstance(paramContext.getApplicationContext()).getHMSPackageName());
    } else if (HMSPublishStateHolder.getPublishState() == 1) {
      ((UpdateBean)localObject).setClientPackageName("com.huawei.hms");
    } else {
      ((UpdateBean)localObject).setClientPackageName("com.huawei.hwid");
    }
    ((UpdateBean)localObject).setClientVersionCode(HuaweiApiAvailability.getServicesVersionCode());
    ((UpdateBean)localObject).setClientAppId("C10132067");
    if (ResourceLoaderUtil.getmContext() == null) {
      ResourceLoaderUtil.setmContext(paramContext.getApplicationContext());
    }
    ((UpdateBean)localObject).setClientAppName(ResourceLoaderUtil.getString("hms_update_title"));
    return UpdateManager.getStartUpdateIntent(paramContext, (UpdateBean)localObject);
  }
  
  public Intent getResolveErrorIntent(Activity paramActivity, int paramInt)
  {
    Object localObject = new StringBuilder();
    ((StringBuilder)localObject).append("Enter getResolveErrorIntent, errorCode: ");
    ((StringBuilder)localObject).append(paramInt);
    HMSLog.append("HuaweiApiAvailabilityImpl", ((StringBuilder)localObject).toString());
    if (!Util.isAvailableLibExist(paramActivity.getApplicationContext())) {
      return null;
    }
    if ((paramInt != 1) && (paramInt != 2))
    {
      if (paramInt != 6) {
        return null;
      }
      return createIntent(paramActivity, BindingFailedResolution.class.getName());
    }
    localObject = new UpdateBean();
    ((UpdateBean)localObject).setHmsOrApkUpgrade(true);
    if (HMSPublishStateHolder.getPublishState() == 0) {
      ((UpdateBean)localObject).setClientPackageName(HMSPackageManager.getInstance(paramActivity.getApplicationContext()).getHMSPackageName());
    } else if (HMSPublishStateHolder.getPublishState() == 1) {
      ((UpdateBean)localObject).setClientPackageName("com.huawei.hms");
    } else {
      ((UpdateBean)localObject).setClientPackageName("com.huawei.hwid");
    }
    ((UpdateBean)localObject).setClientVersionCode(HuaweiApiAvailability.getServicesVersionCode());
    ((UpdateBean)localObject).setClientAppId("C10132067");
    if (ResourceLoaderUtil.getmContext() == null) {
      ResourceLoaderUtil.setmContext(paramActivity.getApplicationContext());
    }
    ((UpdateBean)localObject).setClientAppName(ResourceLoaderUtil.getString("hms_update_title"));
    return UpdateManager.getStartUpdateIntent(paramActivity, (UpdateBean)localObject);
  }
  
  public PendingIntent getResolveErrorPendingIntent(Activity paramActivity, int paramInt)
  {
    Object localObject = new StringBuilder();
    ((StringBuilder)localObject).append("Enter getResolveErrorPendingIntent, errorCode: ");
    ((StringBuilder)localObject).append(paramInt);
    HMSLog.append("HuaweiApiAvailabilityImpl", ((StringBuilder)localObject).toString());
    localObject = getResolveErrorIntent(paramActivity, paramInt);
    if (localObject != null) {
      return PendingIntent.getActivity(paramActivity, 0, (Intent)localObject, 134217728);
    }
    return null;
  }
  
  public int isHuaweiMobileNoticeAvailable(Context paramContext)
  {
    Checker.checkNonNull(paramContext, "context must not be null.");
    PackageManagerHelper.PackageStates localPackageStates = new PackageManagerHelper(paramContext).getPackageStates(HMSPackageManager.getInstance(paramContext).getHMSPackageName());
    if (PackageManagerHelper.PackageStates.NOT_INSTALLED.equals(localPackageStates)) {
      return 1;
    }
    if (HMSPackageManager.getInstance(paramContext).isApkUpdateNecessary(20600000)) {
      return 2;
    }
    return 0;
  }
  
  public int isHuaweiMobileServicesAvailable(Context paramContext)
  {
    Checker.checkNonNull(paramContext, "context must not be null.");
    return HuaweiMobileServicesUtil.isHuaweiMobileServicesAvailable(paramContext, HuaweiApiAvailability.getServicesVersionCode());
  }
  
  public int isHuaweiMobileServicesAvailable(Context paramContext, int paramInt)
  {
    Checker.checkNonNull(paramContext, "context must not be null.");
    return HuaweiMobileServicesUtil.isHuaweiMobileServicesAvailable(paramContext, paramInt);
  }
  
  public boolean isUserResolvableError(int paramInt)
  {
    return isUserResolvableError(paramInt, null);
  }
  
  public boolean isUserResolvableError(int paramInt, PendingIntent paramPendingIntent)
  {
    if (paramInt == 0) {
      return false;
    }
    if (paramPendingIntent != null) {
      return true;
    }
    return (paramInt == 1) || (paramInt == 2) || (paramInt == 6);
  }
  
  public void popupErrNotification(Context paramContext, ConnectionResult paramConnectionResult)
  {
    Preconditions.checkNotNull(paramContext);
    Preconditions.checkNotNull(paramConnectionResult);
    showErrorNotification(paramContext, paramConnectionResult.getErrorCode());
  }
  
  public void resolveError(Activity paramActivity, int paramInt1, int paramInt2)
  {
    resolveError(paramActivity, paramInt1, paramInt2, null);
  }
  
  public void resolveError(Activity paramActivity, int paramInt1, int paramInt2, PendingIntent paramPendingIntent)
  {
    Checker.checkNonNull(paramActivity, "activity must not be null.");
    StringBuilder localStringBuilder;
    if (paramPendingIntent != null)
    {
      localStringBuilder = new StringBuilder();
      localStringBuilder.append("Enter resolveError, param pendingIntent is not null. and.errorCode: ");
      localStringBuilder.append(paramInt1);
      HMSLog.append("HuaweiApiAvailabilityImpl", localStringBuilder.toString());
    }
    else
    {
      paramPendingIntent = new StringBuilder();
      paramPendingIntent.append("Enter resolveError, param pendingIntent is  null. get pendingIntent from error code.and.errorCode: ");
      paramPendingIntent.append(paramInt1);
      HMSLog.append("HuaweiApiAvailabilityImpl", paramPendingIntent.toString());
      paramPendingIntent = getResolveErrorPendingIntent(paramActivity, paramInt1);
    }
    if (paramPendingIntent != null)
    {
      localStringBuilder = new StringBuilder();
      localStringBuilder.append("In resolveError, start pingding intent.errorCode: ");
      localStringBuilder.append(paramInt1);
      HMSLog.append("HuaweiApiAvailabilityImpl", localStringBuilder.toString());
      try
      {
        paramActivity.startIntentSenderForResult(paramPendingIntent.getIntentSender(), paramInt2, null, 0, 0, 0);
        return;
      }
      catch (IntentSender.SendIntentException paramActivity)
      {
        for (;;) {}
      }
      paramActivity = new StringBuilder();
      paramActivity.append("Enter resolveError, start pendingIntent failed.errorCode: ");
      paramActivity.append(paramInt1);
      HMSLog.toString("HuaweiApiAvailabilityImpl", paramActivity.toString());
      return;
    }
  }
  
  public PendingIntent show(Context paramContext, int paramInt)
  {
    Object localObject = new StringBuilder();
    ((StringBuilder)localObject).append("Enter getResolveErrorPendingIntent, errorCode: ");
    ((StringBuilder)localObject).append(paramInt);
    HMSLog.append("HuaweiApiAvailabilityImpl", ((StringBuilder)localObject).toString());
    localObject = getInstance(paramContext, paramInt);
    if (localObject != null) {
      return PendingIntent.getActivity(paramContext, 0, (Intent)localObject, 134217728);
    }
    return null;
  }
  
  public boolean showErrorDialogFragment(Activity paramActivity, int paramInt1, int paramInt2)
  {
    return showErrorDialogFragment(paramActivity, paramInt1, paramInt2, null);
  }
  
  public boolean showErrorDialogFragment(Activity paramActivity, int paramInt1, int paramInt2, DialogInterface.OnCancelListener paramOnCancelListener)
  {
    Dialog localDialog = getErrorDialog(paramActivity, paramInt1, paramInt2, paramOnCancelListener);
    if (localDialog == null) {
      return false;
    }
    show(paramActivity, localDialog, "HuaweiMobileServicesErrorDialog", paramOnCancelListener);
    return true;
  }
  
  public boolean showErrorDialogFragment(Activity paramActivity, int paramInt1, Fragment paramFragment, int paramInt2, DialogInterface.OnCancelListener paramOnCancelListener)
  {
    return showErrorDialogFragment(paramActivity, paramInt1, paramInt2, paramOnCancelListener);
  }
  
  public void showErrorNotification(Context paramContext, int paramInt)
  {
    Checker.checkNonNull(paramContext, "context must not be null.");
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append("Enter showErrorNotification, errorCode: ");
    localStringBuilder.append(paramInt);
    HMSLog.append("HuaweiApiAvailabilityImpl", localStringBuilder.toString());
    paramContext = getErrorDialog((Activity)paramContext, paramInt, 0);
    if (paramContext == null)
    {
      HMSLog.append("HuaweiApiAvailabilityImpl", "showErrorNotification errorDialog can not be null");
      return;
    }
    paramContext.show();
  }
}
