package com.huawei.hms.utils;

import android.text.TextUtils;
import com.huawei.hms.core.aidl.IMessageEntity;
import com.huawei.hms.core.aidl.annotation.Packed;
import com.huawei.hms.support.model.HMSLog;
import com.huawei.hms.support.model.common.Base64;
import java.lang.reflect.Field;
import java.lang.reflect.Type;
import java.security.AccessController;
import java.security.PrivilegedAction;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

public class JsonUtil
{
  private static final String BYTE_BYTE = "_byte_";
  private static final String LIST_FIELD_VALUE = "_value_";
  private static final String LIST_ITEM_VALUE = "_list_item_";
  private static final String LIST_SIZE = "_list_size_";
  private static final String MAP_MAP = "_map_";
  private static final String NEXT_ITEM = "_next_item_";
  private static final String PAGE_KEY = "JsonUtil";
  private static final String PRE_PKG = "com.huawei";
  protected static final int VAL_BYTE = 2;
  protected static final int VAL_ENTITY = 0;
  protected static final int VAL_LIST = 1;
  protected static final int VAL_MAP = 3;
  protected static final int VAL_NULL = -1;
  protected static final String VAL_TYPE = "_val_type_";
  
  public JsonUtil() {}
  
  private static String createInnerJsonString(IMessageEntity paramIMessageEntity)
    throws IllegalAccessException, JSONException
  {
    Class localClass = paramIMessageEntity.getClass();
    JSONObject localJSONObject = new JSONObject();
    while (localClass != null)
    {
      Field[] arrayOfField = localClass.getDeclaredFields();
      int j = arrayOfField.length;
      int i = 0;
      while (i < j)
      {
        Field localField = arrayOfField[i];
        if (localField.isAnnotationPresent(Packed.class))
        {
          boolean bool = localField.isAccessible();
          setAccessible(localField, true);
          String str = localField.getName();
          Object localObject = localField.get(paramIMessageEntity);
          setAccessible(localField, bool);
          disposeType(str, localObject, localJSONObject);
        }
        i += 1;
      }
      localClass = localClass.getSuperclass();
    }
    return localJSONObject.toString();
  }
  
  public static String createJsonString(IMessageEntity paramIMessageEntity)
  {
    if (paramIMessageEntity == null)
    {
      HMSLog.toString("JsonUtil", "createJsonString error, the input IMessageEntity is null");
      return "";
    }
    try
    {
      paramIMessageEntity = createInnerJsonString(paramIMessageEntity);
      return paramIMessageEntity;
    }
    catch (JSONException paramIMessageEntity)
    {
      localStringBuilder = new StringBuilder();
      localStringBuilder.append("catch JSONException ");
      localStringBuilder.append(paramIMessageEntity.getMessage());
      HMSLog.toString("JsonUtil", localStringBuilder.toString());
    }
    catch (IllegalAccessException paramIMessageEntity)
    {
      StringBuilder localStringBuilder = new StringBuilder();
      localStringBuilder.append("catch IllegalAccessException ");
      localStringBuilder.append(paramIMessageEntity.getMessage());
      HMSLog.toString("JsonUtil", localStringBuilder.toString());
    }
    return "";
  }
  
  private static boolean disposeType(String paramString, Object paramObject, JSONObject paramJSONObject)
    throws JSONException, IllegalAccessException
  {
    if ((paramObject instanceof String))
    {
      paramJSONObject.put(paramString, (String)paramObject);
    }
    else if ((paramObject instanceof Integer))
    {
      paramJSONObject.put(paramString, ((Integer)paramObject).intValue());
    }
    else if ((paramObject instanceof Short))
    {
      paramJSONObject.put(paramString, (Short)paramObject);
    }
    else if ((paramObject instanceof Long))
    {
      paramJSONObject.put(paramString, (Long)paramObject);
    }
    else if ((paramObject instanceof Float))
    {
      paramJSONObject.put(paramString, (Float)paramObject);
    }
    else if ((paramObject instanceof Double))
    {
      paramJSONObject.put(paramString, (Double)paramObject);
    }
    else if ((paramObject instanceof Boolean))
    {
      paramJSONObject.put(paramString, (Boolean)paramObject);
    }
    else if ((paramObject instanceof JSONObject))
    {
      paramJSONObject.put(paramString, (JSONObject)paramObject);
    }
    else if ((paramObject instanceof byte[]))
    {
      writeByte(paramString, (byte[])paramObject, paramJSONObject);
    }
    else if ((paramObject instanceof List))
    {
      writeList(paramString, (List)paramObject, paramJSONObject);
    }
    else if ((paramObject instanceof Map))
    {
      writeMap(paramString, (Map)paramObject, paramJSONObject);
    }
    else
    {
      if (!(paramObject instanceof IMessageEntity)) {
        break label275;
      }
      paramObject = (IMessageEntity)paramObject;
    }
    try
    {
      paramJSONObject.put(paramString, createInnerJsonString(paramObject));
      return true;
    }
    catch (IllegalAccessException paramString)
    {
      paramObject = new StringBuilder();
      paramObject.append("IllegalAccessException , ");
      paramObject.append(paramString);
      HMSLog.toString("JsonUtil", paramObject.toString());
    }
    label275:
    return false;
  }
  
  public static Object getInfoFromJsonobject(String paramString1, String paramString2)
  {
    if (!TextUtils.isEmpty(paramString1))
    {
      if (TextUtils.isEmpty(paramString2)) {
        return null;
      }
      try
      {
        paramString1 = new JSONObject(paramString1);
        boolean bool = paramString1.has(paramString2);
        if (!bool) {
          return null;
        }
        paramString1 = paramString1.get(paramString2);
        if (!(paramString1 instanceof String)) {
          break label88;
        }
        return paramString1;
      }
      catch (JSONException paramString1)
      {
        for (;;) {}
      }
      paramString1 = new StringBuilder();
      paramString1.append("getInfoFromJsonobject:parser json error :");
      paramString1.append(paramString2);
      HMSLog.toString("JsonUtil", paramString1.toString());
      return null;
    }
    label88:
    return null;
  }
  
  public static int getIntValue(JSONObject paramJSONObject, String paramString)
    throws JSONException
  {
    if ((paramJSONObject != null) && (paramJSONObject.has(paramString))) {
      return paramJSONObject.getInt(paramString);
    }
    return -1;
  }
  
  private static Object getObjectValue(String paramString, JSONObject paramJSONObject)
    throws JSONException
  {
    if (paramJSONObject.has(paramString)) {
      return paramJSONObject.get(paramString);
    }
    if ((paramJSONObject.has("header")) && (paramJSONObject.getJSONObject("header").has(paramString))) {
      return paramJSONObject.getJSONObject("header").get(paramString);
    }
    if ((paramJSONObject.has("body")) && (paramJSONObject.getJSONObject("body").has(paramString))) {
      return paramJSONObject.getJSONObject("body").get(paramString);
    }
    return null;
  }
  
  public static String getStringValue(JSONObject paramJSONObject, String paramString)
    throws JSONException
  {
    if ((paramJSONObject != null) && (paramJSONObject.has(paramString))) {
      return paramJSONObject.getString(paramString);
    }
    return null;
  }
  
  public static IMessageEntity jsonToEntity(String paramString, IMessageEntity paramIMessageEntity)
  {
    for (;;)
    {
      try
      {
        localObject = paramIMessageEntity.getClass();
        localJSONObject = new JSONObject(paramString);
        paramString = (String)localObject;
        if (paramString == null) {
          break;
        }
        localObject = paramString.getDeclaredFields();
        int j = localObject.length;
        i = 0;
        if (i < j)
        {
          localField = localObject[i];
          boolean bool = localField.isAnnotationPresent(Packed.class);
          if (!bool) {}
        }
      }
      catch (JSONException paramString)
      {
        JSONObject localJSONObject;
        int i;
        Field localField;
        StringBuilder localStringBuilder;
        Object localObject = new StringBuilder();
        ((StringBuilder)localObject).append("catch JSONException when parse jsonString");
        ((StringBuilder)localObject).append(paramString.getMessage());
        HMSLog.toString("JsonUtil", ((StringBuilder)localObject).toString());
        return paramIMessageEntity;
      }
      try
      {
        readFiled(paramIMessageEntity, localField, localJSONObject);
      }
      catch (IllegalAccessException localIllegalAccessException)
      {
        continue;
      }
      localStringBuilder = new StringBuilder();
      localStringBuilder.append("jsonToEntity, set value of the field exception, field name:");
      localStringBuilder.append(localField.getName());
      HMSLog.toString("JsonUtil", localStringBuilder.toString());
      i += 1;
      continue;
      paramString = paramString.getSuperclass();
    }
    return paramIMessageEntity;
  }
  
  private static byte[] readByte(JSONObject paramJSONObject)
    throws JSONException
  {
    try
    {
      paramJSONObject = Base64.decode(paramJSONObject.getString("_byte_"));
      return paramJSONObject;
    }
    catch (IllegalArgumentException paramJSONObject)
    {
      StringBuilder localStringBuilder = new StringBuilder();
      localStringBuilder.append("readByte failed : ");
      localStringBuilder.append(paramJSONObject.getMessage());
      HMSLog.toString("JsonUtil", localStringBuilder.toString());
    }
    return null;
  }
  
  private static void readFiled(IMessageEntity paramIMessageEntity, Field paramField, JSONObject paramJSONObject)
    throws JSONException, IllegalAccessException
  {
    paramJSONObject = readJson(paramIMessageEntity, paramField, paramJSONObject);
    if (paramJSONObject != null)
    {
      boolean bool = paramField.isAccessible();
      setAccessible(paramField, true);
      paramField.set(paramIMessageEntity, paramJSONObject);
      setAccessible(paramField, bool);
    }
  }
  
  private static Object readJson(IMessageEntity paramIMessageEntity, Field paramField, JSONObject paramJSONObject)
    throws JSONException, IllegalAccessException
  {
    paramIMessageEntity = getObjectValue(paramField.getName(), paramJSONObject);
    if (paramIMessageEntity != null)
    {
      try
      {
        boolean bool = paramField.getType().getName().startsWith("com.huawei");
        if (bool)
        {
          paramJSONObject = paramField.getType().newInstance();
          if ((paramJSONObject instanceof IMessageEntity))
          {
            paramIMessageEntity = (String)paramIMessageEntity;
            paramField = paramField.getType().newInstance();
            paramField = (IMessageEntity)paramField;
            paramIMessageEntity = jsonToEntity(paramIMessageEntity, paramField);
            return paramIMessageEntity;
          }
        }
        if (!(paramIMessageEntity instanceof JSONObject)) {
          return paramIMessageEntity;
        }
        paramJSONObject = (JSONObject)paramIMessageEntity;
        bool = paramJSONObject.has("_val_type_");
        if (!bool) {
          return paramIMessageEntity;
        }
        paramJSONObject = (JSONObject)paramIMessageEntity;
        i = paramJSONObject.getInt("_val_type_");
        if ((i != 1) && (i != 0))
        {
          if (i == 2)
          {
            paramIMessageEntity = (JSONObject)paramIMessageEntity;
            paramIMessageEntity = readByte(paramIMessageEntity);
            return paramIMessageEntity;
          }
          if (i == 3)
          {
            paramField = paramField.getGenericType();
            paramIMessageEntity = (JSONObject)paramIMessageEntity;
            paramIMessageEntity = readMap(paramField, paramIMessageEntity);
            return paramIMessageEntity;
          }
        }
      }
      catch (InstantiationException paramIMessageEntity)
      {
        int i;
        label213:
        for (;;) {}
      }
      try
      {
        paramIMessageEntity = new StringBuilder();
        paramIMessageEntity.append("cannot support type : ");
        paramIMessageEntity.append(i);
        HMSLog.toString("JsonUtil", paramIMessageEntity.toString());
        return null;
      }
      catch (InstantiationException paramIMessageEntity)
      {
        break label213;
      }
      paramField = paramField.getGenericType();
      paramIMessageEntity = (JSONObject)paramIMessageEntity;
      paramIMessageEntity = readList(paramField, paramIMessageEntity);
      return paramIMessageEntity;
      HMSLog.toString("JsonUtil", "InstantiationException  ");
      return null;
    }
    return null;
    return paramIMessageEntity;
  }
  
  private static List readList(Type paramType, JSONObject paramJSONObject)
    throws JSONException, IllegalAccessException, InstantiationException
  {
    int j = paramJSONObject.getInt("_list_size_");
    int k = paramJSONObject.getInt("_val_type_");
    ArrayList localArrayList = new ArrayList(j);
    int i = 0;
    while (i < j)
    {
      Object localObject1 = new StringBuilder();
      ((StringBuilder)localObject1).append("_list_item_");
      ((StringBuilder)localObject1).append(i);
      localObject1 = paramJSONObject.get(((StringBuilder)localObject1).toString());
      if (k == 0)
      {
        Object localObject2 = ((Class)((java.lang.reflect.ParameterizedType)paramType).getActualTypeArguments()[0]).newInstance();
        localArrayList.add(jsonToEntity((String)localObject1, (IMessageEntity)localObject2));
      }
      else if (k == 1)
      {
        localArrayList.add(localObject1);
      }
      i += 1;
    }
    return localArrayList;
  }
  
  private static Map readMap(Type paramType, JSONObject paramJSONObject)
    throws JSONException, IllegalAccessException, InstantiationException
  {
    paramType = (Class)((java.lang.reflect.ParameterizedType)paramType).getActualTypeArguments()[1];
    paramJSONObject = new JSONArray(paramJSONObject.getString("_map_"));
    HashMap localHashMap = new HashMap();
    int i = 0;
    while (i < paramJSONObject.length())
    {
      if ((paramType.newInstance() instanceof IMessageEntity))
      {
        IMessageEntity localIMessageEntity = jsonToEntity(paramJSONObject.getString(i + 1), (IMessageEntity)paramType.newInstance());
        localHashMap.put(paramJSONObject.get(i), localIMessageEntity);
      }
      else
      {
        localHashMap.put(paramJSONObject.get(i), paramJSONObject.get(i + 1));
      }
      i += 2;
    }
    return localHashMap;
  }
  
  private static void setAccessible(Field paramField, final boolean paramBoolean)
  {
    AccessController.doPrivileged(new PrivilegedAction()
    {
      public Object run()
      {
        val$field.setAccessible(paramBoolean);
        return null;
      }
    });
  }
  
  private static void writeByte(String paramString, byte[] paramArrayOfByte, JSONObject paramJSONObject)
    throws JSONException
  {
    JSONObject localJSONObject = new JSONObject();
    localJSONObject.put("_val_type_", 2);
    try
    {
      localJSONObject.put("_byte_", Base64.encode(paramArrayOfByte));
    }
    catch (IllegalArgumentException paramArrayOfByte)
    {
      StringBuilder localStringBuilder = new StringBuilder();
      localStringBuilder.append("writeByte failed : ");
      localStringBuilder.append(paramArrayOfByte.getMessage());
      HMSLog.toString("JsonUtil", localStringBuilder.toString());
    }
    paramJSONObject.put(paramString, localJSONObject);
  }
  
  private static void writeList(String paramString, List paramList, JSONObject paramJSONObject)
    throws JSONException, IllegalAccessException
  {
    JSONObject localJSONObject = new JSONObject();
    localJSONObject.put("_val_type_", 1);
    localJSONObject.put("_list_size_", paramList.size());
    int i = 0;
    while (i < paramList.size())
    {
      StringBuilder localStringBuilder = new StringBuilder();
      localStringBuilder.append("_list_item_");
      localStringBuilder.append(i);
      disposeType(localStringBuilder.toString(), paramList.get(i), localJSONObject);
      if ((paramList.get(i) instanceof IMessageEntity)) {
        localJSONObject.put("_val_type_", 0);
      }
      i += 1;
    }
    paramJSONObject.put(paramString, localJSONObject);
  }
  
  private static void writeMap(String paramString, Map paramMap, JSONObject paramJSONObject)
    throws JSONException, IllegalAccessException
  {
    Object localObject1 = paramMap.entrySet().iterator();
    paramMap = new JSONArray();
    while (((Iterator)localObject1).hasNext())
    {
      Object localObject3 = (Map.Entry)((Iterator)localObject1).next();
      Object localObject2 = ((Map.Entry)localObject3).getKey();
      localObject3 = ((Map.Entry)localObject3).getValue();
      if ((localObject2 instanceof IMessageEntity)) {
        paramMap.put(createInnerJsonString((IMessageEntity)localObject2));
      } else {
        paramMap.put(localObject2);
      }
      if ((localObject3 instanceof IMessageEntity)) {
        paramMap.put(createInnerJsonString((IMessageEntity)localObject3));
      } else {
        paramMap.put(localObject3);
      }
    }
    localObject1 = new JSONObject();
    ((JSONObject)localObject1).put("_val_type_", 3);
    ((JSONObject)localObject1).put("_map_", paramMap.toString());
    paramJSONObject.put(paramString, localObject1);
  }
}
