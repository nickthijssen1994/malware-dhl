package com.huawei.hms.push.utils;

import android.app.ActivityManager;
import android.app.ActivityManager.RunningAppProcessInfo;
import android.content.Context;
import android.content.Intent;
import android.os.BaseBundle;
import android.os.Bundle;
import android.text.TextUtils;
import com.huawei.hms.aaid.constant.ErrorEnum;
import com.huawei.hms.aaid.plugin.ProxyCenter;
import com.huawei.hms.aaid.plugin.PushProxy;
import com.huawei.hms.aaid.utils.PushPreferences;
import com.huawei.hms.push.c;
import com.huawei.hms.support.model.HMSLog;
import com.huawei.hms.support.mozilla.push.base.RemoteService;
import com.huawei.hms.support.mozilla.push.pushselfshow.SelfShow;
import com.huawei.hms.support.mozilla.push.utils.common.NotificationUtil;
import com.huawei.hms.support.mozilla.push.utils.common.base.PushConst;
import com.huawei.hms.utils.ResourceLoaderUtil;
import java.util.Iterator;
import java.util.List;
import org.json.JSONException;
import org.json.JSONObject;

public class PluginUtil
{
  public PluginUtil() {}
  
  public static void a(Context paramContext, String paramString1, String paramString2, String paramString3)
  {
    HMSLog.append("PluginUtil", "onNotification");
    if (!NotificationUtil.areNotificationsEnabled(paramContext))
    {
      paramString2 = new StringBuilder();
      paramString2.append(paramContext.getPackageName());
      paramString2.append(" disable display notification.");
      HMSLog.append("PluginUtil", paramString2.toString());
      c.b(paramContext, paramString1, "103");
      return;
    }
    paramString1 = new Intent();
    paramString1.setAction("com.huawei.push.msg.NOTIFY_MSG");
    paramString1.putExtra("selfshow_info", paramString3.getBytes(PushConst.UTF_8));
    paramString1.putExtra("selfshow_token", paramString2.getBytes(PushConst.UTF_8));
    paramString1.setPackage(paramContext.getPackageName());
    SelfShow.onReceive(paramContext, paramString1);
    HMSLog.append("PluginUtil", "invokeSelfShow done");
  }
  
  public static boolean add(Context paramContext, String[] paramArrayOfString)
  {
    if (TextUtils.equals(paramArrayOfString[1], "0"))
    {
      if (!doInBackground(paramContext)) {
        return TextUtils.equals(paramArrayOfString[2], "1");
      }
    }
    else {
      return false;
    }
    return true;
  }
  
  public static boolean doInBackground(Context paramContext)
  {
    Iterator localIterator = ((ActivityManager)paramContext.getSystemService("activity")).getRunningAppProcesses().iterator();
    boolean bool = true;
    while (localIterator.hasNext())
    {
      ActivityManager.RunningAppProcessInfo localRunningAppProcessInfo = (ActivityManager.RunningAppProcessInfo)localIterator.next();
      if (processName.equals(paramContext.getPackageName()))
      {
        int i = importance;
        if ((i != 100) && (i != 200)) {
          bool = true;
        } else {
          bool = false;
        }
      }
    }
    return bool;
  }
  
  public static boolean onDataMessage(Context paramContext, String paramString1, String paramString2)
  {
    HMSLog.append("PluginUtil", "onMessageReceived");
    if (TextUtils.isEmpty(paramString2))
    {
      HMSLog.append("PluginUtil", "Empty message received");
      return true;
    }
    c.b(paramContext, paramString1, "102");
    Intent localIntent = new Intent("com.huawei.push.action.MESSAGING_EVENT");
    localIntent.setPackage(paramContext.getPackageName());
    Bundle localBundle = new Bundle();
    localBundle.putString("message_id", paramString1);
    localBundle.putByteArray("message_body", paramString2.getBytes(PushConst.UTF_8));
    localBundle.putString("message_type", "received_message");
    return new RemoteService().startMsgService(paramContext, localBundle, localIntent);
  }
  
  public static void onDataMessageArrived(Context paramContext, String paramString)
  {
    c.b(paramContext, paramString, "102");
  }
  
  public static boolean onDeletedMessages(Context paramContext)
  {
    HMSLog.append("PluginUtil", "onDeletedMessages");
    if (paramContext == null) {
      return false;
    }
    Intent localIntent = new Intent("com.huawei.push.action.MESSAGING_EVENT");
    localIntent.setPackage(paramContext.getPackageName());
    Bundle localBundle = new Bundle();
    localBundle.putString("message_proxy_type", ProxyCenter.getProxy().getProxyType());
    localBundle.putString("message_type", "server_deleted_message");
    return new RemoteService().startMsgService(paramContext, localBundle, localIntent);
  }
  
  public static void onMessage(Context paramContext, String[] paramArrayOfString)
  {
    HMSLog.append("PluginUtil", "onMessage");
    if ((paramContext != null) && (paramArrayOfString != null))
    {
      if (paramArrayOfString.length < 5) {
        return;
      }
      if (ResourceLoaderUtil.getmContext() == null) {
        ResourceLoaderUtil.setmContext(paramContext.getApplicationContext());
      }
      if (add(paramContext, paramArrayOfString))
      {
        a(paramContext, paramArrayOfString[0], paramArrayOfString[3], paramArrayOfString[4]);
        return;
      }
      onDataMessage(paramContext, paramArrayOfString[0], paramArrayOfString[4]);
    }
  }
  
  public static boolean onNewToken(Context paramContext, String paramString1, String paramString2, ErrorEnum paramErrorEnum)
  {
    HMSLog.append("PluginUtil", "onNewToken called.");
    Intent localIntent = new Intent("com.huawei.push.action.MESSAGING_EVENT");
    localIntent.setPackage(paramContext.getPackageName());
    Bundle localBundle = new Bundle();
    localBundle.putInt("error", paramErrorEnum.getInternalCode());
    localBundle.putString("message_type", "new_token");
    localBundle.putString("device_token", paramString1);
    if (TextUtils.equals(paramString2, paramContext.getPackageName())) {
      localBundle.putString("subjectId", null);
    } else {
      localBundle.putString("subjectId", paramString2);
    }
    localBundle.putString("message_proxy_type", ProxyCenter.getProxy().getProxyType());
    return new RemoteService().startMsgService(paramContext, localBundle, localIntent);
  }
  
  public static void onNotificationArrived(Context paramContext, String paramString)
  {
    c.b(paramContext, paramString, "100");
  }
  
  public static void onNotificationClicked(Context paramContext, String paramString)
  {
    c.b(paramContext, paramString, "1");
  }
  
  public static boolean onOldDataMessage(Context paramContext, String paramString1, String paramString2)
  {
    if (ResourceLoaderUtil.getmContext() == null) {
      ResourceLoaderUtil.setmContext(paramContext.getApplicationContext());
    }
    return onDataMessage(paramContext, paramString1, upload(paramString2));
  }
  
  public static void saveNotifySwitch(Context paramContext, boolean paramBoolean)
  {
    new PushPreferences(paramContext, "push_notify_flag").saveBoolean("notify_msg_enable", paramBoolean);
  }
  
  public static String upload(String paramString)
  {
    if (TextUtils.isEmpty(paramString)) {
      return null;
    }
    try
    {
      localJSONObject1 = new JSONObject();
      localJSONObject2 = new JSONObject();
    }
    catch (JSONException paramString)
    {
      JSONObject localJSONObject1;
      JSONObject localJSONObject2;
      label50:
      for (;;) {}
    }
    try
    {
      localJSONObject1.put("data", paramString);
    }
    catch (JSONException paramString)
    {
      break label50;
    }
    try
    {
      localJSONObject2.put("msgContent", localJSONObject1);
      paramString = localJSONObject2.toString();
      return paramString;
    }
    catch (JSONException paramString)
    {
      break label50;
    }
    HMSLog.toString("PluginUtil", "rebuild message failed");
    return null;
  }
}
