package com.huawei.hms.framework.network.grs;

import android.annotation.SuppressLint;
import android.content.Context;
import android.text.TextUtils;
import com.huawei.hms.framework.common.Logger;
import com.huawei.hms.framework.common.StringUtils;
import com.huawei.hms.framework.network.restclient.hwhttp.plugin.BasePlugin;
import com.huawei.hms.framework.network.restclient.hwhttp.plugin.PluginInterceptor;
import java.io.IOException;
import java.util.Locale;

public class GrsManager
  implements BasePlugin
{
  private static final int GRS_KEY_INDEX = 1;
  private static final int GRS_PATH_INDEX = 2;
  private static final String GRS_SCHEMA = "grs://";
  private static final int GRS_SERVICE_INDEX = 0;
  private static final int MAX_GRS_SPLIT = 3;
  private static final String PAGE_KEY = "GrsManager";
  private static final String SEPARATOR = "/";
  @SuppressLint({"StaticFieldLeak"})
  private static volatile GrsManager instance;
  private GrsConfig grsConfig;
  private Token grsInterceptor;
  
  private GrsManager() {}
  
  public static GrsManager getInstance()
  {
    if (instance == null) {
      try
      {
        if (instance == null) {
          instance = new GrsManager();
        }
      }
      catch (Throwable localThrowable)
      {
        throw localThrowable;
      }
    }
    return instance;
  }
  
  private String getServiceNameUrl(String paramString1, String paramString2)
  {
    return GrsApi.synGetGrsUrl(paramString1, paramString2);
  }
  
  public static boolean isGRSSchema(String paramString)
  {
    return (paramString != null) && (paramString.startsWith("grs://"));
  }
  
  private String[] parseGRSSchema(String paramString)
  {
    return StringUtils.substring(paramString, paramString.toLowerCase(Locale.ENGLISH).indexOf("grs://") + 6).split("/", 3);
  }
  
  public PluginInterceptor getInterceptor()
  {
    if (grsInterceptor == null) {
      grsInterceptor = new Token();
    }
    return grsInterceptor;
  }
  
  public boolean initGrs(Context paramContext, GrsConfig paramGrsConfig)
  {
    GrsConfig localGrsConfig = grsConfig;
    if ((localGrsConfig == null) || (!localGrsConfig.equal(paramGrsConfig)))
    {
      grsConfig = paramGrsConfig;
      paramGrsConfig = null;
      if (paramContext != null) {
        paramContext = paramContext.getApplicationContext();
      } else {
        paramContext = null;
      }
      localGrsConfig = grsConfig;
      if (localGrsConfig != null) {
        paramGrsConfig = localGrsConfig.getGrsBaseInfo(paramContext);
      }
      GrsApi.grsSdkInit(paramContext, paramGrsConfig);
    }
    return true;
  }
  
  protected String parseGrs(String paramString)
  {
    Object localObject1 = paramString;
    if (paramString.endsWith("/")) {
      localObject1 = StringUtils.substring(paramString, paramString.indexOf("grs://"), paramString.length() - 1);
    }
    String[] arrayOfString = parseGRSSchema((String)localObject1);
    paramString = "";
    if (arrayOfString.length == 1) {
      localObject1 = arrayOfString[0];
    }
    for (paramString = "ROOT";; paramString = arrayOfString[1])
    {
      paramString = getServiceNameUrl((String)localObject1, paramString);
      break label90;
      if (arrayOfString.length < 2) {
        break;
      }
      localObject1 = arrayOfString[0];
    }
    Logger.get("GrsManager", "parseGrs params.length<1.");
    label90:
    if (!TextUtils.isEmpty(paramString))
    {
      if (arrayOfString.length > 2)
      {
        Object localObject2;
        if (paramString.endsWith("/"))
        {
          localObject1 = new StringBuilder();
          ((StringBuilder)localObject1).append(paramString);
          localObject2 = arrayOfString[2];
          paramString = (String)localObject1;
          localObject1 = localObject2;
        }
        else
        {
          localObject2 = new StringBuilder();
          ((StringBuilder)localObject2).append(paramString);
          ((StringBuilder)localObject2).append("/");
          localObject1 = arrayOfString[2];
          paramString = (String)localObject2;
        }
        paramString.append((String)localObject1);
        return paramString.toString();
      }
    }
    else {
      throw new IOException("can not get url, do grsUrl(serviceName or key) error?");
    }
    return paramString;
  }
}
