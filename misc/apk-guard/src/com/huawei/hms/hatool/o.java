package com.huawei.hms.hatool;

import com.huawei.secure.android.common.encrypt.hash.PBKDF2;
import com.huawei.secure.android.common.encrypt.utils.EncryptUtil;
import com.huawei.secure.android.common.encrypt.utils.HexUtil;
import java.io.File;
import java.io.IOException;

public class o
{
  public String b = b.f().getFilesDir().getPath();
  
  public o() {}
  
  public static boolean a()
  {
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append(b.f().getFilesDir().getPath());
    localStringBuilder.append("/");
    localStringBuilder.append("hms");
    return copyFiles(new File(localStringBuilder.toString()));
  }
  
  public static boolean copyFiles(File paramFile)
  {
    int i = 0;
    if ((paramFile != null) && (paramFile.exists()))
    {
      if (!paramFile.isDirectory()) {
        return false;
      }
      File[] arrayOfFile = paramFile.listFiles();
      if (arrayOfFile != null)
      {
        if (arrayOfFile.length == 0) {
          return false;
        }
        int j = arrayOfFile.length;
        while (i < j)
        {
          File localFile = arrayOfFile[i];
          if (localFile.isFile())
          {
            if (!localFile.delete())
            {
              StringBuilder localStringBuilder = new StringBuilder();
              localStringBuilder.append("delete file failed : ");
              localStringBuilder.append(localFile.getName());
              Log.i("hmsSdk", localStringBuilder.toString());
            }
          }
          else if (localFile.isDirectory()) {
            copyFiles(localFile);
          }
          i += 1;
        }
        return paramFile.delete();
      }
    }
    return false;
  }
  
  public final String a(String paramString)
  {
    String str = c(paramString);
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append("hianalytics_");
    localStringBuilder.append(paramString);
    paramString = new File(str, localStringBuilder.toString());
    if (c(paramString)) {
      return SignatureReader.a(paramString);
    }
    str = EncryptUtil.generateSecureRandomStr(128);
    SignatureReader.a(paramString, str);
    return str;
  }
  
  public final void a(String paramString1, String paramString2)
  {
    File localFile = new File(c(paramString1));
    String str = c(paramString1);
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append("hianalytics_");
    localStringBuilder.append(paramString1);
    paramString1 = new File(str, localStringBuilder.toString());
    if ((!localFile.exists()) && (localFile.mkdirs())) {
      Log.i("hmsSdk", "file directory is mkdirs");
    }
    if (c(paramString1))
    {
      SignatureReader.a(paramString1, paramString2);
      return;
    }
    Log.e("hmsSdk", "refreshComponent():file is not found,and file is create failed");
  }
  
  public final char[] a(String paramString1, String paramString2, String paramString3, String paramString4)
  {
    paramString1 = HexUtil.hexStr2ByteArray(paramString1);
    paramString2 = HexUtil.hexStr2ByteArray(paramString2);
    paramString3 = HexUtil.hexStr2ByteArray(paramString3);
    paramString4 = HexUtil.hexStr2ByteArray(paramString4);
    int j = paramString1.length;
    int i = j;
    if (j > paramString2.length) {
      i = paramString2.length;
    }
    j = i;
    if (i > paramString3.length) {
      j = paramString3.length;
    }
    i = j;
    if (j > paramString4.length) {
      i = paramString4.length;
    }
    char[] arrayOfChar = new char[i];
    j = 0;
    while (j < i)
    {
      arrayOfChar[j] = ((char)(paramString1[j] ^ paramString2[j] ^ paramString3[j] ^ paramString4[j]));
      j += 1;
    }
    return arrayOfChar;
  }
  
  public String c()
  {
    String str2 = getItem();
    Object localObject2;
    Object localObject1;
    Object localObject4;
    Object localObject3;
    if (save())
    {
      Log.i("hmsSdk", "refresh components");
      localObject2 = EncryptUtil.generateSecureRandomStr(128);
      localObject1 = localObject2;
      a("aprpap", (String)localObject2);
      localObject2 = EncryptUtil.generateSecureRandomStr(128);
      localObject4 = localObject2;
      a("febdoc", (String)localObject2);
      localObject3 = EncryptUtil.generateSecureRandomStr(128);
      localObject2 = localObject3;
      a("marfil", (String)localObject3);
      String str1 = EncryptUtil.generateSecureRandomStr(128);
      localObject3 = str1;
      a("maywnj", str1);
      Context.put(b.f(), "Privacy_MY", "assemblyFlash", System.currentTimeMillis());
    }
    else
    {
      localObject1 = a("aprpap");
      localObject4 = a("febdoc");
      localObject2 = a("marfil");
      localObject3 = a("maywnj");
    }
    return HexUtil.byteArray2HexStr(PBKDF2.pbkdf2(a((String)localObject1, (String)localObject4, (String)localObject2, str2), HexUtil.hexStr2ByteArray((String)localObject3), 10000, 16));
  }
  
  public final String c(String paramString)
  {
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append(b);
    localStringBuilder.append("/hms/component/".replace("component", paramString));
    return localStringBuilder.toString();
  }
  
  public final boolean c(File paramFile)
  {
    if (paramFile.exists()) {
      return true;
    }
    try
    {
      boolean bool = paramFile.createNewFile();
      return bool;
    }
    catch (IOException paramFile)
    {
      for (;;) {}
    }
    Log.e("hmsSdk", "create new file error!");
    return false;
  }
  
  public final String getItem()
  {
    return "f6040d0e807aaec325ecf44823765544e92905158169f694b282bf17388632cf95a83bae7d2d235c1f039b0df1dcca5fda619b6f7f459f2ff8d70ddb7b601592fe29fcae58c028f319b3b12495e67aa5390942a997a8cb572c8030b2df5c2b622608bea02b0c3e5d4dff3f72c9e3204049a45c0760cd3604af8d57f0e0c693cc";
  }
  
  public final boolean save()
  {
    long l = Context.getLong(b.f(), "Privacy_MY", "assemblyFlash", -1L);
    if (-1L == l)
    {
      Log.i("hmsSdk", "First init components");
      return true;
    }
    return System.currentTimeMillis() - l > 31536000000L;
  }
}
