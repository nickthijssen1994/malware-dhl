package com.huawei.hms.opendevice;

import android.content.Context;
import android.content.pm.PackageItemInfo;
import android.content.pm.PackageManager;
import android.content.pm.PackageManager.NameNotFoundException;
import android.os.BaseBundle;
import android.text.TextUtils;
import com.huawei.agconnect.config.AGConnectServicesConfig;
import com.huawei.hms.aaid.HmsInstanceId;
import com.huawei.hms.aaid.entity.DeleteTokenReq;
import com.huawei.hms.aaid.entity.TokenReq;
import com.huawei.hms.aaid.utils.PushPreferences;
import com.huawei.hms.support.model.HMSLog;
import com.huawei.hms.utils.Util;
import java.util.UUID;

public class b
{
  public static DeleteTokenReq a(Context paramContext)
  {
    return c(paramContext, null, null, null, null);
  }
  
  public static DeleteTokenReq a(Context paramContext, String paramString1, String paramString2)
  {
    return c(paramContext, paramString1, null, null, paramString2);
  }
  
  public static TokenReq a(Context paramContext, String paramString)
  {
    return a(paramContext, null, null, paramString, null);
  }
  
  public static TokenReq a(Context paramContext, String paramString1, String paramString2, String paramString3, String paramString4)
  {
    TokenReq localTokenReq = new TokenReq();
    localTokenReq.setPackageName(paramContext.getPackageName());
    localTokenReq.setAppId(paramString1);
    localTokenReq.setScope(paramString4);
    localTokenReq.setProjectId(paramString2);
    localTokenReq.setSubjectId(paramString3);
    localTokenReq.setMultiSender(false);
    if (TextUtils.isEmpty(paramString1)) {
      localTokenReq.setAppId(Util.getAppId(paramContext));
    }
    if (TextUtils.isEmpty(paramString2)) {
      localTokenReq.setProjectId(getString(paramContext));
    }
    if (TextUtils.isEmpty(paramString4)) {
      localTokenReq.setScope("HCM");
    }
    paramContext = ClassWriter.a(paramContext);
    if (!paramContext.getBoolean("hasRequestAgreement"))
    {
      localTokenReq.setFirstTime(true);
      paramContext.saveBoolean("hasRequestAgreement", true);
      return localTokenReq;
    }
    localTokenReq.setFirstTime(false);
    return localTokenReq;
  }
  
  public static String b(Context paramContext)
  {
    paramContext = new PushPreferences(paramContext, "aaid");
    if (paramContext.containsKey("aaid")) {
      return paramContext.getString("aaid");
    }
    return null;
  }
  
  public static DeleteTokenReq c(Context paramContext, String paramString)
  {
    return c(paramContext, null, null, paramString, null);
  }
  
  public static DeleteTokenReq c(Context paramContext, String paramString1, String paramString2, String paramString3, String paramString4)
  {
    DeleteTokenReq localDeleteTokenReq = new DeleteTokenReq();
    localDeleteTokenReq.setAppId(paramString1);
    localDeleteTokenReq.setScope(paramString4);
    localDeleteTokenReq.setProjectId(paramString2);
    localDeleteTokenReq.setPkgName(paramContext.getPackageName());
    localDeleteTokenReq.setSubjectId(paramString3);
    if (TextUtils.isEmpty(paramString1)) {
      localDeleteTokenReq.setAppId(Util.getAppId(paramContext));
    }
    if (TextUtils.isEmpty(paramString4)) {
      localDeleteTokenReq.setScope("HCM");
    }
    if (TextUtils.isEmpty(paramString2)) {
      localDeleteTokenReq.setProjectId(getString(paramContext));
    }
    return localDeleteTokenReq;
  }
  
  public static boolean evaluate(Context paramContext)
  {
    for (;;)
    {
      try
      {
        paramContext = paramContext.getPackageManager().getApplicationInfo(paramContext.getPackageName(), 128);
        if (paramContext == null) {
          break label67;
        }
        if (metaData == null) {
          return false;
        }
        paramContext = metaData;
      }
      catch (PackageManager.NameNotFoundException paramContext)
      {
        boolean bool;
        continue;
      }
      try
      {
        bool = TextUtils.isEmpty(paramContext.getString("com.huawei.hms.client.service.name:base"));
        if (!bool) {
          continue;
        }
        return false;
      }
      catch (PackageManager.NameNotFoundException paramContext) {}
    }
    HMSLog.toString(HmsInstanceId.i, "isIntegratedBaseSdk failed.");
    return true;
    label67:
    return false;
  }
  
  public static String get(Context paramContext)
  {
    try
    {
      PushPreferences localPushPreferences = new PushPreferences(paramContext, "aaid");
      if (localPushPreferences.containsKey("aaid"))
      {
        paramContext = localPushPreferences.getString("aaid");
      }
      else
      {
        String str = UUID.randomUUID().toString();
        paramContext = str;
        localPushPreferences.saveString("aaid", str);
        localPushPreferences.saveLong("creationTime", Long.valueOf(System.currentTimeMillis()));
      }
      return paramContext;
    }
    catch (Throwable paramContext)
    {
      throw paramContext;
    }
  }
  
  public static String getString(Context paramContext)
  {
    return AGConnectServicesConfig.fromContext(paramContext).getString("client/project_id");
  }
  
  public static TokenReq getType(Context paramContext, String paramString1, String paramString2)
  {
    return a(paramContext, paramString1, null, null, paramString2);
  }
}
