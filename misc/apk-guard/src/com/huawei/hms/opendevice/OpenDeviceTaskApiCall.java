package com.huawei.hms.opendevice;

import com.huawei.hms.common.ApiException;
import com.huawei.hms.common.internal.BaseHmsClient;
import com.huawei.hms.common.internal.ResponseErrorCode;
import com.huawei.hms.common.internal.TaskApiCall;
import com.huawei.hms.support.hianalytics.HiAnalyticsClient;
import com.huawei.hms.support.model.HMSLog;
import com.huawei.hms.support.mozilla.client.Result;
import com.huawei.hms.support.mozilla.client.Status;
import com.huawei.hms.support.mozilla.entity.opendevice.OdidResp;
import com.huawei.hms.utils.JsonUtil;
import com.huawei.provider.tasks.TaskCompletionSource;

public class OpenDeviceTaskApiCall
  extends TaskApiCall<OpenDeviceHmsClient, com.huawei.hms.support.api.opendevice.OdidResult>
{
  public OpenDeviceTaskApiCall(String paramString1, String paramString2, String paramString3)
  {
    super(paramString1, paramString2, paramString3);
  }
  
  public void doExecute(OpenDeviceHmsClient paramOpenDeviceHmsClient, ResponseErrorCode paramResponseErrorCode, String paramString, TaskCompletionSource paramTaskCompletionSource)
  {
    if (paramResponseErrorCode == null)
    {
      paramTaskCompletionSource.setException(new ApiException(new Status(1)));
      return;
    }
    HiAnalyticsClient.reportExit(paramOpenDeviceHmsClient.getContext(), getUri(), getTransactionId(), paramResponseErrorCode.getStatusCode(), paramResponseErrorCode.getErrorCode(), 50004300);
    if (paramResponseErrorCode.getErrorCode() == 0)
    {
      HMSLog.append("OpenDeviceTaskApiCall", "onResult, success");
      paramOpenDeviceHmsClient = new OdidResp();
      JsonUtil.jsonToEntity(paramString, paramOpenDeviceHmsClient);
      paramResponseErrorCode = new com.huawei.hms.support.mozilla.opendevice.OdidResult();
      paramResponseErrorCode.setId(paramOpenDeviceHmsClient.getId());
      paramResponseErrorCode.setStatus(new Status(0));
      paramTaskCompletionSource.setResult(paramResponseErrorCode);
      return;
    }
    paramOpenDeviceHmsClient = new StringBuilder();
    paramOpenDeviceHmsClient.append("onResult, returnCode: ");
    paramOpenDeviceHmsClient.append(paramResponseErrorCode.getErrorCode());
    HMSLog.append("OpenDeviceTaskApiCall", paramOpenDeviceHmsClient.toString());
    paramTaskCompletionSource.setException(new ApiException(new Status(paramResponseErrorCode.getErrorCode(), paramResponseErrorCode.getErrorReason())));
  }
  
  public int getApiLevel()
  {
    return 2;
  }
  
  public int getMinApkVersion()
  {
    return 50002300;
  }
}
