package com.huawei.hms.activity;

import android.app.Activity;
import android.content.ContextWrapper;
import android.content.Intent;
import android.text.TextUtils;
import com.huawei.hms.activity.internal.BusResponseCallback;
import com.huawei.hms.activity.internal.ForegroundBusResponseMgr;
import com.huawei.hms.activity.internal.ForegroundInnerHeader;
import com.huawei.hms.common.internal.RequestHeader;
import com.huawei.hms.common.internal.TransactionIdCreater;
import com.huawei.hms.utils.Util;

public class ForegroundIntentBuilder
{
  private Activity activity;
  private String foregroundBody;
  private RequestHeader foregroundHeader;
  private ForegroundInnerHeader innerHeader;
  
  public ForegroundIntentBuilder(Activity paramActivity)
    throws IllegalArgumentException
  {
    if (paramActivity != null)
    {
      activity = paramActivity;
      foregroundHeader = new RequestHeader();
      foregroundHeader.setPkgName(paramActivity.getPackageName());
      foregroundHeader.setSdkVersion(50005300);
      foregroundBody = "";
      innerHeader = new ForegroundInnerHeader();
      innerHeader.setApkVersion(30000000);
      return;
    }
    throw new IllegalArgumentException("listener must not be null.");
  }
  
  public static void registerResponseCallback(String paramString, BusResponseCallback paramBusResponseCallback)
  {
    ForegroundBusResponseMgr.getInstance().registerObserver(paramString, paramBusResponseCallback);
  }
  
  public static void unregisterResponseCallback(String paramString)
  {
    ForegroundBusResponseMgr.getInstance().unRegisterObserver(paramString);
  }
  
  public Intent build()
  {
    Intent localIntent = BridgeActivity.getIntentStartBridgeActivity(activity, ForegroundBusDelegate.class.getName());
    RequestHeader localRequestHeader;
    StringBuilder localStringBuilder;
    if (foregroundHeader.getAppID() == null)
    {
      localRequestHeader = foregroundHeader;
      localStringBuilder = new StringBuilder();
      localStringBuilder.append(Util.getAppId(activity));
      localStringBuilder.append("|");
      localRequestHeader.setAppID(localStringBuilder.toString());
    }
    else
    {
      localRequestHeader = foregroundHeader;
      localStringBuilder = new StringBuilder();
      localStringBuilder.append(Util.getAppId(activity));
      localStringBuilder.append("|");
      localStringBuilder.append(foregroundHeader.getAppID());
      localRequestHeader.setAppID(localStringBuilder.toString());
    }
    if (TextUtils.isEmpty(foregroundHeader.getTransactionId()))
    {
      localRequestHeader = foregroundHeader;
      localRequestHeader.setTransactionId(TransactionIdCreater.getId(localRequestHeader.getAppID(), "hub.request"));
    }
    localIntent.putExtra("HMS_FOREGROUND_REQ_HEADER", foregroundHeader.toJson());
    localIntent.putExtra("HMS_FOREGROUND_REQ_BODY", foregroundBody);
    localIntent.putExtra("HMS_FOREGROUND_REQ_INNER", innerHeader.toJson());
    return localIntent;
  }
  
  public ForegroundIntentBuilder setAction(String paramString)
  {
    foregroundHeader.setApiName(paramString);
    return this;
  }
  
  public ForegroundIntentBuilder setKitSdkVersion(int paramInt)
  {
    foregroundHeader.setKitSdkVersion(paramInt);
    return this;
  }
  
  public ForegroundIntentBuilder setMinApkVersion(int paramInt)
  {
    innerHeader.setApkVersion(paramInt);
    return this;
  }
  
  public ForegroundIntentBuilder setRequestBody(String paramString)
  {
    foregroundBody = paramString;
    return this;
  }
  
  public ForegroundIntentBuilder setResponseCallback(String paramString)
  {
    innerHeader.setResponseCallbackKey(paramString);
    return this;
  }
  
  public ForegroundIntentBuilder setResponseCallback(String paramString, BusResponseCallback paramBusResponseCallback)
  {
    innerHeader.setResponseCallbackKey(paramString);
    ForegroundBusResponseMgr.getInstance().registerObserver(paramString, paramBusResponseCallback);
    return this;
  }
  
  public ForegroundIntentBuilder setServiceName(String paramString)
  {
    foregroundHeader.setSrvName(paramString);
    return this;
  }
  
  public ForegroundIntentBuilder setSubAppId(String paramString)
  {
    foregroundHeader.setAppID(paramString);
    return this;
  }
  
  public ForegroundIntentBuilder setTransactionId(String paramString)
  {
    foregroundHeader.setTransactionId(paramString);
    return this;
  }
}
