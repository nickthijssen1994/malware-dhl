package com.jd.fireeye.security;

import android.content.Context;
import android.content.SharedPreferences;
import android.text.TextUtils;
import com.jd.fireeye.common.Attribute;
import com.jd.fireeye.common.Log;
import com.jd.fireeye.common.Type;
import com.jd.fireeye.common.b;
import com.jd.fireeye.common.c;
import com.jd.fireeye.common.f;
import org.json.JSONException;
import org.json.JSONObject;

public class TrackOrder
{
  private static final String BETA_FIRST_ORDER_URL = "https://beta-fireye.m.jd.com/tracking/app/getTracking";
  private static final String FIRST_ORDER_URL = "https://fireye.m.jd.com/tracking/app/getTracking";
  private static final String PAGE_KEY = "JDMob.Security.TrackOrder";
  private static final String TRACK_KEY = "track_id";
  private static final String TRACK_SIGNATURE = "track_signature";
  private static final String TRACK_SOURCE_NAME = "track_source_name";
  private static SharedPreferences shareStore;
  
  public TrackOrder() {}
  
  private static JSONObject buildFirstOrderRequest(JSONObject paramJSONObject)
    throws JSONException
  {
    JSONObject localJSONObject = new JSONObject();
    if (paramJSONObject != null)
    {
      String str1 = paramJSONObject.optString("firstorderUnion");
      String str2 = paramJSONObject.optString("firstorderChannel");
      String str3 = paramJSONObject.optString("packageName");
      String str4 = paramJSONObject.optString("callerPackage");
      String str5 = Attribute.get(ByteVector.a, str3);
      Object localObject2 = paramJSONObject.optString("firstorderExtended1");
      Object localObject1 = localObject2;
      if (((String)localObject2).length() > 127) {
        localObject1 = ((String)localObject2).substring(0, 126);
      }
      Object localObject3 = paramJSONObject.optString("firstorderExtended2");
      localObject2 = localObject3;
      if (((String)localObject3).length() > 127) {
        localObject2 = ((String)localObject3).substring(0, 126);
      }
      Object localObject4 = paramJSONObject.optString("firstorderExtended3");
      localObject3 = localObject4;
      if (((String)localObject4).length() > 511) {
        localObject3 = ((String)localObject4).substring(0, 510);
      }
      localObject4 = paramJSONObject.optString("firstorderExtended4");
      paramJSONObject = (JSONObject)localObject4;
      if (((String)localObject4).length() > 511) {
        paramJSONObject = ((String)localObject4).substring(0, 510);
      }
      localJSONObject.put("appkey", "1b41a7042ce724d9ecaa5a15fe9fab7a");
      localJSONObject.put("union", str1);
      localJSONObject.put("channel", str2);
      localJSONObject.put("appSign", str5);
      Object localObject5 = ByteVector.getTitle();
      localObject4 = localObject5;
      localObject5 = getEncryptDeviceCode((String)localObject5);
      if (localObject5 != null)
      {
        localObject4 = new StringBuilder();
        ((StringBuilder)localObject4).append(e);
        ((StringBuilder)localObject4).append("-");
        ((StringBuilder)localObject4).append(i);
        localObject4 = ((StringBuilder)localObject4).toString();
        localJSONObject.put("eufv", "1");
      }
      localJSONObject.put("device", localObject4);
      localJSONObject.put("package", str3);
      localJSONObject.put("callerPackage", str4);
      localJSONObject.put("extendedData1", localObject1);
      localJSONObject.put("extendedData2", localObject2);
      localJSONObject.put("extendedData3", localObject3);
      localJSONObject.put("extendedData4", paramJSONObject);
      localObject4 = new StringBuilder();
      localObject5 = new StringBuilder();
      ((StringBuilder)localObject5).append("1b41a7042ce724d9ecaa5a15fe9fab7a");
      ((StringBuilder)localObject5).append(str1);
      ((StringBuilder)localObject5).append(str2);
      ((StringBuilder)localObject5).append(ByteVector.getTitle());
      ((StringBuilder)localObject5).append(str3);
      ((StringBuilder)localObject5).append(str4);
      ((StringBuilder)localObject5).append(str5);
      ((StringBuilder)localObject4).append(Log.init(((StringBuilder)localObject5).toString()));
      localObject5 = new StringBuilder();
      ((StringBuilder)localObject5).append((String)localObject1);
      ((StringBuilder)localObject5).append((String)localObject2);
      ((StringBuilder)localObject5).append((String)localObject3);
      ((StringBuilder)localObject5).append(paramJSONObject);
      ((StringBuilder)localObject4).append(Log.init(((StringBuilder)localObject5).toString()));
      localJSONObject.put("sign", Log.init(((StringBuilder)localObject4).toString()));
    }
    return localJSONObject;
  }
  
  private static b getEncryptDeviceCode(String paramString)
  {
    try
    {
      boolean bool = TextUtils.isEmpty(paramString);
      if (!bool)
      {
        bool = paramString.contains("-");
        if (bool)
        {
          paramString = c.a(paramString);
          return paramString;
        }
      }
    }
    catch (Exception paramString)
    {
      for (;;) {}
    }
    return null;
  }
  
  public static void getFirstOrderTracking(Context paramContext, String paramString, JSONObject paramJSONObject)
  {
    if (TextUtils.equals(paramString, "0"))
    {
      requestAndSaveTracking(paramJSONObject);
      return;
    }
    if (TextUtils.equals(paramString, "1")) {
      putTrackOrderParams(paramContext, paramJSONObject);
    }
  }
  
  private static String getFirstOrderURL()
  {
    if (ByteVector.a()) {
      return "https://beta-fireye.m.jd.com/tracking/app/getTracking";
    }
    return "https://fireye.m.jd.com/tracking/app/getTracking";
  }
  
  public static JSONObject getTrackOrderParams(Context paramContext)
  {
    initialShareStoreFile(paramContext);
    JSONObject localJSONObject = new JSONObject();
    try
    {
      com.jd.fireeye.common.ByteVector.get("JDMob.Security.TrackOrder", "come to getTrackOrderParams");
      Object localObject2 = "";
      Object localObject1 = "";
      Object localObject3 = shareStore;
      if (localObject3 != null)
      {
        String str2 = shareStore.getString("track_id", "");
        localObject3 = str2;
        String str3 = shareStore.getString("track_signature", "");
        String str1 = str3;
        bool = com.jd.fireeye.common.ByteVector.type;
        localObject2 = localObject3;
        localObject1 = str1;
        if (bool)
        {
          localObject1 = new StringBuilder("trackKey = ");
          ((StringBuilder)localObject1).append(str2);
          ((StringBuilder)localObject1).append(",signature = ");
          ((StringBuilder)localObject1).append(str3);
          com.jd.fireeye.common.ByteVector.get("JDMob.Security.TrackOrder", ((StringBuilder)localObject1).toString());
          localObject1 = str1;
          localObject2 = localObject3;
        }
      }
      localObject3 = localObject2;
      if (localObject2 == null) {
        localObject3 = "";
      }
      localJSONObject.put("fe_order_track", localObject3);
      localObject2 = localObject1;
      if (localObject1 == null) {
        localObject2 = "";
      }
      localJSONObject.put("advertise_app", localObject2);
      localObject2 = ByteVector.getTitle();
      localObject1 = localObject2;
      boolean bool = com.jd.fireeye.common.ByteVector.type;
      if (bool)
      {
        localObject3 = new StringBuilder("devicecode = ");
        ((StringBuilder)localObject3).append((String)localObject2);
        com.jd.fireeye.common.ByteVector.get("JDMob.Security.TrackOrder", ((StringBuilder)localObject3).toString());
      }
      bool = Log.a((String)localObject2);
      if (!bool)
      {
        localObject2 = f.b(paramContext);
        paramContext = (Context)localObject2;
        bool = com.jd.fireeye.common.ByteVector.type;
        localObject1 = paramContext;
        if (bool)
        {
          localObject1 = new StringBuilder("get uuid in sdk,devicecode = ");
          ((StringBuilder)localObject1).append((String)localObject2);
          com.jd.fireeye.common.ByteVector.get("JDMob.Security.TrackOrder", ((StringBuilder)localObject1).toString());
          localObject1 = paramContext;
        }
      }
      paramContext = getEncryptDeviceCode((String)localObject1);
      if (paramContext != null)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(e);
        ((StringBuilder)localObject1).append("-");
        ((StringBuilder)localObject1).append(i);
        localObject1 = ((StringBuilder)localObject1).toString();
        localJSONObject.put("eufv", "1");
      }
      localJSONObject.put("uuid", localObject1);
      localJSONObject.put("union_id", ByteVector.read());
      localJSONObject.put("channel_id", ByteVector.length());
      localJSONObject.put("appkey", "1b41a7042ce724d9ecaa5a15fe9fab7a");
    }
    catch (Throwable paramContext)
    {
      paramContext.printStackTrace();
    }
    if (com.jd.fireeye.common.ByteVector.type) {
      com.jd.fireeye.common.ByteVector.get("JDMob.Security.TrackOrder", String.format("getTrackOrderParams json: \n%s", new Object[] { Type.format(localJSONObject.toString()) }));
    }
    return localJSONObject;
  }
  
  private static void initialShareStoreFile(Context paramContext)
  {
    if (shareStore != null) {
      return;
    }
    if (paramContext == null)
    {
      com.jd.fireeye.common.ByteVector.a("JDMob.Security.TrackOrder", "create file but context is null!!!");
      return;
    }
    shareStore = paramContext.getSharedPreferences("jd_order_identify_encrypt_client", 0);
  }
  
  /* Error */
  public static void putTrackOrderParams(Context paramContext, JSONObject paramJSONObject)
  {
    // Byte code:
    //   0: ldc 14
    //   2: ldc_w 276
    //   5: invokestatic 199	com/jd/fireeye/common/ByteVector:get	(Ljava/lang/String;Ljava/lang/String;)V
    //   8: aload_0
    //   9: invokestatic 192	com/jd/fireeye/security/TrackOrder:initialShareStoreFile	(Landroid/content/Context;)V
    //   12: getstatic 203	com/jd/fireeye/security/TrackOrder:shareStore	Landroid/content/SharedPreferences;
    //   15: ifnonnull +4 -> 19
    //   18: return
    //   19: aload_1
    //   20: ifnull +185 -> 205
    //   23: ldc -55
    //   25: astore_3
    //   26: aload_1
    //   27: ldc_w 278
    //   30: invokevirtual 48	org/json/JSONObject:optString	(Ljava/lang/String;)Ljava/lang/String;
    //   33: astore 4
    //   35: aload_1
    //   36: ldc 52
    //   38: invokevirtual 48	org/json/JSONObject:optString	(Ljava/lang/String;)Ljava/lang/String;
    //   41: astore 5
    //   43: getstatic 203	com/jd/fireeye/security/TrackOrder:shareStore	Landroid/content/SharedPreferences;
    //   46: invokeinterface 282 1 0
    //   51: astore 6
    //   53: aload 4
    //   55: invokestatic 157	android/text/TextUtils:isEmpty	(Ljava/lang/CharSequence;)Z
    //   58: istore_2
    //   59: iload_2
    //   60: ifne +15 -> 75
    //   63: aload 6
    //   65: ldc 17
    //   67: aload 4
    //   69: invokeinterface 288 3 0
    //   74: pop
    //   75: aload 5
    //   77: invokestatic 157	android/text/TextUtils:isEmpty	(Ljava/lang/CharSequence;)Z
    //   80: istore_2
    //   81: aload_3
    //   82: astore_1
    //   83: iload_2
    //   84: ifne +50 -> 134
    //   87: new 70	java/lang/String
    //   90: dup
    //   91: aload 5
    //   93: invokevirtual 292	java/lang/String:getBytes	()[B
    //   96: iconst_2
    //   97: invokestatic 298	android/util/Base64:encode	([BI)[B
    //   100: invokespecial 301	java/lang/String:<init>	([B)V
    //   103: astore_1
    //   104: aload 6
    //   106: ldc 23
    //   108: aload_1
    //   109: invokeinterface 288 3 0
    //   114: ldc 20
    //   116: aload_0
    //   117: aload 5
    //   119: invokestatic 66	com/jd/fireeye/common/Attribute:get	(Landroid/content/Context;Ljava/lang/String;)Ljava/lang/String;
    //   122: invokeinterface 288 3 0
    //   127: pop
    //   128: goto +6 -> 134
    //   131: goto +11 -> 142
    //   134: aload 6
    //   136: invokeinterface 304 1 0
    //   141: pop
    //   142: getstatic 213	com/jd/fireeye/common/ByteVector:type	Z
    //   145: ifeq +83 -> 228
    //   148: new 108	java/lang/StringBuilder
    //   151: dup
    //   152: ldc_w 306
    //   155: invokespecial 218	java/lang/StringBuilder:<init>	(Ljava/lang/String;)V
    //   158: astore_0
    //   159: aload_0
    //   160: aload 4
    //   162: invokevirtual 118	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   165: pop
    //   166: aload_0
    //   167: ldc_w 308
    //   170: invokevirtual 118	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   173: pop
    //   174: aload_0
    //   175: aload 5
    //   177: invokevirtual 118	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   180: pop
    //   181: aload_0
    //   182: ldc_w 310
    //   185: invokevirtual 118	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   188: pop
    //   189: aload_0
    //   190: aload_1
    //   191: invokevirtual 118	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   194: pop
    //   195: ldc 14
    //   197: aload_0
    //   198: invokevirtual 126	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   201: invokestatic 199	com/jd/fireeye/common/ByteVector:get	(Ljava/lang/String;Ljava/lang/String;)V
    //   204: return
    //   205: ldc 14
    //   207: ldc_w 312
    //   210: invokestatic 266	com/jd/fireeye/common/ByteVector:a	(Ljava/lang/String;Ljava/lang/String;)V
    //   213: return
    //   214: astore_0
    //   215: aload_3
    //   216: astore_1
    //   217: goto -75 -> 142
    //   220: astore_0
    //   221: goto -90 -> 131
    //   224: astore_0
    //   225: goto -83 -> 142
    //   228: return
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	229	0	paramContext	Context
    //   0	229	1	paramJSONObject	JSONObject
    //   58	26	2	bool	boolean
    //   25	191	3	str1	String
    //   33	128	4	str2	String
    //   41	135	5	str3	String
    //   51	84	6	localEditor	android.content.SharedPreferences.Editor
    // Exception table:
    //   from	to	target	type
    //   43	59	214	java/lang/Throwable
    //   63	75	214	java/lang/Throwable
    //   75	81	214	java/lang/Throwable
    //   87	104	214	java/lang/Throwable
    //   104	128	220	java/lang/Throwable
    //   134	142	224	java/lang/Throwable
  }
  
  private static void requestAndSaveTracking(JSONObject paramJSONObject)
  {
    if (paramJSONObject != null)
    {
      if (com.jd.fireeye.common.ByteVector.type) {
        com.jd.fireeye.common.ByteVector.get("JDMob.Security.TrackOrder", String.format("requestAndSaveTracking param json: \n%s", new Object[] { Type.format(paramJSONObject.toString()) }));
      }
      if (TextUtils.isEmpty(paramJSONObject.optString("firstorderUnion"))) {
        return;
      }
      AsyncSpdyConnection.SpdySocket localSpdySocket = new AsyncSpdyConnection.SpdySocket(getFirstOrderURL(), paramJSONObject);
      localSpdySocket.b(new CollectionSerializer(paramJSONObject));
      localSpdySocket.b(60000);
      paramJSONObject = new StringBuilder("TrackOrder.");
      paramJSONObject.append(System.currentTimeMillis());
      localSpdySocket.a(paramJSONObject.toString());
      localSpdySocket.get();
    }
  }
}
