package com.jd.lib.unification.album.utils;

import android.app.Activity;
import android.content.ContentResolver;
import android.content.ContentValues;
import android.content.ContextWrapper;
import android.content.Intent;
import android.media.MediaMetadataRetriever;
import android.net.Uri;
import android.provider.MediaStore.Images.Media;
import android.provider.MediaStore.Video.Media;
import android.text.TextUtils;
import com.jd.lib.un.utils.UnStringUtils;
import java.io.Closeable;
import java.io.File;
import java.io.IOException;

public class FileUtil
{
  public static final String VIDEO_COMPRESS_SAVE_DIR = "/cVideo";
  
  public FileUtil() {}
  
  private static void closeQuietly(Closeable paramCloseable)
  {
    if (paramCloseable != null) {
      try
      {
        paramCloseable.close();
        return;
      }
      catch (IOException paramCloseable)
      {
        paramCloseable.printStackTrace();
      }
    }
  }
  
  /* Error */
  private static String copyFile(String paramString, File paramFile)
  {
    // Byte code:
    //   0: getstatic 34	android/os/Environment:DIRECTORY_DCIM	Ljava/lang/String;
    //   3: invokestatic 38	android/os/Environment:getExternalStoragePublicDirectory	(Ljava/lang/String;)Ljava/io/File;
    //   6: astore_3
    //   7: aload_3
    //   8: invokevirtual 44	java/io/File:exists	()Z
    //   11: ifne +8 -> 19
    //   14: aload_3
    //   15: invokevirtual 47	java/io/File:mkdir	()Z
    //   18: pop
    //   19: aload_0
    //   20: invokestatic 53	com/jd/lib/unification/album/utils/PictureMimeType:isVideo	(Ljava/lang/String;)Z
    //   23: ifeq +51 -> 74
    //   26: new 55	java/lang/StringBuilder
    //   29: dup
    //   30: invokespecial 56	java/lang/StringBuilder:<init>	()V
    //   33: astore_0
    //   34: aload_0
    //   35: aload_3
    //   36: invokevirtual 60	java/io/File:getAbsolutePath	()Ljava/lang/String;
    //   39: invokevirtual 64	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   42: pop
    //   43: aload_0
    //   44: ldc 66
    //   46: invokevirtual 64	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   49: pop
    //   50: aload_0
    //   51: invokestatic 72	java/lang/System:currentTimeMillis	()J
    //   54: invokevirtual 75	java/lang/StringBuilder:append	(J)Ljava/lang/StringBuilder;
    //   57: pop
    //   58: aload_0
    //   59: ldc 77
    //   61: invokevirtual 64	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   64: pop
    //   65: aload_0
    //   66: invokevirtual 80	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   69: astore 6
    //   71: goto +48 -> 119
    //   74: new 55	java/lang/StringBuilder
    //   77: dup
    //   78: invokespecial 56	java/lang/StringBuilder:<init>	()V
    //   81: astore_0
    //   82: aload_0
    //   83: aload_3
    //   84: invokevirtual 60	java/io/File:getAbsolutePath	()Ljava/lang/String;
    //   87: invokevirtual 64	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   90: pop
    //   91: aload_0
    //   92: ldc 66
    //   94: invokevirtual 64	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   97: pop
    //   98: aload_0
    //   99: invokestatic 72	java/lang/System:currentTimeMillis	()J
    //   102: invokevirtual 75	java/lang/StringBuilder:append	(J)Ljava/lang/StringBuilder;
    //   105: pop
    //   106: aload_0
    //   107: ldc 82
    //   109: invokevirtual 64	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   112: pop
    //   113: aload_0
    //   114: invokevirtual 80	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   117: astore 6
    //   119: aload 6
    //   121: invokestatic 88	com/jd/lib/un/utils/UnStringUtils:isEmpty	(Ljava/lang/CharSequence;)Z
    //   124: ifeq +6 -> 130
    //   127: ldc 90
    //   129: areturn
    //   130: new 92	java/io/FileInputStream
    //   133: dup
    //   134: aload_1
    //   135: invokespecial 95	java/io/FileInputStream:<init>	(Ljava/io/File;)V
    //   138: astore_0
    //   139: new 97	java/io/FileOutputStream
    //   142: dup
    //   143: aload 6
    //   145: invokespecial 100	java/io/FileOutputStream:<init>	(Ljava/lang/String;)V
    //   148: astore 5
    //   150: sipush 1024
    //   153: newarray byte
    //   155: astore_1
    //   156: aload_0
    //   157: astore_3
    //   158: aload 5
    //   160: astore 4
    //   162: aload_0
    //   163: aload_1
    //   164: invokevirtual 106	java/io/InputStream:read	([B)I
    //   167: istore_2
    //   168: iload_2
    //   169: ifle +20 -> 189
    //   172: aload_0
    //   173: astore_3
    //   174: aload 5
    //   176: astore 4
    //   178: aload 5
    //   180: aload_1
    //   181: iconst_0
    //   182: iload_2
    //   183: invokevirtual 112	java/io/OutputStream:write	([BII)V
    //   186: goto -30 -> 156
    //   189: aload_0
    //   190: astore_3
    //   191: aload 5
    //   193: astore 4
    //   195: aload 5
    //   197: invokevirtual 115	java/io/OutputStream:flush	()V
    //   200: aload_0
    //   201: astore_3
    //   202: aload 5
    //   204: astore 4
    //   206: aload 5
    //   208: invokevirtual 116	java/io/OutputStream:close	()V
    //   211: aload_0
    //   212: astore_3
    //   213: aload 5
    //   215: astore 4
    //   217: aload_0
    //   218: invokevirtual 117	java/io/InputStream:close	()V
    //   221: goto +63 -> 284
    //   224: astore_3
    //   225: aload_0
    //   226: astore_1
    //   227: aload 5
    //   229: astore_0
    //   230: aload_3
    //   231: astore 5
    //   233: goto +36 -> 269
    //   236: astore_1
    //   237: aconst_null
    //   238: astore 4
    //   240: goto +59 -> 299
    //   243: astore 5
    //   245: aconst_null
    //   246: astore_3
    //   247: aload_0
    //   248: astore_1
    //   249: aload_3
    //   250: astore_0
    //   251: goto +18 -> 269
    //   254: astore_1
    //   255: aconst_null
    //   256: astore 4
    //   258: aconst_null
    //   259: astore_0
    //   260: goto +39 -> 299
    //   263: astore 5
    //   265: aconst_null
    //   266: astore_1
    //   267: aconst_null
    //   268: astore_0
    //   269: aload_1
    //   270: astore_3
    //   271: aload_0
    //   272: astore 4
    //   274: aload 5
    //   276: invokevirtual 25	java/io/IOException:printStackTrace	()V
    //   279: aload_0
    //   280: astore 5
    //   282: aload_1
    //   283: astore_0
    //   284: aload_0
    //   285: invokestatic 119	com/jd/lib/unification/album/utils/FileUtil:closeQuietly	(Ljava/io/Closeable;)V
    //   288: aload 5
    //   290: invokestatic 119	com/jd/lib/unification/album/utils/FileUtil:closeQuietly	(Ljava/io/Closeable;)V
    //   293: aload 6
    //   295: areturn
    //   296: astore_1
    //   297: aload_3
    //   298: astore_0
    //   299: aload_0
    //   300: invokestatic 119	com/jd/lib/unification/album/utils/FileUtil:closeQuietly	(Ljava/io/Closeable;)V
    //   303: aload 4
    //   305: invokestatic 119	com/jd/lib/unification/album/utils/FileUtil:closeQuietly	(Ljava/io/Closeable;)V
    //   308: aload_1
    //   309: athrow
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	310	0	paramString	String
    //   0	310	1	paramFile	File
    //   167	16	2	i	int
    //   6	207	3	localObject1	Object
    //   224	7	3	localIOException1	IOException
    //   246	52	3	localFile	File
    //   160	144	4	localObject2	Object
    //   148	84	5	localObject3	Object
    //   243	1	5	localIOException2	IOException
    //   263	12	5	localIOException3	IOException
    //   280	9	5	str1	String
    //   69	225	6	str2	String
    // Exception table:
    //   from	to	target	type
    //   162	168	224	java/io/IOException
    //   178	186	224	java/io/IOException
    //   195	200	224	java/io/IOException
    //   206	211	224	java/io/IOException
    //   217	221	224	java/io/IOException
    //   139	150	236	java/lang/Throwable
    //   139	150	243	java/io/IOException
    //   130	139	254	java/lang/Throwable
    //   130	139	263	java/io/IOException
    //   162	168	296	java/lang/Throwable
    //   178	186	296	java/lang/Throwable
    //   195	200	296	java/lang/Throwable
    //   206	211	296	java/lang/Throwable
    //   217	221	296	java/lang/Throwable
    //   274	279	296	java/lang/Throwable
  }
  
  public static long getVideoDuration(String paramString)
  {
    paramString = new File(paramString);
    if (!paramString.exists()) {
      return -100L;
    }
    MediaMetadataRetriever localMediaMetadataRetriever = new MediaMetadataRetriever();
    localMediaMetadataRetriever.setDataSource(paramString.getAbsolutePath());
    paramString = localMediaMetadataRetriever.extractMetadata(9);
    if (TextUtils.isEmpty(paramString)) {
      return 0L;
    }
    return Long.parseLong(paramString);
  }
  
  public static String saveMediaFile(Activity paramActivity, String paramString1, String paramString2)
  {
    paramString1 = copyFile(paramString2, new File(paramString1));
    if (UnStringUtils.isEmpty(paramString1)) {
      return "";
    }
    Object localObject = new File(paramString1);
    paramString1 = ((File)localObject).getAbsolutePath();
    localObject = Uri.fromFile((File)localObject);
    ContentValues localContentValues = new ContentValues(2);
    if (PictureMimeType.isVideo(paramString2))
    {
      localContentValues.put("mime_type", paramString2);
      localContentValues.put("_data", paramString1);
      paramActivity.getContentResolver().insert(MediaStore.Video.Media.EXTERNAL_CONTENT_URI, localContentValues);
      paramActivity.sendBroadcast(new Intent("android.intent.action.MEDIA_SCANNER_SCAN_FILE", (Uri)localObject));
      return paramString1;
    }
    localContentValues.put("mime_type", paramString2);
    localContentValues.put("_data", paramString1);
    paramActivity.getContentResolver().insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, localContentValues);
    paramActivity.sendBroadcast(new Intent("android.intent.action.MEDIA_SCANNER_SCAN_FILE", (Uri)localObject));
    return paramString1;
  }
}
