package com.jingdong.aura.wrapper;

import android.app.Application;
import android.util.Log;
import com.jingdong.aura.core.asm.i;
import com.jingdong.aura.core.data.d;
import com.jingdong.aura.core.util.rss.Attribute;
import com.jingdong.aura.core.util.rss.StringBuffer;
import com.jingdong.aura.wrapper.menu.Command;
import com.jingdong.aura.wrapper.menu.Util;
import com.jingdong.aura.wrapper.menu.c;
import java.util.Properties;
import org.osgi.framework.BundleException;
import org.osgi.framework.a;

public class AuraInitializer
{
  private static StringBuffer log = Attribute.getInstance("AuraInitializer");
  private Application mApplication;
  private long mInitStartTime;
  private boolean mIsUpdate;
  private String mPackageName;
  private Properties mProperties;
  private boolean mTryInstall;
  
  public AuraInitializer(Application paramApplication, String paramString, boolean paramBoolean)
  {
    mApplication = paramApplication;
    mPackageName = paramString;
    mIsUpdate = Handler.loadPreferences(paramApplication);
    mProperties = new Properties();
    mTryInstall = false;
  }
  
  private void installBundles()
  {
    if (mIsUpdate)
    {
      final com.jingdong.aura.wrapper.menu.f localF = com.jingdong.aura.wrapper.menu.f.a();
      final c localC = c.read();
      localF.b(mApplication);
      localC.a(mApplication);
      Util.onPostExecute(new Command("AuraInstallerTask")
      {
        public void run()
        {
          localF.a(true, false);
          localC.a(true, true);
        }
      });
      return;
    }
    Handler.a(mApplication);
    Handler.init(mApplication);
    Handler.doInBackground(mApplication);
  }
  
  public static void loadBundle(String paramString)
  {
    com.jingdong.aura.core.asm.h.a().b(paramString);
    paramString = com.jingdong.aura.core.asm.http.f.d(paramString);
    if (paramString != null)
    {
      i localI = (i)paramString;
      if (localI != null) {
        localI.c();
      }
      try
      {
        paramString.l();
        return;
      }
      catch (BundleException paramString)
      {
        paramString.printStackTrace();
      }
    }
  }
  
  public static boolean update(String paramString1, String paramString2, int paramInt, String paramString3)
  {
    boolean bool = com.jingdong.aura.core.asm.h.a().a(paramString1, paramString2, paramInt, paramString3);
    if (bool)
    {
      paramString1 = com.jingdong.aura.core.runing.h.a(paramString2, paramString3);
      com.jingdong.aura.core.data.f.get().a(paramString1);
      d.doInBackground();
    }
    return bool;
  }
  
  public void init()
  {
    mInitStartTime = System.currentTimeMillis();
    try
    {
      com.jingdong.aura.core.asm.h.a().a(mApplication);
      StringBuffer localStringBuffer = log;
      localStringBuilder = new StringBuilder();
      localStringBuilder.append("Aura framework inited end ");
      localStringBuilder.append(mPackageName);
      localStringBuilder.append(" ");
      long l1 = System.currentTimeMillis();
      long l2 = mInitStartTime;
      localStringBuilder.append(l1 - l2);
      localStringBuilder.append(" ms");
      localStringBuffer.append(localStringBuilder.toString());
      ClassWriter.create(mApplication);
      return;
    }
    catch (Throwable localThrowable)
    {
      Log.e("AuraInitializer", "Could not init  framework !!!", localThrowable);
      StringBuilder localStringBuilder = new StringBuilder();
      localStringBuilder.append(" initialization fail");
      localStringBuilder.append(localThrowable.getMessage());
      throw new RuntimeException(localStringBuilder.toString());
    }
  }
  
  public void preInstallBundles()
  {
    installBundles();
  }
  
  public void setBundleSecurityVerifier(a paramA)
  {
    com.jingdong.aura.core.asm.h.a().b(paramA);
  }
  
  /* Error */
  public void startUp(String paramString)
  {
    // Byte code:
    //   0: aload_1
    //   1: ifnull +22 -> 23
    //   4: invokestatic 217	com/jingdong/aura/core/asm/f:a	()Z
    //   7: istore_2
    //   8: iload_2
    //   9: ifeq +14 -> 23
    //   12: aload_0
    //   13: getfield 56	com/jingdong/aura/wrapper/AuraInitializer:mProperties	Ljava/util/Properties;
    //   16: ldc -37
    //   18: aload_1
    //   19: invokevirtual 223	java/util/Properties:put	(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
    //   22: pop
    //   23: aload_0
    //   24: getfield 56	com/jingdong/aura/wrapper/AuraInitializer:mProperties	Ljava/util/Properties;
    //   27: ldc -31
    //   29: invokestatic 230	com/jingdong/aura/core/util/File:get	()Ljava/io/File;
    //   32: invokevirtual 235	java/io/File:getParent	()Ljava/lang/String;
    //   35: invokevirtual 223	java/util/Properties:put	(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
    //   38: pop
    //   39: invokestatic 236	com/jingdong/aura/wrapper/Handler:a	()Z
    //   42: istore_2
    //   43: iload_2
    //   44: ifeq +16 -> 60
    //   47: invokestatic 103	com/jingdong/aura/core/asm/h:a	()Lcom/jingdong/aura/core/asm/h;
    //   50: new 238	com/jingdong/aura/wrapper/b
    //   53: dup
    //   54: invokespecial 239	com/jingdong/aura/wrapper/b:<init>	()V
    //   57: invokevirtual 242	com/jingdong/aura/core/asm/h:a	(Lorg/osgi/framework/b;)V
    //   60: aload_0
    //   61: getfield 51	com/jingdong/aura/wrapper/AuraInitializer:mIsUpdate	Z
    //   64: istore_2
    //   65: iload_2
    //   66: ifeq +15 -> 81
    //   69: aload_0
    //   70: getfield 56	com/jingdong/aura/wrapper/AuraInitializer:mProperties	Ljava/util/Properties;
    //   73: ldc -12
    //   75: ldc -10
    //   77: invokevirtual 223	java/util/Properties:put	(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
    //   80: pop
    //   81: aload_0
    //   82: getfield 41	com/jingdong/aura/wrapper/AuraInitializer:mApplication	Landroid/app/Application;
    //   85: aload_0
    //   86: getfield 51	com/jingdong/aura/wrapper/AuraInitializer:mIsUpdate	Z
    //   89: invokestatic 251	com/jingdong/aura/core/data/i:a	(Landroid/content/Context;Z)V
    //   92: getstatic 34	com/jingdong/aura/wrapper/AuraInitializer:log	Lcom/jingdong/aura/core/util/rss/StringBuffer;
    //   95: astore_1
    //   96: new 159	java/lang/StringBuilder
    //   99: dup
    //   100: invokespecial 160	java/lang/StringBuilder:<init>	()V
    //   103: astore 7
    //   105: aload 7
    //   107: ldc -3
    //   109: invokevirtual 166	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   112: pop
    //   113: aload 7
    //   115: aload_0
    //   116: getfield 43	com/jingdong/aura/wrapper/AuraInitializer:mPackageName	Ljava/lang/String;
    //   119: invokevirtual 166	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   122: pop
    //   123: aload 7
    //   125: ldc -88
    //   127: invokevirtual 166	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   130: pop
    //   131: invokestatic 154	java/lang/System:currentTimeMillis	()J
    //   134: lstore_3
    //   135: aload_0
    //   136: getfield 156	com/jingdong/aura/wrapper/AuraInitializer:mInitStartTime	J
    //   139: lstore 5
    //   141: aload 7
    //   143: lload_3
    //   144: lload 5
    //   146: lsub
    //   147: invokevirtual 171	java/lang/StringBuilder:append	(J)Ljava/lang/StringBuilder;
    //   150: pop
    //   151: aload 7
    //   153: ldc -83
    //   155: invokevirtual 166	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   158: pop
    //   159: aload_1
    //   160: aload 7
    //   162: invokevirtual 177	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   165: invokeinterface 181 2 0
    //   170: invokestatic 103	com/jingdong/aura/core/asm/h:a	()Lcom/jingdong/aura/core/asm/h;
    //   173: aload_0
    //   174: getfield 41	com/jingdong/aura/wrapper/AuraInitializer:mApplication	Landroid/app/Application;
    //   177: aload_0
    //   178: getfield 56	com/jingdong/aura/wrapper/AuraInitializer:mProperties	Ljava/util/Properties;
    //   181: invokevirtual 256	com/jingdong/aura/core/asm/h:a	(Landroid/app/Application;Ljava/util/Properties;)V
    //   184: getstatic 34	com/jingdong/aura/wrapper/AuraInitializer:log	Lcom/jingdong/aura/core/util/rss/StringBuffer;
    //   187: astore_1
    //   188: new 159	java/lang/StringBuilder
    //   191: dup
    //   192: invokespecial 160	java/lang/StringBuilder:<init>	()V
    //   195: astore 7
    //   197: aload 7
    //   199: ldc_w 258
    //   202: invokevirtual 166	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   205: pop
    //   206: aload 7
    //   208: aload_0
    //   209: getfield 43	com/jingdong/aura/wrapper/AuraInitializer:mPackageName	Ljava/lang/String;
    //   212: invokevirtual 166	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   215: pop
    //   216: aload 7
    //   218: ldc -88
    //   220: invokevirtual 166	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   223: pop
    //   224: invokestatic 154	java/lang/System:currentTimeMillis	()J
    //   227: lstore_3
    //   228: aload_0
    //   229: getfield 156	com/jingdong/aura/wrapper/AuraInitializer:mInitStartTime	J
    //   232: lstore 5
    //   234: aload 7
    //   236: lload_3
    //   237: lload 5
    //   239: lsub
    //   240: invokevirtual 171	java/lang/StringBuilder:append	(J)Ljava/lang/StringBuilder;
    //   243: pop
    //   244: aload 7
    //   246: ldc -83
    //   248: invokevirtual 166	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   251: pop
    //   252: aload_1
    //   253: aload 7
    //   255: invokevirtual 177	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   258: invokeinterface 181 2 0
    //   263: invokestatic 146	com/jingdong/aura/core/data/d:doInBackground	()V
    //   266: return
    //   267: astore_1
    //   268: ldc 26
    //   270: ldc_w 260
    //   273: aload_1
    //   274: invokestatic 195	android/util/Log:e	(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
    //   277: pop
    //   278: new 202	java/lang/RuntimeException
    //   281: dup
    //   282: aload_1
    //   283: invokespecial 263	java/lang/RuntimeException:<init>	(Ljava/lang/Throwable;)V
    //   286: athrow
    //   287: astore_1
    //   288: new 202	java/lang/RuntimeException
    //   291: dup
    //   292: ldc_w 265
    //   295: aload_1
    //   296: invokespecial 268	java/lang/RuntimeException:<init>	(Ljava/lang/String;Ljava/lang/Throwable;)V
    //   299: athrow
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	300	0	this	AuraInitializer
    //   0	300	1	paramString	String
    //   7	59	2	bool	boolean
    //   134	103	3	l1	long
    //   139	99	5	l2	long
    //   103	151	7	localStringBuilder	StringBuilder
    // Exception table:
    //   from	to	target	type
    //   170	234	267	java/lang/Throwable
    //   234	263	267	java/lang/Throwable
    //   4	8	287	java/lang/Throwable
    //   12	23	287	java/lang/Throwable
    //   23	43	287	java/lang/Throwable
    //   47	60	287	java/lang/Throwable
    //   60	65	287	java/lang/Throwable
    //   69	81	287	java/lang/Throwable
    //   81	141	287	java/lang/Throwable
    //   141	170	287	java/lang/Throwable
    //   263	266	287	java/lang/Throwable
    //   268	287	287	java/lang/Throwable
  }
  
  public static abstract interface a
  {
    public abstract boolean startActivity(String paramString);
  }
}
