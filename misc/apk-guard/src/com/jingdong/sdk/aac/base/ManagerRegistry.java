package com.jingdong.sdk.aac.base;

import android.text.TextUtils;
import androidx.fragment.app.FragmentActivity;
import com.jingdong.sdk.aac.util.LifecycleUtil;
import com.jingdong.sdk.aac.util.SyncEventBus;
import de.greenrobot.event.EventBus;

public class ManagerRegistry
  implements ICommon
{
  private boolean isCreateKey = false;
  private boolean isDestroy = false;
  private boolean isSetActivity = false;
  private EventBus mEventBus;
  private String managerKey;
  
  public ManagerRegistry()
  {
    this("");
  }
  
  public ManagerRegistry(String paramString)
  {
    managerKey = paramString;
    if (TextUtils.isEmpty(paramString))
    {
      managerKey = LifecycleUtil.createKey();
      isCreateKey = true;
    }
  }
  
  public void excuteOnActivity(SafeRunnable paramSafeRunnable)
  {
    if ((!isDestroy) && (paramSafeRunnable != null))
    {
      FragmentActivity localFragmentActivity = getThisActivity();
      if ((localFragmentActivity != null) && (!localFragmentActivity.isFinishing())) {
        paramSafeRunnable.runOnActivity(localFragmentActivity);
      }
    }
  }
  
  public EventBus getEventBus()
  {
    EventBus localEventBus = mEventBus;
    if (localEventBus != null) {
      return localEventBus;
    }
    return EventBus.getDefault();
  }
  
  public String getManagerKey()
  {
    return managerKey;
  }
  
  public FragmentActivity getThisActivity()
  {
    if (!TextUtils.isEmpty(managerKey)) {
      return LifecycleUtil.getInstance().getActivity(managerKey);
    }
    return null;
  }
  
  public void onDestroy()
  {
    isDestroy = true;
    if (isCreateKey) {
      SyncEventBus.destroy(managerKey);
    }
    if (isSetActivity) {
      LifecycleUtil.getInstance().removeActivity(managerKey);
    }
  }
  
  public void register(Object paramObject)
  {
    if (!getEventBus().isRegistered(paramObject)) {
      getEventBus().register(paramObject);
    }
  }
  
  public void setActivity(FragmentActivity paramFragmentActivity)
  {
    if (((isCreateKey) || (LifecycleUtil.getInstance().getActivity(managerKey) == null)) && (paramFragmentActivity != null)) {
      isSetActivity = LifecycleUtil.getInstance().setActivity(getManagerKey(), paramFragmentActivity);
    }
  }
  
  public void setEventBus(EventBus paramEventBus)
  {
    mEventBus = paramEventBus;
  }
  
  public void unregister(Object paramObject)
  {
    getEventBus().unregister(paramObject);
  }
}
