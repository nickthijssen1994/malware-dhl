package com.jingdong.common.utils;

import android.app.Activity;
import android.content.Context;
import android.content.ContextWrapper;
import android.content.res.Resources;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.text.TextUtils;
import com.jingdong.appshare.R.string;
import com.jingdong.common.entity.ShareInfo;
import com.jingdong.sdk.jdtoast.ToastUtils;
import com.jingdong.sdk.oklog.OKLog;
import com.sina.weibo.sdk.api.ImageObject;
import com.sina.weibo.sdk.api.TextObject;
import com.sina.weibo.sdk.api.WebpageObject;
import com.sina.weibo.sdk.api.WeiboMessage;
import com.sina.weibo.sdk.api.WeiboMultiMessage;
import com.sina.weibo.sdk.api.share.IWeiboShareAPI;
import com.sina.weibo.sdk.api.share.SendMessageToWeiboRequest;
import com.sina.weibo.sdk.api.share.SendMultiMessageToWeiboRequest;
import com.sina.weibo.sdk.api.share.WeiboShareSDK;
import com.sina.weibo.sdk.utils.Utility;

public class WeiboUtil
{
  public static String APP_ID;
  private static final String PAGE_KEY = "WeiboUtil";
  public static final int WB_SHARE_SUMMARY_LIMIT = 80;
  public static final int WB_SHARE_TITLE_LIMIT = 60;
  private static IWeiboShareAPI mWBShareApi;
  
  public WeiboUtil() {}
  
  public static boolean check()
  {
    if ((isWBInstalled()) && (isWBSupportShare())) {
      return true;
    }
    ToastUtils.showToastY(JdSdk.getInstance().getApplicationContext(), R.string.weibo_can_not_share);
    return false;
  }
  
  public static void createWBApi(Context paramContext)
  {
    String str = APP_ID;
    try
    {
      paramContext = WeiboShareSDK.createWeiboAPI(paramContext, str, false);
      mWBShareApi = paramContext;
      paramContext = mWBShareApi;
      paramContext.registerApp();
      return;
    }
    catch (Exception paramContext)
    {
      if (OKLog.i)
      {
        OKLog.e("WeiboUtil", "Create weibo API failed.");
        OKLog.setNode("WeiboUtil", paramContext);
      }
    }
  }
  
  public static void doWBShare(Activity paramActivity, ShareInfo paramShareInfo, byte[] paramArrayOfByte)
  {
    if ((paramActivity != null) && (paramShareInfo != null))
    {
      if (paramArrayOfByte == null) {
        return;
      }
      if (paramShareInfo.getTitle().length() > 60)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getTitle().substring(0, 57));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setTitle(((StringBuilder)localObject1).toString());
      }
      if (paramShareInfo.getSummary().length() > 80)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getSummary().substring(0, 77));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setSummary(((StringBuilder)localObject1).toString());
      }
      Object localObject2 = paramShareInfo.getTitle();
      Object localObject1 = localObject2;
      Object localObject3 = new StringBuilder();
      ((StringBuilder)localObject3).append(paramShareInfo.getTransaction());
      ((StringBuilder)localObject3).append("##");
      ((StringBuilder)localObject3).append("Sinaweibo");
      localObject3 = ((StringBuilder)localObject3).toString();
      Bitmap localBitmap = BitmapFactory.decodeByteArray(paramArrayOfByte, 0, paramArrayOfByte.length);
      paramArrayOfByte = new WebpageObject();
      identify = Utility.generateGUID();
      if (!((String)localObject2).contains("@"))
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append((String)localObject2);
        ((StringBuilder)localObject1).append(JdSdk.getInstance().getApplication().getResources().getString(R.string.share_at_jingdong));
        ((StringBuilder)localObject1).append(" ");
        localObject1 = ((StringBuilder)localObject1).toString();
      }
      title = ((String)localObject1);
      actionUrl = ShareUtil.getShareUrl(paramShareInfo.getUrl(), "Sinaweibo");
      defaultText = ((String)localObject1);
      paramArrayOfByte.setThumbImage(localBitmap);
      if (getWBShareApi().getWeiboAppSupportAPI() >= 10351)
      {
        localObject1 = new TextObject();
        text = paramShareInfo.getSummary();
        localObject2 = new ImageObject();
        ((ImageObject)localObject2).setImageObject(localBitmap);
        description = paramShareInfo.getSummary();
        sendMultiMessage(paramActivity, (TextObject)localObject1, (ImageObject)localObject2, paramArrayOfByte, (String)localObject3);
        return;
      }
      localObject2 = new StringBuilder();
      ((StringBuilder)localObject2).append(paramShareInfo.getSummary());
      ((StringBuilder)localObject2).append((String)localObject1);
      description = ((StringBuilder)localObject2).toString();
      sendMessage(paramActivity, paramArrayOfByte, (String)localObject3);
    }
  }
  
  public static IWeiboShareAPI getWBShareApi()
  {
    if (mWBShareApi == null) {
      createWBApi(JdSdk.getInstance().getApplication());
    }
    return mWBShareApi;
  }
  
  public static boolean isWBInstalled()
  {
    return getWBShareApi().isWeiboAppInstalled();
  }
  
  public static boolean isWBSupportShare()
  {
    return getWBShareApi().isWeiboAppSupportAPI();
  }
  
  private static void sendMessage(Activity paramActivity, WebpageObject paramWebpageObject, String paramString)
  {
    WeiboMessage localWeiboMessage = new WeiboMessage();
    mediaObject = paramWebpageObject;
    paramWebpageObject = new SendMessageToWeiboRequest();
    transaction = paramString;
    message = localWeiboMessage;
    getWBShareApi().sendRequest(paramActivity, paramWebpageObject);
  }
  
  private static void sendMultiMessage(Activity paramActivity, TextObject paramTextObject, ImageObject paramImageObject, WebpageObject paramWebpageObject, String paramString)
  {
    WeiboMultiMessage localWeiboMultiMessage = new WeiboMultiMessage();
    textObject = paramTextObject;
    imageObject = paramImageObject;
    mediaObject = paramWebpageObject;
    paramTextObject = new SendMultiMessageToWeiboRequest();
    transaction = paramString;
    multiMessage = localWeiboMultiMessage;
    getWBShareApi().sendRequest(paramActivity, paramTextObject);
  }
  
  public static void setAppId(String paramString)
  {
    if (!TextUtils.isEmpty(paramString)) {
      APP_ID = paramString;
    }
  }
}
