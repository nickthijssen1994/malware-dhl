package com.jingdong.common.utils;

import android.app.Activity;
import android.content.Context;
import android.content.ContextWrapper;
import android.content.pm.PackageManager;
import android.content.pm.PackageManager.NameNotFoundException;
import android.os.BaseBundle;
import android.os.Bundle;
import android.text.TextUtils;
import androidx.fragment.app.Fragment;
import com.jingdong.appshare.R.string;
import com.jingdong.common.entity.ShareInfo;
import com.jingdong.sdk.jdtoast.ToastUtils;
import com.tencent.tauth.IUiListener;
import com.tencent.tauth.Tencent;
import java.util.ArrayList;

public class QQUtil
{
  public static String APP_ID;
  private static final String PAGE_KEY = "QQUtil";
  private static final int QQ_SHARE_SUMMARY_LIMIT = 30;
  private static final int QQ_SHARE_TITLE_LIMIT = 30;
  private static final int QZONE_SHARE_SUMMARY_LIMIT = 600;
  private static final int QZONE_SHARE_TITLE_LIMIT = 200;
  private static Tencent mTencent;
  
  public QQUtil() {}
  
  public static boolean check()
  {
    try
    {
      JdSdk.getInstance().getApplication().getPackageManager().getApplicationInfo("com.tencent.mobileqq", 8192);
      return true;
    }
    catch (PackageManager.NameNotFoundException localNameNotFoundException)
    {
      for (;;) {}
    }
    ToastUtils.showToastY(JdSdk.getInstance().getApplicationContext(), R.string.qq_no_install);
    return false;
  }
  
  private static boolean checkQQInstall()
  {
    try
    {
      JdSdk.getInstance().getApplication().getPackageManager().getApplicationInfo("com.tencent.mobileqq", 8192);
      return true;
    }
    catch (PackageManager.NameNotFoundException localNameNotFoundException)
    {
      for (;;) {}
    }
    ToastUtils.showToastY(JdSdk.getInstance().getApplicationContext(), R.string.share_check_install_qq);
    return false;
  }
  
  private static String getIconUrl(Activity paramActivity, String paramString)
  {
    String str = paramString;
    if (TextUtils.isEmpty(paramString)) {
      str = paramActivity.getString(R.string.share_sdk_default_icon_url);
    }
    return str;
  }
  
  public static Tencent getTencentInstance()
  {
    if (mTencent == null) {
      mTencent = Tencent.createInstance(APP_ID, JdSdk.getInstance().getApplicationContext());
    }
    return mTencent;
  }
  
  private static void hasAlreadyLogin(Activity paramActivity)
  {
    Tencent localTencent = getTencentInstance();
    if (localTencent.isSessionValid()) {
      localTencent.logout(paramActivity);
    }
  }
  
  public static void qqOpenSDKLogin(Activity paramActivity, IUiListener paramIUiListener)
  {
    hasAlreadyLogin(paramActivity);
    try
    {
      getTencentInstance().login(paramActivity, "all", paramIUiListener);
      return;
    }
    catch (Exception paramActivity) {}
  }
  
  public static void qqOpenSDKLogin(Fragment paramFragment, IUiListener paramIUiListener)
  {
    hasAlreadyLogin((Activity)paramFragment.getActivity());
    try
    {
      getTencentInstance().login(paramFragment, "all", paramIUiListener);
      return;
    }
    catch (Exception paramFragment) {}
  }
  
  public static void qqOpenSDKLoginWithToast(Activity paramActivity, IUiListener paramIUiListener)
  {
    if (!checkQQInstall()) {
      return;
    }
    hasAlreadyLogin(paramActivity);
    try
    {
      getTencentInstance().login(paramActivity, "all", paramIUiListener);
      return;
    }
    catch (Exception paramActivity) {}
  }
  
  public static void qqOpenSDKLoginWithToast(Fragment paramFragment, IUiListener paramIUiListener)
  {
    if (!checkQQInstall()) {
      return;
    }
    hasAlreadyLogin((Activity)paramFragment.getActivity());
    try
    {
      getTencentInstance().login(paramFragment, "all", paramIUiListener);
      return;
    }
    catch (Exception paramFragment) {}
  }
  
  public static void setAppId(String paramString)
  {
    if (!TextUtils.isEmpty(paramString)) {
      APP_ID = paramString;
    }
  }
  
  public static void shareToQQ(Activity paramActivity, ShareInfo paramShareInfo, IUiListener paramIUiListener)
  {
    if ((paramActivity != null) && (paramShareInfo != null))
    {
      if (paramIUiListener == null) {
        return;
      }
      if (paramShareInfo.getTitle().length() > 30)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getTitle().substring(0, 27));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setTitle(((StringBuilder)localObject1).toString());
      }
      if (paramShareInfo.getTitleLottery().length() > 30)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getTitleLottery().substring(0, 27));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setTitleLottery(((StringBuilder)localObject1).toString());
      }
      if (paramShareInfo.getSummary().length() > 30)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getSummary().substring(0, 27));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setSummary(((StringBuilder)localObject1).toString());
      }
      if (paramShareInfo.getSummaryLottery().length() > 30)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getSummaryLottery().substring(0, 27));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setSummaryLottery(((StringBuilder)localObject1).toString());
      }
      Object localObject1 = paramShareInfo.getTitle();
      String str = paramShareInfo.getSummary();
      Object localObject3 = paramShareInfo.getCpsUrl();
      Object localObject2 = localObject3;
      Object localObject4;
      if (TextUtils.isEmpty((CharSequence)localObject3))
      {
        localObject4 = ShareUtil.getShareUrl(paramShareInfo.getUrl(), "QQfriends");
        localObject3 = localObject1;
      }
      else
      {
        if (!TextUtils.isEmpty(paramShareInfo.getTitleLottery())) {
          localObject1 = paramShareInfo.getTitleLottery();
        }
        localObject3 = localObject1;
        localObject4 = localObject2;
        if (!TextUtils.isEmpty(paramShareInfo.getSummaryLottery()))
        {
          str = paramShareInfo.getSummaryLottery();
          localObject4 = localObject2;
          localObject3 = localObject1;
        }
      }
      localObject1 = new Bundle();
      ((BaseBundle)localObject1).putInt("req_type", 1);
      ((BaseBundle)localObject1).putInt("cflag", 2);
      ((BaseBundle)localObject1).putString("targetUrl", (String)localObject4);
      ((BaseBundle)localObject1).putString("title", (String)localObject3);
      ((BaseBundle)localObject1).putString("summary", str);
      ((BaseBundle)localObject1).putString("imageUrl", getIconUrl(paramActivity, paramShareInfo.getIconUrl()));
      ((BaseBundle)localObject1).putString("appName", paramActivity.getString(R.string.back_to_jd));
      getTencentInstance().shareToQQ(paramActivity, (Bundle)localObject1, paramIUiListener);
    }
  }
  
  public static void shareToQQ(Activity paramActivity, ShareInfo paramShareInfo, String paramString, IUiListener paramIUiListener)
  {
    if ((paramActivity != null) && (paramShareInfo != null) && (!TextUtils.isEmpty(paramString)))
    {
      if (paramIUiListener == null) {
        return;
      }
      paramShareInfo = new Bundle();
      paramShareInfo.putInt("req_type", 5);
      paramShareInfo.putInt("cflag", 2);
      paramShareInfo.putString("imageLocalUrl", paramString);
      paramShareInfo.putString("appName", paramActivity.getString(R.string.back_to_jd));
      getTencentInstance().shareToQQ(paramActivity, paramShareInfo, paramIUiListener);
    }
  }
  
  public static void shareToQZone(Activity paramActivity, ShareInfo paramShareInfo, IUiListener paramIUiListener)
  {
    if ((paramActivity != null) && (paramShareInfo != null))
    {
      if (paramIUiListener == null) {
        return;
      }
      if (paramShareInfo.getTitle().length() > 200)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getTitle().substring(0, 197));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setTitle(((StringBuilder)localObject1).toString());
      }
      if (paramShareInfo.getTitleLottery().length() > 200)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getTitleLottery().substring(0, 197));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setTitleLottery(((StringBuilder)localObject1).toString());
      }
      if (paramShareInfo.getSummary().length() > 600)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getSummary().substring(0, 597));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setSummary(((StringBuilder)localObject1).toString());
      }
      if (paramShareInfo.getSummaryLottery().length() > 600)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getSummaryLottery().substring(0, 597));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setSummaryLottery(((StringBuilder)localObject1).toString());
      }
      ArrayList localArrayList = new ArrayList();
      localArrayList.add(getIconUrl(paramActivity, paramShareInfo.getIconUrl()));
      Object localObject1 = paramShareInfo.getTitle();
      String str = paramShareInfo.getSummary();
      Object localObject3 = paramShareInfo.getCpsUrl();
      Object localObject2 = localObject3;
      Object localObject4;
      if (TextUtils.isEmpty((CharSequence)localObject3))
      {
        localObject4 = ShareUtil.getShareUrl(paramShareInfo.getUrl(), "QQzone");
        localObject3 = localObject1;
      }
      else
      {
        if (!TextUtils.isEmpty(paramShareInfo.getTitleLottery())) {
          localObject1 = paramShareInfo.getTitleLottery();
        }
        localObject3 = localObject1;
        localObject4 = localObject2;
        if (!TextUtils.isEmpty(paramShareInfo.getSummaryLottery()))
        {
          str = paramShareInfo.getSummaryLottery();
          localObject4 = localObject2;
          localObject3 = localObject1;
        }
      }
      paramShareInfo = new Bundle();
      paramShareInfo.putInt("req_type", 1);
      paramShareInfo.putString("title", (String)localObject3);
      paramShareInfo.putString("summary", str);
      paramShareInfo.putString("targetUrl", (String)localObject4);
      paramShareInfo.putStringArrayList("imageUrl", localArrayList);
      getTencentInstance().shareToQzone(paramActivity, paramShareInfo, paramIUiListener);
    }
  }
}
