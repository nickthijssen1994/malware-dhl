package com.jingdong.common.utils;

import android.content.Context;
import android.graphics.Bitmap;
import android.text.TextUtils;
import com.jingdong.appshare.R.string;
import com.jingdong.common.entity.ShareInfo;
import com.jingdong.sdk.jdtoast.ToastUtils;
import com.jingdong.sdk.oklog.OKLog;
import com.tencent.mm.opensdk.modelmsg.SendAuth.Req;
import com.tencent.mm.opensdk.modelmsg.SendMessageToWX.Req;
import com.tencent.mm.opensdk.modelmsg.WXImageObject;
import com.tencent.mm.opensdk.modelmsg.WXMediaMessage;
import com.tencent.mm.opensdk.modelmsg.WXMediaMessage.IMediaObject;
import com.tencent.mm.opensdk.modelmsg.WXMiniProgramObject;
import com.tencent.mm.opensdk.modelmsg.WXWebpageObject;
import com.tencent.mm.opensdk.openapi.IWXAPI;
import com.tencent.mm.opensdk.openapi.WXAPIFactory;

public class WeixinUtil
{
  public static String APP_ID;
  private static final String PAGE_KEY = "WeixinUtil";
  public static final int WX_SHARE_DESCRIPTION_LIMIT = 1024;
  public static final int WX_SHARE_TITLE_LIMIT = 512;
  private static IWXAPI wxApi;
  
  public WeixinUtil() {}
  
  public static boolean check()
  {
    if (!isWXInstalled())
    {
      ToastUtils.showToastY(JdSdk.getInstance().getApplicationContext(), R.string.share_wx_no_install);
      return false;
    }
    if (!isWXSupportShare())
    {
      ToastUtils.showToastY(JdSdk.getInstance().getApplicationContext(), R.string.share_wx_no_support);
      return false;
    }
    return true;
  }
  
  public static void createAndRegisterWX(Context paramContext, Boolean paramBoolean)
  {
    String str = APP_ID;
    try
    {
      paramContext = WXAPIFactory.createWXAPI(paramContext, str, paramBoolean.booleanValue());
      wxApi = paramContext;
      paramContext = wxApi;
      paramBoolean = APP_ID;
      paramContext.registerApp(paramBoolean);
      return;
    }
    catch (Exception paramContext)
    {
      if (OKLog.i)
      {
        OKLog.e("WeixinUtil", "Create weixin API failed.");
        OKLog.setNode("WeixinUtil", paramContext);
      }
    }
  }
  
  public static void doWXShare(ShareInfo paramShareInfo, boolean paramBoolean, byte[] paramArrayOfByte)
  {
    if (paramShareInfo != null)
    {
      if (paramArrayOfByte == null) {
        return;
      }
      Object localObject1;
      if (paramShareInfo.getTitle().length() > 512)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getTitle().substring(0, 509));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setTitle(((StringBuilder)localObject1).toString());
      }
      if (paramShareInfo.getTitleTimeline().length() > 512)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getTitleTimeline().substring(0, 509));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setTitleTimeline(((StringBuilder)localObject1).toString());
      }
      if (paramShareInfo.getTitleLottery().length() > 512)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getTitleLottery().substring(0, 509));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setTitleLottery(((StringBuilder)localObject1).toString());
      }
      if (paramShareInfo.getSummaryLottery().length() > 1024)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getSummaryLottery().substring(0, 1021));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setSummaryLottery(((StringBuilder)localObject1).toString());
      }
      if (paramShareInfo.getWxcontent().length() > 1024)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getWxcontent().substring(0, 1021));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setWxcontent(((StringBuilder)localObject1).toString());
      }
      if (paramShareInfo.getWxMomentsContent().length() > 1024)
      {
        localObject1 = new StringBuilder();
        ((StringBuilder)localObject1).append(paramShareInfo.getWxMomentsContent().substring(0, 1021));
        ((StringBuilder)localObject1).append("...");
        paramShareInfo.setWxMomentsContent(((StringBuilder)localObject1).toString());
      }
      Object localObject2 = paramShareInfo.getCpsUrl();
      Object localObject5 = localObject2;
      Object localObject4 = paramShareInfo.getTransaction();
      String str2;
      Object localObject3;
      String str3;
      String str1;
      if (paramBoolean)
      {
        localObject1 = paramShareInfo.getTitle();
        str2 = paramShareInfo.getWxcontent();
        localObject3 = new StringBuilder();
        ((StringBuilder)localObject3).append((String)localObject4);
        ((StringBuilder)localObject3).append("##");
        ((StringBuilder)localObject3).append("Wxfriends");
        str3 = ((StringBuilder)localObject3).toString();
        if (TextUtils.isEmpty((CharSequence)localObject2))
        {
          localObject3 = ShareUtil.getShareUrl(paramShareInfo.getUrl(), "Wxfriends");
          str1 = str3;
          localObject2 = str2;
        }
        else
        {
          localObject4 = localObject1;
          if (!TextUtils.isEmpty(paramShareInfo.getTitleLottery())) {
            localObject4 = paramShareInfo.getTitleLottery();
          }
          localObject1 = localObject4;
          localObject3 = localObject5;
          str1 = str3;
          localObject2 = str2;
          if (!TextUtils.isEmpty(paramShareInfo.getSummaryLottery()))
          {
            localObject2 = paramShareInfo.getSummaryLottery();
            localObject1 = localObject4;
            localObject3 = localObject5;
            str1 = str3;
          }
        }
      }
      else
      {
        localObject3 = paramShareInfo.getTitleTimeline();
        localObject1 = localObject3;
        if ((TextUtils.isEmpty((CharSequence)localObject3)) || (((String)localObject3).equalsIgnoreCase("null"))) {
          localObject1 = paramShareInfo.getTitle();
        }
        str2 = paramShareInfo.getWxMomentsContent();
        localObject3 = new StringBuilder();
        ((StringBuilder)localObject3).append((String)localObject4);
        ((StringBuilder)localObject3).append("##");
        ((StringBuilder)localObject3).append("Wxmoments");
        str3 = ((StringBuilder)localObject3).toString();
        if (TextUtils.isEmpty((CharSequence)localObject2))
        {
          localObject3 = ShareUtil.getShareUrl(paramShareInfo.getUrl(), "Wxmoments");
          str1 = str3;
          localObject2 = str2;
        }
        else
        {
          localObject4 = localObject1;
          if (!TextUtils.isEmpty(paramShareInfo.getTitleLottery())) {
            localObject4 = paramShareInfo.getTitleLottery();
          }
          localObject1 = localObject4;
          localObject3 = localObject5;
          str1 = str3;
          localObject2 = str2;
          if (!TextUtils.isEmpty(paramShareInfo.getSummaryLottery()))
          {
            localObject2 = paramShareInfo.getSummaryLottery();
            str1 = str3;
            localObject3 = localObject5;
            localObject1 = localObject4;
          }
        }
      }
      if ((paramBoolean) && (!TextUtils.isEmpty(paramShareInfo.getMpId())))
      {
        localObject4 = new WXMiniProgramObject();
        miniprogramType = paramShareInfo.getMpType();
        webpageUrl = ((String)localObject3);
        userName = paramShareInfo.getMpId();
        path = ShareUtil.getShareUrl(paramShareInfo.getMpPath(), "Wxfriends");
        paramShareInfo = new WXMediaMessage((WXMediaMessage.IMediaObject)localObject4);
      }
      else
      {
        paramShareInfo = new WXWebpageObject();
        webpageUrl = ((String)localObject3);
        paramShareInfo = new WXMediaMessage(paramShareInfo);
      }
      title = ((String)localObject1);
      thumbData = paramArrayOfByte;
      description = ((String)localObject2);
      paramArrayOfByte = new SendMessageToWX.Req();
      transaction = str1;
      message = paramShareInfo;
      scene = (paramBoolean ^ true);
      getWXApi().sendReq(paramArrayOfByte);
    }
  }
  
  public static void doWXShare(ShareInfo paramShareInfo, boolean paramBoolean, byte[] paramArrayOfByte, Bitmap paramBitmap)
  {
    if ((paramShareInfo != null) && (paramArrayOfByte != null))
    {
      if (paramBitmap == null) {
        return;
      }
      WXImageObject localWXImageObject = new WXImageObject(paramBitmap);
      paramBitmap = new WXMediaMessage();
      mediaObject = localWXImageObject;
      title = paramShareInfo.getTitle();
      thumbData = paramArrayOfByte;
      paramArrayOfByte = new SendMessageToWX.Req();
      message = paramBitmap;
      if (paramBoolean)
      {
        paramBitmap = new StringBuilder();
        paramBitmap.append(paramShareInfo.getTransaction());
        paramBitmap.append("##");
        paramBitmap.append("Wxfriends");
        transaction = paramBitmap.toString();
        scene = 0;
      }
      else
      {
        paramBitmap = new StringBuilder();
        paramBitmap.append(paramShareInfo.getTransaction());
        paramBitmap.append("##");
        paramBitmap.append("Wxmoments");
        transaction = paramBitmap.toString();
        scene = 1;
      }
      getWXApi().sendReq(paramArrayOfByte);
    }
  }
  
  public static IWXAPI getWXApi()
  {
    if (wxApi == null) {
      createAndRegisterWX(JdSdk.getInstance().getApplication(), Boolean.valueOf(true));
    }
    return wxApi;
  }
  
  public static boolean isWXInstalled()
  {
    return getWXApi().isWXAppInstalled();
  }
  
  public static boolean isWXSupportShare()
  {
    return true;
  }
  
  public static void setAppId(String paramString)
  {
    if (!TextUtils.isEmpty(paramString)) {
      APP_ID = paramString;
    }
  }
  
  public static void wxLogin(String paramString)
  {
    if (!isWXInstalled())
    {
      if (OKLog.c) {
        OKLog.installApp("JD_Smith", "Wechat not available.");
      }
    }
    else
    {
      if (OKLog.c) {
        OKLog.installApp("JD_Smith", "Wechat is ok.");
      }
      SendAuth.Req localReq = new SendAuth.Req();
      scope = "snsapi_userinfo";
      state = paramString;
      getWXApi().sendReq(localReq);
    }
  }
  
  public static void wxLoginWithToast(String paramString)
  {
    if (!check()) {
      return;
    }
    if (OKLog.c) {
      OKLog.installApp("JD_Smith", "Wechat is ok.");
    }
    SendAuth.Req localReq = new SendAuth.Req();
    scope = "snsapi_userinfo";
    state = paramString;
    getWXApi().sendReq(localReq);
  }
}
