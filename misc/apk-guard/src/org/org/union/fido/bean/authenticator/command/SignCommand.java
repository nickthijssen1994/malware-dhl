package org.org.union.fido.bean.authenticator.command;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;
import org.org.union.fido.util.CommonTools;
import org.org.union.fido.util.StringTools;
import org.org.union.fido.util.Utility;

public class SignCommand
  extends BaseCommand
  implements Serializable
{
  private static final long serialVersionUID = 5524143886070252506L;
  public String appID;
  public byte authenticatorIndex = 0;
  public List<cn.com.union.fido.bean.authenticator.tag.TAG_EXTENSION> extensions;
  public byte[] finalChallenge;
  public List<String> keyHandles;
  public String khAccessToken;
  public String transactionContent;
  public String userName;
  public String verificationToken;
  public short widgetType = 13315;
  
  public SignCommand() {}
  
  public SignCommand(short paramShort)
  {
    super(paramShort);
  }
  
  public void deserialize(byte[] paramArrayOfByte)
  {
    widgetType = ((short)Utility.byteToShort(paramArrayOfByte, 0, 2));
    int j = 4;
    Utility.byteToShort(paramArrayOfByte, 2, 4);
    if (10253 == Utility.byteToShort(paramArrayOfByte, 4, 6))
    {
      authenticatorIndex = paramArrayOfByte[8];
      j = 9;
    }
    int k = j + 2;
    int i = j;
    if (10244 == Utility.byteToShort(paramArrayOfByte, j, k))
    {
      j = k + 2;
      i = Utility.byteToShort(paramArrayOfByte, k, j) + j;
      appID = Utility.byteToStr(paramArrayOfByte, j, i);
    }
    k = i + 2;
    j = i;
    if (11786 == Utility.byteToShort(paramArrayOfByte, i, k))
    {
      i = k + 2;
      j = Utility.byteToShort(paramArrayOfByte, k, i);
      finalChallenge = new byte[j];
      System.arraycopy(paramArrayOfByte, i, finalChallenge, 0, j);
      j = i + j;
    }
    k = j + 2;
    i = j;
    if (10256 == Utility.byteToShort(paramArrayOfByte, j, k))
    {
      j = k + 2;
      i = Utility.byteToShort(paramArrayOfByte, k, j) + j;
      transactionContent = Utility.byteToStr(paramArrayOfByte, j, i);
    }
    k = i + 2;
    j = i;
    if (10245 == Utility.byteToShort(paramArrayOfByte, i, k))
    {
      i = k + 2;
      j = Utility.byteToShort(paramArrayOfByte, k, i) + i;
      khAccessToken = Utility.byteToStr(paramArrayOfByte, i, j);
    }
    k = j + 2;
    i = j;
    if (10243 == Utility.byteToShort(paramArrayOfByte, j, k))
    {
      j = k + 2;
      i = Utility.byteToShort(paramArrayOfByte, k, j) + j;
      verificationToken = Utility.byteToStr(paramArrayOfByte, j, i);
    }
    keyHandles = new ArrayList();
    Object localObject;
    while (10241 == Utility.byteToShort(paramArrayOfByte, i, i + 2))
    {
      i += 2;
      j = i + 2;
      i = Utility.byteToShort(paramArrayOfByte, i, j) + j;
      localObject = Utility.byteToStr(paramArrayOfByte, j, i);
      keyHandles.add(localObject);
    }
    k = i + 2;
    j = i;
    if (10246 == Utility.byteToShort(paramArrayOfByte, i, k))
    {
      i = k + 2;
      j = Utility.byteToShort(paramArrayOfByte, k, i) + i;
      userName = Utility.byteToStr(paramArrayOfByte, i, j);
    }
    extensions = new ArrayList();
    while (15889 == Utility.byteToShort(paramArrayOfByte, j, j + 2))
    {
      j += 2;
      i = j + 2;
      j = Utility.byteToShort(paramArrayOfByte, j, i);
      localObject = new byte[j];
      System.arraycopy(paramArrayOfByte, i, localObject, 0, j);
      org.org.union.fido.bean.authenticator.wiki.TAG_EXTENSION localTAG_EXTENSION = new org.org.union.fido.bean.authenticator.wiki.TAG_EXTENSION();
      localTAG_EXTENSION.deserialize((byte[])localObject);
      extensions.add(localTAG_EXTENSION);
      j += i;
    }
  }
  
  public byte[] serialize()
  {
    byte[] arrayOfByte = new byte['?'];
    Utility.shortToByte(arrayOfByte, 0, 2, widgetType);
    Utility.shortToByte(arrayOfByte, 4, 6, 10253);
    Utility.shortToByte(arrayOfByte, 6, 8, 1);
    arrayOfByte[8] = authenticatorIndex;
    if (StringTools.isValidateString(appID))
    {
      Utility.shortToByte(arrayOfByte, 9, 11, 10244);
      i = appID.getBytes().length;
      Utility.shortToByte(arrayOfByte, 11, 13, i);
      j = i + 13;
      Utility.strToByte(arrayOfByte, 13, j, appID);
    }
    else
    {
      j = 9;
    }
    int i = j;
    if (CommonTools.isValidateByteArray(finalChallenge))
    {
      i = j + 2;
      Utility.shortToByte(arrayOfByte, j, i, 11786);
      j = finalChallenge.length;
      k = i + 2;
      Utility.shortToByte(arrayOfByte, i, k, j);
      System.arraycopy(finalChallenge, 0, arrayOfByte, k, j);
      i = j + k;
    }
    int j = i;
    if (StringTools.isValidateString(transactionContent))
    {
      j = i + 2;
      Utility.shortToByte(arrayOfByte, i, j, 10256);
      k = transactionContent.getBytes().length;
      i = j + 2;
      Utility.shortToByte(arrayOfByte, j, i, k);
      j = k + i;
      Utility.strToByte(arrayOfByte, i, j, transactionContent);
    }
    int k = j;
    if (StringTools.isValidateString(khAccessToken))
    {
      i = j + 2;
      Utility.shortToByte(arrayOfByte, j, i, 10245);
      k = khAccessToken.getBytes().length;
      j = i + 2;
      Utility.shortToByte(arrayOfByte, i, j, k);
      k += j;
      Utility.strToByte(arrayOfByte, j, k, khAccessToken);
    }
    i = k;
    if (StringTools.isValidateString(verificationToken))
    {
      i = k + 2;
      Utility.shortToByte(arrayOfByte, k, i, 10243);
      k = verificationToken.getBytes().length;
      j = i + 2;
      Utility.shortToByte(arrayOfByte, i, j, k);
      i = k + j;
      Utility.strToByte(arrayOfByte, j, i, verificationToken);
    }
    j = i;
    if (CommonTools.isValidateList(keyHandles))
    {
      j = 0;
      while (j < keyHandles.size())
      {
        k = i + 2;
        Utility.shortToByte(arrayOfByte, i, k, 10241);
        localObject = (String)keyHandles.get(j);
        i = ((String)localObject).getBytes().length;
        int m = k + 2;
        Utility.shortToByte(arrayOfByte, k, m, i);
        i = m + i;
        Utility.strToByte(arrayOfByte, m, i, (String)localObject);
        j += 1;
      }
      j = i;
    }
    i = j;
    if (StringTools.isValidateString(userName))
    {
      i = j + 2;
      Utility.shortToByte(arrayOfByte, j, i, 10246);
      k = userName.getBytes().length;
      j = i + 2;
      Utility.shortToByte(arrayOfByte, i, j, k);
      i = k + j;
      Utility.strToByte(arrayOfByte, j, i, userName);
    }
    k = i;
    if (CommonTools.isValidateList(extensions))
    {
      j = 0;
      for (;;)
      {
        k = i;
        if (j >= extensions.size()) {
          break;
        }
        localObject = ((org.org.union.fido.bean.authenticator.wiki.TAG_EXTENSION)extensions.get(j)).serialize();
        System.arraycopy(localObject, 0, arrayOfByte, i, localObject.length);
        i += localObject.length;
        j += 1;
      }
    }
    Utility.shortToByte(arrayOfByte, 2, 4, k - 4);
    Object localObject = new byte[k];
    System.arraycopy(arrayOfByte, 0, localObject, 0, k);
    return localObject;
  }
}
