package org.org.union.fido.helpers;

import android.content.ContentValues;
import android.content.Context;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteOpenHelper;
import org.org.union.fido.helpers.help.SQLiteHelper;

public class SignCounterManager
{
  private SQLiteDatabase db;
  private SQLiteHelper helper;
  
  public SignCounterManager(Context paramContext)
  {
    helper = SQLiteHelper.getInstance(paramContext);
    db = helper.getWritableDatabase();
  }
  
  private void addCounter(Object[] paramArrayOfObject)
  {
    db.beginTransaction();
    try
    {
      SQLiteDatabase localSQLiteDatabase = db;
      StringBuilder localStringBuilder = new StringBuilder("INSERT INTO ");
      helper.getClass();
      localStringBuilder.append("signcounter VALUES(null, ?, ?, ?, ?)");
      localSQLiteDatabase.execSQL(localStringBuilder.toString(), paramArrayOfObject);
      db.setTransactionSuccessful();
      db.endTransaction();
      return;
    }
    catch (Throwable paramArrayOfObject)
    {
      db.endTransaction();
      throw paramArrayOfObject;
    }
  }
  
  private void updateCounter(int paramInt, String[] paramArrayOfString)
  {
    ContentValues localContentValues = new ContentValues();
    localContentValues.put("signCounter", Integer.valueOf(paramInt));
    SQLiteDatabase localSQLiteDatabase = db;
    helper.getClass();
    localSQLiteDatabase.update("signcounter", localContentValues, " aaid = ? and keyID = ? and userName = ? ", paramArrayOfString);
  }
  
  public int updateOrAddCounter(String paramString1, String paramString2, String paramString3)
  {
    Object localObject2 = null;
    Object localObject1 = localObject2;
    for (;;)
    {
      try
      {
        Object localObject3 = db;
        localObject1 = localObject2;
        StringBuilder localStringBuilder = new StringBuilder("SELECT signCounter FROM ");
        localObject1 = localObject2;
        helper.getClass();
        localObject1 = localObject2;
        localStringBuilder.append("signcounter WHERE aaid = ? and keyID = ? and userName = ? ");
        localObject1 = localObject2;
        localObject3 = ((SQLiteDatabase)localObject3).rawQuery(localStringBuilder.toString(), new String[] { paramString1, paramString2, paramString3 });
        localObject2 = localObject3;
        localObject1 = localObject2;
        boolean bool = ((Cursor)localObject3).moveToNext();
        if (bool)
        {
          localObject1 = localObject2;
          i = ((Cursor)localObject3).getInt(0);
          i += 1;
          localObject1 = localObject2;
          updateCounter(i, new String[] { paramString1, paramString2, paramString3 });
        }
        else
        {
          localObject1 = localObject2;
          addCounter(new Object[] { paramString1, paramString2, paramString3, Integer.valueOf(1) });
          i = 1;
        }
        if (localObject3 == null) {
          continue;
        }
        localObject1 = localObject2;
        localObject1.close();
        return i;
      }
      catch (Throwable paramString1)
      {
        int i;
        continue;
      }
      i = -1;
      if (localObject1 == null) {
        break label226;
      }
    }
    return i;
    label226:
    return -1;
  }
}
